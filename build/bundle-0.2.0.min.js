class Z4Setting{static language=Z4Setting.initLanguage();static theme=Z4Setting.initTheme();static mode=Z4Setting.initMode();static initLanguage(){let e=decodeURIComponent(document.cookie).split(";");for(let t=0;t<e.length;t++){let o=e[t].trim();if(o.startsWith("z4language"))return o.substring(11)}return navigator.languages?navigator.languages[0].substring(0,2):navigator.language?navigator.language.substring(0,2):navigator.userLanguage?navigator.userLanguage.substring(0,2):"en"}static initTheme(){Z4Setting.theme="auto";let e=decodeURIComponent(document.cookie).split(";");for(let t=0;t<e.length;t++){let o=e[t].trim();o.startsWith("z4theme")&&(Z4Setting.theme=o.substring(8))}return Z4Setting.setTheme(Z4Setting.theme),Z4Setting.theme}static initMode(){let e=decodeURIComponent(document.cookie).split(";");for(let t=0;t<e.length;t++){let o=e[t].trim();if(o.startsWith("z4mode"))return o.substring(7)}return"standard"}static setLanguage(e){let t=new Date;t.setTime(t.getTime()+31536e6),document.cookie="z4language="+e+";expires="+t.toUTCString()+";path="+Z4Loader.path,Z4Setting.language=e}static getLanguage(){return Z4Setting.language}static setTheme(e){Z4Setting.theme=e;let t=new Date;switch(t.setTime(t.getTime()+31536e6),document.cookie="z4theme="+e+";expires="+t.toUTCString()+";path="+Z4Loader.path,Z4Setting.theme){case"auto":window.matchMedia?Z4Setting.addDarkModeListener():document.body.className="";break;case"light":case"dark":document.body.className="dark"===Z4Setting.theme?"z4-dark":""}}static addDarkModeListener(){if("auto"===Z4Setting.theme){document.body.className=window.matchMedia("(prefers-color-scheme: dark)").matches?"z4dark":"";let e=new Object;e.once=!0,window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(()=>Z4Setting.addDarkModeListener()),e)}}static getTheme(){return Z4Setting.theme}static setMode(e){Z4Setting.mode=e;let t=new Date;t.setTime(t.getTime()+31536e6),document.cookie="z4mode="+e+";expires="+t.toUTCString()+";path="+Z4Loader.path}static getMode(){return Z4Setting.mode}static isLiteMode(){return"lite"===Z4Setting.mode}static isStandardMode(){return"standard"===Z4Setting.mode}static isProMode(){return"pro"===Z4Setting.mode}constructor(){}}class Z4MessageFactory{static MESSAGE=Z4MessageFactory.initMessages();static get(e){return Z4MessageFactory.MESSAGE[e]}static changingLanguage(){Z4MessageFactory.MESSAGE=Z4MessageFactory.initMessages(),document.querySelectorAll("[data-token-lang-inner_text]").forEach((e=>e.innerText=Z4MessageFactory.get(e.getAttribute("data-token-lang-inner_text"))))}static initMessages(){let e=new Array,t=Z4Loader.UP+(Z4Loader.allFiles?"src/message/":"build/message/"),o="message-"+Z4Setting.getLanguage()+".properties",r=new XMLHttpRequest;if(r.open("GET",t+o,!1),r.send(),Z4MessageFactory.readMessages(e,r.responseText),0===Object.keys(e).length){Z4Setting.setLanguage("en"),o="message-en.properties";let r=new XMLHttpRequest;r.open("GET",t+o,!1),r.send(),Z4MessageFactory.readMessages(e,r.responseText)}return e}static readMessages(e,t){new String(t).split("\n").forEach((t=>{if(t&&!t.startsWith("#")){let o=t.split("=");e[o[0].trim()]=o[1].trim()}}))}constructor(){}}class Z4ImageFactory{static IMAGES=Z4ImageFactory.initImages();static get(e){return Z4ImageFactory.IMAGES[e]}static initImages(){let e=new Array,t=Z4Loader.UP+(Z4Loader.allFiles?"src/image/":"build/image/"),o=new XMLHttpRequest;return o.open("GET",Z4Loader.UP+"image_list.properties",!1),o.send(),Z4ImageFactory.readImages(t,e,new String(o.responseText).split("\n")),e}static readImages(e,t,o){o.forEach((r=>{if(r&&!r.startsWith("#")){let i=r.split("="),s=new Image;s.onload=r=>Z4ImageFactory.readImages(e,t,o.slice(1)),s.src=e+i[1].trim(),t[i[0].trim()]=s}}))}constructor(){}}class Z4ComponentUI{html=null;onchange=e=>{};static loadHTML(e){let t=Z4Loader.UP+(Z4Loader.allFiles?"src/":"build/html/"),o=new XMLHttpRequest;return o.open("GET",t+e,!1),o.send(),o.responseText}constructor(e){this.html=document.createElement("div"),this.html.setAttribute("id",(new Date).getTime()+"-"+parseInt(1e3*Math.random())),this.html.innerHTML=e}querySelector(e){return this.html.querySelector(e)}appendTo(e){return e.appendChild(this.html),this}}class Z4ModalMessageUI{static html=Z4ModalMessageUI.loadHTML();static modal=new bootstrap.Modal(Z4ModalMessageUI.html);static loadHTML(){let e=Z4Loader.UP+(Z4Loader.allFiles?"src/":"build/html/"),t=new XMLHttpRequest;t.open("GET",e+"giada/pizzapazza/ui/Z4ModalMessageUI.html",!1),t.send();let o=document.createElement("div");return o.setAttribute("id",(new Date).getTime()+"-"+parseInt(1e3*Math.random())),o.setAttribute("data-bs-backdrop","static"),o.setAttribute("data-bs-keyboard","false"),o.setAttribute("tabindex","-1"),o.setAttribute("style","display:none"),o.className="modal modal-dialog-centered fade",o.innerHTML=t.responseText,document.body.appendChild(o),o}static showInfo(e,t,o){Z4ModalMessageUI.showOneButton(e,t,o,"bi bi-info-circle-fill","#0dcaf0")}static showWarning(e,t,o){Z4ModalMessageUI.showOneButton(e,t,o,"bi bi-exclamation-triangle-fill","#ffc107")}static showError(e,t,o){Z4ModalMessageUI.showOneButton(e,t,o,"bi bi-exclamation-octagon-fill","#dc3545")}static showOneButton(e,t,o,r,i){Z4ModalMessageUI.html.querySelector(".modal-title").innerText=e,Z4ModalMessageUI.html.querySelector(".modal-message").innerText=t;let s=Z4ModalMessageUI.html.querySelector(".modal-icon i");s.className=r,s.style.color=i;let a=Z4ModalMessageUI.html.querySelector(".modal-footer");a.innerHTML="",Z4ModalMessageUI.appendButton(Z4MessageFactory.get("OK"),"btn btn-primary",o,a),Z4ModalMessageUI.modal.show()}static showQuestion(e,t,o,r,i,s){Z4ModalMessageUI.html.querySelector(".modal-title").innerText=e,Z4ModalMessageUI.html.querySelector(".modal-message").innerText=t;let a=Z4ModalMessageUI.html.querySelector(".modal-icon i");a.className="bi bi-question-circle-fill",a.style.color="#6c757d";let n=Z4ModalMessageUI.html.querySelector(".modal-footer");n.innerHTML="",o&&Z4ModalMessageUI.appendButton(Z4MessageFactory.get("YES"),"btn btn-primary",o,n),r&&Z4ModalMessageUI.appendButton(Z4MessageFactory.get("NO"),"btn btn-secondary",r,n),i&&Z4ModalMessageUI.appendButton(Z4MessageFactory.get("OK"),"btn btn-primary",i,n),s&&Z4ModalMessageUI.appendButton(Z4MessageFactory.get("CANCEL"),"btn btn-secondary",s,n),Z4ModalMessageUI.modal.show()}static appendButton(e,t,o,r){let i=document.createElement("button");i.setAttribute("type","button"),i.setAttribute("data-bs-dismiss","modal"),i.className=t,i.innerText=e,i.onclick=e=>(o(),null),r.appendChild(i)}constructor(){}}class Z4Math{static TWO_PI=2*Math.PI;static HALF_PI=Math.PI/2;static GOLD_SECTION=(1+Math.sqrt(5))/2;static SQUARE_GOLD_SECTION=Z4Math.GOLD_SECTION*Z4Math.GOLD_SECTION;static RAD2DEG=180/Math.PI;static DEG2RAD=Math.PI/180;static rad2deg(e){return e*Z4Math.RAD2DEG}static deg2rad(e){return e*Z4Math.DEG2RAD}static distance(e,t,o,r){let i=e-o,s=t-r;return Math.sqrt(i*i+s*s)}static atan(e,t,o,r){let i=Math.atan2(r-t,o-e);return i<0?i+Z4Math.TWO_PI:i}static ripple(e,t,o,r){let i=(o-t)*r*Math.random();return(e+=Math.random()>.5?i:-i)<t?t:e>o?o:e}constructor(){}}class Z4Sign{static POSITIVE=new Z4Sign(1);static NEGATIVE=new Z4Sign(-1);static RANDOM=new Z4Sign(0);sign=0;constructor(e){this.sign=e}next(){switch(this.sign){case 1:case-1:return this.sign;case 0:default:return Math.random()>.5?1:-1;case 2:case-2:return this.sign*=-1,this.sign/2}}static alternate(){return new Z4Sign(-2)}}class Z4RandomValue{value=0;type=0;length=0;step=0;prevRandom=0;controlRandom=0;nextRandom=0;bezierCurve=null;constructor(e,t,o){this.value=e,this.type=t,this.length=o,this.step=0,this.prevRandom=Math.random(),this.controlRandom=1,this.nextRandom=Math.random(),1===this.type&&this.createBezierCurve()}createBezierCurve(){this.bezierCurve=new Bezier(0,this.prevRandom,this.length/2,this.controlRandom,1,this.nextRandom)}next(){switch(this.type){case 0:default:return value*Math.random();case 1:return this.step===this.length?(this.step=0,this.prevRandom=this.nextRandom,this.controlRandom=1===this.controlRandom?0:1,this.nextRandom=Math.random(),this.createBezierCurve()):this.step++,value*this.bezierCurve.get(this.step/this.length).y;case 2:return this.step===this.length?(this.step=0,this.prevRandom=this.nextRandom,this.nextRandom=Math.random()):this.step++,value*((this.nextRandom-this.prevRandom)*this.step/this.length+this.prevRandom);case 3:return this.step===this.length?(this.step=0,this.prevRandom=Math.random()):this.step++,value*this.prevRandom}}static classic(e){return new Z4RandomValue(e,0,0)}static bezier(e,t){return new Z4RandomValue(e,1,t)}static polyline(e,t){return new Z4RandomValue(e,2,t)}static stepped(e,t){return new Z4RandomValue(e,3,t)}}class Z4FancifulValue{constantSign=Z4Sign.RANDOM;constantValue=0;randomSign=Z4Sign.RANDOM;randomValue=Z4RandomValue.classic(0);proportionalSign=Z4Sign.RANDOM;proportionalValue=0;uniformSign=!1;setConstant(e,t){return this.constantSign=e,this.constantValue=t,this}setRandom(e,t){return this.randomSign=e,this.randomValue=t,this}setProportional(e,t){return this.proportionalSign=e,this.proportionalValue=t,this}setUniformSign(e){return this.uniformSign=e,this}next(e){return Z4Setting.isLiteMode()?this.constantSign.next()*this.constantValue:Z4Setting.isStandardMode()?this.uniformSign?this.constantSign.next()*(this.constantValue+this.randomValue.next()):this.constantSign.next()*this.constantValue+this.randomSign.next()*this.randomValue.next():Z4Setting.isProMode()?this.uniformSign?this.constantSign.next()*(this.constantValue+this.randomValue.next()+e*this.proportionalValue):this.constantSign.next()*this.constantValue+this.randomSign.next()*this.randomValue.next()+this.proportionalSign.next()*e*this.proportionalValue:0}}class Z4Lighting{static NONE=new Z4Lighting;static LIGTHED=new Z4Lighting;static DARKENED=new Z4Lighting;constructor(){}}class Z4Progression{static SPATIAL=new Z4Progression;static TEMPORAL=new Z4Progression;static RELATIVE_TO_PATH=new Z4Progression;static RANDOM=new Z4Progression;constructor(){}}class Z4AbstractColor{a=0;r=0;g=0;b=0;argb=0;hex=null;constructor(e,t,o,r){this.a=e,this.r=t,this.g=o,this.b=r,this.init()}init(){return this.argb=this.a<<24|this.r<<16|this.g<<8|this.b,this.hex="#"+new Number(this.r).toString(16).padStart(2,"0")+new Number(this.g).toString(16).padStart(2,"0")+new Number(this.b).toString(16).padStart(2,"0")+new Number(this.a).toString(16).padStart(2,"0"),this}getComponents(){let e=new Array;return e.push(this.a,this.r,this.g,this.b),e}getARGB(){return this.argb}getHEX(){return this.hex}set(e){return this.a=e>>>24&255,this.r=e>>>16&255,this.g=e>>>8&255,this.b=255&e,this.init()}gray(){let e=parseInt(.21*this.r+.71*this.g+.08*this.b);return this.r=e,this.g=e,this.b=e,this.init()}negative(){return this.r=255-this.r,this.g=255-this.g,this.b=255-this.b,this.init()}lighted(e){return this.r=parseInt((255-this.r)*e+this.r),this.g=parseInt((255-this.g)*e+this.g),this.b=parseInt((255-this.b)*e+this.b),this.init()}darkened(e){return e=1-e,this.r=parseInt(e*this.r),this.g=parseInt(e*this.g),this.b=parseInt(e*this.b),this.init()}}class Z4Color extends Z4AbstractColor{constructor(e,t,o,r){super(e,t,o,r)}static fromARGB(e){return new Z4Color(e>>>24&255,e>>>16&255,e>>>8&255,255&e)}static fromHEX(e,t){let o=new RegExp("^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$","i").exec(e);return new Z4Color(t,parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16))}static fromZ4AbstractColor(e){return Z4Color.fromARGB(e.getARGB())}static fromZ4AbstractColors(e,t,o){let r=e.getComponents(),i=t.getComponents();return new Z4Color(parseInt((i[0]-r[0])*o+r[0]),parseInt((i[1]-r[1])*o+r[1]),parseInt((i[2]-r[2])*o+r[2]),parseInt((i[3]-r[3])*o+r[3]))}}class Z4StopColor extends Z4AbstractColor{position=0;constructor(e,t,o,r,i){super(e,t,o,r),this.position=i}getPosition(){return this.position}setPosition(e){return this.position=e,this}static fromARGB(e,t){return new Z4StopColor(e>>>24&255,e>>>16&255,e>>>8&255,255&e,t)}static fromHEX(e,t,o){let r=new RegExp("^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$","i").exec(e);return new Z4StopColor(t,parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16),o)}static fromZ4AbstractColor(e,t){return Z4StopColor.fromARGB(e.getARGB(),t)}}class Z4AbstractGradientColor{z4StopColors=new Array;ripple=0;mirrored=!1;constructor(){this.z4StopColors.push(new Z4StopColor(255,255,255,255,0)),this.z4StopColors.push(new Z4StopColor(255,0,0,0,1))}getComponents(){return this.z4StopColors}addOrUpdateColor(e,t){let o=this.z4StopColors.find(((t,o,r)=>t.getPosition()===e));return o?o.set(t):this.z4StopColors.push(Z4StopColor.fromARGB(t,e)),this}generateColor(e){return this.addOrUpdateColor(e,this.getZ4ColorAt(e,!1,!1).getARGB())}removeColor(e){return this.z4StopColors=this.z4StopColors.filter(((t,o,r)=>t.getPosition()!==e)),this}move(e,t){let o=this.z4StopColors.find(((t,o,r)=>t.getPosition()===e));return o&&0!==e&&1!==e&&0!==t&&1!==t&&o.setPosition(t),this}setRipple(e){return this.ripple=e,this}getRipple(){return this.ripple}setMirrored(e){return this.mirrored=e,this}isMirrored(){return this.mirrored}negative(){return this.z4StopColors.forEach((e=>e.negative())),this}inverted(){return this.z4StopColors.forEach((e=>e.setPosition(1-e.getPosition()))),this}getZ4ColorAt(e,t,o){if(Z4Setting.isLiteMode())return this.z4StopColors.find(((e,t,o)=>1===e.getPosition()));if(Z4Setting.isStandardMode()||Z4Setting.isProMode()){o&&this.mirrored&&(e=2*(e<.5?e:1-e)),t&&0!==this.ripple&&(e=Z4Math.ripple(e,0,1,this.ripple));let r=e,i=this.z4StopColors.filter(((e,t,o)=>1===r?e.getPosition()<r:e.getPosition()<=r)).reduce(((e,t,o,r)=>e&&e.getPosition()>t.getPosition()?e:t)),s=this.z4StopColors.filter(((e,t,o)=>0===r?e.getPosition()>r:e.getPosition()>=r)).reduce(((e,t,o,r)=>e&&e.getPosition()<t.getPosition()?e:t));if(i===s)return i;{let t=(e-i.getPosition())/(s.getPosition()-i.getPosition());return Z4Color.fromZ4AbstractColors(i,s,t)}}return null}getLinearGradient(e,t,o,r,i){let s=e.createLinearGradient(t,o,r,i);return this.z4StopColors.forEach(((e,t,o)=>s.addColorStop(e.getPosition(),e.getHEX()))),s}getRadialGradient(e,t,o,r,i,s,a){let n=e.createRadialGradient(t,o,r,i,s,a);return this.z4StopColors.forEach(((e,t,o)=>n.addColorStop(e.getPosition(),e.getHEX()))),n}getConicGradient(e,t,o,r){let i=e.createConicGradient(r,t,o);return this.z4StopColors.forEach(((e,t,o)=>i.addColorStop(e.getPosition(),e.getHEX()))),i}}class Z4GradientColor extends Z4AbstractGradientColor{constructor(){super()}static fromZ4AbstractGradientColor(e){let t=new Z4GradientColor;return e.getComponents().forEach((e=>t.addOrUpdateColor(e.getPosition(),e.getARGB()))),t}static fromZ4AbstractGradientColors(e,t,o){let r=new Z4GradientColor;return e.getComponents().forEach((e=>{let i=t.getZ4ColorAt(e.getPosition(),!1,!1),s=Z4Color.fromZ4AbstractColors(e,i,o);r.addOrUpdateColor(e.getPosition(),s.getARGB())})),r.setRipple(e.getRipple()).setMirrored(e.isMirrored())}}class Z4StopGradientColor extends Z4AbstractGradientColor{position=0;constructor(e){super(),this.position=e}getPosition(){return this.position}setPosition(e){return this.position=e,this}static fromZ4AbstractGradientColor(e,t){let o=new Z4StopGradientColor(t);return e.getComponents().forEach((e=>o.addOrUpdateColor(e.getPosition(),e.getARGB()))),o}}class Z4TemporalColor{z4StopGradientColors=new Array;ripple=0;mirrored=!1;constructor(){this.z4StopGradientColors.push(new Z4StopGradientColor(0)),this.z4StopGradientColors.push(new Z4StopGradientColor(1))}addOrUpdateColor(e,t,o){if(!this.z4StopGradientColors.find(((t,o,r)=>t.getPosition()===e))){let t=this.getZ4GradientColorAt(e,!1,!1);this.z4StopGradientColors.push(Z4StopGradientColor.fromZ4AbstractGradientColor(t,e))}return this.z4StopGradientColors.forEach((r=>{if(r.getPosition()!==e){r.getComponents().find(((e,o,r)=>e.getPosition()===t))||r.generateColor(t)}else r.addOrUpdateColor(t,o)})),this}generateColor(e,t){return-1!==e?this.addOrUpdateColor(e,t,this.getZ4ColorAt(e,t,!1,!1).getARGB()):(-1!==t&&this.z4StopGradientColors.forEach((e=>e.generateColor(t))),this)}removeColor(e,t){return this.z4StopGradientColors=this.z4StopGradientColors.filter(((t,o,r)=>t.getPosition()!==e)),this.z4StopGradientColors.forEach((e=>e.removeColor(t))),this}move(e,t,o,r){let i=this.z4StopGradientColors.find(((t,o,r)=>t.getPosition()===e));return i&&0!==e&&1!==e&&0!==t&&1!==t&&i.setPosition(t),this.z4StopGradientColors.forEach((e=>e.move(o,r))),this}setRipple(e,t){return this.ripple=e,this.z4StopGradientColors.forEach((e=>e.setRipple(t))),this}setMirrored(e,t){return this.mirrored=e,this.z4StopGradientColors.forEach((e=>e.setMirrored(t))),this}negative(){return this.z4StopGradientColors.forEach((e=>e.negative())),this}inverted(e,t){return e&&this.z4StopGradientColors.forEach((e=>e.setPosition(1-e.getPosition()))),t&&this.z4StopGradientColors.forEach((e=>e.inverted())),this}getZ4GradientColorAt(e,t,o){if(Z4Setting.isLiteMode()||Z4Setting.isStandardMode())return this.z4StopGradientColors.find(((e,t,o)=>0===e.getPosition()));if(Z4Setting.isProMode()){o&&this.mirrored&&(e=2*(e<.5?e:1-e)),t&&0!==this.ripple&&(e=Z4Math.ripple(e,0,1,this.ripple));let r=e,i=this.z4StopGradientColors.filter(((e,t,o)=>1===r?e.getPosition()<r:e.getPosition()<=r)).reduce(((e,t,o,r)=>e&&e.getPosition()>t.getPosition()?e:t)),s=this.z4StopGradientColors.filter(((e,t,o)=>0===r?e.getPosition()>r:e.getPosition()>=r)).reduce(((e,t,o,r)=>e&&e.getPosition()<t.getPosition()?e:t));if(i===s)return i;{let e=(r-i.getPosition())/(s.getPosition()-i.getPosition());return Z4GradientColor.fromZ4AbstractGradientColors(i,s,e)}}return null}getZ4ColorAt(e,t,o,r){return Z4Setting.isLiteMode()?this.getZ4GradientColorAt(0,!1,!1).getZ4ColorAt(1,!1,!1):Z4Setting.isStandardMode()?this.getZ4GradientColorAt(0,!1,!1).getZ4ColorAt(t,o,r):Z4Setting.isProMode()?this.getZ4GradientColorAt(e,o,r).getZ4ColorAt(t,o,r):null}}class Z4ColorUI extends Z4ComponentUI{colorLabel=this.querySelector(".color-label");color=this.querySelector(".form-control-color");formRangeLabel=this.querySelector(".form-range-label");formRange=this.querySelector(".form-range");static UI=Z4ComponentUI.loadHTML("giada/pizzapazza/color/ui/Z4ColorUI.html");constructor(){super(Z4ColorUI.UI),this.colorLabel.innerText=Z4MessageFactory.get("COLOR");let e=this.querySelector(".gray");e.innerText=Z4MessageFactory.get("GRAY"),e.onclick=e=>(this.setZ4Color(this.getZ4Color().gray()),this.onchange(this.getZ4Color()),null);let t=this.querySelector(".negative");t.innerText=Z4MessageFactory.get("NEGATIVE"),t.onclick=e=>(this.setZ4Color(this.getZ4Color().negative()),this.onchange(this.getZ4Color()),null),this.querySelector(".opacity-color-label").innerText=Z4MessageFactory.get("OPACITY");let o=e=>(this.onchange(this.getZ4Color()),null);this.color.oninput=o,this.color.onchange=o,this.formRange.oninput=e=>(this.formRangeLabel.innerText=this.formRange.value,this.onchange(this.getZ4Color()),null)}setColorLabel(e){return this.colorLabel.setAttribute("data-token-lang",e),this.colorLabel.innerText=Z4MessageFactory.get(e),this}setZ4Color(e){return this.color.value=e.getHEX().substring(0,7),this.formRange.valueAsNumber=e.getComponents()[0],this.formRangeLabel.innerText=this.formRange.value,this}getZ4Color(){return Z4Color.fromHEX(this.color.value,this.formRange.valueAsNumber)}}class Z4GradientColorUI extends Z4ComponentUI{gradientColorLabel=this.querySelector(".gradient-color-label");canvas=this.querySelector(".canvas");ctx=this.canvas.getContext("2d");chessboard=this.ctx.createPattern(Z4ImageFactory.get("CHESSBOARD"),"repeat");sliders=this.querySelector(".sliders");formRangeLabel=this.querySelector(".form-range-label");mirroredCheck=this.querySelector(".mirrored-check");formRange=this.querySelector(".form-range");del=document.createElement("button");z4ColorUI=new Z4ColorUI;key=(new Date).getTime()+"-"+parseInt(1e3*Math.random());gradientColor=new Z4GradientColor;devicePixelRatioListener=null;mouseDown=!1;static UI=Z4ComponentUI.loadHTML("giada/pizzapazza/color/ui/Z4GradientColorUI.html");static WIDTH=500;static HEIGHT=50;constructor(){super(Z4GradientColorUI.UI),this.initDevicePixelRatio(),this.gradientColorLabel.innerText=Z4MessageFactory.get("GRADIENT_COLOR");let e=this.querySelector(".gradient-inverted");e.innerText=Z4MessageFactory.get("INVERTED"),e.onclick=e=>(this.setZ4GradientColor(this.gradientColor.inverted()),this.onchange(this.gradientColor),null);let t=this.querySelector(".gradient-negative");t.innerText=Z4MessageFactory.get("NEGATIVE"),t.onclick=e=>(this.setZ4GradientColor(this.gradientColor.negative()),this.onchange(this.gradientColor),null);let o=this.querySelector(".gradient-guided-tour");o.innerText=Z4MessageFactory.get("GUIDED_TOUR"),o.onclick=e=>(Z4GradientColorGuidedTourUI.show(),null),this.canvas.style.border="1px dashed gray",this.canvas.style.width=Z4GradientColorUI.WIDTH+"px",this.canvas.style.height=Z4GradientColorUI.HEIGHT+"px",this.sliders.onmousemove=e=>{let t=e.clientX-this.sliders.getBoundingClientRect().left,o=Z4GradientColorUI.WIDTH/(this.gradientColor.isMirrored()?2:1);return this.sliders.style.cursor=t<o?"pointer":"default",null},Z4Loader.touch?this.sliders.ontouchstart=e=>(this.addColor(e.changedTouches[0].clientX),null):this.sliders.onmousedown=e=>(this.addColor(e.clientX),null),this.querySelector(".ripple-color-label").innerText=Z4MessageFactory.get("RIPPLE"),this.querySelector(".mirrored-label").innerText=Z4MessageFactory.get("MIRRORED"),this.mirroredCheck.onchange=e=>(this.gradientColor.setMirrored(this.mirroredCheck.checked),this.configureSliders(-1),this.drawCanvas(),this.onchange(this.gradientColor),null),this.formRange.oninput=e=>(this.formRangeLabel.innerText=this.formRange.value,this.gradientColor.setRipple(this.formRange.valueAsNumber),this.drawCanvas(),this.onchange(this.gradientColor),null),this.z4ColorUI.appendTo(this.querySelector(".canvas-container")),this.z4ColorUI.onchange=e=>{let t=this.querySelector(".sliders .form-check-input:checked");this.gradientColor.addOrUpdateColor(parseFloat(t.value),e.getARGB()),this.drawCanvas(),this.onchange(this.gradientColor)},this.del.setAttribute("class","dropdown-item delete-color"),this.del.setAttribute("type","button"),this.del.setAttribute("data-token-lang-inner_text","DELETE"),this.del.innerText=Z4MessageFactory.get("DELETE"),this.del.onclick=e=>(Z4ModalMessageUI.showQuestion(Z4MessageFactory.get("TITLE"),Z4MessageFactory.get("DELETE_COLOR_MESSAGE"),(()=>{let e=this.querySelector(".sliders .form-check-input:checked");this.gradientColor.removeColor(parseFloat(e.value)),this.configureSliders(-1),this.drawCanvas(),this.onchange(this.gradientColor)}),(()=>{}),null,null),null),this.querySelector(".negative").parentElement.appendChild(document.createElement("li")).appendChild(this.del),this.setZ4GradientColor(this.gradientColor)}initDevicePixelRatio(){window.matchMedia&&(this.devicePixelRatioListener=()=>{this.drawCanvas(),this.addDevicePixelRatioListener()},this.addDevicePixelRatioListener())}addDevicePixelRatioListener(){let e=new Object;e.once=!0,window.matchMedia("(resolution: "+window.devicePixelRatio+"dppx)").addEventListener("change",this.devicePixelRatioListener,e)}addColor(e){e-=this.sliders.getBoundingClientRect().left+8;let t=Z4GradientColorUI.WIDTH/(this.gradientColor.isMirrored()?2:1);if(e<t){let o=e/t;this.gradientColor.getComponents().every(((e,t,r)=>Math.abs(o-e.getPosition())>.05))&&(this.gradientColor.generateColor(o),this.configureSliders(this.gradientColor.getComponents().length-1),this.drawCanvas(),this.onchange(this.gradientColor))}}setGradientColorLabel(e){return this.gradientColorLabel.setAttribute("data-token-lang",e),this.gradientColorLabel.innerText=Z4MessageFactory.get(e),this}setColorLabel(e){return this.z4ColorUI.setColorLabel(e),this}getZ4GradientColor(){return this.gradientColor}setZ4GradientColor(e){return this.gradientColor=e,this.mirroredCheck.checked=this.gradientColor.isMirrored(),this.formRange.valueAsNumber=this.gradientColor.getRipple(),this.configureSliders(-1),this.drawCanvas(),this}configureSliders(e){let t=Z4GradientColorUI.WIDTH/(this.gradientColor.isMirrored()?2:1);this.sliders.innerHTML="",this.gradientColor.getComponents().forEach(((o,r,i)=>{let s=o.getPosition(),a=t*s-16*r,n=document.createElement("input");n.setAttribute("class","form-check-input"),n.setAttribute("type","radio"),n.setAttribute("name","colors_"+this.key),n.setAttribute("value",""+s),n.setAttribute("style",(0!==r&&1!==r?"cursor:ew-resize;":"")+"position:relative;left:"+a+"px"),n.onchange=e=>(this.z4ColorUI.setZ4Color(this.gradientColor.getComponents().find(((e,t,o)=>r===t))),0===r||1===r?this.del.setAttribute("disabled",""):this.del.removeAttribute("disabled"),null),Z4Loader.touch?(n.ontouchstart=e=>this.manageEvent(e,!0,!1,r,n,e.changedTouches[0].clientX),n.ontouchmove=e=>this.manageEvent(e,this.mouseDown,!0,r,n,e.changedTouches[0].clientX),n.ontouchend=e=>this.manageEvent(e,!1,!1,r,n,e.changedTouches[0].clientX),n.ontouchcancel=e=>this.manageEvent(e,!1,!1,r,n,e.changedTouches[0].clientX)):(n.onmousedown=e=>this.manageEvent(e,!0,!1,r,n,e.clientX),n.onmousemove=e=>this.manageEvent(e,this.mouseDown,!0,r,n,e.clientX),n.onmouseup=e=>this.manageEvent(e,!1,!1,r,n,e.clientX),n.onmouseleave=e=>this.manageEvent(e,!1,!1,r,n,e.clientX)),-1!==e&&r===e?(n.setAttribute("checked",""),this.z4ColorUI.setZ4Color(o),this.del.removeAttribute("disabled")):-1===e&&0===r&&(n.setAttribute("checked",""),this.z4ColorUI.setZ4Color(o),this.del.setAttribute("disabled","")),this.sliders.appendChild(n)}))}manageEvent(e,t,o,r,i,s){return e.stopPropagation(),this.mouseDown=t,o&&this.mouseDown&&0!==r&&1!==r&&this.moveColor(i,r,s),null}moveColor(e,t,o){o-=this.sliders.getBoundingClientRect().left+8;let r=Z4GradientColorUI.WIDTH/(this.gradientColor.isMirrored()?2:1);if(o<r){let i=o/r,s=r*i-16*t;if(this.gradientColor.getComponents().every(((e,o,r)=>o===t||Math.abs(i-e.getPosition())>.05))){let t=parseFloat(e.value);e.setAttribute("value",""+i),e.setAttribute("style","cursor:ew-resize;position:relative;left:"+s+"px"),this.gradientColor.move(t,i),this.drawCanvas(),this.onchange(this.gradientColor)}}}drawCanvas(){this.canvas.width=Math.floor(Z4GradientColorUI.WIDTH*window.devicePixelRatio),this.canvas.height=Math.floor(Z4GradientColorUI.HEIGHT*window.devicePixelRatio);let e=new OffscreenCanvas(Z4GradientColorUI.WIDTH,Z4GradientColorUI.HEIGHT),t=e.getContext("2d");for(let e=0;e<Z4GradientColorUI.WIDTH;e++)t.fillStyle=this.gradientColor.getZ4ColorAt(e/Z4GradientColorUI.WIDTH,!0,!0).getHEX(),t.fillRect(e,0,1,Z4GradientColorUI.HEIGHT);this.ctx.save(),this.ctx.scale(window.devicePixelRatio,window.devicePixelRatio),this.ctx.fillStyle=this.chessboard,this.ctx.fillRect(0,0,Z4GradientColorUI.WIDTH,Z4GradientColorUI.HEIGHT),this.ctx.drawImage(e,0,0),this.ctx.restore()}}class Z4GradientColorGuidedTourUI extends Z4GradientColorUI{options=new Object;element1=null;element2=null;event=null;message=null;constructor(){super(),this.querySelector(".dropdown-divider").remove(),this.querySelector(".gradient-guided-tour").remove(),this.options.once=!0,this.doStep(0)}static show(){Z4ModalMessageUI.showInfo(Z4MessageFactory.get("TITLE"),"",(()=>{document.querySelector(".modal-dialog").classList.remove("modal-lg"),document.querySelector(".modal-message").innerHTML="",document.querySelector(".modal-dialog .modal-footer").innerHTML=""}));let e=document.createElement("label");e.className="z4-guided-tour",document.querySelector(".modal-dialog").classList.add("modal-lg"),document.querySelector(".modal-dialog .modal-footer").insertBefore(e,document.querySelector(".modal-dialog .modal-footer button")),(new Z4GradientColorGuidedTourUI).appendTo(document.querySelector(".modal-message"))}doStep(e){switch(e){case 0:this.element1=this.element2=this.querySelector(".form-check-input[value='1']"),this.event="change",this.message=Z4MessageFactory.get("GUIDED_TOUR_GRADIENT_SELECT_COLOR");break;case 1:this.element1=this.element2=this.querySelector(".form-control-color"),this.event="input",this.message=Z4MessageFactory.get("GUIDED_TOUR_GRADIENT_EDIT_COMPONENTS1");break;case 2:this.element1=this.querySelector(".dropdown-toggle-split"),this.element2=this.querySelector(".dropdown-menu .form-range"),this.event="input",this.message=Z4MessageFactory.get("GUIDED_TOUR_GRADIENT_EDIT_OPACITY");break;case 3:this.element1=this.element2=this.querySelector(".sliders"),this.event=Z4Loader.touch?"touchstart":"mousedown",this.message=Z4MessageFactory.get("GUIDED_TOUR_GRADIENT_ADD_COLOR");break;case 4:this.element1=this.element2=this.querySelector(".form-control-color"),this.event="input",this.message=Z4MessageFactory.get("GUIDED_TOUR_GRADIENT_EDIT_COMPONENTS2");break;case 5:this.element1=this.element2=this.querySelector(".form-check-input:nth-child(3)"),this.event=Z4Loader.touch?"touchend":"mouseup",this.message=Z4MessageFactory.get("GUIDED_TOUR_GRADIENT_MOVE");break;case 6:this.element1=this.querySelector(".z4-dropdown-toggle-three-dots"),this.element2=this.querySelector(".gradient-inverted"),this.event="click",this.message=Z4MessageFactory.get("GUIDED_TOUR_GRADIENT_INVERT");break;case 7:this.element1=this.querySelector(".z4-dropdown-toggle-three-dots"),this.element2=this.querySelector(".gradient-negative"),this.event="click",this.message=Z4MessageFactory.get("GUIDED_TOUR_GRADIENT_NEGATIVIZE");break;case 8:this.element1=this.element2=this.querySelector(".mirrored-check"),this.event="change",this.message=Z4MessageFactory.get("GUIDED_TOUR_GRADIENT_MIRROR");break;case 9:this.element1=this.element2=this.querySelector(".form-range[step='0.01']"),this.event="input",this.message=Z4MessageFactory.get("GUIDED_TOUR_GRADIENT_ADD_RIPPLE");break;default:this.element1=null,this.message=Z4MessageFactory.get("GUIDED_TOUR_COMPLETED")}let t=document.querySelector(".modal-dialog .modal-footer label");this.element1?(this.element1.classList.add("z4-guided-tour"),this.element2.classList.add("z4-guided-tour"),this.element2.addEventListener(this.event,(t=>{this.element1.classList.remove("z4-guided-tour"),this.element2.classList.remove("z4-guided-tour"),this.doStep(e+1)}),this.options)):t&&(t.className=""),t?t.innerText=this.message:console.log(this.message)}}class Z4TemporalColorUI extends Z4ComponentUI{temporalColorLabel=this.querySelector(".temporal-color-label");canvas=this.querySelector(".canvas");ctx=this.canvas.getContext("2d");chessboard=this.ctx.createPattern(Z4ImageFactory.get("CHESSBOARD"),"repeat");temporalFormRangeLabel=this.querySelector(".temporal-form-range-label");spatialFormRangeLabel=this.querySelector(".spatial-form-range-label");temporalMirroredCheck=this.querySelector(".temporal-mirrored-check");spatialMirroredCheck=this.querySelector(".spatial-mirrored-check");temporalFormRange=this.querySelector(".form-range-temporal");spatialFormRange=this.querySelector(".form-range-spatial");z4ColorUI=new Z4ColorUI;key=(new Date).getTime()+"-"+parseInt(1e3*Math.random());temporalColor=new Z4TemporalColor;devicePixelRatioListener=null;static UI=Z4ComponentUI.loadHTML("giada/pizzapazza/color/ui/Z4TemporalColorUI.html");static WIDTH=500;static HEIGHT=200;constructor(){super(Z4TemporalColorUI.UI),this.initDevicePixelRatio(),this.temporalColorLabel.innerText=Z4MessageFactory.get("TEMPORAL_COLOR");let e=this.querySelector(".temporal-inverted");e.innerText=Z4MessageFactory.get("TEMPORAL_INVERTED"),e.onclick=e=>this.inverted(!0,!1);let t=this.querySelector(".spatial-inverted");t.innerText=Z4MessageFactory.get("SPATIAL_INVERTED"),t.onclick=e=>this.inverted(!1,!0);let o=this.querySelector(".temporal-negative");o.innerText=Z4MessageFactory.get("NEGATIVE"),o.onclick=e=>(this.setZ4TemporalColor(this.temporalColor.negative()),this.onchange(this.temporalColor),null),this.canvas.style.border="1px dashed gray",this.canvas.style.width=Z4TemporalColorUI.WIDTH+"px",this.canvas.style.height=Z4TemporalColorUI.HEIGHT+"px",this.querySelector(".temporal-ripple-color-label").innerText=Z4MessageFactory.get("RIPPLE"),this.querySelector(".spatial-ripple-color-label").innerText=Z4MessageFactory.get("RIPPLE"),this.querySelector(".temporal-mirrored-label").innerText=Z4MessageFactory.get("MIRRORED"),this.querySelector(".spatial-mirrored-label").innerText=Z4MessageFactory.get("MIRRORED");let r=e=>(this.temporalColor.setMirrored(this.temporalMirroredCheck.checked,this.spatialMirroredCheck.checked),this.drawCanvas(1),this.onchange(this.temporalColor),null);this.temporalMirroredCheck.onchange=r,this.spatialMirroredCheck.onchange=r,this.temporalFormRange.oninput=e=>this.setRipple(5),this.spatialFormRange.oninput=e=>this.setRipple(5),this.temporalFormRange.onchange=e=>this.setRipple(1),this.spatialFormRange.onchange=e=>this.setRipple(1),this.z4ColorUI.appendTo(this.querySelector(".canvas-container")),this.z4ColorUI.onchange=e=>{this.drawCanvas(1),this.onchange(this.temporalColor)},this.setZ4TemporalColor(this.temporalColor)}initDevicePixelRatio(){window.matchMedia&&(this.devicePixelRatioListener=()=>{this.drawCanvas(1),this.addDevicePixelRatioListener()},this.addDevicePixelRatioListener())}addDevicePixelRatioListener(){let e=new Object;e.once=!0,window.matchMedia("(resolution: "+window.devicePixelRatio+"dppx)").addEventListener("change",this.devicePixelRatioListener,e)}setRipple(e){return this.temporalFormRangeLabel.innerText=this.temporalFormRange.value,this.spatialFormRangeLabel.innerText=this.spatialFormRange.value,this.temporalColor.setRipple(this.temporalFormRange.valueAsNumber,this.spatialFormRange.valueAsNumber),this.drawCanvas(e),this.onchange(this.temporalColor),null}inverted(e,t){return this.setZ4TemporalColor(this.temporalColor.inverted(e,t)),this.onchange(this.temporalColor),null}setTemporalColorLabel(e){return this.temporalColorLabel.setAttribute("data-token-lang",e),this.temporalColorLabel.innerText=Z4MessageFactory.get(e),this}setColorLabel(e){return this.z4ColorUI.setColorLabel(e),this}getZ4TemporalColor(){return this.temporalColor}setZ4TemporalColor(e){return this.temporalColor=e,this.drawCanvas(1),this}drawCanvas(e){this.canvas.width=Math.floor(Z4TemporalColorUI.WIDTH*window.devicePixelRatio),this.canvas.height=Math.floor(Z4TemporalColorUI.HEIGHT*window.devicePixelRatio);let t=new OffscreenCanvas(Z4TemporalColorUI.WIDTH,Z4TemporalColorUI.HEIGHT),o=t.getContext("2d");for(let t=0;t<Z4TemporalColorUI.WIDTH;t+=e){let r=this.temporalColor.getZ4GradientColorAt(t/Z4TemporalColorUI.WIDTH,!0,!0);for(let i=0;i<Z4TemporalColorUI.HEIGHT;i+=e)o.fillStyle=r.getZ4ColorAt(i/Z4TemporalColorUI.HEIGHT,!0,!0).getHEX(),o.fillRect(t,Z4TemporalColorUI.HEIGHT-i-e,e,e)}this.ctx.save(),this.ctx.scale(window.devicePixelRatio,window.devicePixelRatio),this.ctx.fillStyle=this.chessboard,this.ctx.fillRect(0,0,Z4TemporalColorUI.WIDTH,Z4TemporalColorUI.HEIGHT),this.ctx.drawImage(t,0,0),this.ctx.restore()}}
//# sourceMappingURL=bundle-0.2.0.min.js.map