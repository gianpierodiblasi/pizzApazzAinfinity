window.onload=()=>{switch(window.addEventListener("wheel",e=>{e.ctrlKey&&e.preventDefault()},{passive:!1}),window.addEventListener("keydown",e=>{e.ctrlKey&&("+"===e.key||"-"===e.key)&&(e.preventDefault(),document.querySelector(".z4canvas").dispatchEvent(new e.constructor(e.type,e)))}),localStorage.getItem("z4language")){case"en":Translations.setEnglish(),Z4Translations.setEnglish();break;case"it":Translations.setItalian(),Z4Translations.setItalian()}switch(localStorage.getItem("z4theme")){case"light":break;case"dark":SwingJS.instance().darkMode(!0).build();break;default:SwingJS.instance().darkMode(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches).build()}let e=localStorage.getItem("z4color");e&&SwingJS.instance().mainActionBGColor(e).build(),SwingJS.instance().fontSize(12).build(),Z4Constants.configureAcceptedFileTypeArrays();var t=new Z4Frame;if("launchQueue"in window&&"files"in LaunchParams.prototype&&launchQueue.setConsumer(e=>{e.files[0]&&e.files[0].getFile().then(e=>{e.name.toLowerCase().endsWith(".z4i")?t.canvas.openProject(e):t.canvas.createFromFile(e)})}),"serviceWorker"in navigator){let i,s;navigator.serviceWorker.register("service-worker.js").then(e=>{e.onupdatefound=()=>{(i=e.installing).onstatechange=()=>{"installed"===i.state&&navigator.serviceWorker.controller&&(document.querySelector(".z4ribbonhelppanel .z4check-update").style.display="flex",document.querySelector(".z4ribbonhelppanel .z4check-update").onclick=()=>i.postMessage({action:"skipWaiting"}))}}}),navigator.serviceWorker.oncontrollerchange=()=>{s||(caches.keys().then(e=>e.forEach(e=>caches.delete(e))),window.location.reload(),s=!0)},window.addEventListener("beforeinstallprompt",e=>{document.querySelector(".z4ribbonhelppanel .z4check-install").style.display="flex",document.querySelector(".z4ribbonhelppanel .z4check-install").onclick=()=>e.prompt()}),window.addEventListener("appinstalled",()=>document.querySelector(".z4ribbonhelppanel .z4check-install").style.display="none"),(navigator.standalone||window.matchMedia("(display-mode: standalone)").matches)&&(document.head.title="")}};class Z4ColorProgressionBehavior{static SPATIAL="SPATIAL";static TEMPORAL="TEMPORAL";static RELATIVE_TO_PATH="RELATIVE_TO_PATH";static RANDOM="RANDOM"}class Z4Lighting{static NONE="NONE";static LIGHTED_IN_OUT="LIGHTED_IN_OUT";static DARKENED_IN_OUT="DARKENED_IN_OUT";static LIGHTED_OUT_IN="LIGHTED_OUT_IN";static DARKENED_OUT_IN="DARKENED_OUT_IN"}class Z4AbstractFiller{fill(e){}getFillingColor(){}}class Z4AbstractGradientColorFiller extends Z4AbstractFiller{gradientColor=null;constructor(e){super(),this.gradientColor=e}fill(e){let t=e.data;for(let i=0;i<e.height;i++)for(let s=0;s<e.width;s++){let n=this.getColorPositionAt(s,i);if(-1!==n){let a=this.gradientColor.getColorAt(n,!0),r=(i*e.width+s)*4;t[r]=a.red,t[r+1]=a.green,t[r+2]=a.blue,t[r+3]=a.alpha}}}getColorPositionAt(e,t){}getFillingColor(){return this.gradientColor}}class Z4AbstractBoundaryBehaviorFiller extends Z4AbstractGradientColorFiller{boundaryBehavior=null;constructor(e,t){super(e),this.boundaryBehavior=t}getColorPositionAt(e,t){return this.getColorPositionAtWithBoundaryBehavior(e,t,this.boundaryBehavior)}getColorPositionAtWithBoundaryBehavior(e,t,i){}}class Z4AbstractDistanceBasedBoundaryBehaviorFiller extends Z4AbstractBoundaryBehaviorFiller{constructor(e,t){super(e,t)}getDistance(e,t){}getColorPositionAtWithBoundaryBehavior(e,t,i){let s=this.getDistance(e,t);if(s<=1)return s;if(i===Z4BoundaryBehavior.STOP_AT_BOUNDARY)return -1;if(i===Z4BoundaryBehavior.FILL_AT_BOUNDARY)return 1;if(i===Z4BoundaryBehavior.SYMMETRIC_AT_BOUNDARY){let n=Math.floor(s);return s-=n,n%2&&(s=1-s),s}if(i===Z4BoundaryBehavior.REPEAT_AT_BOUNDARY)return s-Math.floor(s);else return -1}}class Z4BezierFiller extends Z4AbstractDistanceBasedBoundaryBehaviorFiller{x1=0;y1=0;ctrlx1=0;ctrly1=0;ctrlx2=0;ctrly2=0;x2=0;y2=0;radius=0;bezier=null;constructor(e,t,i,s,n,a,r,o,l,h,d){super(e,d),this.x1=t,this.y1=i,this.ctrlx1=s,this.ctrly1=n,this.ctrlx2=a,this.ctrly2=r,this.x2=o,this.y2=l,this.radius=h,this.bezier=new Bezier(this.x1,this.y1,this.ctrlx1,this.ctrly1,this.ctrlx2,this.ctrly2,this.x2,this.y2)}getDistance(e,t){let i=this.bezier.project(new Z4Point(e,t));return Z4Math.distance(i.x,i.y,e,t)/this.radius}}class Z4EllipticFiller extends Z4AbstractDistanceBasedBoundaryBehaviorFiller{cx=0;cy=0;rx=0;ry=0;angle=0;constructor(e,t,i,s,n,a,r){super(e,r),this.cx=t,this.cy=i,this.rx=s,this.ry=n,this.angle=a}getDistance(e,t){let i=Z4Math.rotate(e-this.cx,t-this.cy,this.angle);return Math.hypot(i.x/this.rx,i.y/this.ry)}}class Z4SinusoidalFiller extends Z4AbstractDistanceBasedBoundaryBehaviorFiller{x=0;y=0;waveLength=0;period=0;amplitude=0;angle=0;two_PI_over_period=0;constructor(e,t,i,s,n,a,r,o){super(e,o),this.x=t,this.y=i,this.waveLength=s,this.period=n,this.amplitude=a,this.angle=r,this.two_PI_over_period=Z4Math.TWO_PI/this.period}getDistance(e,t){let i=Z4Math.rotate(e-this.x,t-this.y,this.angle);return Math.abs(i.y-this.amplitude*Math.sin(i.x*this.two_PI_over_period))/this.waveLength}}class Z4AbstractEllipseInscribedFiller extends Z4AbstractBoundaryBehaviorFiller{cx=0;cy=0;rx=0;ry=0;angle=0;vertexCount=0;edges=null;d00=0;ctx=new OffscreenCanvas(1,1).getContext("2d");constructor(e,t,i,s,n,a,r,o){super(e,o),this.cx=t,this.cy=i,this.rx=s,this.ry=n,this.angle=a,this.vertexCount=r,this.edges=this.createEdges(this.vertexCount),this.ctx.beginPath(),this.edges.forEach((e,t,i)=>{0===t?this.ctx.moveTo(e.x1,e.y1):this.ctx.lineTo(e.x1,e.y1)}),this.ctx.closePath(),this.d00=this.edges.map(e=>Z4Math.ptSegDist(e.x1,e.y1,e.x2,e.y2,0,0)).reduce((e,t,i,s)=>Math.min(e,t))}createEdges(e){}getColorPositionAtWithBoundaryBehavior(e,t,i){let s=Z4Math.rotate(e-this.cx,t-this.cy,this.angle),n=s.x/this.rx,a=s.y/this.ry;if(i===Z4BoundaryBehavior.STOP_AT_BOUNDARY||i===Z4BoundaryBehavior.FILL_AT_BOUNDARY)return this.ctx.isPointInPath(n,a)?1-this.getDistance(n,a,1):i===Z4BoundaryBehavior.STOP_AT_BOUNDARY?-1:1;if(i!==Z4BoundaryBehavior.SYMMETRIC_AT_BOUNDARY&&i!==Z4BoundaryBehavior.REPEAT_AT_BOUNDARY)return -1;{let r=1,o=n/r,l=a/r,h=this.getDistance(o,l,r);for(;h>1||!this.ctx.isPointInPath(o,l);)o=n/++r,l=a/r,h=this.getDistance(o,l,r);return i===Z4BoundaryBehavior.REPEAT_AT_BOUNDARY?1-h:r%2?1-h:h}}getDistance(e,t,i){return this.edges.map(i=>i.distance(e,t)).reduce((e,t,i,s)=>Math.min(e,t))/(this.d00/i)}}class Z4PolygonFiller extends Z4AbstractEllipseInscribedFiller{constructor(e,t,i,s,n,a,r,o){super(e,t,i,s,n,a,r,o)}createEdges(e){let t=[];for(let i=0;i<e-1;i++)t.push(new Z4Line(Math.cos(i*Z4Math.TWO_PI/e),Math.sin(i*Z4Math.TWO_PI/e),Math.cos((i+1)*Z4Math.TWO_PI/e),Math.sin((i+1)*Z4Math.TWO_PI/e)));return t.push(new Z4Line(Math.cos((e-1)*Z4Math.TWO_PI/e),Math.sin((e-1)*Z4Math.TWO_PI/e),1,0)),t}}class Z4StarFiller extends Z4AbstractEllipseInscribedFiller{constructor(e,t,i,s,n,a,r,o){super(e,t,i,s,n,a,r,o)}createEdges(e){let t=[];for(let i=0;i<e;i++){let s=i*Z4Math.TWO_PI/e;t.push(new Z4Point(Math.cos(s),Math.sin(s))),s=(i*Z4Math.TWO_PI+Math.PI)/e,t.push(new Z4Point(Math.cos(s)/Z4Math.SQUARE_GOLD_SECTION,Math.sin(s)/Z4Math.SQUARE_GOLD_SECTION))}t.push(new Z4Point(1,0));let n=[];for(let a=0;a<t.length-1;a++)n.push(new Z4Line(t[a].x,t[a].y,t[a+1].x,t[a+1].y));return n}}class Z4LinearFiller extends Z4AbstractBoundaryBehaviorFiller{p1x=0;p1y=0;p2x=0;p2y=0;angle=0;distance=0;line1x=0;line1y=0;line2x=0;line2y=0;constructor(e,t,i,s,n,a){super(e,a),this.p1x=t,this.p1y=i,this.p2x=s,this.p2y=n,this.angle=Z4Math.atan(this.p1x,this.p1y,this.p2x,this.p2y)+Z4Math.HALF_PI,this.distance=Z4Math.distance(this.p1x,this.p1y,this.p2x,this.p2y),this.line1x=this.p1x+Math.cos(this.angle),this.line1y=this.p1y+Math.sin(this.angle),this.line2x=this.p2x+Math.cos(this.angle),this.line2y=this.p2y+Math.sin(this.angle)}getColorPositionAtWithBoundaryBehavior(e,t,i){let s=Z4Math.ptLineDist(this.p1x,this.p1y,this.line1x,this.line1y,e,t)/this.distance,n=Z4Math.ptLineDist(this.p2x,this.p2y,this.line2x,this.line2y,e,t)/this.distance;if(s<=1&&n<=1)return s;if(i===Z4BoundaryBehavior.STOP_AT_BOUNDARY)return -1;if(i===Z4BoundaryBehavior.FILL_AT_BOUNDARY)return s<n?0:1;if(i===Z4BoundaryBehavior.SYMMETRIC_AT_BOUNDARY){let a=s<n?s:n,r=Math.floor(a);return a-=r,(s<n&&r%2||s>n&&!(r%2))&&(a=1-a),a}{if(i!==Z4BoundaryBehavior.REPEAT_AT_BOUNDARY)return -1;let o=s<n?s:n;return o-=Math.floor(o),s<n&&(o=1-o),o}}}class Z4ConicFiller extends Z4AbstractGradientColorFiller{cx=0;cy=0;angle=0;symmetric=!1;constructor(e,t,i,s,n){super(e),this.cx=t,this.cy=i,this.angle=s,this.symmetric=n}getColorPositionAt(e,t){let i=Z4Math.rotate(e-this.cx,t-this.cy,this.angle),s=Math.atan2(i.y,i.x)/Z4Math.TWO_PI;return(s<0&&(s+=1),this.symmetric)?2*(s<.5?s:1-s):s}}class Z4SpiralFiller extends Z4AbstractGradientColorFiller{cx=0;cy=0;radius=0;angle=0;logarithmic=!1;constructor(e,t,i,s,n,a){super(e),this.cx=t,this.cy=i,this.radius=s,this.angle=n,this.logarithmic=a}getColorPositionAt(e,t){let i=Z4Math.rotate(e-this.cx,t-this.cy,this.angle),s=Math.hypot(i.x,i.y),n=Z4Math.TWO_PI*(this.logarithmic?Math.log(s/this.radius):s/this.radius),a=s*Math.cos(n),r=s*Math.sin(n);return isNaN(s=Z4Math.distance(i.x,i.y,a,r)/(2*s))?0:s}}class Z4TextureFiller extends Z4AbstractFiller{texture=null;x1=0;y1=0;x2=0;y2=0;color=null;symmetric=!1;textureData=null;left=0;top=0;width=0;height=0;scaleW=0;scaleH=0;constructor(e,t,i,s,n,a,r){if(super(),this.texture=e,this.x1=t,this.y1=i,this.x2=s,this.y2=n,this.color=a,this.symmetric=r,this.symmetric){this.textureData=new Uint8Array(16*this.texture.width*this.texture.height);for(let o=0;o<this.texture.height;o++)for(let l=0;l<this.texture.width;l++){let h=(o*this.texture.width+l)*4,d=(o*this.texture.width*2+l)*4;this.textureData[d]=this.texture.data[h],this.textureData[d+1]=this.texture.data[h+1],this.textureData[d+2]=this.texture.data[h+2],this.textureData[d+3]=this.texture.data[h+3],d=(o*this.texture.width*2+(2*this.texture.width-1-l))*4,this.textureData[d]=this.texture.data[h],this.textureData[d+1]=this.texture.data[h+1],this.textureData[d+2]=this.texture.data[h+2],this.textureData[d+3]=this.texture.data[h+3],d=((2*this.texture.height-1-o)*this.texture.width*2+l)*4,this.textureData[d]=this.texture.data[h],this.textureData[d+1]=this.texture.data[h+1],this.textureData[d+2]=this.texture.data[h+2],this.textureData[d+3]=this.texture.data[h+3],d=((2*this.texture.height-o-1)*this.texture.width*2+(2*this.texture.width-1-l))*4,this.textureData[d]=this.texture.data[h],this.textureData[d+1]=this.texture.data[h+1],this.textureData[d+2]=this.texture.data[h+2],this.textureData[d+3]=this.texture.data[h+3]}}else this.textureData=this.texture.data;this.left=Math.min(t,s),this.top=Math.min(i,n),this.width=Math.abs(s-t),this.height=Math.abs(n-i),this.scaleW=(this.symmetric?2:1)*this.texture.width/this.width,this.scaleH=(this.symmetric?2:1)*this.texture.height/this.height}fill(e){if(!this.width||!this.height)return;let t=e.data;for(let i=0;i<e.height;i++)for(let s=0;s<e.width;s++){let n=(i*e.width+s)*4,a=this.computeRect(s,i),r=parseInt(this.scaleW*(s-a.x)),o=(parseInt(this.scaleH*(i-a.y))*(this.symmetric?2:1)*this.texture.width+r)*4;this.textureData[o+3]?(t[n]=this.textureData[o],t[n+1]=this.textureData[o+1],t[n+2]=this.textureData[o+2],t[n+3]=this.textureData[o+3]):(t[n]=this.color.red,t[n+1]=this.color.green,t[n+2]=this.color.blue,t[n+3]=this.color.alpha)}}computeRect(e,t){let i=this.left,s=this.top,n=i+this.width,a=s+this.height;for(;e<i;)i-=this.width,n=i+this.width;for(;e>=n;)i+=this.width,n=i+this.width;for(;t<s;)s-=this.height,a=s+this.height;for(;t>=a;)s+=this.height,a=s+this.height;return new Point(i,s)}getFillingColor(){return this.color}}class Z4BoundaryBehavior{static STOP_AT_BOUNDARY="STOP_AT_BOUNDARY";static FILL_AT_BOUNDARY="FILL_AT_BOUNDARY";static SYMMETRIC_AT_BOUNDARY="SYMMETRIC_AT_BOUNDARY";static REPEAT_AT_BOUNDARY="REPEAT_AT_BOUNDARY"}class Z4PointIteratorDrawingAction{static START="START";static CONTINUE="CONTINUE";static STOP="STOP"}class Z4PointIteratorType{static STAMPER="STAMPER";static TRACER="TRACER";static AIRBRUSH="AIRBRUSH";static SPIROGRAPH="SPIROGRAPH";static SCATTERER="SCATTERER"}class Z4GeometricShape{getPolyline(){}distance(e,t){}}class Z4Line extends Z4GeometricShape{x1=0;y1=0;x2=0;y2=0;constructor(e,t,i,s){super(),this.x1=e,this.y1=t,this.x2=i,this.y2=s}getPolyline(){let e=new Z4Polyline;return e.points.push(new Z4Point(this.x1,this.y1)),e.points.push(new Z4Point(this.x2,this.y2)),e}distance(e,t){return Z4Math.ptSegDist(this.x1,this.y1,this.x2,this.y2,e,t)}}class Z4Polyline extends Z4GeometricShape{points=[];getP1(){return this.points[0]}getP2(){return this.points[this.points.length-1]}getInternalPoints(){return this.points.slice(1,this.points.length-1)}getPolyline(){return this}distance(e,t){return this.points.map((i,s,n)=>0===s?Number.MAX_VALUE:Z4Math.ptSegDist(i.x,i.y,n[s-1].x,n[s-1].x,e,t)).reduce((e,t,i,s)=>Math.min(e,t))}}class Z4DrawingDirection{static FREE="FREE";static HORIZONTAL="HORIZONTAL";static VERTICAL="VERTICAL"}class Z4DrawingPoint{z4Vector=null;intensity=0;temporalPosition=0;intent=null;side=null;useVectorModuleAsSize=!1;constructor(e,t,i,s,n,a){this.z4Vector=e,this.intensity=t,this.temporalPosition=i,this.intent=s,this.side=n,this.useVectorModuleAsSize=a}}class Z4DrawingPointIntent{static DRAW_BOUNDS="DRAW_BOUNDS";static REPLACE_PREVIOUS_BOUNDS="REPLACE_PREVIOUS_BOUNDS";static DRAW_OBJECTS="DRAW_OBJECTS"}class Z4Math{static TWO_PI=2*Math.PI;static HALF_PI=Math.PI/2;static SQRT_OF_2=Math.sqrt(2);static GOLD_SECTION=(1+Math.sqrt(5))/2;static SQUARE_GOLD_SECTION=Z4Math.GOLD_SECTION*Z4Math.GOLD_SECTION;static RAD2DEG=180/Math.PI;static DEG2RAD=Math.PI/180;static rad2deg(e){return e*Z4Math.RAD2DEG}static deg2rad(e){return e*Z4Math.DEG2RAD}static distance(e,t,i,s){let n=e-i,a=t-s;return Math.sqrt(n*n+a*a)}static ptLineDist(e,t,i,s,n,a){return Math.sqrt(Z4Math.ptLineDistSq(e,t,i,s,n,a))}static ptLineDistSq(e,t,i,s,n,a){i-=e,s-=t;let r=(n-=e)*i+(a-=t)*s,o=n*n+a*a-r*r/(i*i+s*s);return o<0?0:o}static ptSegDist(e,t,i,s,n,a){return Math.sqrt(Z4Math.ptSegDistSq(e,t,i,s,n,a))}static ptSegDistSq(e,t,i,s,n,a){i-=e,s-=t;let r=(n-=e)*i+(a-=t)*s,o=0;o=r<=0?0:(r=(n=i-n)*i+(a=s-a)*s)<=0?0:r*r/(i*i+s*s);let l=n*n+a*a-o;return l<0?0:l}static nearestPointInGrid(e,t,i,s,n,a){let r=i+Math.round((e-i)/n)*n,o=s+Math.round((t-s)/n)*n;return Z4Math.distance(e,t,r,o)<=a*n?new Z4Point(r,o):null}static atan(e,t,i,s){let n=Math.atan2(s-t,i-e);return n<0?n+Z4Math.TWO_PI:n}static rotate(e,t,i){let s=Math.cos(i),n=Math.sin(i);return new Z4Point(e*s+t*n,e*n-t*s)}static rotoTranslate(e,t,i,s,n){let a=Math.cos(i),r=Math.sin(i);return new Z4Point(e*a+t*r+s,e*r-t*a+n)}static ripple(e,t,i,s){let n=(i-t)*s*Math.random();return(e+=Math.random()>.5?n:-n)<t?t:e>i?i:e}static getPolygonVertices(e){let t=[];for(let i=0;i<e;i++)t.push(new Z4Point(Math.cos(i*Z4Math.TWO_PI/e),Math.sin(i*Z4Math.TWO_PI/e)));return t}static getStarVertices(e){let t=[];for(let i=0;i<e;i++){let s=i*Z4Math.TWO_PI/e;t.push(new Z4Point(Math.cos(s),Math.sin(s))),s=(i*Z4Math.TWO_PI+Math.PI)/e,t.push(new Z4Point(Math.cos(s)/Z4Math.SQUARE_GOLD_SECTION,Math.sin(s)/Z4Math.SQUARE_GOLD_SECTION))}return t}static butterfly(e,t){let i=Math.cos(t),s=Math.sin(t),n=3*(i+1),a=e.y0-4*e.y,r=-(a*i+4*(e.x-e.x0)*s+a)/n,o=(3*e.x0*i+3*(r-e.y0)*s-5*e.x0+8*e.x)/n,l=new Z4Point(o,r),h=l.x-e.x0,d=l.y-e.y0,c=new Z4Point(h*i-d*s+e.x0,h*s+d*i+e.y0);return[l,c]}static randomCorrected(e){return Math.pow(Math.random(),1/e)}constructor(){}}class Z4Point{x=0;y=0;constructor(e,t){this.x=e,this.y=t}}class Z4RandomValueBehavior{static CLASSIC="CLASSIC";static BEZIER="BEZIER";static POLYLINE="POLYLINE";static STEPPED="STEPPED"}class Z4RotationBehavior{static FIXED="FIXED";static CUMULATIVE="CUMULATIVE";static RELATIVE_TO_PATH="RELATIVE_TO_PATH"}class Z4SignBehavior{static POSITIVE="POSITIVE";static NEGATIVE="NEGATIVE";static RANDOM="RANDOM";static ALTERNATE="ALTERNATE"}class Z4TracerPath{surplus=0;step=0;x1=0;y1=0;x2=0;y2=0;x3=0;y3=0;bezierCurve=null;bezierCurveLength=0;length=0;position=0;static fromLine(e,t,i,s,n,a){let r=new Z4TracerPath;return r.x1=e,r.y1=t,r.x2=i,r.y2=s,r.init(n,a)}static fromQuadAndLine(e,t,i,s,n,a,r,o,l,h){let d=new Z4TracerPath;return d.bezierCurve=new Bezier(e,t,i,s,n,a),d.bezierCurveLength=d.bezierCurve.length(),d.x2=n,d.y2=a,d.x3=r,d.y3=o,d.init(l,h)}init(e,t){return this.surplus=e,this.step=t,this.length=this.bezierCurve?this.bezierCurveLength+Z4Math.distance(this.x2,this.y2,this.x3,this.y3):Z4Math.distance(this.x1,this.y1,this.x2,this.y2),this.position=e,this}hasNext(){return this.length>this.position}next(){if(!this.hasNext())return null;if(this.bezierCurve){if(this.position<this.bezierCurveLength){let e=this.position/this.bezierCurveLength,t=this.bezierCurve.get(e),i=this.bezierCurve.derivative(e);return this.position+=this.step,Z4Vector.fromPoints(t.x,t.y,t.x+i.x,t.y+i.y)}{let s=(this.position-this.bezierCurveLength)/(this.length-this.bezierCurveLength),n=(this.x3-this.x2)*s+this.x2,a=(this.y3-this.y2)*s+this.y2;return this.position+=this.step,Z4Vector.fromVector(n,a,1,Z4Math.atan(this.x2,this.y2,this.x3,this.y3))}}{let r=this.position/this.length,o=(this.x2-this.x1)*r+this.x1,l=(this.y2-this.y1)*r+this.y1;return this.position+=this.step,Z4Vector.fromVector(o,l,1,Z4Math.atan(this.x1,this.y1,this.x2,this.y2))}}restart(){return this.position=this.surplus,this}getLength(){return this.length}getNewSurplus(){return this.position-this.length}getPointCount(){return parseInt((this.length-this.surplus)/this.step)}}class Z4Vector{x0=0;y0=0;x=0;y=0;module=0;phase=0;constructor(e,t,i,s,n,a){this.x0=e,this.y0=t,this.x=i,this.y=s,this.module=n,this.phase=a}static fromPoints(e,t,i,s){return new Z4Vector(e,t,i,s,Z4Math.distance(e,t,i,s),Z4Math.atan(e,t,i,s))}static fromVector(e,t,i,s){return new Z4Vector(e,t,e+i*Math.cos(s),t+i*Math.sin(s),i,s)}direction(e){let t=this.x-this.x0,i=this.y-this.y0,s=e.x-e.x0,n=e.y-e.y0;return Math.atan2(t*n-i*s,t*s+i*n)>=0?Z4SignBehavior.POSITIVE:Z4SignBehavior.NEGATIVE}}class Z4WhirlpoolBehavior{static NONE="NONE";static FORWARD="FORWARD";static BACKWARD="BACKWARD"}class Z4CenteredFigurePainterType{static TYPE_0="TYPE_0";static TYPE_1="TYPE_1";static TYPE_2="TYPE_2";static TYPE_3="TYPE_3";static TYPE_4="TYPE_4";static TYPE_5="TYPE_5"}class Z4DropPainterType{static THOUSAND_POINTS="THOUSAND_POINTS";static THOUSAND_LINES="THOUSAND_LINES";static THOUSAND_AREAS="THOUSAND_AREAS"}class Z4NaturalFigurePainterControlPointClosure{static CONTROL_POINT_CLOSURE_0="CONTROL_POINT_CLOSURE_0";static CONTROL_POINT_CLOSURE_1="CONTROL_POINT_CLOSURE_1";static CONTROL_POINT_CLOSURE_2="CONTROL_POINT_CLOSURE_2"}class Z4NaturalFigurePainterType{static TYPE_0="TYPE_0";static TYPE_1="TYPE_1";static TYPE_2="TYPE_2";static TYPE_3="TYPE_3"}class Z4PainterType{static ARROW="ARROW";static SHAPE_2D="SHAPE_2D";static DROP="DROP";static BRUSH="BRUSH";static PATTERN="PATTERN";static CENTERED_FIGURE="CENTERED_FIGURE";static NATURAL_FIGURE="NATURAL_FIGURE"}class Z4Canvas extends JSComponent{canvas=document.createElement("canvas");ctx=this.canvas.getContext("2d");canvasGrid=document.createElement("canvas");ctxGrid=this.canvasGrid.getContext("2d");pathGrid=null;centerGrid=null;plotWidthGrid=0;dottedGrid=!1;magneticGrid=!1;colorGrid=null;canvasBounds=document.createElement("canvas");ctxBounds=this.canvasBounds.getContext("2d");showLayerBounds=!1;canvasOverlay=document.createElement("canvas");ctxOverlay=this.canvasOverlay.getContext("2d");canvasOverlayModes=new Set;ribbonProjectPanel=null;ribbonLayerPanel=null;ribbonDrawingToolPanel=null;ribbonTextPanel=null;ribbonHistoryPanel=null;statusPanel=null;projectName=null;handle=null;width=0;height=0;zoom=1;zooming=!1;saved=!0;changed=!1;isOpenFromHistory=!1;paper=new Z4Paper;selectedLayer=null;drawingTools=[];selectedDrawingTool=null;drawingDirection=Z4DrawingDirection.FREE;mouseManager=new Z4CanvasMouseManager(this,this.ctx);ioManager=new Z4CanvasIOManager(this,this.paper,this.drawingTools);historyManager=new Z4CanvasHistoryManager(this,this.paper);constructor(){super(document.createElement("div")),this.cssAddClass("z4canvas"),this.appendNodeChild(this.canvas),this.appendNodeChild(this.canvasGrid),this.appendNodeChild(this.canvasBounds),this.appendNodeChild(this.canvasOverlay),this.canvas.classList.add("main-canvas"),this.canvas.addEventListener("mouseenter",e=>this.mouseManager.onMouse(e,"enter")),this.canvas.addEventListener("mouseleave",e=>this.mouseManager.onMouse(e,"leave")),this.canvas.addEventListener("mousedown",e=>this.mouseManager.onMouse(e,"down")),this.canvas.addEventListener("mousemove",e=>this.mouseManager.onMouse(e,"move")),this.canvas.addEventListener("mouseup",e=>this.mouseManager.onMouse(e,"up")),this.canvasOverlay.addEventListener("mousemove",e=>this.mouseManager.onMouse(e,"move")),this.canvasOverlay.addEventListener("mouseup",e=>this.mouseManager.onMouse(e,"up")),this.addEventListener("wheel",e=>{let t=e;t.ctrlKey&&(t.deltaY<0?this.zoomInOut(()=>Z4Constants.ZOOM_LEVEL.find(e=>e>this.zoom,null)):t.ctrlKey&&t.deltaY>0&&this.zoomInOut(()=>Z4Constants.ZOOM_LEVEL.filter(e=>e<this.zoom).pop()))}),this.addEventListener("keydown",e=>{let t=e;t.ctrlKey&&("+"===t.key?(t.stopPropagation(),this.zoomInOut(()=>Z4Constants.ZOOM_LEVEL.find(e=>e>this.zoom,null))):"-"===t.key&&(t.stopPropagation(),this.zoomInOut(()=>Z4Constants.ZOOM_LEVEL.filter(e=>e<this.zoom).pop())))})}setRibbonPanels(e,t,i,s,n){this.ribbonProjectPanel=e,this.ribbonLayerPanel=t,this.ribbonDrawingToolPanel=i,this.ribbonTextPanel=s,this.ribbonHistoryPanel=n,this.ribbonProjectPanel.setCanvas(this),this.ribbonLayerPanel.setCanvas(this),this.ribbonDrawingToolPanel.setCanvas(this),this.ribbonTextPanel.setCanvas(this),this.ribbonHistoryPanel.setCanvas(this),this.mouseManager.setRibbonHistoryPanel(n),this.ioManager.setRibbonPanels(t,i,n),this.historyManager.setRibbonLayerPanel(t)}setStatusPanel(e){this.statusPanel=e,this.statusPanel.setCanvas(this),this.mouseManager.setStatusPanel(e),this.ioManager.setStatusPanel(e)}create(e,t,i){this.paper.reset(),this.paper.addLayer(Z4Translations.BACKGROUND_LAYER,e,t,i,e,t),this.setSize(e,t),this.ribbonLayerPanel.reset(),this.setSelectedLayerAndAddLayerPreview(this.paper.getLayerAt(this.getLayersCount()-1),null,!0),this.drawingTools.length=0,this.ribbonDrawingToolPanel.reset(),Color.resetHistory(),Z4GradientColor.resetHistory(),Z4BiGradientColor.resetHistory(),this.ribbonHistoryPanel.resetHistory(()=>{this.afterCreate("",e,t),this.fitZoomIfNeeded(),this.toHistory(e=>this.ribbonHistoryPanel.addHistory(e,e=>this.ribbonHistoryPanel.setCurrentKey(e),!1))})}createFromHandle(e){this.ioManager.createFromHandle(e)}createFromFile(e){this.ioManager.createFromFile(e)}createFromClipboard(){this.ioManager.createFromClipboard()}afterCreate(e,t,i){this.projectName=e,this.statusPanel.setProjectName(e),this.statusPanel.setProjectSize(t,i),this.isOpenFromHistory||(this.statusPanel.setZoom(1),this.statusPanel.setDrawingDirection(Z4DrawingDirection.FREE),this.statusPanel.resetCanvasGridPanel(t,i,!1),this.zoom=1,this.mouseManager.setZoom(this.zoom),this.mouseManager.setMagneticGrid(null,0,!1),this.setDrawingDirection(Z4DrawingDirection.FREE),this.pathGrid=null,this.showLayerBounds=!1,this.setSaved(!0),this.changed=!1),this.isOpenFromHistory=!1,this.canvas.width=t*this.zoom,this.canvas.height=i*this.zoom,this.canvasGrid.width=t*this.zoom,this.canvasGrid.height=i*this.zoom,this.canvasBounds.width=t*this.zoom,this.canvasBounds.height=i*this.zoom,this.canvasOverlay.width=t*this.zoom,this.canvasOverlay.height=i*this.zoom,this.drawCanvas(),this.drawCanvasGrid(),this.drawCanvasBounds(),this.drawCanvasOverlay()}openProjectFromHandle(e){this.handle=e,this.ioManager.openProjectFromHandle(e)}openProjectFromFile(e){this.ioManager.openProjectFromFile(e)}openFromHistory(e){this.isOpenFromHistory=!0,this.historyManager.openFromHistory(e)}saveProjectToHandle(e,t){this.handle=e,this.projectName=this.ioManager.saveProjectToHandle(e,t)}saveProjectToFile(e,t){this.projectName=e,this.ioManager.saveProjectToFile(e,t)}saveHistory(e){this.ribbonHistoryPanel.saveHistory(e)}toHistory(e){this.historyManager.toHistory(e)}exportToFile(e,t,i){this.ioManager.exportToFile(e,t,i)}exportToHandle(e,t){this.ioManager.exportToHandle(e,t)}getLayerAt(e){return this.paper.getLayerAt(e)}addLayer(e,t,i){this.paper.addLayer(this.findLayerName(),e,t,i,this.width,this.height),this.afterAddLayer(),this.drawCanvas()}addLayerFromHandle(e){this.ioManager.addLayerFromHandle(e)}addLayerFromFile(e){this.ioManager.addLayerFromFile(e)}addLayerFromClipboard(){this.ioManager.addLayerFromClipboard()}afterAddLayer(){this.changed=!0,this.saveHistory("standard,tool"),this.setSelectedLayerAndAddLayerPreview(this.paper.getLayerAt(this.getLayersCount()-1),null,!0),this.setSaved(!1)}duplicateLayer(e){let t=e.getOffset();e.convertToBlob(i=>{let s=document.createElement("img");s.onload=i=>(this.paper.addLayerFromImage(this.findLayerName(),s,this.width,this.height),this.setSelectedLayerAndAddLayerPreview(this.paper.getLayerAt(this.getLayersCount()-1),i=>{i.setOpacity(e.getOpacity()),i.setCompositeOperation(e.getCompositeOperation()),i.setHidden(e.isHidden()),i.move(t.x,t.y)},!0),this.changed=!0,this.saveHistory("standard,tool"),this.setSaved(!1),this.drawCanvas(),null),s.src=URL.createObjectURL(i)})}deleteLayer(e,t){let i=this.paper.deleteLayer(e);if(!t){if(this.selectedLayer===e){let s=this.getLayersCount();this.setSelectedLayer(this.paper.getLayerAt(s-1)),document.querySelector(".z4layerpreview:nth-child("+(s+(i<s?1:0))+") .z4layerpreview-selector").textContent=Z4LayerPreview.SELECTED_LAYER_CONTENT,setTimeout(()=>document.querySelector(".z4layerpreview:nth-child("+(s+(i<s?1:0))+")").scrollIntoView(),0)}this.changed=!0,this.saveHistory("standard,tool"),this.setSaved(!1),this.drawCanvas()}return i}moveLayer(e,t){return!!this.paper.moveLayer(e,t)&&(this.changed=!0,this.saveHistory("standard,tool"),this.setSaved(!1),this.drawCanvas(),!0)}mergeLayers(e){this.ioManager.mergeLayers(e)}findLayerName(){let e=0,t="";for(;!t;){t=Z4Translations.LAYER+"_"+e;for(let i=0;i<this.getLayersCount();i++)t===this.paper.getLayerAt(i).getName()&&(t="");e++}return t}setSelectedLayer(e){this.setSelectedLayerAndAddLayerPreview(e,null,!1)}setSelectedLayerAndAddLayerPreview(e,t,i){this.selectedLayer=e,this.mouseManager.setSelectedLayer(this.selectedLayer),t&&t(this.selectedLayer),i&&this.ribbonLayerPanel.addLayerPreview(this.selectedLayer)}getLayersCount(){return this.paper.getLayersCount()}setShowLayerBounds(e){this.showLayerBounds=e,this.drawCanvasBounds()}addCanvasOverlayMode(e){this.addRemoveCanvasOverlayMode(e,!0)}removeCanvasOverlayMode(e){this.addRemoveCanvasOverlayMode(e,!1)}addRemoveCanvasOverlayMode(e,t){t?(this.canvasOverlayModes.add(e),this.mouseManager.addCanvasOverlayMode(e)):(this.canvasOverlayModes.delete(e),this.mouseManager.removeCanvasOverlayMode(e)),this.canvasOverlay.style.pointerEvents=this.canvasOverlayModes.size?"auto":"none",this.drawCanvasOverlay()}addDrawingTool(e){this.drawingTools.push(e),this.setSelectedDrawingToolAndAddDrawingToolPreview(e,!0),this.setSaved(!1)}addDrawingToolFromHandle(e){this.ioManager.addDrawingToolFromHandle(e)}addDrawingToolFromFile(e){this.ioManager.addDrawingToolFromFile(e)}replaceDrawingTool(e,t){let i=this.drawingTools.indexOf(e);this.drawingTools[i]=t,this.selectedDrawingTool===e&&this.setSelectedDrawingTool(t),this.setSaved(!1)}deleteDrawingTool(e){let t=this.drawingTools.indexOf(e);return this.drawingTools.splice(t,1),this.selectedDrawingTool!==e||(this.drawingTools.length?(this.setSelectedDrawingTool(this.drawingTools[this.drawingTools.length-1]),document.querySelector(".z4drawingtoolpreview:nth-child("+(this.drawingTools.length+(t<this.drawingTools.length?1:0))+") .z4drawingtoolpreview-selector").textContent=Z4DrawingToolPreview.SELECTED_DRAWING_TOOL_CONTENT,setTimeout(()=>document.querySelector(".z4drawingtoolpreview:nth-child("+(this.drawingTools.length+(t<this.drawingTools.length?1:0))+")").scrollIntoView(),0)):this.setSelectedDrawingTool(null)),this.setSaved(!1),t}findDrawingToolName(){let e=0,t="";for(;!t;){t=Z4Translations.DRAWING_TOOL+" "+e;for(let i=0;i<this.drawingTools.length;i++)t===this.drawingTools[i].getName()&&(t="");e++}return t}setSelectedDrawingTool(e){this.setSelectedDrawingToolAndAddDrawingToolPreview(e,!1)}setSelectedDrawingToolAndAddDrawingToolPreview(e,t){this.selectedDrawingTool=e,this.mouseManager.setSelectedDrawingTool(e),this.saveHistory("tool"),t&&this.ribbonDrawingToolPanel.addDrawingToolPreview(this.selectedDrawingTool)}saveDrawingToolToFile(e,t){this.ioManager.saveDrawingToolToFile(e,t)}saveDrawingToolToHandle(e,t){this.ioManager.saveDrawingToolToHandle(e,t)}saveDrawingToolsToFile(e){this.ioManager.saveDrawingToolsToFile(e)}saveDrawingToolsToHandle(e){this.ioManager.saveDrawingToolsToHandle(e)}getProjectName(){return this.projectName}getHandle(){return this.handle}setSize(e,t){this.width=e,this.height=t,this.mouseManager.setSize(this.getSize()),this.ioManager.setSize(this.getSize()),this.historyManager.setSize(this.getSize())}getSize(){return new Dimension(this.width,this.height)}isSaved(){return this.saved}setSaved(e){this.saved=e,this.ribbonProjectPanel.setSaveEnabled(!this.saved)}isChanged(){return this.changed}setChanged(e){this.changed=e}getColorAt(e,t){if(!(0<=e)||!(e<this.width)||!(0<=t)||!(t<this.height))return null;{let i=this.ctx.getImageData(e*this.zoom,t*this.zoom,1,1).data;return new Color(parseInt(i[0]),parseInt(i[1]),parseInt(i[2]),parseInt(i[3]))}}getSelectedLayerColorAt(e,t){return this.selectedLayer.getColorAt(e,t)}setZoom(e){this.zoom=e,this.mouseManager.setZoom(this.zoom),this.canvas.width=this.width*e,this.canvas.height=this.height*e,this.canvasGrid.width=this.width*e,this.canvasGrid.height=this.height*e,this.canvasBounds.width=this.width*e,this.canvasBounds.height=this.height*e,this.canvasOverlay.width=this.width*e,this.canvasOverlay.height=this.height*e,this.pathGrid=this.pathGrid?this.createGrid():null,this.drawCanvas(),this.drawCanvasGrid(),this.drawCanvasBounds(),this.drawCanvasOverlay()}fitZoom(){this.setZoom(Math.min((this.canvas.parentElement.clientWidth-20)/this.width,(this.canvas.parentElement.clientHeight-20)/this.height))}fitZoomIfNeeded(){(this.canvas.parentElement.clientWidth-20<this.width||this.canvas.parentElement.clientHeight-20<this.height)&&(this.fitZoom(),this.statusPanel.setZoom(this.zoom))}zoomInOut(e){if(this.zooming);else{this.zooming=!0;let t=e();t&&(this.setZoom(t),this.statusPanel.setZoom(this.zoom)),this.zooming=!1}}getDrawingDirection(){return this.drawingDirection}setDrawingDirection(e){this.drawingDirection=e,this.mouseManager.setDrawingDirection(e)}setGrid(e,t,i,s,n,a){this.centerGrid=t,this.plotWidthGrid=i,this.dottedGrid=s,this.magneticGrid=n,this.colorGrid=a,this.pathGrid=e?this.createGrid():null,this.mouseManager.setMagneticGrid(t,i,e&&n),this.drawCanvasGrid()}createGrid(){let e=new Path2D;if(this.dottedGrid){for(let t=this.centerGrid.x;t>0;t-=this.plotWidthGrid)this.createDottedGrid(e,t);for(let i=this.centerGrid.x;i<this.width;i+=this.plotWidthGrid)this.createDottedGrid(e,i)}else{for(let s=this.centerGrid.x;s>0;s-=this.plotWidthGrid)this.createLineGrid(e,s,0,s,this.height);for(let n=this.centerGrid.x;n<this.width;n+=this.plotWidthGrid)this.createLineGrid(e,n,0,n,this.height);for(let a=this.centerGrid.y;a>0;a-=this.plotWidthGrid)this.createLineGrid(e,0,a,this.width,a);for(let r=this.centerGrid.y;r<this.height;r+=this.plotWidthGrid)this.createLineGrid(e,0,r,this.width,r)}if(this.magneticGrid){let o=parseInt(this.plotWidthGrid*Z4Constants.MAGNETISM_PERCENTAGE);for(let l=this.centerGrid.x;l>0;l-=this.plotWidthGrid)this.createMagneticGrid(e,l,o);for(let h=this.centerGrid.x;h<this.width;h+=this.plotWidthGrid)this.createMagneticGrid(e,h,o)}return e}createDottedGrid(e,t){for(let i=this.centerGrid.y;i>0;i-=this.plotWidthGrid)e.moveTo(t+2/this.zoom,i),e.arc(t,i,2/this.zoom,0,Z4Math.TWO_PI);for(let s=this.centerGrid.y;s<this.height;s+=this.plotWidthGrid)e.moveTo(t+2/this.zoom,s),e.arc(t,s,2/this.zoom,0,Z4Math.TWO_PI)}createLineGrid(e,t,i,s,n){e.moveTo(t,i),e.lineTo(s,n)}createMagneticGrid(e,t,i){for(let s=this.centerGrid.y;s>0;s-=this.plotWidthGrid)e.moveTo(t+i,s),e.arc(t,s,i,0,Z4Math.TWO_PI);for(let n=this.centerGrid.y;n<this.height;n+=this.plotWidthGrid)e.moveTo(t+i,n),e.arc(t,n,i,0,Z4Math.TWO_PI)}rotatePlus90(){this.resize(this.height,this.width)}resize(e,t){this.setSize(e,t),this.statusPanel.setProjectSize(this.width,this.height),this.statusPanel.resetCanvasGridPanel(this.width,this.height,!0),this.canvas.width=this.width*this.zoom,this.canvas.height=this.height*this.zoom,this.canvasGrid.width=this.width*this.zoom,this.canvasGrid.height=this.height*this.zoom,this.canvasBounds.width=this.width*this.zoom,this.canvasBounds.height=this.height*this.zoom,this.canvasOverlay.width=this.width*this.zoom,this.canvasOverlay.height=this.height*this.zoom,this.drawCanvas(),this.drawCanvasGrid(),this.drawCanvasBounds(),this.drawCanvasOverlay()}drawCanvas(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.ctx.scale(this.zoom,this.zoom),this.paper.draw(this.ctx,!1),this.ctx.restore()}drawCanvasGrid(){this.ctxGrid.clearRect(0,0,this.canvasGrid.width,this.canvasGrid.height),this.pathGrid&&(this.ctxGrid.save(),this.ctxGrid.scale(this.zoom,this.zoom),this.ctxGrid.strokeStyle=Z4Constants.getStyle(this.colorGrid.getRGBA_HEX()),this.ctxGrid.lineWidth=1/this.zoom,this.ctxGrid.stroke(this.pathGrid),this.ctxGrid.beginPath(),this.ctxGrid.arc(this.centerGrid.x,this.centerGrid.y,4/this.zoom,0,Z4Math.TWO_PI),this.ctxGrid.fillStyle=Z4Constants.getStyle(this.colorGrid.getRGBA_HEX()),this.ctxGrid.fill(),this.ctxGrid.restore())}drawCanvasBounds(){this.ctxBounds.clearRect(0,0,this.canvasBounds.width,this.canvasBounds.height);let e=!1,t=new Path2D;for(let i=0;i<this.getLayersCount();i++){let s=this.paper.getLayerAt(i);(this.showLayerBounds||s.isShowBounds())&&(e=!0,t.rect(s.getOffset().x,s.getOffset().y,s.getSize().width,s.getSize().height))}if(e){this.ctxBounds.save(),this.ctxBounds.scale(this.zoom,this.zoom),this.ctxBounds.lineWidth=3/this.zoom;let n=[];this.ctxBounds.strokeStyle=Z4Constants.getStyle("black"),this.ctxBounds.setLineDash(n),this.ctxBounds.stroke(t),n.push(2*this.ctxBounds.lineWidth,2*this.ctxBounds.lineWidth),this.ctxBounds.strokeStyle=Z4Constants.getStyle("white"),this.ctxBounds.setLineDash(n),this.ctxBounds.stroke(t),this.ctxBounds.restore()}}drawCanvasOverlay(){this.ctxOverlay.clearRect(0,0,this.canvasOverlay.width,this.canvasOverlay.height),this.canvasOverlayModes.has(Z4CanvasOverlayMode.PICK_COLOR)}}class Z4CanvasHistoryManager{canvas=null;paper=null;size=null;ribbonLayerPanel=null;constructor(e,t){this.canvas=e,this.paper=t}setSize(e){this.size=e}setRibbonLayerPanel(e){this.ribbonLayerPanel=e}openFromHistory(e){this.paper.reset(),this.ribbonLayerPanel.reset(),this.canvas.setSize(e.width,e.height),this.openLayerFromHistory(e,e.layers,0)}openLayerFromHistory(e,t,i){let s=document.createElement("img");s.onload=n=>(this.paper.addLayerFromImage(t[i].name,s,s.width,s.height),this.canvas.setSelectedLayerAndAddLayerPreview(this.paper.getLayerAt(i),e=>{e.setOpacity(t[i].opacity),e.setCompositeOperation(t[i].compositeOperation),e.setHidden(t[i].hidden),e.move(t[i].offsetX,t[i].offsetY)},!0),i+1<t.length?this.openLayerFromHistory(e,t,i+1):(this.canvas.afterCreate(e.projectName,e.width,e.height),this.canvas.setSaved(!1)),null),s.src=URL.createObjectURL(t[i].data)}toHistory(e){this.layerToJSON(null,[],0,e)}layerToJSON(e,t,i,s){let n=this.paper.getLayerAt(i);n.convertToBlob(a=>{e&&e.file("layers/layer"+i+".png",a,null);let r=n.getOffset(),o={};if(e||(o.data=a),o.name=n.getName(),o.opacity=n.getOpacity(),o.compositeOperation=n.getCompositeOperation(),o.hidden=n.isHidden(),o.offsetX=r.x,o.offsetY=r.y,t[i]=o,i+1===this.canvas.getLayersCount()){let l={};l.projectName=this.canvas.getProjectName(),l.width=this.size.width,l.height=this.size.height,l.layers=t,s(l)}else this.layerToJSON(e,t,i+1,s)})}}class Z4CanvasIOManager{canvas=null;paper=null;drawingTools=null;size=null;ribbonLayerPanel=null;ribbonDrawingToolPanel=null;ribbonHistoryPanel=null;statusPanel=null;constructor(e,t,i){this.canvas=e,this.paper=t,this.drawingTools=i}setSize(e){this.size=e}setRibbonPanels(e,t,i){this.ribbonLayerPanel=e,this.ribbonDrawingToolPanel=t,this.ribbonHistoryPanel=i}setStatusPanel(e){this.statusPanel=e}createFromHandle(e){e.getFile().then(e=>{this.createFromFile(e)})}createFromFile(e){Z4UI.pleaseWait(this.canvas,!0,!0,!0,!1,"",()=>{let t=new FileReader;t.onload=i=>this.createFromURL(e.name.substring(0,e.name.lastIndexOf(".")),t.result,Z4Translations.FROM_FILE),t.onerror=e=>(Z4UI.pleaseWaitCompleted(),JSOptionPane.showMessageDialog(Z4Translations.IMAGE_OPEN_ERROR_MESSAGE,Z4Translations.FROM_FILE,JSOptionPane.ERROR_MESSAGE,null),null),t.readAsDataURL(e)})}createFromClipboard(){Z4UI.pleaseWait(this.canvas,!0,!0,!0,!1,"",()=>navigator.clipboard.read().then(e=>{e.forEach(e=>{let t=e.types.find((e,t,i)=>e.startsWith("image/"));t?e.getType(t).then(e=>{this.createFromURL("",URL.createObjectURL(e),Z4Translations.FROM_CLIPBOARD)}):(Z4UI.pleaseWaitCompleted(),JSOptionPane.showMessageDialog(Z4Translations.IMAGE_OPEN_ERROR_MESSAGE,Z4Translations.FROM_CLIPBOARD,JSOptionPane.ERROR_MESSAGE,null))})}))}createFromURL(e,t,i){let s=document.createElement("img");return s.onload=t=>(Z4UI.pleaseWaitCompleted(),s.width<=Z4Constants.MAX_IMAGE_SIZE&&s.height<=Z4Constants.MAX_IMAGE_SIZE?(this.paper.reset(),this.paper.addLayerFromImage(Z4Translations.BACKGROUND_LAYER,s,s.width,s.height),this.canvas.setSize(s.width,s.height),this.ribbonLayerPanel.reset(),this.canvas.setSelectedLayerAndAddLayerPreview(this.paper.getLayerAt(this.canvas.getLayersCount()-1),null,!0),this.drawingTools.length=0,this.ribbonDrawingToolPanel.reset(),Color.resetHistory(),Z4GradientColor.resetHistory(),Z4BiGradientColor.resetHistory(),this.ribbonHistoryPanel.resetHistory(()=>{this.canvas.afterCreate(e,s.width,s.height),this.canvas.fitZoomIfNeeded(),this.canvas.toHistory(e=>this.ribbonHistoryPanel.addHistory(e,e=>this.ribbonHistoryPanel.setCurrentKey(e),!1))})):JSOptionPane.showMessageDialog(Z4Translations.IMAGE_TOO_BIG_MESSAGE.replace("$image_size$",s.width+" x "+s.height).replace("$max_image_size$",Z4Constants.MAX_IMAGE_SIZE+" x "+Z4Constants.MAX_IMAGE_SIZE),i,JSOptionPane.ERROR_MESSAGE,null),null),s.onerror=e=>(Z4UI.pleaseWaitCompleted(),JSOptionPane.showMessageDialog(Z4Translations.IMAGE_OPEN_ERROR_MESSAGE,i,JSOptionPane.ERROR_MESSAGE,null),null),s.src=t,null}openProjectFromHandle(e){e.getFile().then(e=>{this.openProjectFromFile(e)})}openProjectFromFile(file){let onError=e=>{Z4UI.pleaseWaitCompleted(),JSOptionPane.showMessageDialog(Z4Translations.IMAGE_OPEN_ERROR_MESSAGE,Z4Translations.OPEN_PROJECT,JSOptionPane.ERROR_MESSAGE,null)};Z4UI.pleaseWait(this.canvas,!0,!0,!1,!0,"",()=>{let promise=new JSZip().loadAsync(file).then(zip=>{let promise2=zip.file("manifest.json").async("string",null).then(e=>{this.paper.reset(),this.ribbonLayerPanel.reset(),this.drawingTools.length=0,this.ribbonDrawingToolPanel.reset(),Color.resetHistory(),Z4GradientColor.resetHistory(),Z4BiGradientColor.resetHistory(),this.ribbonHistoryPanel.resetHistory(()=>{let t=JSON.parse(""+e);this.canvas.setSize(t.width,t.height),this.openLayer(zip,t,t.layers,0)})});eval("promise2.catch(onError);")});eval("promise.catch(onError);")})}openLayer(e,t,i,s){e.file("layers/layer"+s+".png").async("blob",e=>Z4UI.setPleaseWaitProgressBarValue(e.percent)).then(n=>{let a=document.createElement("img");a.onload=n=>(this.paper.addLayerFromImage(i[s].name,a,a.width,a.height),this.canvas.setSelectedLayerAndAddLayerPreview(this.paper.getLayerAt(s),e=>{e.setOpacity(i[s].opacity),e.setCompositeOperation(i[s].compositeOperation),e.setHidden(i[s].hidden),e.move(i[s].offsetX,i[s].offsetY)},!0),s+1<i.length?this.openLayer(e,t,i,s+1):t.history?this.jsonToHistory(e,t,0,t.currentKeyHistory,0):this.jsonToArrays(e,()=>{this.canvas.afterCreate(t.projectName,t.width,t.height),this.canvas.fitZoomIfNeeded(),this.canvas.toHistory(e=>this.ribbonHistoryPanel.addHistory(e,e=>this.ribbonHistoryPanel.setCurrentKey(e),!1)),Z4UI.pleaseWaitCompleted()}),null),a.src=URL.createObjectURL(n)})}jsonToHistory(e,t,i,s,n){let a=t.history[i],r="history/history_"+a+"/";e.file(r+"manifest.json").async("string",null).then(o=>{let l=JSON.parse(""+o);this.layerToHistory(e,t,i,s,n,r,l,0,a)})}layerToHistory(e,t,i,s,n,a,r,o,l){e.file(a+"layers/layer"+o+".png").async("blob",e=>Z4UI.setPleaseWaitProgressBarValue(e.percent)).then(h=>{let d=r.layers;d[o].data=h,o+1<d.length?this.layerToHistory(e,t,i,s,n,a,r,o+1,l):i+1<t.history.length?this.ribbonHistoryPanel.addHistory(r,a=>this.jsonToHistory(e,t,i+1,s,s===l?a:n),!0):this.ribbonHistoryPanel.addHistory(r,i=>this.jsonToArrays(e,()=>{this.ribbonHistoryPanel.setCurrentKey(s===l?i:n),this.canvas.afterCreate(t.projectName,t.width,t.height),this.canvas.fitZoomIfNeeded(),Z4UI.pleaseWaitCompleted()}),!0)})}jsonToArrays(e,t){this.jsonToArray(e,"drawingTools",!1,e=>this.canvas.addDrawingTool(Z4DrawingTool.fromJSON(e)),()=>this.jsonToArray(e,"colors",!0,e=>Color.pushHistory(Color.fromJSON(e)),()=>this.jsonToArray(e,"gradientcolors",!0,e=>Z4GradientColor.pushHistory(Z4GradientColor.fromJSON(e)),()=>this.jsonToArray(e,"bigradientcolors",!0,e=>Z4BiGradientColor.pushHistory(Z4BiGradientColor.fromJSON(e)),t))))}jsonToArray(e,t,i,s,n){let a=e.file(t+".json");a?a.async("string",null).then(e=>{let a=JSON.parse(e)[t];i?a.reverse().forEach(e=>s(e)):a.forEach(e=>s(e)),n()}):n()}saveProjectToHandle(e,t){let i=e.name.substring(0,e.name.lastIndexOf("."));return this.saveProject(i,(t,i)=>e.createWritable(new FileSystemWritableFileStreamCreateOptions).then(e=>{e.write(t),e.close()}),t),i}saveProjectToFile(e,t){this.saveProject(e,(e,t)=>saveAs(e,t),t)}saveProject(e,t,i){Z4UI.pleaseWait(this.canvas,!0,!0,!1,!0,"",()=>{this.statusPanel.setProjectName(e);let s=new JSZip;this.layerToJSON(s,e,[],0,n=>{let a=()=>{this.writeJSONArray(s,"drawingTools",e=>this.drawingTools.forEach(t=>e.push(t.toJSON()))),this.writeJSONArray(s,"colors",e=>Color.getHistory().forEach(t=>e.push(t.getJSON()))),this.writeJSONArray(s,"gradientcolors",e=>Z4GradientColor.getHistory().forEach(t=>e.push(t.toJSON()))),this.writeJSONArray(s,"bigradientcolors",e=>Z4BiGradientColor.getHistory().forEach(t=>e.push(t.toJSON()))),s.file("manifest.json",JSON.stringify(n),null);let a={};a.type="blob",a.compression="DEFLATE",a.streamFiles=!0;let r={};r.level=9,a.compressionOptions=r,s.generateAsync(a,e=>Z4UI.setPleaseWaitProgressBarValue(e.percent)).then(s=>{t(s,e+".z4i"),this.canvas.setSaved(!0),Z4UI.pleaseWaitCompleted(),i&&i()})};n.currentKeyHistory=this.ribbonHistoryPanel.getCurrentKey(),n.history=[],this.historyToJSON(s,n,a)})})}writeJSONArray(e,t,i){let s={},n=[];i(n),s[t]=n,e.file(t+".json",JSON.stringify(s),null)}layerToJSON(e,t,i,s,n){let a=this.paper.getLayerAt(s);a.convertToBlob(r=>{e&&e.file("layers/layer"+s+".png",r,null);let o=a.getOffset(),l={};if(e||(l.data=r),l.name=a.getName(),l.opacity=a.getOpacity(),l.compositeOperation=a.getCompositeOperation(),l.hidden=a.isHidden(),l.offsetX=o.x,l.offsetY=o.y,i[s]=l,s+1===this.canvas.getLayersCount()){let h={};h.projectName=t,h.width=this.size.width,h.height=this.size.height,h.layers=i,n(h)}else this.layerToJSON(e,t,i,s+1,n)})}historyToJSON(e,t,i){this.ribbonHistoryPanel.iterateHistoryBuffer((s,n,a)=>{if(-1!==s){t.history.push(s);let r="history/history_"+s+"/";n.layers.forEach((t,i,s)=>{e.file(r+"layers/layer"+i+".png",t.data,null),t.data=null}),e.file(r+"manifest.json",JSON.stringify(n),null),a()}else i()})}exportToFile(e,t,i){this.exportTo(t,i,i=>{let s=document.createElement("a");s.setAttribute("href",URL.createObjectURL(i)),s.setAttribute("download",e+t),document.body.appendChild(s);let n=document.createEvent("MouseEvents");n.initEvent("click",!1,!1),s.dispatchEvent(n),document.body.removeChild(s)})}exportToHandle(e,t){e.getFile().then(i=>{this.exportTo(i.name.toLowerCase().substring(i.name.toLowerCase().lastIndexOf(".")),t,t=>e.createWritable(new FileSystemWritableFileStreamCreateOptions).then(e=>{e.write(t),e.close()}))})}exportTo(e,t,i){Z4UI.pleaseWait(this.canvas,!1,!1,!1,!1,"",()=>{let s=new OffscreenCanvas(this.size.width,this.size.height),n=s.getContext("2d");this.paper.draw(n,!1);let a={};a.type=".png"===e?"image/png":"image/jpeg",a.quality=t,s.convertToBlob(a).then(e=>{i(e)})})}addLayerFromHandle(e){e.getFile().then(e=>{this.addLayerFromFile(e)})}addLayerFromFile(e){Z4UI.pleaseWait(this.canvas,!0,!0,!0,!1,"",()=>{let t=e.name.substring(0,e.name.lastIndexOf(".")),i=new FileReader;i.onload=e=>this.addLayerFromURL(t,i.result,Z4Translations.FROM_FILE),i.onerror=e=>(Z4UI.pleaseWaitCompleted(),JSOptionPane.showMessageDialog(Z4Translations.IMAGE_OPEN_ERROR_MESSAGE,Z4Translations.FROM_FILE,JSOptionPane.ERROR_MESSAGE,null),null),i.readAsDataURL(e)})}addLayerFromClipboard(){Z4UI.pleaseWait(this.canvas,!0,!0,!0,!1,"",()=>navigator.clipboard.read().then(e=>{e.forEach(e=>{let t=e.types.find((e,t,i)=>e.startsWith("image/"));t?e.getType(t).then(e=>{this.addLayerFromURL(this.canvas.findLayerName(),URL.createObjectURL(e),Z4Translations.FROM_CLIPBOARD)}):(Z4UI.pleaseWaitCompleted(),JSOptionPane.showMessageDialog(Z4Translations.IMAGE_OPEN_ERROR_MESSAGE,Z4Translations.FROM_CLIPBOARD,JSOptionPane.ERROR_MESSAGE,null))})}))}mergeLayers(e){let t=new OffscreenCanvas(this.size.width,this.size.height),i=t.getContext("2d");e.forEach(e=>e.draw(i,!1));let s={};s.type="image/png",t.convertToBlob(s).then(e=>{this.addLayerFromURL(this.canvas.findLayerName(),URL.createObjectURL(e),Z4Translations.MERGE)})}addLayerFromURL(e,t,i){let s=document.createElement("img");return s.onload=t=>(Z4UI.pleaseWaitCompleted(),s.width<=Z4Constants.MAX_IMAGE_SIZE&&s.height<=Z4Constants.MAX_IMAGE_SIZE?(this.paper.addLayerFromImage(e,s,this.size.width,this.size.height),this.canvas.afterAddLayer(),this.canvas.drawCanvas()):JSOptionPane.showMessageDialog(Z4Translations.IMAGE_TOO_BIG_MESSAGE.replace("$image_size$",s.width+" x "+s.height).replace("$max_image_size$",Z4Constants.MAX_IMAGE_SIZE+" x "+Z4Constants.MAX_IMAGE_SIZE),i,JSOptionPane.ERROR_MESSAGE,null),null),s.onerror=e=>(Z4UI.pleaseWaitCompleted(),JSOptionPane.showMessageDialog(Z4Translations.IMAGE_OPEN_ERROR_MESSAGE,i,JSOptionPane.ERROR_MESSAGE,null),null),s.src=t,null}addDrawingToolFromHandle(e){e.getFile().then(e=>{this.addDrawingToolFromFile(e)})}addDrawingToolFromFile(e){let t=new FileReader;t.onload=i=>{try{let s=JSON.parse(t.result);e.name.toLowerCase().endsWith(".z4ts")?s.drawingTools.forEach(e=>this.canvas.addDrawingTool(Z4DrawingTool.fromJSON(e))):this.canvas.addDrawingTool(Z4DrawingTool.fromJSON(s))}catch(n){JSOptionPane.showMessageDialog(Z4Translations.DRAWING_TOOL_OPEN_ERROR_MESSAGE,Z4Translations.FROM_FILE,JSOptionPane.ERROR_MESSAGE,null)}return null},t.onerror=e=>(JSOptionPane.showMessageDialog(Z4Translations.DRAWING_TOOL_OPEN_ERROR_MESSAGE,Z4Translations.FROM_FILE,JSOptionPane.ERROR_MESSAGE,null),null),t.readAsText(e)}saveDrawingToolToFile(fileName,drawingTool){fileName.toLowerCase().endsWith(".z4t")||(fileName+=".z4t");let blob=null;eval("blob = new Blob([JSON.stringify(drawingTool.toJSON())], {type: 'application/json'});"),saveAs(blob,fileName)}saveDrawingToolToHandle(e,t){e.createWritable(new FileSystemWritableFileStreamCreateOptions).then(e=>{e.write(JSON.stringify(t.toJSON())),e.close()})}saveDrawingToolsToFile(fileName){fileName.toLowerCase().endsWith(".z4ts")||(fileName+=".z4ts"),this.saveDrawingTools(fileName,(json,name)=>{let blob=null;eval("blob = new Blob([JSON.stringify(json)], {type: 'application/json'});"),saveAs(blob,name)})}saveDrawingToolsToHandle(e){let t=e.name.substring(0,e.name.lastIndexOf("."));this.saveDrawingTools(t,(t,i)=>e.createWritable(new FileSystemWritableFileStreamCreateOptions).then(e=>{e.write(JSON.stringify(t)),e.close()}))}saveDrawingTools(e,t){Z4UI.pleaseWait(this.canvas,!1,!1,!1,!1,"",()=>{let i=[];this.drawingTools.forEach(e=>i.push(e.toJSON()));let s={};s.drawingTools=i,t(s,e)})}}class Z4CanvasMouseManager{canvas=null;ctx=null;selectedLayer=null;selectedDrawingTool=null;drawingDirection=Z4DrawingDirection.FREE;centerGrid=null;plotWidthGrid=0;magneticGrid=!1;size=null;zoom=0;canvasOverlayModes=new Set;ribbonHistoryPanel=null;statusPanel=null;pressed=!1;onStartX=0;onStartY=0;constructor(e,t){this.canvas=e,this.ctx=t}setSelectedLayer(e){this.selectedLayer=e}setSelectedDrawingTool(e){this.selectedDrawingTool=e}setDrawingDirection(e){this.drawingDirection=e}setMagneticGrid(e,t,i){this.centerGrid=e,this.plotWidthGrid=t,this.magneticGrid=i}setSize(e){this.size=e}setZoom(e){this.zoom=e}addCanvasOverlayMode(e){this.canvasOverlayModes.add(e)}removeCanvasOverlayMode(e){this.canvasOverlayModes.delete(e)}setRibbonHistoryPanel(e){this.ribbonHistoryPanel=e}setStatusPanel(e){this.statusPanel=e}onMouse(e,t){let i=Math.min(this.size.width,Math.max(0,e.offsetX/this.zoom)),s=Math.min(this.size.height,Math.max(0,e.offsetY/this.zoom)),n=parseInt(i),a=parseInt(s);if(this.canvasOverlayModes.has(Z4CanvasOverlayMode.PICK_COLOR))switch(t){case"up":this.statusPanel.colorPicked(this.canvas.getColorAt(n,a),this.canvas.getSelectedLayerColorAt(n,a));break;case"move":this.statusPanel.setMousePosition(n,a)}else switch(t){case"enter":this.pressed=1===e.buttons,this.onAction(Z4PointIteratorDrawingAction.START,i,s),this.onAction(Z4PointIteratorDrawingAction.CONTINUE,i,s);break;case"down":this.pressed=!0,this.onAction(Z4PointIteratorDrawingAction.START,i,s);break;case"move":this.statusPanel.setMousePosition(n,a),this.onAction(Z4PointIteratorDrawingAction.CONTINUE,i,s);break;case"up":this.onStop(i,s);break;case"leave":this.pressed&&this.onStop(i,s)}}onAction(e,t,i){let s=this.checkPoint(e,t,i);this.selectedDrawingTool&&this.selectedLayer&&s&&this.pressed&&this.selectedDrawingTool.drawAction(e,s.x,s.y)&&(this.ribbonHistoryPanel.stopStandard(),this.iteratePoints(e))}onStop(e,t){this.pressed=!1,this.selectedDrawingTool&&this.selectedLayer&&(this.selectedDrawingTool.drawAction(Z4PointIteratorDrawingAction.STOP,e,t)?(this.ribbonHistoryPanel.stopStandard(),this.iteratePoints(Z4PointIteratorDrawingAction.STOP)):this.startStandard())}checkPoint(e,t,i){let s=this.magneticGrid?Z4Math.nearestPointInGrid(t,i,this.centerGrid.x,this.centerGrid.y,this.plotWidthGrid,Z4Constants.MAGNETISM_PERCENTAGE):new Z4Point(t,i);if(!s)return e===Z4PointIteratorDrawingAction.START&&(this.pressed=!1),null;if(e===Z4PointIteratorDrawingAction.START)return this.onStartX=t,this.onStartY=i,s;if(this.drawingDirection===Z4DrawingDirection.FREE)return s;if(this.drawingDirection===Z4DrawingDirection.HORIZONTAL)return new Z4Point(s.x,this.onStartY);if(this.drawingDirection===Z4DrawingDirection.VERTICAL)return new Z4Point(this.onStartX,s.y);else return null}iteratePoints(e){if(e!==Z4PointIteratorDrawingAction.STOP){for(;this.drawNextPoint(););this.selectedDrawingTool.isInfinitePointGenerator()&&this.pressed&&setTimeout(()=>this.iteratePoints(e),this.selectedDrawingTool.getInfinitePointGeneratorSleep())}else this.selectedDrawingTool.getNextCountOnSTOP()?Z4UI.pleaseWait(this.canvas,!0,!0,!1,!0,"",()=>this.iteratePoint(0)):this.startStandard()}iteratePoint(e){Z4UI.setPleaseWaitProgressBarValue(100*e/this.selectedDrawingTool.getNextCountOnSTOP()),this.drawNextPoint()?Z4UI.pleaseWaitAdvanced(()=>this.iteratePoint(e+1)):(this.startStandard(),Z4UI.pleaseWaitCompleted())}drawNextPoint(){let e=this.selectedDrawingTool.next();return!!e&&(e.intent===Z4DrawingPointIntent.DRAW_OBJECTS?(this.selectedLayer.drawTool(this.selectedDrawingTool,e),this.selectedLayer.getLayerPreview().drawLayer(),this.canvas.drawCanvas(),!0):(1!==this.zoom&&(e=new Z4DrawingPoint(Z4Vector.fromPoints(this.zoom*e.z4Vector.x0,this.zoom*e.z4Vector.y0,this.zoom*e.z4Vector.x,this.zoom*e.z4Vector.y),e.intensity,e.temporalPosition,e.intent,e.side,e.useVectorModuleAsSize)),e.intent===Z4DrawingPointIntent.REPLACE_PREVIOUS_BOUNDS&&this.canvas.drawCanvas(),this.ctx.save(),this.ctx.translate(e.z4Vector.x0,e.z4Vector.y0),this.ctx.rotate(e.z4Vector.phase),this.selectedDrawingTool.draw(this.ctx,e),this.ctx.restore(),!0))}startStandard(){this.canvas.setChanged(!0),this.canvas.setSaved(!1),this.ribbonHistoryPanel.startStandard()}}class Z4CanvasOverlayMode{static PICK_COLOR="PICK_COLOR";static DRAW_TEXT="DRAW_TEXT"}class Z4DrawingToolPreview extends JSDropDown{summary=new JSPanel;name=new JSLabel;preview=new JSComponent(document.createElement("canvas"));ctx=this.preview.invoke("getContext('2d')");editor=new Z4DrawingToolPanel;ribbonDrawingToolPanel=null;canvas=null;drawingTool=null;oldDrawingTool=null;changed=!1;static SELECTED_DRAWING_TOOL_CONTENT="x";static UNSELECTED_DRAWING_TOOL_CONTENT="-";static PREVIEW_SIZE=48;constructor(){super(".z4drawingtoolpreview-editor"),this.cssAddClass("z4drawingtoolpreview"),this.addEventListener("toggle",e=>{""+this.getProperty("open")=="true"?(this.changed=!1,this.oldDrawingTool=this.drawingTool):this.changed&&(this.canvas.setChanged(!0),this.canvas.replaceDrawingTool(this.oldDrawingTool,this.drawingTool),JSON.stringify(this.oldDrawingTool.getSpatioTemporalColor().toJSON())!==JSON.stringify(this.drawingTool.getSpatioTemporalColor().toJSON())&&Z4Constants.pushHistory(this.drawingTool.getSpatioTemporalColor()))}),this.name.getStyle().width=Z4DrawingToolPreview.PREVIEW_SIZE+15+"px",this.preview.setAttribute("width",""+Z4DrawingToolPreview.PREVIEW_SIZE),this.preview.setAttribute("height",""+Z4DrawingToolPreview.PREVIEW_SIZE),this.summary.setLayout(new GridBagLayout),this.summary.add(this.name,new GBC(0,0).w(2)),this.summary.add(this.preview,new GBC(0,1));let e=new JSButton;e.setText(Z4DrawingToolPreview.SELECTED_DRAWING_TOOL_CONTENT),e.setTooltip(Z4Translations.SELECTED),e.cssAddClass("z4drawingtoolpreview-selector"),e.getStyle().color="var(--main-action-bgcolor)",e.setContentAreaFilled(!1),e.addActionListener(t=>{document.querySelectorAll(".z4drawingtoolpreview .z4drawingtoolpreview-selector").forEach(e=>e.textContent=Z4DrawingToolPreview.UNSELECTED_DRAWING_TOOL_CONTENT),e.setText(Z4DrawingToolPreview.SELECTED_DRAWING_TOOL_CONTENT),this.canvas.setSelectedDrawingTool(this.drawingTool)}),this.summary.add(e,new GBC(1,1).a(GBC.NORTH).i(0,2,0,0)),this.appendChildInTree("summary",this.summary),this.editor.cssAddClass("z4drawingtoolpreview-editor"),this.editor.addChangeListener(e=>{this.changed=!0,this.drawingTool=this.editor.getValue(),this.name.setText(this.drawingTool.getName()),this.setChildAttributeByQuery("summary","title",this.drawingTool.getName()),this.computePopupPosition(),this.drawDemo()}),this.appendChild(this.editor),this.editor.addAction(Z4Translations.DUPLICATE,new GBC(0,0).a(GBC.NORTH).i(0,1,0,0),e=>{let t=this.drawingTool.toJSON();t.name=this.canvas.findDrawingToolName(),this.canvas.addDrawingTool(Z4DrawingTool.fromJSON(t)),this.removeAttribute("open"),setTimeout(()=>document.querySelector(".z4drawingtoolpreview:nth-last-child(1)").setAttribute("open","open"),0)}),this.editor.addAction(Z4Translations.SAVE_DRAWING_TOOL_AS,new GBC(1,0).a(GBC.NORTH).i(0,1,0,0),e=>this.save()),this.editor.addAction(Z4Translations.DELETE,new GBC(2,0).a(GBC.NORTHEAST).wxy(1,1),e=>JSOptionPane.showConfirmDialog(Z4Translations.DELETE_DRAWING_TOOL_MESSAGE,Z4Translations.DELETE,JSOptionPane.YES_NO_OPTION,JSOptionPane.QUESTION_MESSAGE,e=>{if(e===JSOptionPane.YES_OPTION){this.changed=!0;let t=this.canvas.deleteDrawingTool(this.drawingTool);document.querySelector(".z4drawingtoolpreview:nth-child("+(t+1)+")").remove()}}))}setRibbonDrawingToolPanel(e){this.ribbonDrawingToolPanel=e}setDrawingTool(e,t){this.canvas=e,this.drawingTool=t,this.name.setText(this.drawingTool.getName()),this.editor.setValue(this.drawingTool),this.setChildAttributeByQuery("summary","title",this.drawingTool.getName()),this.drawDemo()}drawDemo(){this.drawingTool&&(this.ctx.clearRect(0,0,Z4DrawingToolPreview.PREVIEW_SIZE,Z4DrawingToolPreview.PREVIEW_SIZE),this.ctx.save(),this.ctx.scale(.1,.1),this.drawingTool.getPointIterator().drawDemo(this.ctx,this.drawingTool.getPainter(),this.drawingTool.getSpatioTemporalColor(),this.drawingTool.getProgression(),10*Z4DrawingToolPreview.PREVIEW_SIZE,10*Z4DrawingToolPreview.PREVIEW_SIZE,!1),this.ctx.restore())}save(){"function"==typeof window.showSaveFilePicker?this.saveToolsToHandle():this.saveToolsToFile()}saveToolsToFile(){let e=new JSPanel;e.setLayout(new BorderLayout(0,0));let t=new JSLabel;t.setText(Z4Translations.FILENAME),e.add(t,BorderLayout.NORTH);let i=new JSTextField;i.setText(this.drawingTool.getName()),e.add(i,BorderLayout.CENTER),JSOptionPane.showInputDialog(e,Z4Translations.SAVE,e=>i.addActionListener(t=>e(new ChangeEvent)),()=>!!i.getText(),e=>{e===JSOptionPane.OK_OPTION&&this.canvas.saveDrawingToolToFile(i.getText(),this.drawingTool)})}saveToolsToHandle(){let e=new FilePickerOptions;e.excludeAcceptAllOption=!0,e.id=Z4Constants.TOOL_FILE_ID,e.multiple=!1,e.suggestedName=this.drawingTool.getName(),e.types=Z4Constants.PIZZAPAZZA_SAVE_TOOL_FILE_TYPE,JSFilePicker.showSaveFilePicker(e,e=>this.canvas.saveDrawingToolToHandle(e,this.drawingTool))}}class Z4HistoryPreview extends JSDropDown{summary=new JSPanel;preview=new JSComponent(document.createElement("canvas"));previewBig=new JSComponent(document.createElement("canvas"));ctx=this.preview.invoke("getContext('2d')");ctxBig=this.previewBig.invoke("getContext('2d')");ribbonHistoryPanel=null;canvas=null;key=0;json=null;zoom=1;zoomBig=1;static PREVIEW_SIZE=50;static PREVIEW_BIG_SIZE=500;static SELECTED_HISTORY_CONTENT="x";static UNSELECTED_HISTORY_CONTENT="-";constructor(){super(".z4historypreview-editor"),this.cssAddClass("z4historypreview"),this.summary.setLayout(new GridBagLayout),this.preview.setAttribute("width",""+Z4HistoryPreview.PREVIEW_SIZE),this.preview.setAttribute("height",""+Z4HistoryPreview.PREVIEW_SIZE),this.summary.add(this.preview,new GBC(0,0));let e=new JSButton;e.setText(Z4HistoryPreview.UNSELECTED_HISTORY_CONTENT),e.setTooltip(Z4Translations.SELECTED),e.cssAddClass("z4historypreview-selector"),e.getStyle().color="var(--main-action-bgcolor)",e.setContentAreaFilled(!1),e.addActionListener(e=>{this.ribbonHistoryPanel.setCurrentKey(this.key),this.canvas.openFromHistory(this.json)}),this.summary.add(e,new GBC(1,0).a(GBC.NORTH).i(0,2,0,0)),this.appendChildInTree("summary",this.summary),this.previewBig.setAttribute("width",""+Z4HistoryPreview.PREVIEW_BIG_SIZE),this.previewBig.setAttribute("height",""+Z4HistoryPreview.PREVIEW_BIG_SIZE);let t=new JSPanel;t.cssAddClass("z4historypreview-editor"),t.add(this.previewBig,null),this.appendChild(t)}setRibbonHistoryPanel(e){this.ribbonHistoryPanel=e}setHistory(e,t,i){this.key=e,this.json=t,this.canvas=i,this.cssAddClass("z4historypreview-"+e);let s=new Dimension(t.width,t.height);this.zoom=this.setSize(this.preview,s,Z4HistoryPreview.PREVIEW_SIZE),this.zoomBig=this.setSize(this.previewBig,s,Z4HistoryPreview.PREVIEW_BIG_SIZE),this.drawHistory(this.ctx,this.zoom),this.drawHistory(this.ctxBig,this.zoomBig)}setSize(e,t,i){let s=t.width/t.height,n=0,a=0;return s>1?(n=i,a=i/s):(n=i*s,a=i),e.setAttribute("width",""+n),e.setAttribute("height",""+a),e.getStyle().marginTop=(i-a-1)/2+"px",e.getStyle().marginBottom=(i-a-1)/2+"px",e.getStyle().marginLeft=(i-n-1)/2+"px",e.getStyle().marginRight=(i-n-1)/2+"px",Math.min(n/t.width,a/t.height)}drawHistory(e,t){e.scale(t,t),this.drawLayer(e,this.json.layers,0)}drawLayer(e,t,i){let s=t[i];if(s.hidden)i<t.length-1&&this.drawLayer(e,t,i+1);else{let n=document.createElement("img");n.onload=a=>(e.save(),e.globalAlpha=s.opacity,e.globalCompositeOperation=s.compositeOperation,e.drawImage(n,s.offsetX,s.offsetY),e.restore(),i<t.length-1&&this.drawLayer(e,t,i+1),null),n.src=URL.createObjectURL(s.data)}}}class Z4LayerPreview extends JSDropDown{summary=new JSPanel;name=new JSLabel;eye=new JSButton;preview=new JSComponent(document.createElement("canvas"));ctx=this.preview.invoke("getContext('2d')");editor=new JSTabbedPane;editName=new JSTextField;size=new JSLabel;offsetXSlider=new JSSlider;offsetXSpinner=new JSSpinner;offsetYSlider=new JSSlider;offsetYSpinner=new JSSpinner;opacitySlider=new JSSlider;opacitySpinner=new JSSpinner;compositeOperations=[];compositeOperationsGroup=new ButtonGroup;delete=new JSButton;ribbonLayerPanel=null;canvas=null;layer=null;zoom=1;changed=!1;static SELECTED_LAYER_CONTENT="x";static UNSELECTED_LAYER_CONTENT="-";static VISIBLE_LAYER_CONTENT="#";static PREVIEW_SIZE=50;constructor(){super(".z4layerpreview-editor"),this.cssAddClass("z4layerpreview"),this.addEventListener("toggle",e=>{""+this.getProperty("open")=="true"?(this.changed=!1,this.delete.setEnabled(this.canvas.getLayersCount()>1)):this.changed&&(this.canvas.setChanged(!0),this.canvas.saveHistory("standard,tool"))}),this.name.getStyle().width=Z4LayerPreview.PREVIEW_SIZE+35+"px",this.preview.setAttribute("width",""+Z4LayerPreview.PREVIEW_SIZE),this.preview.setAttribute("height",""+Z4LayerPreview.PREVIEW_SIZE),this.summary.setLayout(new GridBagLayout),this.summary.add(this.name,new GBC(0,0).w(3)),this.summary.add(this.preview,new GBC(1,1).h(3).f(GBC.BOTH)),this.eye.setText(Z4LayerPreview.VISIBLE_LAYER_CONTENT),this.eye.setTooltip(Z4Translations.VISIBLE),this.eye.setContentAreaFilled(!1),this.eye.addActionListener(e=>{let t=!this.layer.isHidden();t?this.eye.getStyle().removeProperty("color"):this.eye.getStyle().color="var(--main-action-bgcolor)",this.layer.setHidden(t),this.canvas.setChanged(!0),this.canvas.setSaved(!1),this.canvas.drawCanvas()}),this.summary.add(this.eye,new GBC(0,1).f(GBC.BOTH).i(0,0,0,2));let e=new JSButton;e.setText(Z4LayerPreview.SELECTED_LAYER_CONTENT),e.setTooltip(Z4Translations.SELECTED),e.cssAddClass("z4layerpreview-selector"),e.getStyle().color="var(--main-action-bgcolor)",e.setContentAreaFilled(!1),e.addActionListener(t=>{document.querySelectorAll(".z4layerpreview .z4layerpreview-selector").forEach(e=>e.textContent=Z4LayerPreview.UNSELECTED_LAYER_CONTENT),e.setText(Z4LayerPreview.SELECTED_LAYER_CONTENT),this.canvas.setSelectedLayer(this.layer)}),this.summary.add(e,new GBC(2,1).f(GBC.BOTH).i(0,2,0,0));let t=new JSButton;t.setText("\uD83E\uDC08"),t.setTooltip(Z4Translations.MOVE_DOWN),t.getStyle().color="var(--main-action-bgcolor)",t.setContentAreaFilled(!1),t.addActionListener(e=>this.move(-1)),this.summary.add(t,new GBC(0,2).f(GBC.BOTH).i(0,0,0,2)),(t=new JSButton).setText("⯬"),t.setTooltip(Z4Translations.MOVE_BOTTOM),t.getStyle().color="var(--main-action-bgcolor)",t.setContentAreaFilled(!1),t.addActionListener(e=>this.ribbonLayerPanel.moveLayer(this,this.layer,0)),this.summary.add(t,new GBC(0,3).f(GBC.BOTH).i(0,0,0,2)),(t=new JSButton).setText("\uD83E\uDC0A"),t.setTooltip(Z4Translations.MOVE_UP),t.getStyle().color="var(--main-action-bgcolor)",t.setContentAreaFilled(!1),t.addActionListener(e=>this.move(2)),this.summary.add(t,new GBC(2,2).f(GBC.BOTH).i(0,2,0,0)),(t=new JSButton).setText("⯮"),t.setTooltip(Z4Translations.MOVE_TOP),t.getStyle().color="var(--main-action-bgcolor)",t.setContentAreaFilled(!1),t.addActionListener(e=>this.ribbonLayerPanel.moveLayer(this,this.layer,this.canvas.getLayersCount())),this.summary.add(t,new GBC(2,3).f(GBC.BOTH).i(0,2,0,0)),Z4UI.addVLine(this.summary,new GBC(3,0).h(4).f(GBC.VERTICAL).i(1,2,1,2)),this.appendChildInTree("summary",this.summary),this.editor.cssAddClass("z4layerpreview-editor"),this.editor.addChangeListener(e=>this.computePopupPosition());let i=new JSPanel;i.setLayout(new GridBagLayout),this.editName.addActionListener(e=>{let t=this.editName.getText();t&&(this.changed=!0,this.canvas.setSaved(!1),this.name.setText(t),this.layer.setName(t),this.setChildAttributeByQuery("summary","title",t))}),Z4UI.addLabel(i,Z4Translations.LAYER_NAME,new GBC(0,0).a(GBC.WEST).wx(1)),i.add(this.size,new GBC(1,0).a(GBC.EAST).w(4)),i.add(this.editName,new GBC(0,1).w(5).a(GBC.WEST).f(GBC.HORIZONTAL).i(0,0,5,0)),Z4UI.addLabel(i,Z4Translations.OFFSET_X,new GBC(0,2).a(GBC.WEST)),this.offsetXSpinner.cssAddClass("jsspinner_w_4rem"),this.offsetXSpinner.addChangeListener(e=>this.onChange(!0,this.offsetXSpinner.getValueIsAdjusting(),this.offsetXSpinner,this.offsetXSlider)),i.add(this.offsetXSpinner,new GBC(1,2).a(GBC.EAST)),this.offsetXSlider.getStyle().minWidth="20rem",this.offsetXSlider.addChangeListener(e=>this.onChange(!1,this.offsetXSlider.getValueIsAdjusting(),this.offsetXSpinner,this.offsetXSlider)),i.add(this.offsetXSlider,new GBC(0,3).w(2).a(GBC.NORTH).f(GBC.HORIZONTAL)),Z4UI.addLabel(i,Translations.JSColorChooser_OPACITY,new GBC(0,4).a(GBC.WEST)),this.opacitySpinner.cssAddClass("jsspinner_w_4rem"),this.opacitySpinner.addChangeListener(e=>this.onChange(!0,this.opacitySpinner.getValueIsAdjusting(),this.opacitySpinner,this.opacitySlider)),i.add(this.opacitySpinner,new GBC(1,4).a(GBC.EAST)),this.opacitySlider.addChangeListener(e=>this.onChange(!1,this.opacitySlider.getValueIsAdjusting(),this.opacitySpinner,this.opacitySlider)),this.opacitySlider.getStyle().minWidth="20rem",i.add(this.opacitySlider,new GBC(0,5).w(2).a(GBC.NORTH).f(GBC.HORIZONTAL)),Z4UI.addVLine(i,new GBC(2,2).h(6).f(GBC.VERTICAL).i(1,2,1,2)),Z4UI.addLabel(i,Z4Translations.OFFSET_Y,new GBC(3,5).h(3).a(GBC.SOUTH)).cssAddClass("jslabel-vertical"),this.offsetYSpinner.cssAddClass("jsspinner-vertical"),this.offsetYSpinner.cssAddClass("jsspinner_h_4rem"),this.offsetYSpinner.setChildPropertyByQuery("*:nth-child(2)","textContent","▶"),this.offsetYSpinner.setChildPropertyByQuery("*:nth-child(3)","textContent","◀"),this.offsetYSpinner.addChangeListener(e=>this.onChange(!0,this.offsetYSpinner.getValueIsAdjusting(),this.offsetYSpinner,this.offsetYSlider)),i.add(this.offsetYSpinner,new GBC(3,2).h(3).a(GBC.NORTH)),this.offsetYSlider.setOrientation(JSSlider.VERTICAL),this.offsetYSlider.setInverted(!0),this.offsetYSlider.getStyle().minHeight="20rem",this.offsetYSlider.getStyle().minWidth="1.5rem",this.offsetYSlider.addChangeListener(e=>this.onChange(!1,this.offsetYSlider.getValueIsAdjusting(),this.offsetYSpinner,this.offsetYSlider)),i.add(this.offsetYSlider,new GBC(4,2).h(6).wy(1).a(GBC.NORTH));let s=new JSCheckBox;s.setText(Z4Translations.SHOW_LAYER_BOUNDS),s.addActionListener(e=>{this.layer.setShowBounds(s.isSelected()),this.canvas.drawCanvasBounds()}),i.add(s,new GBC(0,6).a(GBC.NORTHWEST)),(t=new JSButton).setText(Z4Translations.DUPLICATE),t.addActionListener(e=>{this.changed=!0,this.canvas.duplicateLayer(this.layer),this.removeAttribute("open")}),i.add(t,new GBC(0,7).a(GBC.SOUTHWEST)),this.delete.setText(Z4Translations.DELETE),this.delete.addActionListener(e=>JSOptionPane.showConfirmDialog(Z4Translations.DELETE_LAYER_MESSAGE,Z4Translations.DELETE,JSOptionPane.YES_NO_OPTION,JSOptionPane.QUESTION_MESSAGE,e=>{if(e===JSOptionPane.YES_OPTION){this.changed=!0;let t=this.canvas.deleteLayer(this.layer,!1);document.querySelector(".z4layerpreview:nth-child("+(t+1)+")").remove()}})),i.add(this.delete,new GBC(1,7).a(GBC.SOUTHEAST)),this.editor.addTab(Z4Translations.BASIC,i);let n=new JSPanel;n.setLayout(new GridBagLayout),Z4UI.addLabel(n,Z4Translations.COMPOSITE_OPERATION,new GBC(0,0).a(GBC.WEST)),Z4Constants.COMPOSITE_OPERATION.forEach((e,t,i)=>{e.forEach((e,i,s)=>{let a=new JSRadioButton;a.setContentAreaFilled(!1),a.setToggle(),a.setText(e),a.setTooltip(Z4Translations["COMPOSITE_OPERATION_"+e.toUpperCase().replace("-","_")]),a.addActionListener(t=>this.onAction(e)),this.compositeOperations.push(a),this.compositeOperationsGroup.add(a),n.add(a,new GBC(i,t+1).a(GBC.WEST).f(GBC.HORIZONTAL).i(1,1,1,1))})}),this.editor.addTab(Z4Translations.ADVANCED,n);let a=new JSPanel;a.setLayout(new GridBagLayout),this.editor.addTab(Z4Translations.TRANSFORM,a),this.addButton(a,Z4Translations.FLIP_HORIZONTAL,0,0,e=>{this.layer.flipHorizonal(),this.afterTransform()}),this.addButton(a,Z4Translations.FLIP_VERTICAL,1,0,e=>{this.layer.flipVertical(),this.afterTransform()}),this.addButton(a,Z4Translations.RESIZE,2,0,e=>{let t=this.layer.getSize(),i=new OffscreenCanvas(t.width,t.height);this.layer.draw(i.getContext("2d"),!0);let s=new Z4ResizeImagePanel;s.setCanvas(i,t.width,t.height),JSOptionPane.showInputDialog(s,Z4Translations.RESIZE,e=>s.addChangeListener(e),()=>{let e=s.getResizeOptions(),t=0<e.containerWidth&&e.containerWidth<=Z4Constants.MAX_IMAGE_SIZE&&0<e.containerHeight&&e.containerHeight<=Z4Constants.MAX_IMAGE_SIZE,i=0<e.contentWidth&&e.contentWidth<=Z4Constants.MAX_IMAGE_SIZE&&0<e.contentHeight&&e.contentHeight<=Z4Constants.MAX_IMAGE_SIZE;return t&&i},e=>{e===JSOptionPane.OK_OPTION&&(this.layer.resize(s.getResizeOptions()),this.setLayer(this.canvas,this.layer),this.afterTransform())})}),this.addButton(a,Z4Translations.ROTATE_PLUS_90,0,1,e=>{this.layer.rotatePlus90(),this.setLayer(this.canvas,this.layer),this.afterTransform()}),this.addButton(a,Z4Translations.ROTATE_MINUS_90,1,1,e=>{this.layer.rotatePlus90(),this.layer.rotatePlus90(),this.layer.rotatePlus90(),this.setLayer(this.canvas,this.layer),this.afterTransform()}),this.addButton(a,Z4Translations.ROTATE_180,2,1,e=>{this.layer.rotatePlus90(),this.layer.rotatePlus90(),this.setLayer(this.canvas,this.layer),this.afterTransform()}),this.addButton(a,"",3,1,e=>this.setLayer(this.canvas,this.layer)).cssAddClass("z4layerpreview-setlayer"),this.appendChild(this.editor)}addButton(e,t,i,s,n){let a=new JSButton;return a.setText(t),a.setContentAreaFilled(!1),a.addActionListener(n),e.add(a,new GBC(i,s).f(GBC.HORIZONTAL).i(1,1,1,1)),a}afterTransform(){this.changed=!0,this.drawLayer(),this.canvas.setSaved(!1),this.canvas.drawCanvas(),this.canvas.drawCanvasBounds()}onChange(e,t,i,s){this.changed=!0,this.canvas.setSaved(!1),e?s.setValue(i.getValue()):i.setValue(s.getValue()),t?this.editor.setAttribute("offset","true"):this.editor.removeAttribute("offset"),this.layer.setOpacity(this.opacitySpinner.getValue()/100),this.layer.move(this.offsetXSlider.getValue(),this.offsetYSlider.getValue()),this.canvas.drawCanvas(),this.canvas.drawCanvasBounds()}onAction(e){this.changed=!0,this.canvas.setSaved(!1),this.layer.setCompositeOperation(e),this.canvas.drawCanvas()}move(e){this.cssAddClass("z4layerpreview-move");let t=-1,i=document.querySelector(".z4layerpreview-move");for(let s=0;s<i.parentElement.children.length;s++)i===i.parentElement.children.item(s)&&(t=s);(e<0&&t>0||e>0&&t<this.canvas.getLayersCount()-1)&&(this.removeAttribute("open"),this.ribbonLayerPanel.moveLayer(this,this.layer,t+e)),this.cssRemoveClass("z4layerpreview-move")}setRibbonLayerPanel(e){this.ribbonLayerPanel=e}setLayer(e,t){this.canvas=e,this.layer=t,this.layer.setLayerPreview(this),this.name.setText(this.layer.getName()),this.size.setText(this.layer.getSize().width+" x "+this.layer.getSize().height),this.editName.setText(this.layer.getName()),this.setChildAttributeByQuery("summary","title",this.layer.getName()),this.layer.isHidden()?this.eye.getStyle().removeProperty("color"):this.eye.getStyle().color="var(--main-action-bgcolor)";let i=t.getSize(),s=i.width/i.height,n=s>1?Z4LayerPreview.PREVIEW_SIZE:Z4LayerPreview.PREVIEW_SIZE*s,a=s>1?Z4LayerPreview.PREVIEW_SIZE/s:Z4LayerPreview.PREVIEW_SIZE;this.zoom=Math.min(n/i.width,a/i.height),this.preview.setAttribute("width",""+n),this.preview.setAttribute("height",""+a),this.preview.getStyle().marginTop=(Z4LayerPreview.PREVIEW_SIZE-a-1)/2+"px",this.preview.getStyle().marginBottom=(Z4LayerPreview.PREVIEW_SIZE-a-1)/2+"px",this.preview.getStyle().marginLeft=(Z4LayerPreview.PREVIEW_SIZE-n-1)/2+"px",this.preview.getStyle().marginRight=(Z4LayerPreview.PREVIEW_SIZE-n-1)/2+"px";let r=t.getOffset(),o=this.canvas.getSize();this.offsetXSlider.setMinimum(-i.width),this.offsetXSlider.setMaximum(o.width),this.offsetXSlider.setValue(r.x),this.offsetXSpinner.setModel(new SpinnerNumberModel(r.x,-i.width,o.width,1)),this.offsetYSlider.setMinimum(-i.height),this.offsetYSlider.setMaximum(o.height),this.offsetYSlider.setValue(r.y),this.offsetYSpinner.setModel(new SpinnerNumberModel(r.y,-i.height,o.height,1)),this.opacitySlider.setValue(parseInt(100*t.getOpacity())),this.opacitySpinner.setModel(new SpinnerNumberModel(parseInt(100*t.getOpacity()),0,100,1)),this.compositeOperations.forEach(e=>e.setSelected(e.getText()===t.getCompositeOperation())),this.drawLayer()}drawLayer(){this.layer&&(this.ctx.save(),this.ctx.scale(this.zoom,this.zoom),this.layer.draw(this.ctx,!0),this.ctx.restore())}}class Z4Frame extends JSFrame{ribbon=new Z4Ribbon;canvas=new Z4Canvas;statusPanel=new Z4StatusPanel;constructor(){super(),this.cssAddClass("z4frame"),this.ribbon.setCanvas(this.canvas),this.ribbon.setStatusPanel(this.statusPanel),this.canvas.setStatusPanel(this.statusPanel),this.getContentPane().add(this.ribbon,BorderLayout.NORTH),this.getContentPane().add(this.canvas,BorderLayout.CENTER),this.getContentPane().add(this.statusPanel,BorderLayout.SOUTH),this.canvas.create(Z4Constants.DEFAULT_IMAGE_SIZE,Z4Constants.DEFAULT_IMAGE_SIZE,new Color(0,0,0,0)),window.onbeforeunload=e=>this.canvas.isSaved()?null:(e.preventDefault(),e.returnValue=Z4Translations.PROJECT_NOT_SAVED_MESSAGE,e.returnValue)}}class Z4ColorProgressionPanelOrientation{static HORIZONTALLY_COMPACT="HORIZONTALLY_COMPACT";static VERTICALLY_COMPACT="VERTICALLY_COMPACT"}class Z4LightingPanelOrientation{static HORIZONTAL="HORIZONTAL";static VERTICAL="VERTICAL"}class Z4AbstractFillerPanel extends JSPanel{preview=new JSComponent(document.createElement("canvas"));ctx=this.preview.invoke("getContext('2d')");offscreenCanvas=new OffscreenCanvas(Z4AbstractFillerPanel.SIZE/Z4AbstractFillerPanel.RESCALE,Z4AbstractFillerPanel.SIZE/Z4AbstractFillerPanel.RESCALE);offscreenCtx=this.offscreenCanvas.getContext("2d");xSlider=new JSSlider;xSpinner=new JSSpinner;ySlider=new JSSlider;ySpinner=new JSSpinner;gradientColor=new Z4GradientColor;radios=[];points=[];width=Z4Constants.DEFAULT_IMAGE_SIZE;height=Z4Constants.DEFAULT_IMAGE_SIZE;selectedIndex=0;selectedOption=null;pressed=!1;static SIZE=180;static SELECTOR_RADIUS=7;static RESCALE=3;constructor(e,t){super(),this.cssAddClass("z4abstractfillerpanel"),this.setLayout(new GridBagLayout);let i=new JSPanel;this.add(i,new GBC(0,0).w(4).a(GBC.WEST).f(GBC.HORIZONTAL)),this.preview.setProperty("width",""+Z4AbstractFillerPanel.SIZE),this.preview.setProperty("height",""+Z4AbstractFillerPanel.SIZE),this.preview.addEventListener("mouseenter",e=>this.onMouse(e,"enter")),this.preview.addEventListener("mouseleave",e=>this.onMouse(e,"leave")),this.preview.addEventListener("mousedown",e=>this.onMouse(e,"down")),this.preview.addEventListener("mousemove",e=>this.onMouse(e,"move")),this.preview.addEventListener("mouseup",e=>this.onMouse(e,"up")),this.add(this.preview,new GBC(0,1).wh(2,2).wxy(1,1).i(2,2,2,2)),Z4UI.addLabel(this,"y",new GBC(2,2).a(GBC.SOUTH)).cssAddClass("jslabel-vertical"),this.ySpinner.cssAddClass("jsspinner-vertical"),this.ySpinner.cssAddClass("jsspinner_h_4rem"),this.ySpinner.setModel(new SpinnerNumberModel(0,0,this.height,1)),this.ySpinner.setChildPropertyByQuery("*:nth-child(2)","textContent","▶"),this.ySpinner.setChildPropertyByQuery("*:nth-child(3)","textContent","◀"),this.ySpinner.addChangeListener(e=>this.onChange(!0,this.ySpinner.getValueIsAdjusting(),this.ySpinner,this.ySlider,!1)),this.add(this.ySpinner,new GBC(2,1).wy(1).a(GBC.NORTHEAST)),this.ySlider.setMaximum(this.height),this.ySlider.setOrientation(JSSlider.VERTICAL),this.ySlider.setInverted(!0),this.ySlider.getStyle().minHeight="20rem",this.ySlider.getStyle().minWidth="1.5rem",this.ySlider.addChangeListener(e=>this.onChange(!1,this.ySlider.getValueIsAdjusting(),this.ySpinner,this.ySlider,!1)),this.add(this.ySlider,new GBC(3,1).h(2).a(GBC.EAST)),Z4UI.addHLine(this,new GBC(0,3).w(4).a(GBC.WEST).f(GBC.HORIZONTAL).i(2,1,2,1)),Z4UI.addLabel(this,"x",new GBC(0,4).a(GBC.WEST)),this.xSpinner.setModel(new SpinnerNumberModel(0,0,this.width,1)),this.xSpinner.cssAddClass("jsspinner_w_4rem"),this.xSpinner.addChangeListener(e=>this.onChange(!0,this.xSpinner.getValueIsAdjusting(),this.xSpinner,this.xSlider,!0)),this.add(this.xSpinner,new GBC(1,4).w(3).a(GBC.EAST)),this.xSlider.setMaximum(this.width),this.xSlider.getStyle().minWidth="20rem",this.xSlider.addChangeListener(e=>this.onChange(!1,this.xSlider.getValueIsAdjusting(),this.xSpinner,this.xSlider,!0)),this.add(this.xSlider,new GBC(0,5).w(4).a(GBC.NORTH).f(GBC.HORIZONTAL));let s=new JSPanel;if(this.add(s,new GBC(0,6).w(4).a(GBC.WEST).f(GBC.HORIZONTAL)),t){let n=new ButtonGroup;t.forEach((e,t,s)=>{let a=new JSRadioButton;a.setContentAreaFilled(!1),a.setToggle(),a.setSelected(0===t),0===t&&(this.selectedOption=e),a.setIcon(new Z4EmptyImageProducer(e)),a.addActionListener(t=>{this.selectedOption=e,this.drawPreview(!1)}),n.add(a),i.add(a,null)})}let a=new ButtonGroup;for(let r=0;r<e;r++){let o=r,l=new JSRadioButton;l.setText(""+(r+1)),l.setSelected(0===r),l.addActionListener(e=>this.onRadio(o)),this.radios.push(l),a.add(l),s.add(l,null)}this.pushPointPositions(this.points,this.width,this.height),this.setXY()}onRadio(e){this.selectedIndex=e,this.setXY(),this.drawPreview(!1)}onChange(e,t,i,s,n){e?s.setValue(i.getValue()):i.setValue(s.getValue()),this.setPointPosition(this.points,this.selectedIndex,n?s.getValue():this.points[this.selectedIndex].x,n?this.points[this.selectedIndex].y:s.getValue(),this.width,this.height),this.drawPreview(t)}onMouse(e,t){let i=parseInt(this.preview.getProperty("width")),s=parseInt(this.preview.getProperty("height"));switch(t){case"enter":break;case"down":this.points.map(e=>new Point(i*e.x/this.width,s*e.y/this.height)).forEach((t,i,s)=>{this.isPointEnabled(i)&&Z4Math.distance(t.x,t.y,e.offsetX,e.offsetY)<=Z4AbstractFillerPanel.SELECTOR_RADIUS&&(this.pressed=!0,this.selectedIndex=i,this.radios[this.selectedIndex].setSelected(!0),this.setXY(),this.drawPreview(!1))});break;case"move":this.pressed?(this.setPointPosition(this.points,this.selectedIndex,parseInt(this.width*e.offsetX/i),parseInt(this.height*e.offsetY/s),this.width,this.height),this.setXY(),this.drawPreview(!0)):(this.preview.getStyle().cursor="default",this.points.map(e=>new Point(i*e.x/this.width,s*e.y/this.height)).forEach((t,i,s)=>{this.isPointEnabled(i)&&Z4Math.distance(t.x,t.y,e.offsetX,e.offsetY)<=Z4AbstractFillerPanel.SELECTOR_RADIUS&&(this.preview.getStyle().cursor="pointer")}));break;case"up":this.pressed=!1,this.drawPreview(!1);break;case"leave":this.pressed&&(this.pressed=!1,this.drawPreview(!1))}}setPointPosition(e,t,i,s,n,a){}requestSetPointPosition(){this.setPointPosition(this.points,this.selectedIndex,this.points[this.selectedIndex].x,this.points[this.selectedIndex].y,this.width,this.height)}setSize(e,t){this.width=e,this.height=t,this.ySpinner.setModel(new SpinnerNumberModel(0,0,this.height,1)),this.ySlider.setMaximum(this.height),this.xSpinner.setModel(new SpinnerNumberModel(0,0,this.width,1)),this.xSlider.setMaximum(this.width),this.points.length=0,this.pushPointPositions(this.points,this.width,this.height),this.setXY();let i=e/t;this.preview.setProperty("width",""+parseInt(i>1?Z4AbstractFillerPanel.SIZE:Z4AbstractFillerPanel.SIZE*i)),this.preview.setProperty("height",""+parseInt(i>1?Z4AbstractFillerPanel.SIZE/i:Z4AbstractFillerPanel.SIZE)),this.offscreenCanvas=new OffscreenCanvas(parseInt(this.preview.getProperty("width"))/Z4AbstractFillerPanel.RESCALE,parseInt(this.preview.getProperty("height"))/Z4AbstractFillerPanel.RESCALE),this.offscreenCtx=this.offscreenCanvas.getContext("2d"),this.drawPreview(!1)}setGradientColor(e){this.gradientColor=e,this.drawPreview(!1)}pushPointPositions(e,t,i){}setXY(){this.xSlider.setValue(this.points[this.selectedIndex].x),this.xSpinner.setValue(this.points[this.selectedIndex].x),this.ySlider.setValue(this.points[this.selectedIndex].y),this.ySpinner.setValue(this.points[this.selectedIndex].y)}setPointsEnabled(){this.radios.forEach((e,t,i)=>{let s=this.isPointEnabled(t);e.setEnabled(s),!s&&e.isSelected()&&(this.radios[0].setSelected(!0),this.selectedIndex=0,this.setXY(),this.drawPreview(!1))})}getSelectedFiller(){return this.getFiller(this.gradientColor,this.points,this.selectedOption)}drawPreview(e){let t=parseInt(this.preview.getProperty("width")),i=parseInt(this.preview.getProperty("height"));if(t>0&&i>0){this.ctx.clearRect(0,0,t,i);let s=this.points.map(e=>new Point(t*e.x/this.width,i*e.y/this.height));if(e&&this.needsRescale(this.selectedOption)){let n=this.offscreenCtx.createImageData(t/Z4AbstractFillerPanel.RESCALE,i/Z4AbstractFillerPanel.RESCALE);this.getFiller(this.gradientColor,s.map(e=>new Point(e.x/Z4AbstractFillerPanel.RESCALE,e.y/Z4AbstractFillerPanel.RESCALE)),this.selectedOption).fill(n),this.offscreenCtx.putImageData(n,0,0),this.ctx.drawImage(this.offscreenCanvas,0,0,t,i)}else{let a=this.ctx.createImageData(t,i);this.getFiller(this.gradientColor,s,this.selectedOption).fill(a),this.ctx.putImageData(a,0,0)}this.ctx.save(),s.forEach((e,t,i)=>this.drawCircle(e,t)),this.ctx.restore(),this.ctx.save(),this.drawObjects(this.ctx,s),this.ctx.restore()}}needsRescale(e){}getFiller(e,t,i){}drawCircle(e,t){if(this.isPointEnabled(t)){this.ctx.lineWidth=3;let i=[];this.ctx.beginPath(),this.ctx.arc(e.x,e.y,Z4AbstractFillerPanel.SELECTOR_RADIUS,0,2*Math.PI),this.ctx.strokeStyle=Z4Constants.getStyle(t===this.selectedIndex?"red":"black"),this.ctx.setLineDash(i),this.ctx.stroke(),i.push(2.5,2.5),this.ctx.beginPath(),this.ctx.arc(e.x,e.y,Z4AbstractFillerPanel.SELECTOR_RADIUS,0,2*Math.PI),this.ctx.strokeStyle=Z4Constants.getStyle("white"),this.ctx.setLineDash(i),this.ctx.stroke()}}isPointEnabled(e){}drawObjects(e,t){}}class Z4BezierFillerPanel extends Z4AbstractFillerPanel{constructor(){super(5,[Z4BoundaryBehavior.STOP_AT_BOUNDARY,Z4BoundaryBehavior.FILL_AT_BOUNDARY,Z4BoundaryBehavior.SYMMETRIC_AT_BOUNDARY,Z4BoundaryBehavior.REPEAT_AT_BOUNDARY]),this.cssAddClass("z4bezierfillerpanel"),this.drawPreview(!1)}setPointPosition(e,t,i,s,n,a){e[t]=new Point(i,s)}pushPointPositions(e,t,i){e.push(new Point(0,3*i/4)),e.push(new Point(t/4,i/8)),e.push(new Point(3*t/4,i/8)),e.push(new Point(t,3*i/4)),e.push(new Point(t/4,7*i/8))}needsRescale(e){return!0}getFiller(e,t,i){return new Z4BezierFiller(e,t[0].x,t[0].y,t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y,parseInt(Z4Math.distance(t[0].x,t[0].y,t[4].x,t[4].y)),i)}isPointEnabled(e){return!0}drawObjects(e,t){e.lineWidth=3;let i=[];e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.lineTo(t[2].x,t[2].y),e.lineTo(t[3].x,t[3].y),e.moveTo(t[0].x,t[0].y),e.lineTo(t[4].x,t[4].y),e.strokeStyle=Z4Constants.getStyle("black"),e.setLineDash(i),e.stroke(),i.push(2.5,2.5),e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.lineTo(t[2].x,t[2].y),e.lineTo(t[3].x,t[3].y),e.moveTo(t[0].x,t[0].y),e.lineTo(t[4].x,t[4].y),e.strokeStyle=Z4Constants.getStyle("white"),e.setLineDash(i),e.stroke()}}class Z4ConicFillerPanel extends Z4AbstractFillerPanel{constructor(){super(2,[!1,!0]),this.cssAddClass("z4conicfillerpanel"),this.drawPreview(!1)}setPointPosition(e,t,i,s,n,a){e[t]=new Point(i,s)}pushPointPositions(e,t,i){e.push(new Point(t/2,i/2)),e.push(new Point(t,i/2))}needsRescale(e){return!1}getFiller(e,t,i){return new Z4ConicFiller(e,t[0].x,t[0].y,Z4Math.atan(t[0].x,t[0].y,t[1].x,t[1].y),i)}isPointEnabled(e){return!0}drawObjects(e,t){e.lineWidth=3;let i=[];e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.strokeStyle=Z4Constants.getStyle("black"),e.setLineDash(i),e.stroke(),i.push(2.5,2.5),e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.strokeStyle=Z4Constants.getStyle("white"),e.setLineDash(i),e.stroke()}}class Z4LinearFillerPanel extends Z4AbstractFillerPanel{constructor(){super(2,[Z4BoundaryBehavior.STOP_AT_BOUNDARY,Z4BoundaryBehavior.FILL_AT_BOUNDARY,Z4BoundaryBehavior.SYMMETRIC_AT_BOUNDARY,Z4BoundaryBehavior.REPEAT_AT_BOUNDARY]),this.cssAddClass("z4linearfillerpanel"),this.drawPreview(!1)}setPointPosition(e,t,i,s,n,a){e[t]=new Point(i,s)}pushPointPositions(e,t,i){e.push(new Point(0,i/2)),e.push(new Point(t,i/2))}needsRescale(e){return!1}getFiller(e,t,i){return new Z4LinearFiller(e,t[0].x,t[0].y,t[1].x,t[1].y,i)}isPointEnabled(e){return!0}drawObjects(e,t){e.lineWidth=3;let i=[];e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.strokeStyle=Z4Constants.getStyle("black"),e.setLineDash(i),e.stroke(),i.push(2.5,2.5),e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.strokeStyle=Z4Constants.getStyle("white"),e.setLineDash(i),e.stroke()}}class Z4SinusoidalFillerPanel extends Z4AbstractFillerPanel{constructor(){super(4,[Z4BoundaryBehavior.STOP_AT_BOUNDARY,Z4BoundaryBehavior.FILL_AT_BOUNDARY,Z4BoundaryBehavior.SYMMETRIC_AT_BOUNDARY,Z4BoundaryBehavior.REPEAT_AT_BOUNDARY]),this.cssAddClass("z4sinusoidalfillerpanel"),this.drawPreview(!1)}setPointPosition(e,t,i,s,n,a){let r=0,o=0,l=null,h=0,d=0,c=null,g=0,u=0,T=null;switch(t){case 0:let S=e[0].x-i,p=e[0].y-s;o=Z4Math.distance(e[0].x,e[0].y,e[1].x,e[1].y),r=Z4Math.atan(e[0].x,e[0].y,e[1].x,e[1].y),d=Z4Math.distance(e[0].x,e[0].y,e[2].x,e[2].y),h=Z4Math.atan(e[0].x,e[0].y,e[2].x,e[2].y),u=Z4Math.distance(e[0].x,e[0].y,e[3].x,e[3].y),g=Z4Math.atan(e[0].x,e[0].y,e[3].x,e[3].y),e[0]=new Point(i,s),l=this.getPoint(e[0].x,e[0].y,e[1].x-S,e[1].y-p,o,r,n,a),e[1]=new Point(Math.round(l.x),Math.round(l.y)),c=this.getPoint(e[0].x,e[0].y,e[2].x-S,e[2].y-p,d,h,n,a),e[2]=new Point(Math.round(c.x),Math.round(c.y)),T=this.getPoint(e[0].x,e[0].y,e[3].x-S,e[3].y-p,u,g,n,a),e[3]=new Point(Math.round(T.x),Math.round(T.y));break;case 1:d=Z4Math.distance(e[0].x,e[0].y,e[2].x,e[2].y),h=Z4Math.atan(e[0].x,e[0].y,i,s)+Z4Math.HALF_PI,u=Z4Math.distance(e[0].x,e[0].y,e[3].x,e[3].y),g=Z4Math.atan(e[0].x,e[0].y,i,s)+Math.PI,c=this.getPoint(e[0].x,e[0].y,e[0].x+d*Math.cos(h),e[0].y+d*Math.sin(h),d,h,n,a),T=this.getPoint(e[0].x,e[0].y,e[0].x+u*Math.cos(g),e[0].y+u*Math.sin(g),u,g,n,a),e[1]=new Point(i,s),e[2]=new Point(Math.round(c.x),Math.round(c.y)),e[3]=new Point(Math.round(T.x),Math.round(T.y));break;case 2:o=Z4Math.distance(e[0].x,e[0].y,e[1].x,e[1].y),r=Z4Math.atan(e[0].x,e[0].y,i,s)-Z4Math.HALF_PI,u=Z4Math.distance(e[0].x,e[0].y,e[3].x,e[3].y),g=Z4Math.atan(e[0].x,e[0].y,i,s)+Z4Math.HALF_PI,l=this.getPoint(e[0].x,e[0].y,e[0].x+o*Math.cos(r),e[0].y+o*Math.sin(r),o,r,n,a),T=this.getPoint(e[0].x,e[0].y,e[0].x+u*Math.cos(g),e[0].y+u*Math.sin(g),u,g,n,a),e[1]=new Point(Math.round(l.x),Math.round(l.y)),e[2]=new Point(i,s),e[3]=new Point(Math.round(T.x),Math.round(T.y));break;case 3:o=Z4Math.distance(e[0].x,e[0].y,e[1].x,e[1].y),r=Z4Math.atan(e[0].x,e[0].y,i,s)+Math.PI,d=Z4Math.distance(e[0].x,e[0].y,e[2].x,e[2].y),h=Z4Math.atan(e[0].x,e[0].y,i,s)-Z4Math.HALF_PI,l=this.getPoint(e[0].x,e[0].y,e[0].x+o*Math.cos(r),e[0].y+o*Math.sin(r),o,r,n,a),c=this.getPoint(e[0].x,e[0].y,e[0].x+d*Math.cos(h),e[0].y+d*Math.sin(h),d,h,n,a),e[1]=new Point(Math.round(l.x),Math.round(l.y)),e[2]=new Point(Math.round(c.x),Math.round(c.y)),e[3]=new Point(i,s)}}getPoint(e,t,i,s,n,a,r,o){for(;(i<0||i>r||s<0||s>o)&&n>0;)i=e+(n=Math.max(0,n-.05))*Math.cos(a),s=t+n*Math.sin(a);return new Z4Point(i,s)}pushPointPositions(e,t,i){e.push(new Point(t/2,i/2)),e.push(new Point(t/2,i/8)),e.push(new Point(t,i/2)),e.push(new Point(t/2,i))}needsRescale(e){return!1}getFiller(e,t,i){return new Z4SinusoidalFiller(e,t[0].x,t[0].y,Z4Math.distance(t[0].x,t[0].y,t[1].x,t[1].y),Z4Math.distance(t[0].x,t[0].y,t[2].x,t[2].y),Z4Math.distance(t[0].x,t[0].y,t[3].x,t[3].y),Z4Math.atan(t[0].x,t[0].y,t[2].x,t[2].y),i)}isPointEnabled(e){return!0}drawObjects(e,t){e.lineWidth=3;let i=[];e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.moveTo(t[0].x,t[0].y),e.lineTo(t[2].x,t[2].y),e.moveTo(t[0].x,t[0].y),e.lineTo(t[3].x,t[3].y),e.strokeStyle=Z4Constants.getStyle("black"),e.setLineDash(i),e.stroke(),i.push(2.5,2.5),e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.moveTo(t[0].x,t[0].y),e.lineTo(t[2].x,t[2].y),e.moveTo(t[0].x,t[0].y),e.lineTo(t[3].x,t[3].y),e.strokeStyle=Z4Constants.getStyle("white"),e.setLineDash(i),e.stroke()}}class Z4SpiralFillerPanel extends Z4AbstractFillerPanel{constructor(){super(2,[!1,!0]),this.cssAddClass("z4spiralfillerpanel"),this.drawPreview(!1)}setPointPosition(e,t,i,s,n,a){e[t]=new Point(i,s)}pushPointPositions(e,t,i){e.push(new Point(t/2,i/2)),e.push(new Point(t,i/2))}needsRescale(e){return!1}getFiller(e,t,i){return new Z4SpiralFiller(e,t[0].x,t[0].y,Z4Math.distance(t[0].x,t[0].y,t[1].x,t[1].y),Z4Math.atan(t[0].x,t[0].y,t[1].x,t[1].y),i)}isPointEnabled(e){return!0}drawObjects(e,t){e.lineWidth=3;let i=[];e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.strokeStyle=Z4Constants.getStyle("black"),e.setLineDash(i),e.stroke(),i.push(2.5,2.5),e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.strokeStyle=Z4Constants.getStyle("white"),e.setLineDash(i),e.stroke()}}class Z4TextureFillerPanel extends Z4AbstractFillerPanel{colorPanel=new Z4ColorPanel;free=new JSRadioButton;lockRatio=new JSRadioButton;lock=new JSRadioButton;group=new ButtonGroup;imageData=new ImageData(Z4TextureFillerPanel.DEFAULT_SIZE,Z4TextureFillerPanel.DEFAULT_SIZE);backgroundColor=new Color(0,0,0,0);newImage=!0;static DEFAULT_SIZE=50;constructor(){super(2,[!1,!0]),Z4UI.addLabel(this,Z4Translations.DIMENSION,new GBC(0,7).w(4).a(GBC.WEST));let e=new JSPanel;this.add(e,new GBC(0,8).w(4).a(GBC.WEST).f(GBC.HORIZONTAL)),this.free.setText(Z4Translations.FREE),this.free.setSelected(!0),this.group.add(this.free),e.add(this.free,null),this.lockRatio.setText(Z4Translations.LOCK_ASPECT_RATIO),this.group.add(this.lockRatio),e.add(this.lockRatio,null),this.lock.setText(Z4Translations.LOCK),this.group.add(this.lock),e.add(this.lock,null),(e=new JSPanel).setLayout(new GridBagLayout),this.add(e,new GBC(0,9).w(4).wx(1).f(GBC.HORIZONTAL));let t=new JSButton;t.setText(Z4Translations.PATTERN),t.addActionListener(e=>this.selectPattern()),e.add(t,new GBC(0,0).a(GBC.SOUTHWEST).i(0,0,0,25)),this.colorPanel.setLabel(Z4Translations.BACKGROUND_COLOR),this.colorPanel.setValue(this.backgroundColor),this.colorPanel.addChangeListener(e=>{this.backgroundColor=this.colorPanel.getValue(),this.drawPreview(!1)}),e.add(this.colorPanel,new GBC(1,0).wx(1).f(GBC.HORIZONTAL));let i=this.imageData.data;for(let s=0;s<Z4TextureFillerPanel.DEFAULT_SIZE;s++)for(let n=0;n<Z4TextureFillerPanel.DEFAULT_SIZE;n++){let a=(s*Z4TextureFillerPanel.DEFAULT_SIZE+n)*4;Z4Math.distance(n,s,Z4TextureFillerPanel.DEFAULT_SIZE/2,Z4TextureFillerPanel.DEFAULT_SIZE/2)>Z4TextureFillerPanel.DEFAULT_SIZE/2||(s<Z4TextureFillerPanel.DEFAULT_SIZE/2?(i[a]=255,i[a+1]=255,i[a+2]=255,i[a+3]=255):(i[a]=0,i[a+1]=0,i[a+2]=0,i[a+3]=255))}this.cssAddClass("z4texturefillerpanel"),this.drawPreview(!1)}selectPattern(){if("function"==typeof window.showOpenFilePicker){let e=new FilePickerOptions;e.excludeAcceptAllOption=!0,e.id=Z4Constants.TEXTURE_FILE_ID,e.multiple=!1,e.types=Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_TYPE,JSFilePicker.showOpenFilePicker(e,0,e=>e.forEach(e=>e.getFile().then(e=>{this.openTexture(e)})))}else JSFileChooser.showOpenDialog(""+Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_FORMAT.join(","),JSFileChooser.SINGLE_SELECTION,0,e=>e.forEach(e=>this.openTexture(e)))}openTexture(e){let t=new FileReader;t.onload=e=>{let i=document.createElement("img");return i.onload=e=>{let t=new OffscreenCanvas(i.width,i.height).getContext("2d");return t.drawImage(i,0,0),this.imageData=t.getImageData(0,0,i.width,i.height),this.newImage=!0,this.requestSetPointPosition(),this.drawPreview(!1),null},i.src=t.result,null},t.readAsDataURL(e)}setPointPosition(e,t,i,s,n,a){if(this.newImage)e[0]=new Point(0,0),e[1]=new Point(Math.min(n,this.imageData.width),Math.min(a,this.imageData.height));else if(this.free.isSelected())e[t]=new Point(i,s);else if(this.lockRatio.isSelected()){let r=Z4Math.distance(e[1-t].x,e[1-t].y,i,s),o=Z4Math.atan(e[1-t].x,e[1-t].y,e[t].x,e[t].y);e[t]=new Point(Math.round(e[1-t].x+r*Math.cos(o)),Math.round(e[1-t].y+r*Math.sin(o)))}else if(this.lock.isSelected()){let l=e[t].x-i,h=e[t].y-s,d=e[1-t].x-l,c=e[1-t].y-h;0<=d&&d<n&&0<=c&&c<a&&(e[t]=new Point(i,s),e[1-t]=new Point(d,c))}this.newImage=!1}pushPointPositions(e,t,i){e.push(new Point(0,0)),e.push(new Point(Math.min(t,Z4TextureFillerPanel.DEFAULT_SIZE),Math.min(i,Z4TextureFillerPanel.DEFAULT_SIZE)))}needsRescale(e){return!1}getFiller(e,t,i){return new Z4TextureFiller(this.imageData,t[0].x,t[0].y,t[1].x,t[1].y,this.backgroundColor,i)}isPointEnabled(e){return!0}drawObjects(e,t){e.lineWidth=3;let i=[];e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.strokeStyle=Z4Constants.getStyle("black"),e.setLineDash(i),e.stroke(),i.push(2.5,2.5),e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.strokeStyle=Z4Constants.getStyle("white"),e.setLineDash(i),e.stroke()}}class Z4VertexBasedFillerPanel extends Z4AbstractFillerPanel{star=new JSCheckBox;vertexCounter=new JSSlider;regular=new JSCheckBox;constructor(){super(3,[Z4BoundaryBehavior.STOP_AT_BOUNDARY,Z4BoundaryBehavior.FILL_AT_BOUNDARY,Z4BoundaryBehavior.SYMMETRIC_AT_BOUNDARY,Z4BoundaryBehavior.REPEAT_AT_BOUNDARY]),Z4UI.addLabel(this,Z4Translations.VERTICES,new GBC(0,7).a(GBC.WEST)),this.star.setText(Z4Translations.STAR),this.star.setEnabled(!1),this.star.addActionListener(e=>{this.setIcons(),this.drawPreview(!1)}),this.add(this.star,new GBC(1,7).w(3).a(GBC.EAST));let e=new DefaultSliderModelAndRenderer;for(let t=3;t<10;t++)e.addElement(""+t);e.addElement("∞"),this.vertexCounter.setModelAndRenderer(e),this.vertexCounter.setValue(7),this.vertexCounter.addChangeListener(e=>{this.star.setEnabled(7!==this.vertexCounter.getValue()),this.setIcons(),this.drawPreview(!1)}),this.add(this.vertexCounter,new GBC(0,8).w(4).a(GBC.WEST).f(GBC.HORIZONTAL)),this.getChilStyleByQuery("*:nth-child(13) datalist option:nth-child(8)").fontSize="larger",this.regular.setText(Z4Translations.REGULAR),this.regular.addActionListener(e=>{this.setPointsEnabled(),this.drawPreview(!1)}),this.appendChildInTree("*:nth-child(10)",this.regular),this.cssAddClass("z4ellipticfillerpanel"),this.drawPreview(!1)}setIcons(){this.cssRemoveClass("z4ellipticfillerpanel"),this.cssRemoveClass("z4starfillerpanel"),this.cssRemoveClass("z4polygonfillerpanel"),7===this.vertexCounter.getValue()?this.cssAddClass("z4ellipticfillerpanel"):this.star.isSelected()?this.cssAddClass("z4starfillerpanel"):this.cssAddClass("z4polygonfillerpanel")}setPointPosition(e,t,i,s,n,a){let r=0,o=0,l=null,h=0,d=0,c=null;switch(t){case 0:let g=e[0].x-i,u=e[0].y-s;o=Z4Math.distance(e[0].x,e[0].y,e[1].x,e[1].y),r=Z4Math.atan(e[0].x,e[0].y,e[1].x,e[1].y),d=Z4Math.distance(e[0].x,e[0].y,e[2].x,e[2].y),h=Z4Math.atan(e[0].x,e[0].y,e[2].x,e[2].y),e[0]=new Point(i,s),l=this.getPoint(e[0].x,e[0].y,e[1].x-g,e[1].y-u,o,r,n,a),e[1]=new Point(Math.round(l.x),Math.round(l.y)),c=this.getPoint(e[0].x,e[0].y,e[2].x-g,e[2].y-u,d,h,n,a),e[2]=new Point(Math.round(c.x),Math.round(c.y));break;case 1:d=Z4Math.distance(e[0].x,e[0].y,e[2].x,e[2].y),h=Z4Math.atan(e[0].x,e[0].y,i,s)-Z4Math.HALF_PI,c=this.getPoint(e[0].x,e[0].y,e[0].x+d*Math.cos(h),e[0].y+d*Math.sin(h),d,h,n,a),e[1]=new Point(i,s),e[2]=new Point(Math.round(c.x),Math.round(c.y));break;case 2:o=Z4Math.distance(e[0].x,e[0].y,e[1].x,e[1].y),r=Z4Math.atan(e[0].x,e[0].y,i,s)+Z4Math.HALF_PI,l=this.getPoint(e[0].x,e[0].y,e[0].x+o*Math.cos(r),e[0].y+o*Math.sin(r),o,r,n,a),e[1]=new Point(Math.round(l.x),Math.round(l.y)),e[2]=new Point(i,s)}}getPoint(e,t,i,s,n,a,r,o){for(;(i<0||i>r||s<0||s>o)&&n>0;)i=e+(n=Math.max(0,n-.05))*Math.cos(a),s=t+n*Math.sin(a);return new Z4Point(i,s)}pushPointPositions(e,t,i){e.push(new Point(t/2,i/2)),e.push(new Point(t,i/2)),e.push(new Point(t/2,0))}needsRescale(e){return e!==Z4BoundaryBehavior.STOP_AT_BOUNDARY&&e!==Z4BoundaryBehavior.FILL_AT_BOUNDARY&&(e!==Z4BoundaryBehavior.SYMMETRIC_AT_BOUNDARY&&e!==Z4BoundaryBehavior.REPEAT_AT_BOUNDARY||7!==this.vertexCounter.getValue())}getFiller(e,t,i){let s=Z4Math.distance(t[0].x,t[0].y,t[1].x,t[1].y),n=Z4Math.distance(t[0].x,t[0].y,t[2].x,t[2].y),a=Z4Math.atan(t[0].x,t[0].y,t[1].x,t[1].y),r=this.vertexCounter.getValue();return 7===r?new Z4EllipticFiller(e,t[0].x,t[0].y,s,this.regular.isSelected()?s:n,a,i):this.star.isSelected()?new Z4StarFiller(e,t[0].x,t[0].y,s,this.regular.isSelected()?s:n,a,r+3,i):new Z4PolygonFiller(e,t[0].x,t[0].y,s,this.regular.isSelected()?s:n,a,r+3,i)}isPointEnabled(e){return 2!==e||!this.regular.isSelected()}drawObjects(e,t){e.lineWidth=3;let i=[];e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),this.regular.isSelected()||(e.moveTo(t[0].x,t[0].y),e.lineTo(t[2].x,t[2].y)),e.strokeStyle=Z4Constants.getStyle("black"),e.setLineDash(i),e.stroke(),i.push(2.5,2.5),e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),this.regular.isSelected()||(e.moveTo(t[0].x,t[0].y),e.lineTo(t[2].x,t[2].y)),e.strokeStyle=Z4Constants.getStyle("white"),e.setLineDash(i),e.stroke()}}class Z4FancifulValuePanelOrientation{static HORIZONTAL="HORIZONTAL";static VERTICAL="VERTICAL";static HORIZONTALLY_VERTICAL="HORIZONTALLY_VERTICAL"}class Z4RandomValuePanelOrientation{static HORIZONTAL="HORIZONTAL";static VERTICAL="VERTICAL";static HORIZONTALLY_VERTICAL="HORIZONTALLY_VERTICAL"}class Z4RotationPanelOrientation{static HORIZONTAL="HORIZONTAL";static VERTICAL="VERTICAL"}class Z4SignedValuePanelOrientation{static HORIZONTAL="HORIZONTAL";static VERTICAL="VERTICAL"}class Z4SignPanelOrientation{static HORIZONTAL="HORIZONTAL";static VERTICAL="VERTICAL";static SQUARED="SQUARED"}class Z4WhirlpoolPanelOrientation{static HORIZONTAL="HORIZONTAL";static VERTICAL="VERTICAL"}class Z4AbstractRibbonPanel extends JSPanel{constructor(){super()}addButton(e,t,i,s,n,a,r){let o=new JSButton;o.setText(e),o.setEnabled(t),o.setContentAreaFilled(!1),o.addActionListener(r);let l=new GBC(i,s).a(GBC.NORTHWEST);switch(n){case"left":l.i(a,5,0,0).f(GBC.HORIZONTAL),o.getStyle().borderTopRightRadius="0px",o.getStyle().borderBottomRightRadius="0px",o.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"both":l.i(a,0,0,0).f(GBC.HORIZONTAL),o.getStyle().borderRadius="0px",o.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",o.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"right":l.i(a,0,0,5).f(GBC.HORIZONTAL),o.getStyle().borderTopLeftRadius="0px",o.getStyle().borderBottomLeftRadius="0px",o.getStyle().borderLeft="1px solid var(--main-action-bgcolor)";break;default:l.i(a,5,0,5)}return this.add(o,l),o}}class Z4RibbonDrawingToolPanel extends Z4AbstractRibbonPanel{drawingToolsPreview=new JSPanel;statusPanel=null;canvas=null;constructor(){super(),this.setLayout(new GridBagLayout),this.cssAddClass("z4ribbondrawingtoolpanel"),Z4UI.addLabel(this,Z4Translations.NEW_DRAWING_TOOL,new GBC(0,0).w(3).a(GBC.WEST).i(5,5,2,0)),this.addButton(Z4Translations.CREATE,!0,0,1,"left",0,e=>this.create()),this.addButton(Z4Translations.FROM_FILE,!0,1,1,"both",0,e=>this.open()),this.addButton(Z4Translations.FROM_LIBRARY,!0,2,1,"right",0,e=>this.openFromLibrary()),Z4UI.addVLine(this,new GBC(3,0).h(2).wy(1).f(GBC.VERTICAL).i(1,2,1,2)),this.addButton(Z4Translations.SAVE_DRAWING_TOOLS_AS,!0,4,1,"",0,e=>this.save()),Z4UI.addVLine(this,new GBC(5,0).h(2).wy(1).f(GBC.VERTICAL).i(1,2,1,2)),this.drawingToolsPreview.setLayout(new BoxLayout(this.drawingToolsPreview,BoxLayout.X_AXIS)),this.drawingToolsPreview.getStyle().overflowX="scroll",this.add(this.drawingToolsPreview,new GBC(6,0).h(2).wx(1).f(GBC.BOTH))}setCanvas(e){this.canvas=e}setStatusPanel(e){this.statusPanel=e}create(){this.canvas.addDrawingTool(new Z4DrawingTool(this.canvas.findDrawingToolName(),new Z4Stamper(new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),1),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4Rotation(0,new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),Z4RotationBehavior.FIXED,!1)),new Z4Shape2DPainter(new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),10),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),10),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),!1,!1,-1,new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Color(0,0,0,0),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Color(0,0,0,0)),Z4SpatioTemporalColor.fromColor(new Color(0,0,0,255)),new Z4ColorProgression(Z4ColorProgressionBehavior.SPATIAL,0,!1,Z4Lighting.NONE))),setTimeout(()=>document.querySelector(".z4drawingtoolpreview:nth-last-child(1)").setAttribute("open","open"),0)}open(){if("function"==typeof window.showOpenFilePicker){let e=new FilePickerOptions;e.excludeAcceptAllOption=!0,e.id=Z4Constants.TOOL_FILE_ID,e.multiple=!0,e.types=Z4Constants.PIZZAPAZZA_OPEN_TOOLS_FILE_TYPE,JSFilePicker.showOpenFilePicker(e,0,e=>e.forEach(e=>this.canvas.addDrawingToolFromHandle(e)))}else JSFileChooser.showOpenDialog(".z4t,.z4ts",JSFileChooser.MULTIPLE_SELECTION,0,e=>e.forEach(e=>this.canvas.addDrawingToolFromFile(e)))}openFromLibrary(){let e=new Z4OpenDrawingToolsFromLibraryPanel;JSOptionPane.showInputDialog(e,Z4Translations.FROM_LIBRARY,t=>e.addChangeListener(t),()=>!!e.getSelectedDrawingTools().length,t=>{t===JSOptionPane.OK_OPTION&&e.getSelectedDrawingTools().forEach(e=>this.canvas.addDrawingTool(Z4DrawingTool.fromJSON(e)))})}save(){"function"==typeof window.showSaveFilePicker?this.saveToolsToHandle():this.saveToolsToFile()}saveToolsToFile(){let e=new JSPanel;e.setLayout(new BorderLayout(0,0));let t=new JSLabel;t.setText(Z4Translations.FILENAME),e.add(t,BorderLayout.NORTH);let i=new JSTextField;i.setText(this.canvas.getProjectName()),e.add(i,BorderLayout.CENTER),JSOptionPane.showInputDialog(e,Z4Translations.SAVE,e=>i.addActionListener(t=>e(new ChangeEvent)),()=>!!i.getText(),e=>{e===JSOptionPane.OK_OPTION&&this.canvas.saveDrawingToolsToFile(i.getText())})}saveToolsToHandle(){let e=new FilePickerOptions;e.excludeAcceptAllOption=!0,e.id=Z4Constants.TOOL_FILE_ID,e.multiple=!1,e.suggestedName=this.canvas.getProjectName(),e.types=Z4Constants.PIZZAPAZZA_SAVE_TOOLS_FILE_TYPE,JSFilePicker.showSaveFilePicker(e,e=>this.canvas.saveDrawingToolsToHandle(e))}reset(){this.drawingToolsPreview.setProperty("innerHTML","")}addDrawingToolPreview(e){let t=new Z4DrawingToolPreview;t.setRibbonDrawingToolPanel(this),t.setDrawingTool(this.canvas,e),document.querySelectorAll(".z4drawingtoolpreview .z4drawingtoolpreview-selector").forEach(e=>e.textContent=Z4DrawingToolPreview.UNSELECTED_DRAWING_TOOL_CONTENT),this.drawingToolsPreview.add(t,null),setTimeout(()=>t.invoke("scrollIntoView()"),0)}}class Z4RibbonHelpPanel extends Z4AbstractRibbonPanel{constructor(){super(),this.setLayout(new FlowLayout(FlowLayout.LEFT,5,5)),this.cssAddClass("z4ribbonhelppanel");let e=new JSButton;e.setText(Z4Translations.ABOUT),e.setContentAreaFilled(!1),e.addActionListener(e=>this.showAbout()),this.add(e,null),(e=new JSButton).cssAddClass("z4check-install"),e.setProperty("innerHTML",Z4Translations.INSTALL),e.setContentAreaFilled(!1),this.add(e,null),(e=new JSButton).cssAddClass("z4check-update"),e.setText(Z4Translations.CHECK_UPDATE),e.setContentAreaFilled(!1),this.add(e,null)}showAbout(){let e=RegExp("pizzApazzA-bundle-.*js");document.querySelectorAll("script").forEach(t=>{let i=t.getAttribute("src");if(e.test(i)){let s=22,n=i.indexOf("pizzApazzA-bundle-min-");-1===n&&(s=18,n=i.indexOf("pizzApazzA-bundle-"));let a=i.indexOf(".js"),r=i.substring(n+s,a),o=new JSPanel;o.cssAddClass("z4ribbonhelppanel-about"),o.setLayout(new BoxLayout(o,BoxLayout.Y_AXIS));let l=new JSComponent(document.createElement("img"));l.cssAddClass("z4ribbonhelppanel-splash"),o.add(l,null);let h=new JSLabel;h.setProperty("innerHTML",Z4Translations.BASED_ON.replace("$version$",r)),h.getStyle().marginTop="5px",h.getStyle().maxWidth="500px",o.add(h,null),JSOptionPane.showMessageDialog(o,Z4Translations.ABOUT,JSOptionPane.INFORMATION_MESSAGE,null)}})}}class Z4RibbonHistoryPanel extends Z4AbstractRibbonPanel{undo=null;redo=null;save=null;consolidate=null;historyPreview=new JSPanel;canvas=null;statusPanel=null;dbName=null;database=null;currentKey=0;z4historyManagement=null;z4savingDelay=0;z4savingInterval=0;timerID=-1;standardID=-1;standardRand=0;constructor(){super(),this.setLayout(new GridBagLayout),this.cssAddClass("z4ribbonhistorypanel"),this.undo=this.addButton(Z4Translations.UNDO,!1,0,0,"left",5,e=>this.database.transaction("history","readonly").objectStore("history").openCursor(IDBKeyRange.upperBound(this.currentKey,!0),"prev").onsuccess=e=>this.undoRedo(e)),this.redo=this.addButton(Z4Translations.REDO,!1,1,0,"right",5,e=>this.database.transaction("history","readonly").objectStore("history").openCursor(IDBKeyRange.lowerBound(this.currentKey,!0)).onsuccess=e=>this.undoRedo(e)),this.save=this.addButton(Z4Translations.SAVE,!1,2,0,"",5,e=>this.saveHistory("manual")),this.consolidate=this.addButton(Z4Translations.CONSOLIDATE,!1,3,0,"",5,e=>JSOptionPane.showConfirmDialog(Z4Translations.CONSOLIDATE_MESSAGE,Z4Translations.CONSOLIDATE,JSOptionPane.YES_NO_OPTION,JSOptionPane.WARNING_MESSAGE,e=>{e===JSOptionPane.YES_OPTION&&(this.canvas.setChanged(!1),this.resetHistory(()=>this.canvas.toHistory(e=>this.addHistory(e,e=>this.setCurrentKey(e),!1))))})),Z4UI.addVLine(this,new GBC(4,0).h(2).wy(1).f(GBC.VERTICAL).i(1,2,1,2)),this.historyPreview.setLayout(new BoxLayout(this.historyPreview,BoxLayout.X_AXIS)),this.historyPreview.getStyle().overflowX="scroll",this.add(this.historyPreview,new GBC(5,0).h(2).wx(1).f(GBC.BOTH)),window.onunload=e=>(window.indexedDB.deleteDatabase(this.dbName),null)}undoRedo(e){let t=e.target.result;return this.setCurrentKey(t.key),this.canvas.openFromHistory(t.value),setTimeout(()=>document.querySelector(".z4historypreview.z4historypreview-"+this.currentKey).scrollIntoView(),0),null}resetHistory(e){this.clearIntervals(),this.undo.setEnabled(!1),this.redo.setEnabled(!1),this.consolidate.setEnabled(!1),this.historyPreview.setProperty("innerHTML",""),this.dbName&&window.indexedDB.deleteDatabase(this.dbName),this.dbName="pizzapazza_"+new Date().getTime(),window.indexedDB.open(this.dbName,1).onupgradeneeded=t=>{this.database=t.target.result;let i={};return i.autoIncrement=!0,this.database.createObjectStore("history",i).transaction.oncomplete=t=>(this.setIntervals(),e(),null),null}}saveHistory(e){this.canvas.isChanged()&&-1!==e.indexOf(this.z4historyManagement)&&(this.database.transaction("history","readwrite").objectStore("history").openCursor(IDBKeyRange.lowerBound(this.currentKey,!0)).onsuccess=e=>{let t=e.target.result;return t?(document.querySelector(".z4historypreview.z4historypreview-"+t.key).remove(),t.delete().onsuccess=e=>(t.continue(),null)):this.canvas.toHistory(e=>{this.database.transaction("history","readwrite").objectStore("history").add(e).onsuccess=t=>{this.undo.setEnabled(!0),this.redo.setEnabled(!1),this.consolidate.setEnabled(!0),this.canvas.setChanged(!1),this.currentKey=t.target.result;let i=new Z4HistoryPreview;return i.setHistory(this.currentKey,e,this.canvas),i.setRibbonHistoryPanel(this),this.historyPreview.add(i,null),document.querySelectorAll(".z4historypreview .z4historypreview-selector").forEach(e=>e.textContent=Z4HistoryPreview.UNSELECTED_HISTORY_CONTENT),document.querySelector(".z4historypreview.z4historypreview-"+this.currentKey+" .z4historypreview-selector").textContent=Z4HistoryPreview.SELECTED_HISTORY_CONTENT,setTimeout(()=>document.querySelector(".z4historypreview.z4historypreview-"+this.currentKey).scrollIntoView(),0),null}}),null})}addHistory(e,t,i){this.database.transaction("history","readwrite").objectStore("history").add(e).onsuccess=s=>{this.consolidate.setEnabled(i);let n=s.target.result,a=new Z4HistoryPreview;return a.setHistory(n,e,this.canvas),a.setRibbonHistoryPanel(this),this.historyPreview.add(a,null),t(n),null}}iterateHistoryBuffer(e){this.database.transaction("history","readonly").objectStore("history").openCursor().onsuccess=t=>{let i=t.target.result;return i?e(i.key,i.value,()=>i.continue()):e(-1,null,null),null}}setCurrentKey(e){this.currentKey=e,document.querySelectorAll(".z4historypreview .z4historypreview-selector").forEach(e=>e.textContent=Z4HistoryPreview.UNSELECTED_HISTORY_CONTENT),document.querySelector(".z4historypreview.z4historypreview-"+this.currentKey+" .z4historypreview-selector").textContent=Z4HistoryPreview.SELECTED_HISTORY_CONTENT,this.database.transaction("history","readonly").objectStore("history").openCursor(IDBKeyRange.upperBound(this.currentKey,!0)).onsuccess=e=>(this.undo.setEnabled(!!e.target.result),null),this.database.transaction("history","readonly").objectStore("history").openCursor(IDBKeyRange.lowerBound(this.currentKey,!0)).onsuccess=e=>(this.redo.setEnabled(!!e.target.result),null)}getCurrentKey(){return this.currentKey}setCanvas(e){this.canvas=e}setStatusPanel(e){this.statusPanel=e}startStandard(){if("standard"===this.z4historyManagement){this.clearIntervals(),this.standardRand=Math.random();let e=this.standardRand;this.standardID=setTimeout(()=>{this.standardRand===e&&this.saveHistory("standard")},this.z4savingDelay)}}stopStandard(){"standard"===this.z4historyManagement&&(this.clearIntervals(),this.standardRand=Math.random())}setHistoryManagementSettings(e,t,i){this.z4historyManagement=e,this.z4savingDelay=t,this.z4savingInterval=i,this.save.setEnabled("manual"===e),this.clearIntervals(),this.setIntervals()}clearIntervals(){-1!==this.timerID&&(clearInterval(this.timerID),this.timerID=-1),-1!==this.standardID&&(clearTimeout(this.standardID),this.standardID=-1)}setIntervals(){switch(this.z4historyManagement){case"standard":case"manual":break;case"timer":this.timerID=setInterval(()=>this.saveHistory("timer"),this.z4savingInterval)}}}class Z4RibbonLayerPanel extends Z4AbstractRibbonPanel{showLayerBounds=new JSCheckBox;layersPreview=new JSPanel;statusPanel=null;canvas=null;layerDnD=null;previewDnD=null;constructor(){super(),this.setLayout(new GridBagLayout),this.cssAddClass("z4ribbonlayerpanel"),Z4UI.addLabel(this,Z4Translations.NEW_LAYER,new GBC(0,0).w(3).a(GBC.WEST).i(5,5,2,0)),this.addButton(Z4Translations.CREATE,!0,0,1,"left",0,e=>this.addFromColor()),this.addButton(Z4Translations.FROM_CLIPBOARD,"function"==typeof navigator.clipboard.read,1,1,"both",0,e=>this.addFromClipboard()),this.addButton(Z4Translations.FROM_FILE,!0,2,1,"right",0,e=>this.addFromFile()),Z4UI.addVLine(this,new GBC(3,0).h(3).wy(1).f(GBC.VERTICAL).i(1,2,1,2)),this.addButton(Z4Translations.MERGE,!0,4,1,"",0,e=>this.merge()),this.showLayerBounds.setText(Z4Translations.SHOW_LAYER_BOUNDS),this.showLayerBounds.addActionListener(e=>this.canvas.setShowLayerBounds(this.showLayerBounds.isSelected())),this.add(this.showLayerBounds,new GBC(4,2).a(GBC.NORTH)),Z4UI.addVLine(this,new GBC(5,0).h(3).wy(1).f(GBC.VERTICAL).i(1,2,1,2)),this.layersPreview.setLayout(new BoxLayout(this.layersPreview,BoxLayout.X_AXIS)),this.layersPreview.getStyle().overflowX="scroll",this.layersPreview.addEventListener("dragenter",e=>e.preventDefault()),this.layersPreview.addEventListener("dragover",e=>e.preventDefault()),this.layersPreview.addEventListener("dragleave",e=>e.preventDefault()),this.layersPreview.addEventListener("drop",e=>{e.preventDefault();let t=e,i=this.previewDnD.invoke("getBoundingClientRect()"),s=this.layersPreview.invoke("getBoundingClientRect()"),n=parseInt((t.clientX-s.left)/i.width);this.moveLayer(this.previewDnD,this.layerDnD,n)}),this.add(this.layersPreview,new GBC(6,0).h(3).wx(1).f(GBC.BOTH))}setCanvas(e){this.canvas=e}setStatusPanel(e){this.statusPanel=e}moveLayer(e,t,i){this.canvas.moveLayer(t,i)&&(i<this.canvas.getLayersCount()?(i=Math.min(this.canvas.getLayersCount(),i+1),this.layersPreview.insertBefore(e,"details:nth-child("+i+")")):this.layersPreview.add(e,null))}addFromColor(){let e=this.canvas.getSize(),t=new Z4NewImagePanel;t.setSelectedSize(e.width,e.height),JSOptionPane.showInputDialog(t,Z4Translations.CREATE,e=>t.addChangeListener(e),()=>{let e=t.getSelectedSize();return 0<e.width&&e.width<=Z4Constants.MAX_IMAGE_SIZE&&0<e.height&&e.height<=Z4Constants.MAX_IMAGE_SIZE},e=>{if(e===JSOptionPane.OK_OPTION){let i=t.getSelectedSize(),s=t.getSelectedFilling();this.canvas.addLayer(i.width,i.height,s),Z4Constants.pushHistory(s)}})}addFromFile(){if("function"==typeof window.showOpenFilePicker){let e=new FilePickerOptions;e.excludeAcceptAllOption=!0,e.id=Z4Constants.IMAGE_FILE_ID,e.multiple=!1,e.types=Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_TYPE,JSFilePicker.showOpenFilePicker(e,0,e=>e.forEach(e=>this.canvas.addLayerFromHandle(e)))}else JSFileChooser.showOpenDialog(""+Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_FORMAT.join(","),JSFileChooser.SINGLE_SELECTION,0,e=>e.forEach(e=>this.canvas.addLayerFromFile(e)))}addFromClipboard(){this.canvas.addLayerFromClipboard()}merge(){let e=new Z4MergeLayerPanel;e.setCanvas(this.canvas),JSOptionPane.showInputDialog(e,Z4Translations.MERGE,t=>e.addChangeListener(t),()=>e.getSelectedLayers().length>1,t=>{if(t===JSOptionPane.OK_OPTION){let i=e.getSelectedLayers();i.forEach(e=>{let t=this.canvas.deleteLayer(e,!0);document.querySelector(".z4layerpreview:nth-child("+(t+1)+")").remove()}),this.canvas.mergeLayers(i)}})}reset(){this.showLayerBounds.setSelected(!1),this.layersPreview.setProperty("innerHTML","")}addLayerPreview(e){let t=new Z4LayerPreview;t.setRibbonLayerPanel(this),t.setLayer(this.canvas,e),t.setChildAttributeByQuery("summary","draggable","true"),t.addEventListener("dragstart",i=>{i.dataTransfer.effectAllowed="move",this.layerDnD=e,this.previewDnD=t}),document.querySelectorAll(".z4layerpreview .z4layerpreview-selector").forEach(e=>e.textContent=Z4LayerPreview.UNSELECTED_LAYER_CONTENT),this.layersPreview.add(t,null),setTimeout(()=>t.invoke("scrollIntoView()"),0)}}class Z4RibbonProjectPanel extends Z4AbstractRibbonPanel{canvas=null;statusPanel=null;saveProjectButton=null;constructor(){super(),this.setLayout(new GridBagLayout),this.cssAddClass("z4ribbonprojectpanel"),Z4UI.addLabel(this,Z4Translations.NEW_PROJECT,new GBC(0,0).w(3).a(GBC.WEST).i(5,5,2,0)),this.addButton(Z4Translations.CREATE,!0,0,1,"left",0,e=>this.checkSaved(Z4Translations.CREATE,()=>this.createFromColor())),this.addButton(Z4Translations.FROM_CLIPBOARD,"function"==typeof navigator.clipboard.read,1,1,"both",0,e=>this.checkSaved(Z4Translations.FROM_CLIPBOARD,()=>this.createFromClipboard())),this.addButton(Z4Translations.FROM_FILE,!0,2,1,"right",0,e=>this.checkSaved(Z4Translations.FROM_FILE,()=>this.createFromFile())),Z4UI.addVLine(this,new GBC(3,0).h(3).wy(1).f(GBC.VERTICAL).i(1,2,1,2)),Z4UI.addLabel(this,Z4Translations.OPEN,new GBC(4,0).a(GBC.WEST).i(5,5,2,0)),this.addButton(Z4Translations.OPEN_PROJECT,!0,4,1,"",0,e=>this.checkSaved(Z4Translations.OPEN_PROJECT,()=>this.openProject())),Z4UI.addVLine(this,new GBC(5,0).h(3).wy(1).f(GBC.VERTICAL).i(1,2,1,2)),Z4UI.addLabel(this,Z4Translations.SAVE,new GBC(6,0).w(2).a(GBC.WEST).i(5,5,2,0)),this.saveProjectButton=this.addButton(Z4Translations.SAVE_PROJECT,!1,6,1,"left",0,e=>this.saveProject(null,!1)),this.addButton(Z4Translations.SAVE_PROJECT_AS,!0,7,1,"right",0,e=>this.saveProject(null,!0)),this.addButton(Z4Translations.EXPORT,!0,6,2,"",0,e=>this.exportToFile()),Z4UI.addVLine(this,new GBC(9,0).h(3).wy(1).f(GBC.VERTICAL).i(1,2,1,2)),Z4UI.addLabel(this,Z4Translations.TRANSFORM,new GBC(10,0).w(3).a(GBC.WEST).i(5,5,2,0)),this.addButton(Z4Translations.FLIP_HORIZONTAL,!0,10,1,"left",0,e=>this.flip(e=>e.flipHorizonal(),(e,t,i)=>new Point(2*e.x-t.x-i.width,t.y))).getStyle().marginBottom="5px",this.addButton(Z4Translations.FLIP_VERTICAL,!0,11,1,"both",0,e=>this.flip(e=>e.flipVertical(),(e,t,i)=>new Point(t.x,2*e.y-t.y-i.height))).getStyle().marginBottom="5px",this.addButton(Z4Translations.RESIZE,!0,12,1,"right",0,e=>{let t=this.canvas.getSize(),i=new OffscreenCanvas(t.width,t.height),s=i.getContext("2d");for(let n=0;n<this.canvas.getLayersCount();n++)this.canvas.getLayerAt(n).draw(s,!1);let a=new Z4ResizeImagePanel;a.setCanvas(i,t.width,t.height),JSOptionPane.showInputDialog(a,Z4Translations.RESIZE,e=>a.addChangeListener(e),()=>{let e=a.getResizeOptions(),t=0<e.containerWidth&&e.containerWidth<=Z4Constants.MAX_IMAGE_SIZE&&0<e.containerHeight&&e.containerHeight<=Z4Constants.MAX_IMAGE_SIZE,i=0<e.contentWidth&&e.contentWidth<=Z4Constants.MAX_IMAGE_SIZE&&0<e.contentHeight&&e.contentHeight<=Z4Constants.MAX_IMAGE_SIZE;return t&&i},e=>{if(e===JSOptionPane.OK_OPTION){let i=a.getResizeOptions(),s=i.contentWidth/t.width,n=i.contentHeight/t.height;for(let r=0;r<this.canvas.getLayersCount();r++){let o=this.canvas.getLayerAt(r),l=o.getOffset(),h=o.getSize();o.resize(new Z4ResizeOptions(parseInt(h.width*s),parseInt(h.height*n),parseInt(h.width*s),parseInt(h.height*n),0,0)),o.move(i.contentOffsetX+parseInt(l.x*s),i.contentOffsetY+parseInt(l.y*n))}this.canvas.resize(i.containerWidth,i.containerHeight),document.querySelectorAll(".z4layerpreview .z4layerpreview-setlayer").forEach(e=>e.click()),this.afterTransform()}})}).getStyle().marginBottom="5px",this.addButton(Z4Translations.ROTATE_PLUS_90,!0,10,2,"left",0,e=>{this.rotatePlus90(),document.querySelectorAll(".z4layerpreview .z4layerpreview-setlayer").forEach(e=>e.click()),this.afterTransform()}),this.addButton(Z4Translations.ROTATE_MINUS_90,!0,11,2,"both",0,e=>{this.rotatePlus90(),this.rotatePlus90(),this.rotatePlus90(),document.querySelectorAll(".z4layerpreview .z4layerpreview-setlayer").forEach(e=>e.click()),this.afterTransform()}),this.addButton(Z4Translations.ROTATE_180,!0,12,2,"right",0,e=>{this.rotatePlus90(),this.rotatePlus90(),document.querySelectorAll(".z4layerpreview .z4layerpreview-setlayer").forEach(e=>e.click()),this.afterTransform()}),Z4UI.addVLine(this,new GBC(16,0).h(3).wxy(1,1).f(GBC.VERTICAL).i(1,2,1,2))}flip(e,t){let i=this.canvas.getSize(),s=new Point(i.width/2,i.height/2);for(let n=0;n<this.canvas.getLayersCount();n++){let a=this.canvas.getLayerAt(n);e(a);let r=t(s,a.getOffset(),a.getSize());a.move(r.x,r.y)}document.querySelectorAll(".z4layerpreview .z4layerpreview-setlayer").forEach(e=>e.click()),this.afterTransform()}rotatePlus90(){let e=this.canvas.getSize(),t=new Point(e.width/2,e.height/2);for(let i=0;i<this.canvas.getLayersCount();i++){let s=this.canvas.getLayerAt(i),n=s.getOffset(),a=s.getSize();s.rotatePlus90(),s.move(2*t.y-n.y-a.height,n.x)}this.canvas.rotatePlus90()}afterTransform(){this.canvas.setSaved(!1),this.canvas.drawCanvas(),this.canvas.drawCanvasBounds(),this.canvas.setChanged(!0),this.canvas.saveHistory("standard,tool")}setCanvas(e){this.canvas=e,this.canvas.addEventListener("dragenter",e=>this.onDrop(e,!1)),this.canvas.addEventListener("dragover",e=>this.onDrop(e,!1)),this.canvas.addEventListener("dragleave",e=>this.onDrop(e,!1)),this.canvas.addEventListener("drop",e=>this.onDrop(e,!0))}setStatusPanel(e){this.statusPanel=e}checkSaved(e,t){this.canvas.isSaved()?t():JSOptionPane.showConfirmDialog(Z4Translations.PROJECT_NOT_SAVED_MESSAGE,e,JSOptionPane.YES_NO_CANCEL_OPTION,JSOptionPane.QUESTION_MESSAGE,e=>{switch(e){case JSOptionPane.YES_OPTION:this.saveProject(t,!1);break;case JSOptionPane.NO_OPTION:t()}})}createFromColor(){let e=new Z4NewImagePanel;JSOptionPane.showInputDialog(e,Z4Translations.CREATE,t=>e.addChangeListener(t),()=>{let t=e.getSelectedSize();return 0<t.width&&t.width<=Z4Constants.MAX_IMAGE_SIZE&&0<t.height&&t.height<=Z4Constants.MAX_IMAGE_SIZE},t=>{if(t===JSOptionPane.OK_OPTION){let i=e.getSelectedSize(),s=e.getSelectedFilling();this.canvas.create(i.width,i.height,s),Z4Constants.pushHistory(s)}})}createFromFile(){if("function"==typeof window.showOpenFilePicker){let e=new FilePickerOptions;e.excludeAcceptAllOption=!0,e.id=Z4Constants.IMAGE_FILE_ID,e.multiple=!1,e.types=Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_TYPE,JSFilePicker.showOpenFilePicker(e,0,e=>e.forEach(e=>this.canvas.createFromHandle(e)))}else JSFileChooser.showOpenDialog(""+Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_FORMAT.join(","),JSFileChooser.SINGLE_SELECTION,0,e=>e.forEach(e=>this.canvas.createFromFile(e)))}createFromClipboard(){this.canvas.createFromClipboard()}openProject(){if("function"==typeof window.showOpenFilePicker){let e=new FilePickerOptions;e.excludeAcceptAllOption=!0,e.id=Z4Constants.IMAGE_FILE_ID,e.multiple=!1,e.types=Z4Constants.PIZZAPAZZA_PROJECT_FILE_TYPE,JSFilePicker.showOpenFilePicker(e,0,e=>e.forEach(e=>this.canvas.openProjectFromHandle(e)))}else JSFileChooser.showOpenDialog(".z4i",JSFileChooser.SINGLE_SELECTION,0,e=>e.forEach(e=>this.canvas.openProjectFromFile(e)))}saveProject(e,t){"function"==typeof window.showSaveFilePicker?this.saveProjectToHandle(e,t):this.saveProjectToFile(e,t)}saveProjectToFile(e,t){if(t||!this.canvas.getProjectName()){let i=new JSPanel;i.setLayout(new BorderLayout(0,0));let s=new JSLabel;s.setText(Z4Translations.PROJECT_NAME),i.add(s,BorderLayout.NORTH);let n=new JSTextField;n.setText(this.canvas.getProjectName()),i.add(n,BorderLayout.CENTER),JSOptionPane.showInputDialog(i,Z4Translations.SAVE,e=>n.addActionListener(t=>e(new ChangeEvent)),()=>!!n.getText(),t=>{t===JSOptionPane.OK_OPTION&&this.canvas.saveProjectToFile(n.getText(),e)})}else this.canvas.saveProjectToFile(this.canvas.getProjectName(),e)}saveProjectToHandle(e,t){if(t||!this.canvas.getHandle()){let i=new FilePickerOptions;i.excludeAcceptAllOption=!0,i.id=Z4Constants.IMAGE_FILE_ID,i.multiple=!1,i.suggestedName=this.canvas.getProjectName(),i.types=Z4Constants.PIZZAPAZZA_PROJECT_FILE_TYPE,JSFilePicker.showSaveFilePicker(i,t=>this.canvas.saveProjectToHandle(t,e))}else this.canvas.saveProjectToHandle(this.canvas.getHandle(),e)}exportToFile(){if("function"==typeof window.showSaveFilePicker){let e=new FilePickerOptions;e.excludeAcceptAllOption=!0,e.id=Z4Constants.IMAGE_FILE_ID,e.multiple=!1,e.suggestedName=this.canvas.getProjectName(),e.types=Z4Constants.ACCEPTED_SAVE_IMAGE_FILE_TYPE,JSFilePicker.showSaveFilePicker(e,e=>this.export(e))}else this.export(null)}export(e){if(e)e.name.toLowerCase().endsWith(".png")?this.canvas.exportToHandle(e,0):e.getFile().then(t=>{let i=new Z4ExportToFilePanel;i.setFilename(t.name),i.setFilenameEditable(!1),i.setFileExtension(".jpg"),i.setFileExtensionEnabled(!1),JSOptionPane.showInputDialog(i,Z4Translations.EXPORT,e=>i.addChangeListener(e),()=>i.isValid(),t=>{t===JSOptionPane.OK_OPTION&&this.canvas.exportToHandle(e,i.getQuality())})});else{let t=new Z4ExportToFilePanel;t.setFilename(this.canvas.getProjectName()),JSOptionPane.showInputDialog(t,Z4Translations.EXPORT,e=>t.addChangeListener(e),()=>t.isValid(),e=>{e===JSOptionPane.OK_OPTION&&this.canvas.exportToFile(t.getFilename(),t.getFileExtension(),t.getQuality())})}}onDrop(e,t){e.preventDefault(),e.dataTransfer.dropEffect="none";let i=[];if(e.dataTransfer.items){for(let s=0;s<e.dataTransfer.items.length;s++)if("file"===e.dataTransfer.items[s].kind){let n=e.dataTransfer.items[s].getAsFile();i.push(n||e.dataTransfer.items[s])}}else e.dataTransfer.files.forEach(e=>i.push(e));i[0]&&(e.dataTransfer.dropEffect="copy",t&&(i[0].name.toLowerCase().endsWith(".z4i")?this.checkSaved(Z4Translations.OPEN_PROJECT,()=>this.canvas.openProjectFromFile(i[0])):Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_FORMAT.some((e,t,s)=>i[0].name.toLowerCase().endsWith(e))&&this.checkSaved(Z4Translations.FROM_FILE,()=>this.canvas.createFromFile(i[0]))))}setSaveEnabled(e){this.saveProjectButton.setEnabled(e)}}class Z4RibbonSettingsPanel extends Z4AbstractRibbonPanel{language=new JSComboBox;theme=new JSComboBox;color=new JSColorChooser;historyManagement=new JSComboBox;historyManagementDescription=new JSLabel;savingInterval=new JSComboBox;savingDelay=new JSComboBox;historyPanel=null;constructor(){super(),this.setLayout(new GridBagLayout),this.cssAddClass("z4ribbonsettingspanel"),Z4UI.addLabel(this,Z4Translations.LANGUAGE,new GBC(0,0).a(GBC.WEST).i(5,5,2,0));let e=new DefaultKeyValueComboBoxModelAndRenderer;e.addElement(new KeyValue("en",Z4Translations.LANGUAGE_ENGLISH_NATIVE)),e.addElement(new KeyValue("it",Z4Translations.LANGUAGE_ITALIAN_NATIVE)),this.language.setModelAndRenderer(e),this.language.setSelectedItem(Z4Translations.CURRENT_LANGUAGE),this.language.addActionListener(e=>this.onchangeLanguage()),this.add(this.language,new GBC(0,1).f(GBC.HORIZONTAL).i(0,5,0,5)),Z4UI.addLabel(this,Z4Translations.THEME,new GBC(1,0).a(GBC.WEST).i(5,5,2,0));let t=null,i=localStorage.getItem("z4theme");switch(i){case"light":case"dark":case"auto":t=new KeyValue(i,Z4Translations["THEME_"+i.toUpperCase()]);break;default:t=new KeyValue("auto",Z4Translations.THEME_AUTO)}let s=new DefaultKeyValueComboBoxModelAndRenderer;s.addElement(new KeyValue("auto",Z4Translations.THEME_AUTO)),s.addElement(new KeyValue("light",Z4Translations.THEME_LIGHT)),s.addElement(new KeyValue("dark",Z4Translations.THEME_DARK)),this.theme.setModelAndRenderer(s),this.theme.setSelectedItem(t),this.theme.addActionListener(e=>this.onchangeTheme()),this.add(this.theme,new GBC(1,1).f(GBC.HORIZONTAL).i(0,5,0,5)),Z4UI.addLabel(this,Z4Translations.THEME_COLOR,new GBC(2,0).a(GBC.WEST).i(5,5,2,0));let n=localStorage.getItem("z4color");this.color.setSelectedColor(Color.fromRGB_HEX(n||"#0d6efd")),this.color.setOpacityVisible(!1),this.color.addChangeListener(e=>this.onchangeColor()),this.add(this.color,new GBC(2,1).f(GBC.HORIZONTAL).i(0,5,0,5)),Z4UI.addVLine(this,new GBC(3,0).h(3).wy(1).a(GBC.EAST).f(GBC.VERTICAL).i(1,2,1,2)),Z4UI.addLabel(this,Z4Translations.HISTORY_MANAGEMENT,new GBC(4,0).a(GBC.WEST).i(5,5,2,0));let a=null,r=localStorage.getItem("z4historymanagement");switch(r){case"standard":case"timer":case"manual":case"tool":a=new KeyValue(r,Z4Translations[r.toUpperCase()+"_POLICY"]);break;default:a=new KeyValue("standard",Z4Translations.STANDARD_POLICY)}let o=new DefaultKeyValueComboBoxModelAndRenderer;o.addElement(new KeyValue("standard",Z4Translations.STANDARD_POLICY)),o.addElement(new KeyValue("timer",Z4Translations.TIMER_POLICY)),o.addElement(new KeyValue("manual",Z4Translations.MANUAL_POLICY)),o.addElement(new KeyValue("tool",Z4Translations.TOOL_POLICY)),this.historyManagement.getStyle().minWidth="18rem",this.historyManagement.setModelAndRenderer(o),this.historyManagement.setSelectedItem(a),this.historyManagement.addActionListener(e=>this.onchangeHistoryManagementSettings()),this.add(this.historyManagement,new GBC(4,1).a(GBC.WEST).i(0,5,0,5)),this.historyManagementDescription.setText(Z4Translations[a.key.toUpperCase()+"_POLICY_DESCRIPTION"]),this.add(this.historyManagementDescription,new GBC(4,2).w(3).wx(1).a(GBC.NORTHWEST).i(5,0,0,0)),Z4UI.addLabel(this,Z4Translations.SAVING_DELAY,new GBC(5,0).a(GBC.WEST).i(5,5,2,0));let l=parseInt(localStorage.getItem("z4savingdelay")),h=(l=l||1e3)<1e3?l+"ms":l/1e3+"s",d=new KeyValue(l,h),c=new DefaultKeyValueComboBoxModelAndRenderer;c.addElement(new KeyValue(100,"100ms")),c.addElement(new KeyValue(200,"200ms")),c.addElement(new KeyValue(500,"500ms")),c.addElement(new KeyValue(1e3,"1s")),c.addElement(new KeyValue(2e3,"2s")),c.addElement(new KeyValue(5e3,"5s")),this.savingDelay.getStyle().minWidth="6rem",this.savingDelay.setEnabled("standard"===a.key),this.savingDelay.setModelAndRenderer(c),this.savingDelay.setSelectedItem(d),this.savingDelay.addActionListener(e=>this.onchangeHistoryManagementSettings()),this.add(this.savingDelay,new GBC(5,1).a(GBC.WEST).i(0,5,0,0)),Z4UI.addLabel(this,Z4Translations.SAVING_INTERVAL,new GBC(6,0).a(GBC.WEST).i(5,5,2,0));let g=parseInt(localStorage.getItem("z4savinginterval")),u=(g=g||6e4)<6e4?g/1e3+"s":g/6e4+"min",T=new KeyValue(g,u),S=new DefaultKeyValueComboBoxModelAndRenderer;S.addElement(new KeyValue(1e4,"10s")),S.addElement(new KeyValue(3e4,"30s")),S.addElement(new KeyValue(6e4,"1m")),S.addElement(new KeyValue(12e4,"2m")),S.addElement(new KeyValue(18e4,"3m")),S.addElement(new KeyValue(3e5,"5m")),this.savingInterval.getStyle().minWidth="6rem",this.savingInterval.setEnabled("timer"===a.key),this.savingInterval.setModelAndRenderer(S),this.savingInterval.setSelectedItem(T),this.savingInterval.addActionListener(e=>this.onchangeHistoryManagementSettings()),this.add(this.savingInterval,new GBC(6,1).a(GBC.WEST).i(0,5,0,0)),Z4UI.addVLine(this,new GBC(7,0).h(3).wy(1).a(GBC.EAST).f(GBC.VERTICAL).i(1,2,1,2));let p=new JSButton;p.setText(Z4Translations.RESET),p.setContentAreaFilled(!1),p.addActionListener(e=>this.onreset()),this.add(p,new GBC(8,1).a(GBC.BOTH).i(0,5,0,5))}onchangeLanguage(){localStorage.setItem("z4language",this.language.getSelectedItem().key),JSOptionPane.showMessageDialog(Z4Translations.REFRESH_PAGE_MESSAGE,Z4Translations.LANGUAGE,JSOptionPane.INFORMATION_MESSAGE,null)}onchangeTheme(){localStorage.setItem("z4theme",this.theme.getSelectedItem().key),JSOptionPane.showMessageDialog(Z4Translations.REFRESH_PAGE_MESSAGE,Z4Translations.THEME,JSOptionPane.INFORMATION_MESSAGE,null)}onchangeColor(){this.color.getValueIsAdjusting()||(localStorage.setItem("z4color",this.color.getSelectedColor().getRGB_HEX()),JSOptionPane.showMessageDialog(Z4Translations.REFRESH_PAGE_MESSAGE,Z4Translations.THEME_COLOR,JSOptionPane.INFORMATION_MESSAGE,null))}onchangeHistoryManagementSettings(){let e=this.historyManagement.getSelectedItem();localStorage.setItem("z4historymanagement",e.key),this.historyManagementDescription.setText(Z4Translations[e.key.toUpperCase()+"_POLICY_DESCRIPTION"]);let t=this.savingDelay.getSelectedItem();localStorage.setItem("z4savingdelay",""+t.key);let i=this.savingInterval.getSelectedItem();localStorage.setItem("z4savinginterval",""+i.key),this.savingDelay.setEnabled("standard"===e.key),this.savingInterval.setEnabled("timer"===e.key),this.historyPanel.setHistoryManagementSettings(e.key,t.key,i.key)}onreset(){localStorage.removeItem("z4language"),localStorage.removeItem("z4theme"),localStorage.removeItem("z4color"),localStorage.removeItem("z4historymanagement"),localStorage.removeItem("z4savingdelay"),localStorage.removeItem("z4savinginterval"),this.historyManagement.setSelectedItem(new KeyValue("standard",Z4Translations.STANDARD_POLICY)),this.historyManagementDescription.setText(Z4Translations.STANDARD_POLICY_DESCRIPTION),this.savingDelay.setSelectedItem(new KeyValue(1e3,"1s")),this.savingDelay.setEnabled(!0),this.savingInterval.setSelectedItem(new KeyValue(6e4,"1min")),this.savingInterval.setEnabled(!1),this.historyPanel.setHistoryManagementSettings("standard",1e3,6e4),JSOptionPane.showMessageDialog(Z4Translations.REFRESH_PAGE_MESSAGE,Z4Translations.RESET,JSOptionPane.INFORMATION_MESSAGE,null)}setHistoryPanel(e){this.historyPanel=e;let t=this.historyManagement.getSelectedItem(),i=this.savingDelay.getSelectedItem(),s=this.savingInterval.getSelectedItem();this.historyPanel.setHistoryManagementSettings(t.key,i.key,s.key)}}class Z4RibbonTextPanel extends Z4AbstractRibbonPanel{fontSelection=new JSButton;textText=new JSTextField;textEmpty=new JSCheckBox;textBorder=new JSSpinner;textBorderColor=new JSColorChooser;textShearX=new JSSpinner;textShearY=new JSSpinner;shadow=new JSCheckBox;shadowText=new JSTextField;shadowEmpty=new JSCheckBox;shadowShearX=new JSSpinner;shadowShearY=new JSSpinner;apply=new JSButton;reset=new JSButton;canvas=null;fontsChecked=!1;fonts=[];textInfo=new Z4TextInfo;constructor(){super(),this.setLayout(new GridBagLayout),this.cssAddClass("z4ribbontextpanel"),this.textInfo.font=new Z4Font("Arial",12,!1,!1),this.fontSelection.setContentAreaFilled(!1),this.fontSelection.setText(Z4Translations.FONT_SELECTION),this.fontSelection.addActionListener(e=>{let t=new Z4FontSelectionPanel(this.fonts);t.setValue(this.textInfo.font),JSOptionPane.showInputDialog(t,Z4Translations.FONT_SELECTION,e=>t.addChangeListener(e),()=>!!t.getValue(),e=>{e===JSOptionPane.OK_OPTION&&(this.textInfo.font=t.getValue(),this.onTextInfoChange())})}),this.add(this.fontSelection,new GBC(0,2).f(GBC.VERTICAL)),Z4UI.addVLine(this,new GBC(1,0).h(4).wy(1).f(GBC.VERTICAL).i(1,2,1,2)),Z4UI.addLabel(this,Z4Translations.TEXT,new GBC(2,0).h(2).a(GBC.WEST).i(5,5,2,0)),this.textText.addActionListener(e=>this.onTextInfoChange()),this.add(this.textText,new GBC(2,2).a(GBC.WEST).f(GBC.VERTICAL).i(0,0,0,5)),this.textEmpty.setText(Z4Translations.EMPTY),this.textEmpty.addActionListener(e=>this.onTextInfoChange()),this.add(this.textEmpty,new GBC(2,3).a(GBC.WEST)),Z4UI.addLabel(this,Z4Translations.BORDER,new GBC(3,0).h(2).a(GBC.WEST).i(5,5,2,0)),this.textBorder.cssAddClass("jsspinner_w_4rem"),this.textBorder.setModel(new SpinnerNumberModel(0,1,20,1)),this.textBorder.addChangeListener(e=>this.onTextInfoChange()),this.add(this.textBorder,new GBC(3,2).a(GBC.WEST).i(0,0,0,5)),this.textBorderColor.setCloseOnChange(!1),this.textBorderColor.setSelectedColor(new Color(0,0,0,255)),this.textBorderColor.addChangeListener(e=>this.onTextInfoChange()),this.add(this.textBorderColor,new GBC(3,3).f(GBC.HORIZONTAL).i(0,0,0,5)),Z4UI.addLabel(this,Z4Translations.SHEARING,new GBC(4,0).w(2).a(GBC.WEST).i(5,5,0,0)),Z4UI.addLabel(this,Z4Translations.HORIZONTAL,new GBC(4,1).a(GBC.WEST).i(0,5,0,0)).getStyle().fontSize="smaller",Z4UI.addLabel(this,Z4Translations.VERTICAL,new GBC(5,1).a(GBC.WEST).i(0,5,0,0)).getStyle().fontSize="smaller",this.textShearX.cssAddClass("jsspinner_w_4rem"),this.textShearX.setModel(new SpinnerNumberModel(0,-200,200,1)),this.textShearX.addChangeListener(e=>this.onTextInfoChange()),this.add(this.textShearX,new GBC(4,2).a(GBC.WEST).i(0,0,0,5)),this.textShearY.cssAddClass("jsspinner_w_4rem"),this.textShearY.setModel(new SpinnerNumberModel(0,-200,200,1)),this.textShearY.addChangeListener(e=>this.onTextInfoChange()),this.add(this.textShearY,new GBC(5,2).a(GBC.WEST)),Z4UI.addVLine(this,new GBC(11,0).h(4).wy(1).f(GBC.VERTICAL).i(1,2,1,2)),this.shadow.setText(Z4Translations.SHADOW),this.shadow.addActionListener(e=>this.onTextInfoChange()),this.add(this.shadow,new GBC(12,0).h(2).a(GBC.WEST)),this.shadowText.addActionListener(e=>this.onTextInfoChange()),this.add(this.shadowText,new GBC(12,2).f(GBC.VERTICAL).a(GBC.WEST).i(0,0,0,5)),this.shadowEmpty.setText(Z4Translations.EMPTY),this.shadowEmpty.addActionListener(e=>this.onTextInfoChange()),this.add(this.shadowEmpty,new GBC(12,3).a(GBC.WEST)),Z4UI.addLabel(this,Z4Translations.SHEARING,new GBC(13,0).w(2).a(GBC.WEST).i(5,5,0,0)),Z4UI.addLabel(this,Z4Translations.HORIZONTAL,new GBC(13,1).a(GBC.WEST).i(0,5,0,0)).getStyle().fontSize="smaller",Z4UI.addLabel(this,Z4Translations.VERTICAL,new GBC(14,1).a(GBC.WEST).i(0,5,0,0)).getStyle().fontSize="smaller",this.shadowShearX.cssAddClass("jsspinner_w_4rem"),this.shadowShearX.setModel(new SpinnerNumberModel(0,-200,200,1)),this.shadowShearX.addChangeListener(e=>this.onTextInfoChange()),this.add(this.shadowShearX,new GBC(13,2).a(GBC.WEST).i(0,0,0,5)),this.shadowShearY.cssAddClass("jsspinner_w_4rem"),this.shadowShearY.setModel(new SpinnerNumberModel(0,-200,200,1)),this.shadowShearY.addChangeListener(e=>this.onTextInfoChange()),this.add(this.shadowShearY,new GBC(14,2).a(GBC.WEST)),Z4UI.addVLine(this,new GBC(21,0).h(4).wy(1).f(GBC.VERTICAL).i(1,2,1,2)),this.apply.setContentAreaFilled(!1),this.apply.setText("APPLY"),this.apply.addActionListener(e=>{}),this.add(this.apply,new GBC(22,2).i(0,0,0,5)),this.reset.setContentAreaFilled(!1),this.reset.setText(Z4Translations.RESET),this.reset.addActionListener(e=>this.onReset()),this.add(this.reset,new GBC(23,2))}onTextInfoChange(){this.textInfo.textText=this.textText.getText(),this.textInfo.textEmpty=this.textEmpty.isSelected(),this.textInfo.textBorder=parseInt(this.textBorder.getValue()),this.textInfo.textBorderColor=this.textBorderColor.getSelectedColor(),this.textInfo.textShearX=parseInt(this.textShearX.getValue()),this.textInfo.textShearY=parseInt(this.textShearY.getValue()),this.textInfo.shadow=this.shadow.isSelected(),this.textInfo.shadowText=this.shadowText.getText(),this.textInfo.shadowEmpty=this.shadowEmpty.isSelected(),this.textInfo.shadowShearX=parseInt(this.shadowShearX.getValue()),this.textInfo.shadowShearY=parseInt(this.shadowShearY.getValue())}onReset(){this.textInfo.font=new Z4Font("Arial",12,!1,!1),this.textText.setText(""),this.textEmpty.setSelected(!1),this.textBorder.setValue(0),this.textBorderColor.setSelectedColor(new Color(0,0,0,255)),this.textShearX.setValue(0),this.textShearY.setValue(0),this.shadow.setSelected(!1),this.shadowText.setText(""),this.shadowEmpty.setSelected(!1),this.shadowShearX.setValue(0),this.shadowShearY.setValue(0),this.onTextInfoChange()}setCanvas(e){this.canvas=e}checkFonts(){this.fontsChecked?this.canvas.addCanvasOverlayMode(Z4CanvasOverlayMode.DRAW_TEXT):this.checkStandardFonts()}checkStandardFonts(){let e=new Set(["Arial","Arial Black","Bahnschrift","Calibri","Cambria","Cambria Math","Candara","Comic Sans MS","Consolas","Constantia","Corbel","Courier New","Ebrima","Franklin Gothic Medium","Gabriola","Gadugi","Georgia","HoloLens MDL2 Assets","Impact","Ink Free","Javanese Text","Leelawadee UI","Lucida Console","Lucida Sans Unicode","Malgun Gothic","Marlett","Microsoft Himalaya","Microsoft JhengHei","Microsoft New Tai Lue","Microsoft PhagsPa","Microsoft Sans Serif","Microsoft Tai Le","Microsoft YaHei","Microsoft Yi Baiti","MingLiU-ExtB","Mongolian Baiti","MS Gothic","MV Boli","Myanmar Text","Nirmala UI","Palatino Linotype","Segoe MDL2 Assets","Segoe Print","Segoe Script","Segoe UI","Segoe UI Historic","Segoe UI Emoji","Segoe UI Symbol","SimSun","Sitka","Sylfaen","Symbol","Tahoma","Times New Roman","Trebuchet MS","Verdana","Webdings","Wingdings","Yu Gothic","American Typewriter","Andale Mono","Arial","Arial Black","Arial Narrow","Arial Rounded MT Bold","Arial Unicode MS","Avenir","Avenir Next","Avenir Next Condensed","Baskerville","Big Caslon","Bodoni 72","Bodoni 72 Oldstyle","Bodoni 72 Smallcaps","Bradley Hand","Brush Script MT","Chalkboard","Chalkboard SE","Chalkduster","Charter","Cochin","Comic Sans MS","Copperplate","Courier","Courier New","Didot","DIN Alternate","DIN Condensed","Futura","Geneva","Georgia","Gill Sans","Helvetica","Helvetica Neue","Herculanum","Hoefler Text","Impact","Lucida Grande","Luminari","Marker Felt","Menlo","Microsoft Sans Serif","Monaco","Noteworthy","Optima","Palatino","Papyrus","Phosphate","Rockwell","Savoye LET","SignPainter","Skia","Snell Roundhand","Tahoma","Times","Times New Roman","Trattatello","Trebuchet MS","Verdana","Zapfino"]),t=new Set;document.fonts.ready.then(()=>{e.forEach((e,i,s)=>{document.fonts.check("12px '"+e+"'")&&t.add(e)}),this.checkLocalFonts(t)})}checkLocalFonts(e){this.setFontsChecked(e)}setFontsChecked(e){e.forEach((e,t,i)=>this.fonts.push(e)),this.fonts.sort(),this.fontsChecked=!0,this.canvas.addCanvasOverlayMode(Z4CanvasOverlayMode.DRAW_TEXT)}}class Z4AbstractValuePanel extends JSPanel{value=null;listeners=[];constructor(){super(),this.cssAddClass("z4abstractvaluepanel")}setValue(e){}getValue(){return this.value}addChangeListener(e){this.listeners.push(e)}onchange(){let e=new ChangeEvent;this.listeners.forEach(t=>{"function"==typeof t?t(e):t.stateChanged(e)})}}class Z4BiGradientColorPanel extends Z4AbstractValuePanel{preview=new JSComponent(document.createElement("canvas"));ctx=this.preview.invoke("getContext('2d')");biRippleSpinner=new JSSpinner;biRippleSlider=new JSSlider;rippleSpinner=new JSSpinner;rippleSlider=new JSSlider;colorPanel=new Z4ColorPanel;biDelete=new JSButton;delete=new JSButton;space=null;time=null;biSelectedIndex=0;selectedIndex=0;pressed=!1;valueIsAdjusting=!1;width=Z4BiGradientColorPanel.SIZE;height=Z4BiGradientColorPanel.SIZE;static SELECTOR_RADIUS=7;static SIZE=200;static TOLERANCE=.1;constructor(){super(),this.cssAddClass("z4bigradientcolorpanel"),this.setLayout(new GridBagLayout),this.add(new JSLabel,new GBC(0,0).w(3).wy(1)),this.space=Z4UI.addLabel(this,Z4Translations.SPACE,new GBC(1,1).w(2).a(GBC.SOUTHEAST)),this.time=Z4UI.addLabel(this,Z4Translations.TIME,new GBC(0,2).wh(3,2).a(GBC.SOUTHEAST)),this.time.cssAddClass("jslabel-vertical"),this.preview.setProperty("width",""+this.width),this.preview.setProperty("height",""+this.height),this.preview.addEventListener("mouseenter",e=>this.onMouse(e,"enter")),this.preview.addEventListener("mouseleave",e=>this.onMouse(e,"leave")),this.preview.addEventListener("mousedown",e=>this.onMouse(e,"down")),this.preview.addEventListener("mousemove",e=>this.onMouse(e,"move")),this.preview.addEventListener("mouseup",e=>this.onMouse(e,"up")),this.add(this.preview,new GBC(1,2).wh(2,2)),Z4UI.addLabel(this,Z4Translations.RIPPLE,new GBC(3,3).h(2).a(GBC.SOUTH)).cssAddClass("jslabel-vertical"),this.biRippleSpinner.cssAddClass("jsspinner-vertical"),this.biRippleSpinner.cssAddClass("jsspinner_h_4rem"),this.biRippleSpinner.setModel(new SpinnerNumberModel(0,0,100,1)),this.biRippleSpinner.setChildPropertyByQuery("*:nth-child(2)","textContent","▶"),this.biRippleSpinner.setChildPropertyByQuery("*:nth-child(3)","textContent","◀"),this.biRippleSpinner.addChangeListener(e=>this.onRippleChange(!0,this.biRippleSpinner.getValueIsAdjusting(),this.biRippleSpinner,this.biRippleSlider,!0)),this.add(this.biRippleSpinner,new GBC(3,0).h(3).a(GBC.NORTHEAST).i(0,5,0,0)),this.biRippleSlider.setValue(0),this.biRippleSlider.setOrientation(JSSlider.VERTICAL),this.biRippleSlider.setInverted(!0),this.biRippleSlider.getStyle().minHeight="20rem",this.biRippleSlider.getStyle().minWidth="1.5rem",this.biRippleSlider.addChangeListener(e=>this.onRippleChange(!1,this.biRippleSlider.getValueIsAdjusting(),this.biRippleSpinner,this.biRippleSlider,!0)),this.add(this.biRippleSlider,new GBC(4,0).h(5).a(GBC.EAST));let e=new JSPanel;e.cssAddClass("jspanel-vertical"),this.add(e,new GBC(5,0).h(5).a(GBC.NORTH).f(GBC.BOTH));let t=new JSButton;t.cssAddClass("jsbutton-vertical"),t.setText(Z4Translations.MIRRORED),t.addActionListener(e=>{this.value.mirror(),this.afterOperation(this.value.getColorAtIndex(this.biSelectedIndex)),this.onchange()}),e.add(t,null),(t=new JSButton).cssAddClass("jsbutton-vertical"),t.setText(Z4Translations.INVERTED),t.addActionListener(e=>{this.value.reverse(),this.drawPreview(!1),this.onchange()}),e.add(t,null),this.biDelete.cssAddClass("jsbutton-vertical"),this.biDelete.setText(Z4Translations.DELETE),this.biDelete.setEnabled(!1),this.biDelete.addActionListener(e=>JSOptionPane.showConfirmDialog(Z4Translations.DELETE_COLOR_MESSAGE,Z4Translations.DELETE,JSOptionPane.YES_NO_OPTION,JSOptionPane.QUESTION_MESSAGE,e=>{e===JSOptionPane.YES_OPTION&&(this.value.removeColor(this.value.getColorPositionAtIndex(this.biSelectedIndex)),this.biSelectedIndex=0,this.afterOperation(this.value.getColorAtIndex(this.biSelectedIndex)),this.onchange())})),e.add(this.biDelete,null),this.add(new JSLabel,new GBC(0,4).w(3).wy(1)),Z4UI.addHLine(this,new GBC(0,5).w(6).a(GBC.WEST).f(GBC.HORIZONTAL).i(2,1,2,1)),this.colorPanel.addChangeListener(e=>{let t=this.value.getColorAtIndex(this.biSelectedIndex);t.addColor(this.colorPanel.getValue(),t.getColorPositionAtIndex(this.selectedIndex)),this.drawPreview(!1),this.onchange()}),this.add(this.colorPanel,new GBC(0,6).w(4).wx(1).f(GBC.HORIZONTAL)),this.delete.setText(Z4Translations.DELETE),this.delete.setEnabled(!1),this.delete.addActionListener(e=>JSOptionPane.showConfirmDialog(Z4Translations.DELETE_COLOR_MESSAGE,Z4Translations.DELETE,JSOptionPane.YES_NO_OPTION,JSOptionPane.QUESTION_MESSAGE,e=>{if(e===JSOptionPane.YES_OPTION){let t=this.value.getColorAtIndex(this.biSelectedIndex);t.removeColor(t.getColorPositionAtIndex(this.selectedIndex)),this.selectedIndex=0,this.afterOperation(t),this.onchange()}})),this.add(this.delete,new GBC(4,6).w(2).a(GBC.EAST).i(0,5,0,0)),Z4UI.addLabel(this,Z4Translations.RIPPLE,new GBC(0,7).w(2).a(GBC.WEST)),this.rippleSpinner.setModel(new SpinnerNumberModel(0,0,100,1)),this.rippleSpinner.cssAddClass("jsspinner_w_4rem"),this.rippleSpinner.addChangeListener(e=>this.onRippleChange(!0,this.rippleSpinner.getValueIsAdjusting(),this.rippleSpinner,this.rippleSlider,!1)),this.add(this.rippleSpinner,new GBC(3,7).w(3).a(GBC.EAST).i(5,0,0,0)),this.rippleSlider.setValue(0),this.rippleSlider.getStyle().minWidth="20rem",this.rippleSlider.addChangeListener(e=>this.onRippleChange(!1,this.rippleSlider.getValueIsAdjusting(),this.rippleSpinner,this.rippleSlider,!1)),this.add(this.rippleSlider,new GBC(0,8).w(6).a(GBC.NORTH).f(GBC.HORIZONTAL)),e=new JSPanel,this.add(e,new GBC(0,9).w(5).a(GBC.NORTH).f(GBC.HORIZONTAL)),(t=new JSButton).setText(Z4Translations.MIRRORED),t.addActionListener(e=>{let t=this.value.getColorAtIndex(this.biSelectedIndex);t.mirror(),this.afterOperation(t),this.onchange()}),e.add(t,null),(t=new JSButton).setText(Z4Translations.INVERTED),t.addActionListener(e=>{let t=this.value.getColorAtIndex(this.biSelectedIndex);t.reverse(),this.afterOperation(t),this.onchange()}),e.add(t,null),(t=new JSButton).cssAddClass("z4bigradientcolorpanel-history"),t.setIcon(new Z4EmptyImageProducer("")),t.setTooltip(Z4Translations.HISTORY),t.addActionListener(e=>this.showHistory()),this.add(t,new GBC(5,9).a(GBC.EAST)),this.setValue(new Z4BiGradientColor)}onMouse(e,t){switch(t){case"enter":break;case"down":for(let i=0;i<this.value.getColorCount();i++){let s=this.value.getColorPositionAtIndex(i),n=this.value.getColorAtIndex(i);for(let a=0;a<n.getColorCount();a++){let r=n.getColorPositionAtIndex(a);Z4Math.distance(r*this.width,s*this.height,e.offsetX,e.offsetY)<=Z4BiGradientColorPanel.SELECTOR_RADIUS&&(this.pressed=!0,this.biSelectedIndex=i,this.selectedIndex=a,this.afterOperation(n))}}if(!this.pressed&&!this.value.isPositionOccupied(e.offsetY/this.height,Z4BiGradientColorPanel.TOLERANCE)){let o=this.value.getColorAt(e.offsetY/this.height,!1);for(;o.getColorCount()>2;)o.removeColor(o.getColorPositionAtIndex(1));o.isPositionOccupied(e.offsetX/this.width,Z4BiGradientColorPanel.TOLERANCE)||o.addColor(o.getColorAt(e.offsetX/this.width,!1),e.offsetX/this.width),o.mergeOverlapping(Z4BiGradientColorPanel.TOLERANCE),this.value.addColor(o,e.offsetY/this.height),this.pressed=!0,this.setPointer(e,!0),this.onchange()}if(!this.pressed){let l=this.value.getPosition(e.offsetY/this.height,Z4BiGradientColorPanel.TOLERANCE),h=this.value.getColorAt(l,!1);h.isPositionOccupied(e.offsetX/this.width,Z4BiGradientColorPanel.TOLERANCE)||(h.addColor(h.getColorAt(e.offsetX/this.width,!1),e.offsetX/this.width),this.setPointer(e,!0))}break;case"move":if(this.pressed){let d=this.value.getColorPositionAtIndex(this.biSelectedIndex),c=this.value.getColorPositionAtIndex(this.biSelectedIndex-1),g=this.value.getColorPositionAtIndex(this.biSelectedIndex+1),u=e.offsetY/this.height,T=this.value.getColorAtIndex(this.biSelectedIndex),S=T.getColorPositionAtIndex(this.selectedIndex),p=T.getColorPositionAtIndex(this.selectedIndex-1),E=T.getColorPositionAtIndex(this.selectedIndex+1),w=e.offsetX/this.width;if(0!==this.biSelectedIndex&&this.biSelectedIndex!==this.value.getColorCount()-1&&c<u-Z4BiGradientColorPanel.TOLERANCE&&g>u+Z4BiGradientColorPanel.TOLERANCE&&(this.value.removeColor(d),this.value.addColor(T,u),this.drawPreview(!0),this.valueIsAdjusting=!0,this.onchange()),0!==this.selectedIndex&&this.selectedIndex!==T.getColorCount()-1&&p<w-Z4BiGradientColorPanel.TOLERANCE&&E>w+Z4BiGradientColorPanel.TOLERANCE){let P=T.getColorAtIndex(this.selectedIndex);T.removeColor(S),T.addColor(P,w),this.drawPreview(!0),this.valueIsAdjusting=!0,this.onchange()}}else if(this.preview.getStyle().cursor="default",this.setPointer(e,!1),"default"!==this.preview.getStyle().cursor||this.value.isPositionOccupied(e.offsetY/this.height,Z4BiGradientColorPanel.TOLERANCE)||(this.preview.getStyle().cursor="copy"),"default"===this.preview.getStyle().cursor){let Z=this.value.getPosition(e.offsetY/this.height,Z4BiGradientColorPanel.TOLERANCE);this.value.getColorAt(Z,!1).isPositionOccupied(e.offsetX/this.width,Z4BiGradientColorPanel.TOLERANCE)||(this.preview.getStyle().cursor="copy")}break;case"up":this.pressed=!1,this.drawPreview(!1),this.valueIsAdjusting=!1,this.onchange();break;case"leave":this.pressed&&(this.pressed=!1,this.drawPreview(!1),this.valueIsAdjusting=!1,this.onchange())}}setPointer(e,t){for(let i=0;i<this.value.getColorCount();i++){let s=this.value.getColorPositionAtIndex(i),n=this.value.getColorAtIndex(i);for(let a=0;a<n.getColorCount();a++){let r=n.getColorPositionAtIndex(a);Z4Math.distance(r*this.width,s*this.height,e.offsetX,e.offsetY)<=Z4BiGradientColorPanel.SELECTOR_RADIUS&&(t&&(this.biSelectedIndex=i,this.selectedIndex=a,this.afterOperation(n)),this.preview.getStyle().cursor="pointer")}}}onRippleChange(e,t,i,s,n){e?s.setValue(i.getValue()):i.setValue(s.getValue()),n?this.value.setRipple(s.getValue()/100):this.value.setGradientRipple(s.getValue()/100),this.drawPreview(t),this.valueIsAdjusting=t,this.onchange()}afterOperation(e){this.colorPanel.setValue(this.value.getColorAtIndex(this.biSelectedIndex).getColorAtIndex(this.selectedIndex)),this.biDelete.setEnabled(0!==this.biSelectedIndex&&this.biSelectedIndex!==this.value.getColorCount()-1),this.delete.setEnabled(0!==this.selectedIndex&&this.selectedIndex!==e.getColorCount()-1),this.drawPreview(!1)}showHistory(){let e=new JSPanel;e.cssAddClass("z4bigradientcolorpanel-scrollpanel"),e.getStyle().height=(Z4BiGradientColorPanel.SIZE/2+6)*4+5+"px";let t=new JSPanel;t.setLayout(new GridBagLayout),t.cssAddClass("z4bigradientcolorpanel-historypanel"),e.add(t,null);let i=[],s=[],n=new ButtonGroup;Z4BiGradientColor.getHistory().forEach((e,a,r)=>{let o=new JSRadioButton;n.add(o),i.push(o);let l=new JSComponent(document.createElement("canvas"));l.setProperty("width",""+Z4BiGradientColorPanel.SIZE/2),l.setProperty("height",""+Z4BiGradientColorPanel.SIZE/2),l.getStyle().width=Z4BiGradientColorPanel.SIZE/2+"px",l.getStyle().height=Z4BiGradientColorPanel.SIZE/2+"px",s.push(l),this.putImageData(l.invoke("getContext('2d')"),e,Z4BiGradientColorPanel.SIZE/2,Z4BiGradientColorPanel.SIZE/2),t.add(o,new GBC(a%4*2,parseInt(a/4))),t.add(l,new GBC(a%4*2+1,parseInt(a/4)).wx(1).a(GBC.WEST).i(2,0,2,20))}),JSOptionPane.showInputDialog(e,Z4Translations.HISTORY,e=>{i.forEach(t=>t.addActionListener(t=>e(new ChangeEvent))),s.forEach((t,s,n)=>t.addEventListener("mousedown",t=>{i[s].setSelected(!0),e(new ChangeEvent)})),s.forEach((t,s,n)=>t.addEventListener("dblclick",t=>{i[s].setSelected(!0),e(new ChangeEvent),document.querySelector(".z4bigradientcolorpanel-historypanel").closest(".jsdialog").querySelector(".jsoptionpane-option-0").click()}))},()=>i.some((e,t,i)=>e.isSelected()),e=>{e===JSOptionPane.OK_OPTION&&this.setValue(Z4BiGradientColor.getHistory()[i.findIndex(e=>e.isSelected())])})}drawPreview(e){if(this.width>0&&this.height>0){this.putImageData(this.ctx,this.value,this.width,this.height);for(let t=0;t<this.value.getColorCount();t++){let i=this.value.getColorPositionAtIndex(t),s=this.value.getColorAtIndex(t);for(let n=0;n<s.getColorCount();n++)this.drawCircle(i,s.getColorPositionAtIndex(n),t,n)}}}putImageData(e,t,i,s){let n=e.createImageData(i,s),a=n.data;for(let r=0;r<s;r++){let o=t.getColorAt(r/s,!0);for(let l=0;l<i;l++){let h=o.getColorAt(l/i,!0),d=(r*i+l)*4;a[d]=h.red,a[d+1]=h.green,a[d+2]=h.blue,a[d+3]=h.alpha}}e.putImageData(n,0,0)}drawCircle(e,t,i,s){this.ctx.lineWidth=3;let n=[];this.ctx.beginPath(),this.ctx.arc(t*this.width,e*this.height,Z4BiGradientColorPanel.SELECTOR_RADIUS,0,2*Math.PI),this.ctx.strokeStyle=Z4Constants.getStyle(i===this.biSelectedIndex&&s===this.selectedIndex?"red":"black"),this.ctx.setLineDash(n),this.ctx.stroke(),n.push(2.5,2.5),this.ctx.beginPath(),this.ctx.arc(t*this.width,e*this.height,Z4BiGradientColorPanel.SELECTOR_RADIUS,0,2*Math.PI),this.ctx.strokeStyle=Z4Constants.getStyle("white"),this.ctx.setLineDash(n),this.ctx.stroke()}setSpaceTimeLabelsVisible(e){this.space.getStyle().visibility=e?"visible":"hidden",this.time.getStyle().visibility=e?"visible":"hidden"}setSize(e,t){let i=e/t;this.width=parseInt(i>1?Z4BiGradientColorPanel.SIZE:Z4BiGradientColorPanel.SIZE*i),this.height=parseInt(i>1?Z4BiGradientColorPanel.SIZE/i:Z4BiGradientColorPanel.SIZE),this.preview.setProperty("width",""+this.width),this.preview.setProperty("height",""+this.height),this.drawPreview(!1)}getValueIsAdjusting(){return this.valueIsAdjusting}getValue(){return Z4BiGradientColor.fromJSON(this.value.toJSON())}setValue(e){this.value=Z4BiGradientColor.fromJSON(e.toJSON()),this.colorPanel.setValue(this.value.getColorAtIndex(this.biSelectedIndex).getColorAtIndex(this.selectedIndex)),this.drawPreview(!1)}}class Z4ColorPanel extends Z4AbstractValuePanel{label=new JSLabel;colorPreview=new JSColorPreview;edit=new JSButton;opacityVisible=!0;constructor(){super(),this.cssAddClass("z4colorpanel"),this.setLayout(new GridBagLayout),this.add(this.label,new GBC(0,0).w(2).a(GBC.WEST)),this.add(this.colorPreview,new GBC(0,1).wx(1).f(GBC.HORIZONTAL)),this.edit.setText(Z4Translations.EDIT),this.edit.addActionListener(e=>{JSColorChooser.showDialog(Z4Translations.COLOR,this.value,this.opacityVisible,null,e=>{this.setValue(e),this.onchange()})}),this.add(this.edit,new GBC(1,1).i(0,5,0,0)),this.setValue(new Color(0,0,0,255))}setLabel(e){this.label.setText(e)}setValue(e){this.value=e,this.colorPreview.setColor(e);let t=[],i=[];t[0]=e.red,t[1]=e.green,t[2]=e.blue,Color.RGBtoHSL(t,i)}setEnabled(e){super.setEnabled(e),this.edit.setEnabled(e)}setEditButtonVisible(e){this.edit.getStyle().display=e?"flex":"none"}setEditButtonContentAreaFilled(e){this.edit.setContentAreaFilled(e)}setOpacityVisible(e){this.opacityVisible=e}}class Z4ColorProgressionPanel extends Z4AbstractValuePanel{lightingPanel=new Z4LightingPanel(Z4LightingPanelOrientation.HORIZONTAL);radios=[];temporalStepSlider=new JSSlider;temporalStepSpinner=new JSSpinner;resetOnStartMoving=new JSToggleButton;enabled=!0;valueIsAdjusting=!1;constructor(e){super(),this.cssAddClass("z4colorprogressionpanel"),this.setLayout(new GridBagLayout);let t=new JSPanel,i=new ButtonGroup;e===Z4ColorProgressionPanelOrientation.HORIZONTALLY_COMPACT?(Z4UI.addLabel(this,Z4Translations.FILLING,new GBC(0,0).w(2).a(GBC.WEST)),t.setLayout(new BoxLayout(t,BoxLayout.X_AXIS)),this.add(t,new GBC(2,0).a(GBC.EAST)),this.addRadio(Z4ColorProgressionBehavior.SPATIAL,t,i,"left"),this.addRadio(Z4ColorProgressionBehavior.TEMPORAL,t,i,"centerh"),this.addRadio(Z4ColorProgressionBehavior.RELATIVE_TO_PATH,t,i,"centerh"),this.addRadio(Z4ColorProgressionBehavior.RANDOM,t,i,"right"),Z4UI.addLabel(this,Z4Translations.STEP,new GBC(0,1).w(2).a(GBC.WEST)),this.add(this.temporalStepSpinner,new GBC(2,1).a(GBC.EAST).i(1,0,0,0)),this.add(this.temporalStepSlider,new GBC(0,2).w(3)),this.add(this.resetOnStartMoving,new GBC(0,3).a(GBC.WEST).wx(1)),Z4UI.addLabel(this,Z4Translations.LIGHTING,new GBC(1,3).a(GBC.EAST).i(0,0,0,2)),this.add(this.lightingPanel,new GBC(2,3).a(GBC.EAST))):e===Z4ColorProgressionPanelOrientation.VERTICALLY_COMPACT&&(Z4UI.addLabel(this,Z4Translations.FILLING,new GBC(0,0).w(4).a(GBC.WEST)),t.setLayout(new BoxLayout(t,BoxLayout.Y_AXIS)),this.add(t,new GBC(0,1).h(3).i(0,0,0,1)),this.addRadio(Z4ColorProgressionBehavior.SPATIAL,t,i,"top"),this.addRadio(Z4ColorProgressionBehavior.TEMPORAL,t,i,"centerv"),this.addRadio(Z4ColorProgressionBehavior.RELATIVE_TO_PATH,t,i,"centerv"),this.addRadio(Z4ColorProgressionBehavior.RANDOM,t,i,"bottom"),Z4UI.addLabel(this,Z4Translations.STEP,new GBC(1,1).w(2).a(GBC.WEST)),this.add(this.temporalStepSpinner,new GBC(3,1).a(GBC.EAST)),this.add(this.temporalStepSlider,new GBC(1,2).w(3)),this.add(this.resetOnStartMoving,new GBC(1,3).a(GBC.WEST).wx(1)),Z4UI.addLabel(this,Z4Translations.LIGHTING,new GBC(2,3).a(GBC.EAST).i(0,0,0,2)),this.add(this.lightingPanel,new GBC(3,3).a(GBC.EAST))),this.temporalStepSpinner.setModel(new SpinnerNumberModel(1,1,100,1)),this.temporalStepSpinner.cssAddClass("jsspinner_w_4rem"),this.temporalStepSpinner.addChangeListener(e=>this.onTemporalStepChange(!0,this.temporalStepSpinner.getValueIsAdjusting(),this.temporalStepSpinner,this.temporalStepSlider)),this.temporalStepSlider.setMinimum(1),this.temporalStepSlider.setMaximum(100),this.temporalStepSlider.setValue(1),this.temporalStepSlider.getStyle().minWidth="20rem",this.temporalStepSlider.addChangeListener(e=>this.onTemporalStepChange(!1,this.temporalStepSlider.getValueIsAdjusting(),this.temporalStepSpinner,this.temporalStepSlider)),this.resetOnStartMoving.setContentAreaFilled(!1),this.resetOnStartMoving.cssAddClass("z4colorprogressionpanel-toggle"),this.resetOnStartMoving.getStyle().padding="1px",this.resetOnStartMoving.setTooltip(Z4Translations.RESET_ON_START_MOVING),this.resetOnStartMoving.setIcon(new Z4EmptyImageProducer("")),this.resetOnStartMoving.addActionListener(e=>{this.valueIsAdjusting=!1,this.onProgressionChange()}),this.lightingPanel.addChangeListener(e=>{this.valueIsAdjusting=!1,this.onProgressionChange()}),this.setValue(new Z4ColorProgression(Z4ColorProgressionBehavior.SPATIAL,.1,!1,Z4Lighting.NONE)),this.setProgressionSettings(Z4PointIteratorType.STAMPER,null,!0,!1,!1)}addRadio(e,t,i,s){let n=new JSRadioButton;switch(n.cssAddClass("z4colorprogressionpanel-radio"),n.getStyle().padding="1px",n.setTooltip(Z4Translations[""+e]),n.setToggle(),n.setIcon(new Z4EmptyImageProducer(e)),n.addActionListener(t=>{Object.keys(this.radios).forEach(e=>this.radios[e].setContentAreaFilled(!1)),n.setContentAreaFilled(!0),this.temporalStepSpinner.setEnabled(e===Z4ColorProgressionBehavior.TEMPORAL),this.temporalStepSlider.setEnabled(e===Z4ColorProgressionBehavior.TEMPORAL),this.valueIsAdjusting=!1,this.onProgressionChange()}),s){case"left":n.getStyle().borderTopRightRadius="0px",n.getStyle().borderBottomRightRadius="0px",n.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"centerh":n.getStyle().borderRadius="0px",n.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",n.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"right":n.getStyle().borderTopLeftRadius="0px",n.getStyle().borderBottomLeftRadius="0px",n.getStyle().borderLeft="1px solid var(--main-action-bgcolor)";break;case"top":n.getStyle().borderBottomLeftRadius="0px",n.getStyle().borderBottomRightRadius="0px",n.getStyle().borderBottom="1px solid var(--main-action-bgcolor)";break;case"centerv":n.getStyle().borderRadius="0px",n.getStyle().borderTop="1px solid var(--main-action-bgcolor)",n.getStyle().borderBottom="1px solid var(--main-action-bgcolor)";break;case"bottom":n.getStyle().borderTopLeftRadius="0px",n.getStyle().borderTopRightRadius="0px",n.getStyle().borderTop="1px solid var(--main-action-bgcolor)"}i.add(n),this.radios[""+e]=n,t.add(n,null)}onTemporalStepChange(e,t,i,s){e?s.setValue(i.getValue()):i.setValue(s.getValue()),this.valueIsAdjusting=t,this.onProgressionChange()}onProgressionChange(){this.resetOnStartMoving.setContentAreaFilled(this.resetOnStartMoving.isSelected()),Object.keys(this.radios).forEach(e=>{if(this.radios[e].isSelected())switch(""+e){case"SPATIAL":this.value=new Z4ColorProgression(Z4ColorProgressionBehavior.SPATIAL,this.temporalStepSlider.getValue()/100,this.resetOnStartMoving.isSelected(),this.lightingPanel.getValue());break;case"TEMPORAL":this.value=new Z4ColorProgression(Z4ColorProgressionBehavior.TEMPORAL,this.temporalStepSlider.getValue()/100,this.resetOnStartMoving.isSelected(),this.lightingPanel.getValue());break;case"RELATIVE_TO_PATH":this.value=new Z4ColorProgression(Z4ColorProgressionBehavior.RELATIVE_TO_PATH,this.temporalStepSlider.getValue()/100,this.resetOnStartMoving.isSelected(),this.lightingPanel.getValue());break;case"RANDOM":this.value=new Z4ColorProgression(Z4ColorProgressionBehavior.RANDOM,this.temporalStepSlider.getValue()/100,this.resetOnStartMoving.isSelected(),this.lightingPanel.getValue())}}),this.onchange()}getValueIsAdjusting(){return this.valueIsAdjusting}setProgressionSettings(e,t,i,s,n){if(e===Z4PointIteratorType.AIRBRUSH?Object.keys(this.radios).forEach(e=>this.radios[e].cssAddClass("z4colorprogressionpanel-airbrush-radio")):Object.keys(this.radios).forEach(e=>this.radios[e].cssRemoveClass("z4colorprogressionpanel-airbrush-radio")),i){Object.keys(this.radios).forEach(e=>{let t=this.radios[e];t.setContentAreaFilled(!1),t.getStyle().visibility="hidden"});let a=this.radios[""+Z4ColorProgressionBehavior.SPATIAL];a.setContentAreaFilled(!0),a.isSelected()||(a.setSelected(!0),this.onProgressionChange())}else if(s){if(Object.keys(this.radios).forEach(e=>{let t=this.radios[e];t.setEnabled(this.enabled),t.getStyle().visibility="visible"}),e===Z4PointIteratorType.STAMPER||e===Z4PointIteratorType.SPIROGRAPH&&!t.drawWhileMoving||e===Z4PointIteratorType.SCATTERER){let r=this.radios[""+Z4ColorProgressionBehavior.RELATIVE_TO_PATH];r.setEnabled(!1),r.setContentAreaFilled(!1),r.isSelected()&&(this.radios[""+Z4ColorProgressionBehavior.SPATIAL].setSelected(!0),this.radios[""+Z4ColorProgressionBehavior.SPATIAL].setContentAreaFilled(!0),this.onProgressionChange())}}else if(n){Object.keys(this.radios).forEach(e=>{let t=this.radios[e];t.setEnabled(this.enabled),t.getStyle().visibility="visible"});let o=this.radios[""+Z4ColorProgressionBehavior.SPATIAL];o.setEnabled(!1),o.setContentAreaFilled(!1);let l=this.radios[""+Z4ColorProgressionBehavior.RELATIVE_TO_PATH];(e===Z4PointIteratorType.STAMPER||e===Z4PointIteratorType.SPIROGRAPH&&t.drawWhileMoving||e===Z4PointIteratorType.SCATTERER)&&(l.setEnabled(!1),l.setContentAreaFilled(!1)),(o.isSelected()||e===Z4PointIteratorType.STAMPER&&l.isSelected()||e===Z4PointIteratorType.SPIROGRAPH&&!t.drawWhileMoving&&l.isSelected()||e===Z4PointIteratorType.SCATTERER&&l.isSelected())&&(this.radios[""+Z4ColorProgressionBehavior.TEMPORAL].setSelected(!0),this.radios[""+Z4ColorProgressionBehavior.TEMPORAL].setContentAreaFilled(!0),this.temporalStepSpinner.setEnabled(this.enabled),this.temporalStepSlider.setEnabled(this.enabled),this.onProgressionChange())}}setValue(e){this.value=e,this.lightingPanel.setValue(e.getLighting()),Object.keys(this.radios).forEach(e=>this.radios[e].setContentAreaFilled(!1)),this.radios[""+e.getColorProgressionBehavior()].setSelected(!0),this.radios[""+e.getColorProgressionBehavior()].setContentAreaFilled(!0),this.temporalStepSpinner.setValue(100*e.getTemporalStepProgression()),this.temporalStepSpinner.setEnabled(e.getColorProgressionBehavior()===Z4ColorProgressionBehavior.TEMPORAL),this.temporalStepSlider.setValue(parseInt(100*e.getTemporalStepProgression())),this.temporalStepSlider.setEnabled(e.getColorProgressionBehavior()===Z4ColorProgressionBehavior.TEMPORAL),this.resetOnStartMoving.setSelected(e.isResetOnStartMoving()),this.resetOnStartMoving.setContentAreaFilled(e.isResetOnStartMoving())}setEnabled(e){super.setEnabled(e),this.enabled=e,this.resetOnStartMoving.setEnabled(e),this.lightingPanel.setEnabled(e),Object.keys(this.radios).forEach(t=>{let i=this.radios[t];i.setEnabled(e),i.isSelected()&&(this.temporalStepSpinner.setEnabled(e&&""+t!=""+Z4ColorProgressionBehavior.TEMPORAL),this.temporalStepSlider.setEnabled(e&&""+t!=""+Z4ColorProgressionBehavior.TEMPORAL))})}}class Z4GradientColorPanel extends Z4AbstractValuePanel{preview=new JSComponent(document.createElement("canvas"));ctx=this.preview.invoke("getContext('2d')");rippleSpinner=new JSSpinner;rippleSlider=new JSSlider;colorPanel=new Z4ColorPanel;delete=new JSButton;selectedIndex=0;pressed=!1;valueIsAdjusting=!1;static SELECTOR_RADIUS=7;static WIDTH=200;static HEIGHT=50;static TOLERANCE=.1;constructor(){super(),this.cssAddClass("z4gradientcolorpanel"),this.setLayout(new GridBagLayout),this.preview.setProperty("width",""+Z4GradientColorPanel.WIDTH),this.preview.setProperty("height",""+Z4GradientColorPanel.HEIGHT),this.preview.addEventListener("mouseenter",e=>this.onMouse(e,"enter")),this.preview.addEventListener("mouseleave",e=>this.onMouse(e,"leave")),this.preview.addEventListener("mousedown",e=>this.onMouse(e,"down")),this.preview.addEventListener("mousemove",e=>this.onMouse(e,"move")),this.preview.addEventListener("mouseup",e=>this.onMouse(e,"up")),this.add(this.preview,new GBC(0,0).w(3).i(0,0,5,0)),this.colorPanel.addChangeListener(e=>{this.value.addColor(this.colorPanel.getValue(),this.value.getColorPositionAtIndex(this.selectedIndex)),this.drawPreview(!1),this.onchange()}),this.add(this.colorPanel,new GBC(0,1).w(2).wx(1).f(GBC.HORIZONTAL)),this.delete.setText(Z4Translations.DELETE),this.delete.setEnabled(!1),this.delete.addActionListener(e=>JSOptionPane.showConfirmDialog(Z4Translations.DELETE_COLOR_MESSAGE,Z4Translations.DELETE,JSOptionPane.YES_NO_OPTION,JSOptionPane.QUESTION_MESSAGE,e=>{e===JSOptionPane.YES_OPTION&&(this.value.removeColor(this.value.getColorPositionAtIndex(this.selectedIndex)),this.selectedIndex=0,this.afterOperation(),this.onchange())})),this.add(this.delete,new GBC(2,1).a(GBC.WEST).i(0,5,0,0)),Z4UI.addLabel(this,Z4Translations.RIPPLE,new GBC(0,2).a(GBC.WEST)),this.rippleSpinner.cssAddClass("jsspinner_w_4rem"),this.rippleSpinner.setModel(new SpinnerNumberModel(0,0,100,1)),this.rippleSpinner.addChangeListener(e=>this.onRippleChange(!0,this.rippleSpinner.getValueIsAdjusting())),this.add(this.rippleSpinner,new GBC(1,2).w(2).a(GBC.EAST).i(5,0,0,0)),this.rippleSlider.setValue(0),this.rippleSlider.getStyle().minWidth="20rem",this.rippleSlider.addChangeListener(e=>this.onRippleChange(!1,this.rippleSlider.getValueIsAdjusting())),this.add(this.rippleSlider,new GBC(0,3).w(3).a(GBC.NORTH).f(GBC.HORIZONTAL));let e=new JSPanel;this.add(e,new GBC(0,4).w(2).a(GBC.NORTH).f(GBC.HORIZONTAL));let t=new JSButton;t.setText(Z4Translations.MIRRORED),t.addActionListener(e=>{this.value.mirror(),this.afterOperation(),this.onchange()}),e.add(t,null),(t=new JSButton).setText(Z4Translations.INVERTED),t.addActionListener(e=>{this.value.reverse(),this.drawPreview(!1),this.onchange()}),e.add(t,null),(t=new JSButton).cssAddClass("z4gradientcolorpanel-history"),t.setIcon(new Z4EmptyImageProducer("")),t.setTooltip(Z4Translations.HISTORY),t.addActionListener(e=>this.showHistory()),this.add(t,new GBC(2,4).a(GBC.EAST)),this.setValue(new Z4GradientColor)}onMouse(e,t){switch(t){case"enter":break;case"down":for(let i=0;i<this.value.getColorCount();i++){let s=this.value.getColorPositionAtIndex(i);Z4Math.distance(s*Z4GradientColorPanel.WIDTH,Z4GradientColorPanel.HEIGHT/2,e.offsetX,e.offsetY)<=Z4GradientColorPanel.SELECTOR_RADIUS&&(this.pressed=!0,this.selectedIndex=i,this.afterOperation())}if(!this.pressed&&!this.value.isPositionOccupied(e.offsetX/Z4GradientColorPanel.WIDTH,Z4GradientColorPanel.TOLERANCE)&&Math.abs(Z4GradientColorPanel.HEIGHT/2-e.offsetY)<=Z4GradientColorPanel.SELECTOR_RADIUS){this.value.addColor(this.value.getColorAt(e.offsetX/Z4GradientColorPanel.WIDTH,!1),e.offsetX/Z4GradientColorPanel.WIDTH),this.pressed=!0;for(let n=0;n<this.value.getColorCount();n++){let a=this.value.getColorPositionAtIndex(n);Z4Math.distance(a*Z4GradientColorPanel.WIDTH,Z4GradientColorPanel.HEIGHT/2,e.offsetX,e.offsetY)<=Z4GradientColorPanel.SELECTOR_RADIUS&&(this.selectedIndex=n,this.afterOperation(),this.onchange())}this.preview.getStyle().cursor="pointer"}break;case"move":if(this.pressed){let r=this.value.getColorPositionAtIndex(this.selectedIndex),o=this.value.getColorPositionAtIndex(this.selectedIndex-1),l=this.value.getColorPositionAtIndex(this.selectedIndex+1),h=e.offsetX/Z4GradientColorPanel.WIDTH;if(0!==this.selectedIndex&&this.selectedIndex!==this.value.getColorCount()-1&&o<h-Z4GradientColorPanel.TOLERANCE&&l>h+Z4GradientColorPanel.TOLERANCE){let d=this.value.getColorAtIndex(this.selectedIndex);this.value.removeColor(r),this.value.addColor(d,h),this.drawPreview(!0),this.valueIsAdjusting=!0,this.onchange()}}else{this.preview.getStyle().cursor="default";for(let c=0;c<this.value.getColorCount();c++){let g=this.value.getColorPositionAtIndex(c);Z4Math.distance(g*Z4GradientColorPanel.WIDTH,Z4GradientColorPanel.HEIGHT/2,e.offsetX,e.offsetY)<=Z4GradientColorPanel.SELECTOR_RADIUS&&(this.preview.getStyle().cursor="pointer")}"default"===this.preview.getStyle().cursor&&!this.value.isPositionOccupied(e.offsetX/Z4GradientColorPanel.WIDTH,Z4GradientColorPanel.TOLERANCE)&&Math.abs(Z4GradientColorPanel.HEIGHT/2-e.offsetY)<=Z4GradientColorPanel.SELECTOR_RADIUS&&(this.preview.getStyle().cursor="copy")}break;case"up":this.pressed=!1,this.drawPreview(!1),this.valueIsAdjusting=!1,this.onchange();break;case"leave":this.pressed&&(this.pressed=!1,this.drawPreview(!1),this.valueIsAdjusting=!1,this.onchange())}}onRippleChange(e,t){e?this.rippleSlider.setValue(this.rippleSpinner.getValue()):this.rippleSpinner.setValue(this.rippleSlider.getValue()),this.value.setRipple(this.rippleSlider.getValue()/100),this.drawPreview(t),this.valueIsAdjusting=t,this.onchange()}afterOperation(){this.colorPanel.setValue(this.value.getColorAtIndex(this.selectedIndex)),this.delete.setEnabled(0!==this.selectedIndex&&this.selectedIndex!==this.value.getColorCount()-1),this.drawPreview(!1)}showHistory(){let e=new JSPanel;e.cssAddClass("z4gradientcolorpanel-scrollpanel"),e.getStyle().height=(Z4GradientColorPanel.HEIGHT+6)*8+5+"px";let t=new JSPanel;t.setLayout(new GridBagLayout),t.cssAddClass("z4gradientcolorpanel-historypanel"),e.add(t,null);let i=[],s=[],n=new ButtonGroup;Z4GradientColor.getHistory().forEach((e,a,r)=>{let o=new JSRadioButton;n.add(o),i.push(o);let l=new JSComponent(document.createElement("canvas"));l.setProperty("width",""+Z4GradientColorPanel.WIDTH),l.setProperty("height",""+Z4GradientColorPanel.HEIGHT),l.getStyle().height=Z4GradientColorPanel.HEIGHT+"px",s.push(l),this.putImageData(l.invoke("getContext('2d')"),e),t.add(o,new GBC(a%2*2,parseInt(a/2))),t.add(l,new GBC(a%2*2+1,parseInt(a/2)).i(2,0,2,20).wx(1).f(GBC.HORIZONTAL))}),JSOptionPane.showInputDialog(e,Z4Translations.HISTORY,e=>{i.forEach(t=>t.addActionListener(t=>e(new ChangeEvent))),s.forEach((t,s,n)=>t.addEventListener("mousedown",t=>{i[s].setSelected(!0),e(new ChangeEvent)})),s.forEach((t,s,n)=>t.addEventListener("dblclick",t=>{i[s].setSelected(!0),e(new ChangeEvent),document.querySelector(".z4gradientcolorpanel-historypanel").closest(".jsdialog").querySelector(".jsoptionpane-option-0").click()}))},()=>i.some((e,t,i)=>e.isSelected()),e=>{e===JSOptionPane.OK_OPTION&&this.setValue(Z4GradientColor.getHistory()[i.findIndex(e=>e.isSelected())])})}drawPreview(e){this.putImageData(this.ctx,this.value);for(let t=0;t<this.value.getColorCount();t++)this.drawCircle(this.value.getColorPositionAtIndex(t),t)}putImageData(e,t){let i=e.createImageData(Z4GradientColorPanel.WIDTH,Z4GradientColorPanel.HEIGHT),s=i.data;for(let n=0;n<Z4GradientColorPanel.WIDTH;n++){let a=t.getColorAt(n/Z4GradientColorPanel.WIDTH,!0);for(let r=0;r<Z4GradientColorPanel.HEIGHT;r++){let o=(r*Z4GradientColorPanel.WIDTH+n)*4;s[o]=a.red,s[o+1]=a.green,s[o+2]=a.blue,s[o+3]=a.alpha}}e.putImageData(i,0,0)}drawCircle(e,t){this.ctx.lineWidth=3;let i=[];this.ctx.beginPath(),this.ctx.arc(e*Z4GradientColorPanel.WIDTH,Z4GradientColorPanel.HEIGHT/2,Z4GradientColorPanel.SELECTOR_RADIUS,0,2*Math.PI),this.ctx.strokeStyle=Z4Constants.getStyle(t===this.selectedIndex?"red":"black"),this.ctx.setLineDash(i),this.ctx.stroke(),i.push(2.5,2.5),this.ctx.beginPath(),this.ctx.arc(e*Z4GradientColorPanel.WIDTH,Z4GradientColorPanel.HEIGHT/2,Z4GradientColorPanel.SELECTOR_RADIUS,0,2*Math.PI),this.ctx.strokeStyle=Z4Constants.getStyle("white"),this.ctx.setLineDash(i),this.ctx.stroke()}getValueIsAdjusting(){return this.valueIsAdjusting}getValue(){return Z4GradientColor.fromJSON(this.value.toJSON())}setValue(e){this.value=Z4GradientColor.fromJSON(e.toJSON()),this.colorPanel.setValue(this.value.getColorAtIndex(this.selectedIndex)),this.drawPreview(!1)}}class Z4LightingPanel extends Z4AbstractValuePanel{radios=[];constructor(e){super(),this.cssAddClass("z4lightingpanel"),this.setLayout(new GridBagLayout);let t=new ButtonGroup;e===Z4LightingPanelOrientation.HORIZONTAL?(this.addRadio(Z4Lighting.NONE,t,0,0,"left"),this.addRadio(Z4Lighting.LIGHTED_IN_OUT,t,1,0,"centerh"),this.addRadio(Z4Lighting.LIGHTED_OUT_IN,t,2,0,"centerh"),this.addRadio(Z4Lighting.DARKENED_IN_OUT,t,3,0,"centerh"),this.addRadio(Z4Lighting.DARKENED_OUT_IN,t,4,0,"right")):e===Z4LightingPanelOrientation.VERTICAL&&(this.addRadio(Z4Lighting.NONE,t,0,0,"top"),this.addRadio(Z4Lighting.LIGHTED_IN_OUT,t,0,1,"centerv"),this.addRadio(Z4Lighting.LIGHTED_OUT_IN,t,0,2,"centerv"),this.addRadio(Z4Lighting.DARKENED_IN_OUT,t,0,3,"centerv"),this.addRadio(Z4Lighting.DARKENED_OUT_IN,t,0,4,"bottom")),this.setValue(Z4Lighting.NONE)}addRadio(e,t,i,s,n){let a=new JSRadioButton;switch(a.cssAddClass("z4lightingpanel-radio"),a.getStyle().padding="1px",a.setTooltip(Z4Translations[(""+e).replace("NONE","NONE_HER").replace("_IN_OUT","").replace("_OUT_IN","")]),a.setToggle(),a.setIcon(new Z4EmptyImageProducer(e)),a.addActionListener(t=>{Object.keys(this.radios).forEach(e=>this.radios[e].setContentAreaFilled(!1)),a.setContentAreaFilled(!0),this.value=e,this.onchange()}),n){case"left":a.getStyle().borderTopRightRadius="0px",a.getStyle().borderBottomRightRadius="0px",a.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"centerh":a.getStyle().borderRadius="0px",a.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",a.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"right":a.getStyle().borderTopLeftRadius="0px",a.getStyle().borderBottomLeftRadius="0px",a.getStyle().borderLeft="1px solid var(--main-action-bgcolor)";break;case"top":a.getStyle().borderBottomLeftRadius="0px",a.getStyle().borderBottomRightRadius="0px",a.getStyle().borderBottom="1px solid var(--main-action-bgcolor)";break;case"centerv":a.getStyle().borderRadius="0px",a.getStyle().borderTop="1px solid var(--main-action-bgcolor)",a.getStyle().borderBottom="1px solid var(--main-action-bgcolor)";break;case"bottom":a.getStyle().borderTopLeftRadius="0px",a.getStyle().borderTopRightRadius="0px",a.getStyle().borderTop="1px solid var(--main-action-bgcolor)"}t.add(a),this.radios[""+e]=a,this.add(a,new GBC(i,s))}setValue(e){this.value=e,Object.keys(this.radios).forEach(e=>this.radios[e].setContentAreaFilled(!1)),this.radios[""+e].setSelected(!0),this.radios[""+e].setContentAreaFilled(!0)}setEnabled(e){Object.keys(this.radios).forEach(t=>this.radios[t].setEnabled(e))}}class Z4PointIteratorPanel extends Z4AbstractValuePanel{rotation=new Z4RotationPanel(Z4RotationPanelOrientation.HORIZONTAL);valueIsAdjusting=!1;enabled=!0;constructor(){super(),this.cssAddClass("z4pointiteratorpanel"),this.setLayout(new GridBagLayout),this.rotation.setLabel(Z4Translations.ROTATION),this.rotation.cssAddClass("z4abstractvaluepanel-titled"),this.rotation.addChangeListener(e=>this.onIteratorChange(this.rotation.getValueIsAdjusting()))}onIteratorChange(e){}getValueIsAdjusting(){return this.valueIsAdjusting}setValue(e){this.value=e,this.rotation.setValue(e.getRotation())}setEnabled(e){super.setEnabled(e),this.enabled=e,this.rotation.setEnabled(e)}}class Z4AirbrushPanel extends Z4PointIteratorPanel{multiplicity=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.VERTICAL);radiusSpinner=new JSSpinner;radiusSlider=new JSSlider;speed=new JSSlider;speedLabel=new JSLabel;gaussianCorrectionSpinner=new JSSpinner;gaussianCorrectionSlider=new JSSlider;constructor(){super(),this.cssAddClass("z4airbrushpanel"),this.multiplicity.setSignsVisible(!1),this.multiplicity.setConstantRange(1,50),this.multiplicity.setLabel(Z4Translations.MULTIPLICITY),this.multiplicity.cssAddClass("z4abstractvaluepanel-titled"),this.multiplicity.addChangeListener(e=>this.onIteratorChange(this.multiplicity.getValueIsAdjusting())),this.add(this.multiplicity,new GBC(0,0).h(6).i(0,0,0,1)),Z4UI.addLabel(this,Z4Translations.RADIUS,new GBC(1,0).a(GBC.WEST)),this.radiusSpinner.cssAddClass("jsspinner_w_4rem"),this.radiusSpinner.setModel(new SpinnerNumberModel(100,1,500,1)),this.radiusSpinner.addChangeListener(e=>{this.radiusSlider.setValue(this.radiusSpinner.getValue()),this.onIteratorChange(this.radiusSpinner.getValueIsAdjusting())}),this.add(this.radiusSpinner,new GBC(2,0).a(GBC.EAST)),this.radiusSlider.setMinimum(1),this.radiusSlider.setMaximum(500),this.radiusSlider.getStyle().minWidth="18rem",this.radiusSlider.addChangeListener(e=>{this.radiusSpinner.setValue(this.radiusSlider.getValue()),this.onIteratorChange(this.radiusSlider.getValueIsAdjusting())}),this.add(this.radiusSlider,new GBC(1,1).w(2).f(GBC.HORIZONTAL)),Z4UI.addLabel(this,Z4Translations.GAUSSIAN_CORRECTION,new GBC(1,2).a(GBC.WEST)),this.gaussianCorrectionSpinner.cssAddClass("jsspinner_w_4rem"),this.gaussianCorrectionSpinner.setModel(new SpinnerNumberModel(10,1,100,1)),this.gaussianCorrectionSpinner.addChangeListener(e=>{this.gaussianCorrectionSlider.setValue(this.gaussianCorrectionSpinner.getValue()),this.onIteratorChange(this.gaussianCorrectionSpinner.getValueIsAdjusting())}),this.add(this.gaussianCorrectionSpinner,new GBC(2,2).a(GBC.EAST)),this.gaussianCorrectionSlider.setMinimum(1),this.gaussianCorrectionSlider.setMaximum(100),this.gaussianCorrectionSlider.addChangeListener(e=>{this.gaussianCorrectionSpinner.setValue(this.gaussianCorrectionSlider.getValue()),this.onIteratorChange(this.gaussianCorrectionSlider.getValueIsAdjusting())}),this.add(this.gaussianCorrectionSlider,new GBC(1,3).w(2).f(GBC.HORIZONTAL)),Z4UI.addLabel(this,Z4Translations.SPEED,new GBC(1,4).wx(1).a(GBC.WEST)),this.add(this.speedLabel,new GBC(2,4)),this.speed.setMinimum(1),this.speed.setMaximum(10),this.speed.addChangeListener(e=>this.onIteratorChange(this.speed.getValueIsAdjusting())),this.add(this.speed,new GBC(1,5).w(2).f(GBC.HORIZONTAL).wy(1).a(GBC.NORTH)),this.add(this.rotation,new GBC(3,0).h(6).a(GBC.NORTH).i(1,1,0,0)),this.setValue(new Z4Airbrush(new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),10),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),100,5,10,new Z4Rotation(0,new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),Z4RotationBehavior.FIXED,!1)))}onIteratorChange(e){this.valueIsAdjusting=e,this.speedLabel.setText(""+this.speed.getValue()),this.value=new Z4Airbrush(this.multiplicity.getValue(),this.radiusSlider.getValue(),this.speed.getValue(),this.gaussianCorrectionSlider.getValue(),this.rotation.getValue()),this.onchange()}setValue(e){super.setValue(e),this.multiplicity.setValue(e.getMultiplicity()),this.radiusSpinner.setValue(e.getRadius()),this.radiusSlider.setValue(e.getRadius()),this.speed.setValue(e.getSpeed()),this.speedLabel.setText(""+e.getSpeed()),this.gaussianCorrectionSpinner.setValue(e.getGaussianCorrection()),this.gaussianCorrectionSlider.setValue(e.getGaussianCorrection())}setEnabled(e){super.setEnabled(e),this.multiplicity.setEnabled(e),this.radiusSpinner.setEnabled(e),this.radiusSlider.setEnabled(e),this.speed.setEnabled(e),this.gaussianCorrectionSpinner.setEnabled(e),this.gaussianCorrectionSlider.setEnabled(e)}}class Z4ScattererPanel extends Z4PointIteratorPanel{multiplicity=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.HORIZONTAL);scattering=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.HORIZONTAL);constructor(){super(),this.cssAddClass("z4scattererpanel"),this.multiplicity.setSignsVisible(!1),this.multiplicity.setConstantRange(1,50),this.multiplicity.setLabel(Z4Translations.MULTIPLICITY),this.multiplicity.cssAddClass("z4abstractvaluepanel-titled"),this.multiplicity.addChangeListener(e=>this.onIteratorChange(this.multiplicity.getValueIsAdjusting())),this.add(this.multiplicity,new GBC(0,0)),this.scattering.setSignsVisible(!1),this.scattering.setLabel(Z4Translations.SCATTERING),this.scattering.cssAddClass("z4abstractvaluepanel-titled"),this.scattering.addChangeListener(e=>this.onIteratorChange(this.scattering.getValueIsAdjusting())),this.add(this.scattering,new GBC(0,1).i(1,0,0,0)),this.add(this.rotation,new GBC(1,0).h(2).a(GBC.NORTH).i(0,1,0,0)),this.setValue(new Z4Scatterer(new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),10),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),10),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4Rotation(0,new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),Z4RotationBehavior.FIXED,!1)))}onIteratorChange(e){this.valueIsAdjusting=e,this.value=new Z4Scatterer(this.multiplicity.getValue(),this.scattering.getValue(),this.rotation.getValue()),this.onchange()}setValue(e){super.setValue(e),this.multiplicity.setValue(e.getMultiplicity()),this.scattering.setValue(e.getScattering())}setEnabled(e){super.setEnabled(e),this.multiplicity.setEnabled(e),this.scattering.setEnabled(e)}}class Z4SpirographPanel extends Z4PointIteratorPanel{drawWhileMoving=new JSCheckBox;constructor(){super(),this.cssAddClass("z4spirographpanel"),this.drawWhileMoving.setText(Z4Translations.DRAW_WHILE_MOVING),this.drawWhileMoving.addActionListener(e=>this.onIteratorChange(!1)),this.add(this.drawWhileMoving,new GBC(0,0).a(GBC.WEST)),this.add(this.rotation,new GBC(0,1)),this.setValue(new Z4Spirograph(!0,new Z4Rotation(0,new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),Z4RotationBehavior.FIXED,!1)))}onIteratorChange(e){this.valueIsAdjusting=e,this.value=new Z4Spirograph(this.drawWhileMoving.isSelected(),this.rotation.getValue()),this.onchange()}setValue(e){super.setValue(e),this.drawWhileMoving.setSelected(e.isDrawWhileMoving())}setEnabled(e){super.setEnabled(e),this.drawWhileMoving.setEnabled(e)}}class Z4StamperPanel extends Z4PointIteratorPanel{multiplicity=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.HORIZONTAL);push=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.HORIZONTAL);constructor(){super(),this.cssAddClass("z4stamperpanel"),this.multiplicity.setSignsVisible(!1),this.multiplicity.setConstantRange(1,50),this.multiplicity.setLabel(Z4Translations.MULTIPLICITY),this.multiplicity.cssAddClass("z4abstractvaluepanel-titled"),this.multiplicity.addChangeListener(e=>this.onIteratorChange(this.multiplicity.getValueIsAdjusting())),this.add(this.multiplicity,new GBC(0,0)),this.push.setSignsVisible(!1),this.push.setLabel(Z4Translations.PUSH),this.push.cssAddClass("z4abstractvaluepanel-titled"),this.push.addChangeListener(e=>this.onIteratorChange(this.push.getValueIsAdjusting())),this.add(this.push,new GBC(0,1).i(1,0,0,0)),this.add(this.rotation,new GBC(1,0).h(2).a(GBC.NORTH).i(0,1,0,0)),this.setValue(new Z4Stamper(new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),1),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4Rotation(0,new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),Z4RotationBehavior.FIXED,!1)))}onIteratorChange(e){this.valueIsAdjusting=e,this.value=new Z4Stamper(this.multiplicity.getValue(),this.push.getValue(),this.rotation.getValue()),this.onchange()}setValue(e){super.setValue(e),this.multiplicity.setValue(e.getMultiplicity()),this.push.setValue(e.getPush())}setEnabled(e){super.setEnabled(e),this.multiplicity.setEnabled(e),this.push.setEnabled(e)}}class Z4TracerPanel extends Z4PointIteratorPanel{multiplicity=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.HORIZONTALLY_VERTICAL);push=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.HORIZONTALLY_VERTICAL);step=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.HORIZONTALLY_VERTICAL);assistedDrawing=new JSCheckBox;attack=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.HORIZONTALLY_VERTICAL);sustain=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.HORIZONTALLY_VERTICAL);release=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.HORIZONTALLY_VERTICAL);endlessSustain=new JSCheckBox;constructor(){super(),this.cssAddClass("z4tracerpanel"),this.multiplicity.setSignsVisible(!1),this.multiplicity.setConstantRange(1,50),this.multiplicity.setLabel(Z4Translations.MULTIPLICITY),this.multiplicity.cssAddClass("z4abstractvaluepanel-titled"),this.multiplicity.addChangeListener(e=>this.onIteratorChange(this.multiplicity.getValueIsAdjusting())),this.add(this.multiplicity,new GBC(0,0).i(0,0,0,1)),this.push.setSignsVisible(!1),this.push.setLabel(Z4Translations.PUSH),this.push.cssAddClass("z4abstractvaluepanel-titled"),this.push.addChangeListener(e=>this.onIteratorChange(this.push.getValueIsAdjusting())),this.add(this.push,new GBC(1,0).i(0,0,0,1)),this.step.setSignsVisible(!1),this.step.setConstantRange(1,50),this.step.setLabel(Z4Translations.STEP),this.step.cssAddClass("z4abstractvaluepanel-titled"),this.step.addChangeListener(e=>this.onIteratorChange(this.step.getValueIsAdjusting())),this.add(this.step,new GBC(2,0).i(0,0,0,5)),this.attack.setSignsVisible(!1),this.attack.setLabel(Z4Translations.ATTACK),this.attack.cssAddClass("z4abstractvaluepanel-titled"),this.attack.addChangeListener(e=>this.onIteratorChange(this.attack.getValueIsAdjusting())),this.add(this.attack,new GBC(3,0).i(0,0,0,1)),this.sustain.setSignsVisible(!1),this.sustain.setLabel(Z4Translations.SUSTAIN),this.sustain.cssAddClass("z4abstractvaluepanel-titled"),this.sustain.addChangeListener(e=>this.onIteratorChange(this.sustain.getValueIsAdjusting())),this.sustain.add(this.endlessSustain,new GBC(0,4).w(3).a(GBC.WEST)),this.add(this.sustain,new GBC(4,0).h(2).a(GBC.NORTH).i(0,0,0,1)),this.endlessSustain.setText(Z4Translations.ENDLESS),this.endlessSustain.addActionListener(e=>this.onIteratorChange(!1)),this.release.setSignsVisible(!1),this.release.setLabel(Z4Translations.RELEASE),this.release.cssAddClass("z4abstractvaluepanel-titled"),this.release.addChangeListener(e=>this.onIteratorChange(this.release.getValueIsAdjusting())),this.add(this.release,new GBC(5,0)),this.assistedDrawing.setText(Z4Translations.ASSISTED_DRAWING),this.assistedDrawing.addActionListener(e=>this.onIteratorChange(!1)),this.add(this.assistedDrawing,new GBC(3,1).a(GBC.NORTHWEST)),this.add(this.rotation,new GBC(0,1).w(3).a(GBC.WEST).i(1,0,0,0)),this.setValue(new Z4Tracer(new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),1),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),!0,new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),10),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),!0,new Z4Rotation(0,new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),Z4RotationBehavior.FIXED,!1)))}onIteratorChange(e){this.valueIsAdjusting=e,this.sustain.setEnabled(this.enabled&&!this.endlessSustain.isSelected()),this.release.setEnabled(this.enabled&&!this.endlessSustain.isSelected()),this.value=new Z4Tracer(this.multiplicity.getValue(),this.push.getValue(),this.attack.getValue(),this.sustain.getValue(),this.release.getValue(),this.endlessSustain.isSelected(),this.step.getValue(),this.assistedDrawing.isSelected(),this.rotation.getValue()),this.onchange()}setValue(e){super.setValue(e),this.multiplicity.setValue(e.getMultiplicity()),this.push.setValue(e.getPush()),this.attack.setValue(e.getAttack()),this.sustain.setValue(e.getSustain()),this.sustain.setEnabled(this.enabled&&!e.isEndlessSustain()),this.release.setValue(e.getRelease()),this.release.setEnabled(this.enabled&&!e.isEndlessSustain()),this.endlessSustain.setSelected(e.isEndlessSustain()),this.step.setValue(e.getStep()),this.assistedDrawing.setSelected(e.isAssistedDrawing())}setEnabled(e){super.setEnabled(e),this.multiplicity.setEnabled(e),this.push.setEnabled(e),this.attack.setEnabled(e),this.sustain.setEnabled(e&&!this.endlessSustain.isSelected()),this.release.setEnabled(e&&!this.endlessSustain.isSelected()),this.endlessSustain.setEnabled(e),this.step.setEnabled(e),this.assistedDrawing.setEnabled(e)}}class Z4AbstractRandomValuePanel extends Z4AbstractValuePanel{valuePanel=null;radios=[];lengthPanel=null;valueIsAdjusting=!1;constructor(e,t){super(),this.cssAddClass("z4abstractrandomvaluepanel"),this.setLayout(new GridBagLayout);let i=new ButtonGroup;t===Z4RandomValuePanelOrientation.HORIZONTAL?(this.valuePanel=new Z4SignedValuePanel(Z4SignedValuePanelOrientation.HORIZONTAL),this.add(this.valuePanel,new GBC(0,0).h(2).a(GBC.SOUTH).i(0,0,0,1)),this.addRadio(Z4RandomValueBehavior.CLASSIC,i,1,0,"topleft"),this.addRadio(Z4RandomValueBehavior.BEZIER,i,2,0,"topright"),this.addRadio(Z4RandomValueBehavior.POLYLINE,i,1,1,"bottomleft"),this.addRadio(Z4RandomValueBehavior.STEPPED,i,2,1,"bottomright"),this.lengthPanel=new Z4SignedValuePanel(Z4SignedValuePanelOrientation.HORIZONTAL),this.add(this.lengthPanel,new GBC(3,0).h(2).a(GBC.SOUTH))):t===Z4RandomValuePanelOrientation.VERTICAL?(this.valuePanel=new Z4SignedValuePanel(Z4SignedValuePanelOrientation.VERTICAL),this.add(this.valuePanel,new GBC(0,0).w(4).f(GBC.HORIZONTAL).i(0,0,1,0)),this.addRadio(Z4RandomValueBehavior.CLASSIC,i,0,1,"left"),this.addRadio(Z4RandomValueBehavior.BEZIER,i,1,1,"center"),this.addRadio(Z4RandomValueBehavior.POLYLINE,i,2,1,"center"),this.addRadio(Z4RandomValueBehavior.STEPPED,i,3,1,"right"),this.lengthPanel=new Z4SignedValuePanel(Z4SignedValuePanelOrientation.VERTICAL),this.add(this.lengthPanel,new GBC(0,2).w(4).f(GBC.HORIZONTAL))):t===Z4RandomValuePanelOrientation.HORIZONTALLY_VERTICAL?(this.valuePanel=new Z4SignedValuePanel(Z4SignedValuePanelOrientation.HORIZONTAL),this.add(this.valuePanel,new GBC(0,0).w(3).a(GBC.EAST)),this.addRadio(Z4RandomValueBehavior.CLASSIC,i,0,1,"topleft"),this.addRadio(Z4RandomValueBehavior.BEZIER,i,1,1,"topright"),this.addRadio(Z4RandomValueBehavior.POLYLINE,i,0,2,"bottomleft"),this.addRadio(Z4RandomValueBehavior.STEPPED,i,1,2,"bottomright"),this.lengthPanel=new Z4SignedValuePanel(Z4SignedValuePanelOrientation.VERTICAL),this.add(this.lengthPanel,new GBC(2,1).h(2).i(0,1,0,0))):(this.valuePanel=null,this.lengthPanel=null),this.valuePanel.setSignVisible(e),this.valuePanel.addChangeListener(e=>{this.valueIsAdjusting=this.valuePanel.getValueIsAdjusting(),this.onRandomValueChange(),this.onchange()}),this.lengthPanel.setLabel(Z4Translations.LENGTH),this.lengthPanel.setSignVisible(!1),this.lengthPanel.addChangeListener(e=>{this.valueIsAdjusting=this.lengthPanel.getValueIsAdjusting(),this.onRandomValueChange(),this.onchange()})}addRadio(e,t,i,s,n){let a=new JSRadioButton;a.cssAddClass("z4abstractrandomvaluepanel-radio"),a.getStyle().padding="1px",a.setTooltip(Z4Translations[""+e]),a.setToggle(),a.setIcon(new Z4EmptyImageProducer(e)),a.addActionListener(t=>{Object.keys(this.radios).forEach(e=>this.radios[e].setContentAreaFilled(!1)),a.setContentAreaFilled(!0),this.lengthPanel.setEnabled(e!==Z4RandomValueBehavior.CLASSIC),this.onRandomValueChange(),this.onchange()});let r=new GBC(i,s);switch(n){case"left":a.getStyle().borderTopRightRadius="0px",a.getStyle().borderBottomRightRadius="0px",a.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"center":a.getStyle().borderRadius="0px",a.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",a.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"right":a.getStyle().borderTopLeftRadius="0px",a.getStyle().borderBottomLeftRadius="0px",a.getStyle().borderLeft="1px solid var(--main-action-bgcolor)";break;case"topleft":r.a(GBC.SOUTH).wy(1),a.getStyle().borderTopRightRadius="0px",a.getStyle().borderBottomRightRadius="0px",a.getStyle().borderBottomLeftRadius="0px",a.getStyle().borderRight="1px solid var(--main-action-bgcolor)",a.getStyle().borderBottom="1px solid var(--main-action-bgcolor)";break;case"topright":r.a(GBC.SOUTH).wy(1),a.getStyle().borderTopLeftRadius="0px",a.getStyle().borderBottomLeftRadius="0px",a.getStyle().borderBottomRightRadius="0px",a.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",a.getStyle().borderBottom="1px solid var(--main-action-bgcolor)";break;case"bottomleft":a.getStyle().borderTopRightRadius="0px",a.getStyle().borderBottomRightRadius="0px",a.getStyle().borderTopLeftRadius="0px",a.getStyle().borderRight="1px solid var(--main-action-bgcolor)",a.getStyle().borderTop="1px solid var(--main-action-bgcolor)";break;case"bottomright":a.getStyle().borderTopLeftRadius="0px",a.getStyle().borderBottomLeftRadius="0px",a.getStyle().borderTopRightRadius="0px",a.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",a.getStyle().borderTop="1px solid var(--main-action-bgcolor)"}t.add(a),this.radios[""+e]=a,this.add(a,r)}onRandomValueChange(){}getValueIsAdjusting(){return this.valueIsAdjusting}setLabel(e){this.valuePanel.setLabel(e)}setRange(e,t){this.valuePanel.setRange(e,t)}setLengthRange(e,t){this.lengthPanel.setRange(e,t)}setEnabled(e){this.valuePanel.setEnabled(e),Object.keys(this.radios).forEach(t=>{let i=this.radios[t];i.setEnabled(e),i.isSelected()&&this.lengthPanel.setEnabled(e&&""+t!=""+Z4RandomValueBehavior.CLASSIC)})}}class Z4RandomValuePanel extends Z4AbstractRandomValuePanel{constructor(e){super(!1,e),this.cssAddClass("z4randomvaluepanel"),this.setValue(new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0))}onRandomValueChange(){Object.keys(this.radios).forEach(e=>{if(this.radios[e].isSelected())switch(""+e){case"CLASSIC":this.value=new Z4RandomValue(this.valuePanel.getValue().getValue(),Z4RandomValueBehavior.CLASSIC,this.lengthPanel.getValue().getValue());break;case"BEZIER":this.value=new Z4RandomValue(this.valuePanel.getValue().getValue(),Z4RandomValueBehavior.BEZIER,this.lengthPanel.getValue().getValue());break;case"POLYLINE":this.value=new Z4RandomValue(this.valuePanel.getValue().getValue(),Z4RandomValueBehavior.POLYLINE,this.lengthPanel.getValue().getValue());break;case"STEPPED":this.value=new Z4RandomValue(this.valuePanel.getValue().getValue(),Z4RandomValueBehavior.STEPPED,this.lengthPanel.getValue().getValue())}})}setValue(e){this.value=e,this.valuePanel.setValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),e.getValue())),Object.keys(this.radios).forEach(e=>this.radios[e].setContentAreaFilled(!1)),this.radios[""+e.getRandomValueBehavior()].setSelected(!0),this.radios[""+e.getRandomValueBehavior()].setContentAreaFilled(!0),this.lengthPanel.setEnabled(e.getRandomValueBehavior()!==Z4RandomValueBehavior.CLASSIC),this.lengthPanel.setValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),e.getLength()))}}class Z4SignedRandomValuePanel extends Z4AbstractRandomValuePanel{constructor(e){super(!0,e),this.cssAddClass("z4signedrandomvaluepanel"),this.setValue(new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.RANDOM),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)))}onRandomValueChange(){Object.keys(this.radios).forEach(e=>{if(this.radios[e].isSelected())switch(""+e){case"CLASSIC":this.value=new Z4SignedRandomValue(this.valuePanel.getValue().getSign(),new Z4RandomValue(this.valuePanel.getValue().getValue(),Z4RandomValueBehavior.CLASSIC,this.lengthPanel.getValue().getValue()));break;case"BEZIER":this.value=new Z4SignedRandomValue(this.valuePanel.getValue().getSign(),new Z4RandomValue(this.valuePanel.getValue().getValue(),Z4RandomValueBehavior.BEZIER,this.lengthPanel.getValue().getValue()));break;case"POLYLINE":this.value=new Z4SignedRandomValue(this.valuePanel.getValue().getSign(),new Z4RandomValue(this.valuePanel.getValue().getValue(),Z4RandomValueBehavior.POLYLINE,this.lengthPanel.getValue().getValue()));break;case"STEPPED":this.value=new Z4SignedRandomValue(this.valuePanel.getValue().getSign(),new Z4RandomValue(this.valuePanel.getValue().getValue(),Z4RandomValueBehavior.STEPPED,this.lengthPanel.getValue().getValue()))}})}setValue(e){this.value=e,this.valuePanel.setValue(new Z4SignedValue(e.getSign(),e.getValue().getValue())),Object.keys(this.radios).forEach(e=>this.radios[e].setContentAreaFilled(!1)),this.radios[""+e.getValue().getRandomValueBehavior()].setSelected(!0),this.radios[""+e.getValue().getRandomValueBehavior()].setContentAreaFilled(!0),this.lengthPanel.setEnabled(e.getValue().getRandomValueBehavior()!==Z4RandomValueBehavior.CLASSIC),this.lengthPanel.setValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),e.getValue().getLength()))}}class Z4FancifulValuePanel extends Z4AbstractValuePanel{label=new JSLabel;uniformSign=new JSToggleButton;sign=null;constant=null;random=null;signedRandom=null;signsVisible=!0;valueIsAdjusting=!1;orientation=null;constructor(e){super(),this.cssAddClass("z4fancifulvaluepanel"),this.setLayout(new GridBagLayout),this.orientation=e,e===Z4FancifulValuePanelOrientation.HORIZONTAL?(this.add(this.label,new GBC(0,0).w(2).wx(1).a(GBC.WEST)),this.add(this.uniformSign,new GBC(2,0).w(2).a(GBC.EAST)),this.sign=new Z4SignPanel(Z4SignPanelOrientation.SQUARED),this.add(this.sign,new GBC(0,1).i(0,0,0,2).a(GBC.SOUTH)),this.constant=new Z4SignedValuePanel(Z4SignedValuePanelOrientation.HORIZONTAL),this.add(this.constant,new GBC(1,1).i(0,0,0,2)),this.random=new Z4RandomValuePanel(Z4RandomValuePanelOrientation.HORIZONTAL),this.add(this.random,new GBC(2,1)),this.signedRandom=new Z4SignedRandomValuePanel(Z4RandomValuePanelOrientation.HORIZONTAL),this.add(this.signedRandom,new GBC(3,1))):e===Z4FancifulValuePanelOrientation.VERTICAL?(this.add(this.label,new GBC(0,0).a(GBC.WEST)),this.add(this.uniformSign,new GBC(1,0).a(GBC.EAST)),this.sign=new Z4SignPanel(Z4SignPanelOrientation.HORIZONTAL),this.add(this.sign,new GBC(0,1).w(2).i(1,0,0,0)),this.constant=new Z4SignedValuePanel(Z4SignedValuePanelOrientation.VERTICAL),this.add(this.constant,new GBC(0,2).w(2).i(0,0,2,0).f(GBC.HORIZONTAL)),this.random=new Z4RandomValuePanel(Z4RandomValuePanelOrientation.VERTICAL),this.add(this.random,new GBC(0,3).w(2)),this.signedRandom=new Z4SignedRandomValuePanel(Z4RandomValuePanelOrientation.VERTICAL),this.add(this.signedRandom,new GBC(0,4).w(2))):e===Z4FancifulValuePanelOrientation.HORIZONTALLY_VERTICAL?(this.add(this.label,new GBC(0,0).w(2).wx(1).a(GBC.WEST)),this.add(this.uniformSign,new GBC(2,0).a(GBC.EAST)),this.sign=new Z4SignPanel(Z4SignPanelOrientation.SQUARED),this.add(this.sign,new GBC(0,1).a(GBC.SOUTH)),this.constant=new Z4SignedValuePanel(Z4SignedValuePanelOrientation.HORIZONTAL),this.add(this.constant,new GBC(1,1).w(2).a(GBC.EAST)),this.random=new Z4RandomValuePanel(Z4RandomValuePanelOrientation.HORIZONTALLY_VERTICAL),this.add(this.random,new GBC(0,2).w(3).a(GBC.EAST)),this.signedRandom=new Z4SignedRandomValuePanel(Z4RandomValuePanelOrientation.HORIZONTALLY_VERTICAL),this.add(this.signedRandom,new GBC(0,3).w(3).a(GBC.EAST))):(this.sign=null,this.constant=null,this.random=null,this.signedRandom=null),this.uniformSign.cssAddClass("z4fancifulvaluepanel-uniform-sign"),this.uniformSign.getStyle().padding="1px",this.uniformSign.setTooltip(Z4Translations.UNIFORM_SIGN),this.uniformSign.setIcon(new Z4EmptyImageProducer("")),this.uniformSign.addActionListener(e=>this.onFancifulValueChange(!1)),this.sign.getStyle().display="none",this.sign.addChangeListener(e=>this.onFancifulValueChange(!1)),this.constant.setLabel(Z4Translations.CONSTANT),this.constant.addChangeListener(e=>this.onFancifulValueChange(this.constant.getValueIsAdjusting())),this.random.setLabel(Z4Translations.RANDOM),this.random.getStyle().display="none",this.random.addChangeListener(e=>this.onFancifulValueChange(this.random.getValueIsAdjusting())),this.signedRandom.setLabel(Z4Translations.RANDOM),this.signedRandom.addChangeListener(e=>this.onFancifulValueChange(this.signedRandom.getValueIsAdjusting())),this.setValue(new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.RANDOM),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.RANDOM),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1))}onFancifulValueChange(e){this.valueIsAdjusting=e,this.uniformSign.setContentAreaFilled(this.uniformSign.isSelected()),this.signsVisible?this.uniformSign.isSelected()?(this.constant.setValue(new Z4SignedValue(this.sign.getValue(),this.constant.getValue().getValue())),this.signedRandom.setValue(new Z4SignedRandomValue(this.sign.getValue(),this.random.getValue()))):(this.sign.setValue(this.constant.getValue().getSign()),this.random.setValue(this.signedRandom.getValue().getValue())):this.signedRandom.setValue(new Z4SignedRandomValue(this.signedRandom.getValue().getSign(),this.random.getValue())),this.value=new Z4FancifulValue(this.constant.getValue(),this.signedRandom.getValue(),this.uniformSign.isSelected()),this.setSignsVisible(this.signsVisible),this.onchange()}setLabel(e){this.label.setText(e)}setConstantRange(e,t){this.constant.setRange(e,t)}setRandomRange(e,t){this.random.setRange(e,t),this.signedRandom.setRange(e,t)}setRandomLengthRange(e,t){this.random.setLengthRange(e,t),this.signedRandom.setLengthRange(e,t)}setSignsVisible(e){if(this.signsVisible=e,this.uniformSign.getStyle().display=e?"flex":"none",this.sign.getStyle().display=e&&this.uniformSign.isSelected()?"grid":"none",this.constant.setSignVisible(e&&!this.uniformSign.isSelected()),this.random.getStyle().display=e&&!this.uniformSign.isSelected()?"none":"grid",this.signedRandom.getStyle().display=e&&!this.uniformSign.isSelected()?"grid":"none",this.orientation===Z4FancifulValuePanelOrientation.VERTICAL){let t=this.random.invoke("getBoundingClientRect()"),i=this.signedRandom.invoke("getBoundingClientRect()");this.constant.getStyle().minWidth=Math.max(t.width,i.width)+"px"}}getValueIsAdjusting(){return this.valueIsAdjusting}setValue(e){this.value=e,this.sign.setValue(e.getConstant().getSign()),this.constant.setValue(e.getConstant()),this.random.setValue(e.getRandom().getValue()),this.signedRandom.setValue(e.getRandom()),this.uniformSign.setSelected(e.isUniformSign()),this.uniformSign.setContentAreaFilled(e.isUniformSign()),this.setSignsVisible(this.signsVisible)}setEnabled(e){this.uniformSign.setEnabled(e),this.sign.setEnabled(e),this.constant.setEnabled(e),this.random.setEnabled(e),this.signedRandom.setEnabled(e)}}class Z4RotationPanel extends Z4AbstractValuePanel{label=new JSLabel;startAngle=null;angle=null;radios=[];delayed=new JSToggleButton;valueIsAdjusting=!1;constructor(e){super(),this.cssAddClass("z4rotationpanel"),this.setLayout(new GridBagLayout);let t=new ButtonGroup;e===Z4RotationPanelOrientation.HORIZONTAL?(this.cssAddClass("z4rotationpanel-horizontal"),this.add(this.label,new GBC(0,0)),this.startAngle=new Z4SignedValuePanel(Z4SignedValuePanelOrientation.HORIZONTAL),this.add(this.startAngle,new GBC(1,0).h(2).a(GBC.SOUTHEAST).wx(1).i(0,0,0,1)),this.angle=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.HORIZONTAL),this.add(this.angle,new GBC(0,2).w(4).i(1,0,0,0)),this.addRadio(Z4RotationBehavior.FIXED,t,2,0,"topleft"),this.addRadio(Z4RotationBehavior.CUMULATIVE,t,3,0,"topright"),this.addRadio(Z4RotationBehavior.RELATIVE_TO_PATH,t,2,1,"bottomleft"),this.delayed.getStyle().borderTopLeftRadius="0px",this.delayed.getStyle().borderBottomLeftRadius="0px",this.delayed.getStyle().borderTopRightRadius="0px",this.delayed.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",this.delayed.getStyle().borderTop="1px solid var(--main-action-bgcolor)",this.add(this.delayed,new GBC(3,1))):e===Z4RotationPanelOrientation.VERTICAL?(this.cssAddClass("z4rotationpanel-vertical"),this.add(this.label,new GBC(0,0).w(4).a(GBC.WEST)),this.startAngle=new Z4SignedValuePanel(Z4SignedValuePanelOrientation.VERTICAL),this.add(this.startAngle,new GBC(0,1).w(4).f(GBC.HORIZONTAL).i(0,0,1,0)),this.addRadio(Z4RotationBehavior.FIXED,t,0,2,"left"),this.addRadio(Z4RotationBehavior.CUMULATIVE,t,1,2,"center"),this.addRadio(Z4RotationBehavior.RELATIVE_TO_PATH,t,2,2,"center"),this.delayed.getStyle().borderTopLeftRadius="0px",this.delayed.getStyle().borderBottomLeftRadius="0px",this.delayed.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",this.add(this.delayed,new GBC(3,2)),this.angle=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.VERTICAL),this.add(this.angle,new GBC(0,3).w(4).i(1,0,0,0))):(this.startAngle=null,this.angle=null),this.startAngle.setRange(0,360),this.startAngle.setSignVisible(!1),this.startAngle.setLabel(Z4Translations.FIXED),this.startAngle.addChangeListener(e=>this.onRotationChange(this.startAngle.getValueIsAdjusting())),this.angle.setLabel(Z4Translations.VARIABLE),this.angle.setConstantRange(0,180),this.angle.setRandomRange(0,180),this.angle.addChangeListener(e=>this.onRotationChange(this.angle.getValueIsAdjusting())),this.delayed.cssAddClass("z4rotationpanel-delayed"),this.delayed.getStyle().padding="1px",this.delayed.setTooltip(Z4Translations.DELAYED),this.delayed.setIcon(new Z4EmptyImageProducer("")),this.delayed.addActionListener(e=>this.onRotationChange(!1)),this.setValue(new Z4Rotation(0,new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.RANDOM),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.RANDOM),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),Z4RotationBehavior.FIXED,!1))}addRadio(e,t,i,s,n){let a=new JSRadioButton;a.cssAddClass("z4rotationpanel-radio"),a.getStyle().padding="1px",a.setTooltip(Z4Translations[""+e]),a.setToggle(),a.setIcon(new Z4EmptyImageProducer(e)),a.addActionListener(e=>{Object.keys(this.radios).forEach(e=>this.radios[e].setContentAreaFilled(!1)),a.setContentAreaFilled(!0),this.onRotationChange(!1)});let r=new GBC(i,s);switch(n){case"left":a.getStyle().borderTopRightRadius="0px",a.getStyle().borderBottomRightRadius="0px",a.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"center":a.getStyle().borderRadius="0px",a.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",a.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"topleft":r.a(GBC.SOUTH).wy(1),a.getStyle().borderTopRightRadius="0px",a.getStyle().borderBottomRightRadius="0px",a.getStyle().borderBottomLeftRadius="0px",a.getStyle().borderRight="1px solid var(--main-action-bgcolor)",a.getStyle().borderBottom="1px solid var(--main-action-bgcolor)";break;case"topright":r.a(GBC.SOUTH).wy(1),a.getStyle().borderTopLeftRadius="0px",a.getStyle().borderBottomLeftRadius="0px",a.getStyle().borderBottomRightRadius="0px",a.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",a.getStyle().borderBottom="1px solid var(--main-action-bgcolor)";break;case"bottomleft":a.getStyle().borderTopRightRadius="0px",a.getStyle().borderBottomRightRadius="0px",a.getStyle().borderTopLeftRadius="0px",a.getStyle().borderRight="1px solid var(--main-action-bgcolor)",a.getStyle().borderTop="1px solid var(--main-action-bgcolor)"}t.add(a),this.radios[""+e]=a,this.add(a,r)}onRotationChange(e){this.valueIsAdjusting=e,this.delayed.setContentAreaFilled(this.delayed.isSelected()),Object.keys(this.radios).forEach(e=>{if(this.radios[e].isSelected())switch(""+e){case"FIXED":this.value=new Z4Rotation(this.startAngle.getValue().getValue(),this.angle.getValue(),Z4RotationBehavior.FIXED,this.delayed.isSelected());break;case"CUMULATIVE":this.value=new Z4Rotation(this.startAngle.getValue().getValue(),this.angle.getValue(),Z4RotationBehavior.CUMULATIVE,this.delayed.isSelected());break;case"RELATIVE_TO_PATH":this.value=new Z4Rotation(this.startAngle.getValue().getValue(),this.angle.getValue(),Z4RotationBehavior.RELATIVE_TO_PATH,this.delayed.isSelected())}}),this.onchange()}setLabel(e){this.label.setText(e)}setRandomLengthRange(e,t){this.angle.setRandomLengthRange(e,t)}getValueIsAdjusting(){return this.valueIsAdjusting}setValue(e){this.value=e,this.startAngle.setValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),e.getStartAngle())),this.angle.setValue(e.getAngle()),this.delayed.setSelected(e.isDelayed()),this.delayed.setContentAreaFilled(e.isDelayed()),Object.keys(this.radios).forEach(e=>this.radios[e].setContentAreaFilled(!1)),this.radios[""+e.getRotationBehavior()].setSelected(!0),this.radios[""+e.getRotationBehavior()].setContentAreaFilled(!0)}setEnabled(e){this.startAngle.setEnabled(e),this.angle.setEnabled(e),Object.keys(this.radios).forEach(t=>this.radios[t].setEnabled(e)),this.delayed.setEnabled(e)}}class Z4SignedValuePanel extends Z4AbstractValuePanel{label=new JSLabel;signPanel=null;valueSpinner=new JSSpinner;constructor(e){super(),this.cssAddClass("z4signedvaluepanel"),this.setLayout(new GridBagLayout),e===Z4SignedValuePanelOrientation.HORIZONTAL?(this.add(this.label,new GBC(1,0).a(GBC.WEST)),this.signPanel=new Z4SignPanel(Z4SignPanelOrientation.SQUARED),this.add(this.signPanel,new GBC(0,0).h(2).a(GBC.SOUTH)),this.add(this.valueSpinner,new GBC(1,1).a(GBC.SOUTH).i(0,1,0,0))):e===Z4SignedValuePanelOrientation.VERTICAL?(this.add(this.label,new GBC(0,0).a(GBC.WEST)),this.signPanel=new Z4SignPanel(Z4SignPanelOrientation.HORIZONTAL),this.add(this.signPanel,new GBC(0,1)),this.add(this.valueSpinner,new GBC(0,2).wx(1).f(GBC.HORIZONTAL).i(1,0,0,0))):this.signPanel=null,this.signPanel.addChangeListener(e=>this.onSignedValueChange()),this.valueSpinner.cssAddClass("jsspinner_w_4rem"),this.valueSpinner.setModel(new SpinnerNumberModel(0,0,50,1)),this.valueSpinner.addChangeListener(e=>this.onSignedValueChange()),this.setValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.RANDOM),0))}onSignedValueChange(){this.value=new Z4SignedValue(this.signPanel.getValue(),this.valueSpinner.getValue()),this.onchange()}setLabel(e){this.label.setText(e)}setRange(e,t){this.valueSpinner.setModel(new SpinnerNumberModel(e,e,t,1))}getValueIsAdjusting(){return this.valueSpinner.getValueIsAdjusting()}setValue(e){this.value=e,this.signPanel.setValue(e.getSign()),this.valueSpinner.setValue(e.getValue())}setEnabled(e){this.signPanel.setEnabled(e),this.valueSpinner.setEnabled(e)}setSignVisible(e){this.signPanel.getStyle().display=e?"grid":"none"}}class Z4SignPanel extends Z4AbstractValuePanel{radios=[];constructor(e){super(),this.cssAddClass("z4signpanel"),this.setLayout(new GridBagLayout);let t=new ButtonGroup;e===Z4SignPanelOrientation.HORIZONTAL?(this.addRadio(Z4SignBehavior.POSITIVE,t,0,0,"left"),this.addRadio(Z4SignBehavior.NEGATIVE,t,1,0,"centerh"),this.addRadio(Z4SignBehavior.RANDOM,t,2,0,"centerh"),this.addRadio(Z4SignBehavior.ALTERNATE,t,3,0,"right")):e===Z4SignPanelOrientation.VERTICAL?(this.addRadio(Z4SignBehavior.POSITIVE,t,0,0,"top"),this.addRadio(Z4SignBehavior.NEGATIVE,t,0,1,"centerv"),this.addRadio(Z4SignBehavior.RANDOM,t,0,2,"centerv"),this.addRadio(Z4SignBehavior.ALTERNATE,t,0,3,"bottom")):e===Z4SignPanelOrientation.SQUARED&&(this.addRadio(Z4SignBehavior.POSITIVE,t,0,0,"topleft"),this.addRadio(Z4SignBehavior.NEGATIVE,t,1,0,"topright"),this.addRadio(Z4SignBehavior.RANDOM,t,0,1,"bottomleft"),this.addRadio(Z4SignBehavior.ALTERNATE,t,1,1,"bottomright")),this.setValue(new Z4Sign(Z4SignBehavior.RANDOM))}addRadio(e,t,i,s,n){let a=new JSRadioButton;switch(a.cssAddClass("z4signpanel-radio"),a.getStyle().padding="1px",a.setTooltip(Z4Translations[""+e]),a.setToggle(),a.setIcon(new Z4EmptyImageProducer(e)),a.addActionListener(t=>{Object.keys(this.radios).forEach(e=>this.radios[e].setContentAreaFilled(!1)),a.setContentAreaFilled(!0),this.value=new Z4Sign(e),this.onchange()}),n){case"left":a.getStyle().borderTopRightRadius="0px",a.getStyle().borderBottomRightRadius="0px",a.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"centerh":a.getStyle().borderRadius="0px",a.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",a.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"right":a.getStyle().borderTopLeftRadius="0px",a.getStyle().borderBottomLeftRadius="0px",a.getStyle().borderLeft="1px solid var(--main-action-bgcolor)";break;case"top":a.getStyle().borderBottomLeftRadius="0px",a.getStyle().borderBottomRightRadius="0px",a.getStyle().borderBottom="1px solid var(--main-action-bgcolor)";break;case"centerv":a.getStyle().borderRadius="0px",a.getStyle().borderTop="1px solid var(--main-action-bgcolor)",a.getStyle().borderBottom="1px solid var(--main-action-bgcolor)";break;case"bottom":a.getStyle().borderTopLeftRadius="0px",a.getStyle().borderTopRightRadius="0px",a.getStyle().borderTop="1px solid var(--main-action-bgcolor)";break;case"topleft":a.getStyle().borderTopRightRadius="0px",a.getStyle().borderBottomRightRadius="0px",a.getStyle().borderBottomLeftRadius="0px",a.getStyle().borderRight="1px solid var(--main-action-bgcolor)",a.getStyle().borderBottom="1px solid var(--main-action-bgcolor)";break;case"topright":a.getStyle().borderTopLeftRadius="0px",a.getStyle().borderBottomLeftRadius="0px",a.getStyle().borderBottomRightRadius="0px",a.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",a.getStyle().borderBottom="1px solid var(--main-action-bgcolor)";break;case"bottomleft":a.getStyle().borderTopRightRadius="0px",a.getStyle().borderBottomRightRadius="0px",a.getStyle().borderTopLeftRadius="0px",a.getStyle().borderRight="1px solid var(--main-action-bgcolor)",a.getStyle().borderTop="1px solid var(--main-action-bgcolor)";break;case"bottomright":a.getStyle().borderTopLeftRadius="0px",a.getStyle().borderBottomLeftRadius="0px",a.getStyle().borderTopRightRadius="0px",a.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",a.getStyle().borderTop="1px solid var(--main-action-bgcolor)"}t.add(a),this.radios[""+e]=a,this.add(a,new GBC(i,s))}setValue(e){this.value=e,Object.keys(this.radios).forEach(e=>this.radios[e].setContentAreaFilled(!1)),this.radios[""+e.getSignBehavior()].setSelected(!0),this.radios[""+e.getSignBehavior()].setContentAreaFilled(!0)}setEnabled(e){Object.keys(this.radios).forEach(t=>this.radios[t].setEnabled(e))}}class Z4WhirlpoolPanel extends Z4AbstractValuePanel{angle=null;radios=[];enabled=!0;valueIsAdjusting=!1;constructor(e){super(),this.cssAddClass("z4whirlpoolpanel"),this.setLayout(new GridBagLayout);let t=new ButtonGroup;e===Z4WhirlpoolPanelOrientation.HORIZONTAL?(Z4UI.addLabel(this,Z4Translations.WHIRLPOOL,new GBC(0,0).a(GBC.WEST).wx(1)),this.addRadio(Z4WhirlpoolBehavior.NONE,t,1,0,"left"),this.addRadio(Z4WhirlpoolBehavior.FORWARD,t,2,0,"center"),this.addRadio(Z4WhirlpoolBehavior.BACKWARD,t,3,0,"right"),this.angle=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.HORIZONTAL),this.add(this.angle,new GBC(0,1).w(4))):e===Z4WhirlpoolPanelOrientation.VERTICAL?(Z4UI.addLabel(this,Z4Translations.WHIRLPOOL,new GBC(0,0).w(4).a(GBC.WEST)),this.addRadio(Z4WhirlpoolBehavior.NONE,t,0,1,"left"),this.addRadio(Z4WhirlpoolBehavior.FORWARD,t,1,1,"center"),this.addRadio(Z4WhirlpoolBehavior.BACKWARD,t,2,1,"right"),Z4UI.addLabel(this,"",new GBC(3,1).wx(1)),this.angle=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.VERTICAL),this.add(this.angle,new GBC(0,2).w(4))):this.angle=null,this.angle.setLabel(Z4Translations.ANGLE),this.angle.setSignsVisible(!1),this.angle.setConstantRange(0,90),this.angle.setRandomRange(0,90),this.angle.addChangeListener(e=>this.onWhirlpoolChange(this.angle.getValueIsAdjusting())),this.setValue(new Z4Whirlpool(Z4WhirlpoolBehavior.NONE,new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.RANDOM),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.RANDOM),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1)))}addRadio(e,t,i,s,n){let a=new JSRadioButton;a.cssAddClass("z4whirlpoolpanel-radio"),a.getStyle().padding="1px",a.setTooltip(Z4Translations[e===Z4WhirlpoolBehavior.NONE?"NONE_HIM":""+e]),a.setToggle(),a.setIcon(new Z4EmptyImageProducer(e)),a.addActionListener(e=>{Object.keys(this.radios).forEach(e=>this.radios[e].setContentAreaFilled(!1)),a.setContentAreaFilled(!0),this.onWhirlpoolChange(!1)});let r=new GBC(i,s);switch(n){case"left":a.getStyle().borderTopRightRadius="0px",a.getStyle().borderBottomRightRadius="0px",a.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"center":a.getStyle().borderRadius="0px",a.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",a.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"right":a.getStyle().borderTopLeftRadius="0px",a.getStyle().borderBottomLeftRadius="0px",a.getStyle().borderLeft="1px solid var(--main-action-bgcolor)"}t.add(a),this.radios[""+e]=a,this.add(a,r)}onWhirlpoolChange(e){this.valueIsAdjusting=e,Object.keys(this.radios).forEach(e=>{if(this.radios[e].isSelected())switch(""+e){case"NONE":this.value=new Z4Whirlpool(Z4WhirlpoolBehavior.NONE,this.angle.getValue());break;case"FORWARD":this.value=new Z4Whirlpool(Z4WhirlpoolBehavior.FORWARD,this.angle.getValue());break;case"BACKWARD":this.value=new Z4Whirlpool(Z4WhirlpoolBehavior.BACKWARD,this.angle.getValue())}}),this.angle.setEnabled(this.enabled&&this.value.getWhirlpoolBehavior()!==Z4WhirlpoolBehavior.NONE),this.onchange()}setRandomLengthRange(e,t){this.angle.setRandomLengthRange(e,t)}getValueIsAdjusting(){return this.valueIsAdjusting}setValue(e){this.value=e,this.angle.setValue(e.getAngle()),this.angle.setEnabled(this.enabled&&e.getWhirlpoolBehavior()!==Z4WhirlpoolBehavior.NONE),Object.keys(this.radios).forEach(e=>this.radios[e].setContentAreaFilled(!1)),this.radios[""+e.getWhirlpoolBehavior()].setSelected(!0),this.radios[""+e.getWhirlpoolBehavior()].setContentAreaFilled(!0)}setEnabled(e){this.enabled=e,this.angle.setEnabled(e&&this.value.getWhirlpoolBehavior()!==Z4WhirlpoolBehavior.NONE),Object.keys(this.radios).forEach(t=>this.radios[t].setEnabled(e))}}class Z4PainterPanel extends Z4AbstractValuePanel{valueIsAdjusting=!1;enabled=!0;constructor(){super(),this.cssAddClass("z4painterpanel"),this.setLayout(new GridBagLayout)}getValueIsAdjusting(){return this.valueIsAdjusting}setEnabled(e){super.setEnabled(e),this.enabled=e}}class Z4BrushPainterPanel extends Z4PainterPanel{width=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.VERTICAL);thickness=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.VERTICAL);pattern=document.createElement("img");open=new JSButton;delete=new JSButton;constructor(){super(),this.cssAddClass("z4brushpainterpanel"),this.width.setSignsVisible(!1),this.width.setConstantRange(1,150),this.width.setLabel(Z4Translations.WIDTH),this.width.cssAddClass("z4abstractvaluepanel-titled"),this.width.addChangeListener(e=>this.onbrushchange(this.width.getValueIsAdjusting(),this.value.getPattern())),this.add(this.width,new GBC(0,0).h(3).i(1,0,0,1)),this.thickness.setSignsVisible(!1),this.thickness.setConstantRange(1,15),this.thickness.setLabel(Z4Translations.THICKNESS),this.thickness.cssAddClass("z4abstractvaluepanel-titled"),this.thickness.addChangeListener(e=>this.onbrushchange(this.thickness.getValueIsAdjusting(),this.value.getPattern())),this.add(this.thickness,new GBC(1,0).h(3).i(0,0,0,1)),Z4UI.addLabel(this,Z4Translations.PATTERN,new GBC(2,0).w(2).a(GBC.WEST));let e=new JSComponent(document.createElement("div"));e.getStyle().width="150px",e.getStyle().height="150px",e.getStyle().border="2px solid var(--main-action-bgcolor)",e.getStyle().borderRadius="var(--roundness)",e.getStyle().display="flex",e.getStyle().alignItems="center",e.getStyle().justifyContent="center",this.add(e,new GBC(2,1).wxy(1,1).w(2)),this.pattern.style.maxWidth="150px",this.pattern.style.maxHeight="150px",e.appendNodeChild(this.pattern),this.open.setText(Z4Translations.OPEN),this.open.addActionListener(e=>this.selectPattern()),this.add(this.open,new GBC(2,2).i(0,0,0,1).a(GBC.EAST).wx(1)),this.delete.setText(Z4Translations.DELETE),this.delete.setEnabled(!1),this.delete.addActionListener(e=>JSOptionPane.showConfirmDialog(Z4Translations.DELETE_PATTERN_MESSAGE,Z4Translations.DELETE,JSOptionPane.YES_NO_OPTION,JSOptionPane.QUESTION_MESSAGE,e=>{e===JSOptionPane.YES_OPTION&&this.onbrushchange(!1,null)})),this.add(this.delete,new GBC(3,2)),this.setValue(new Z4BrushPainter(new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),10),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),2),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),null))}selectPattern(){if("function"==typeof window.showOpenFilePicker){let e=new FilePickerOptions;e.excludeAcceptAllOption=!0,e.id=Z4Constants.TEXTURE_FILE_ID,e.multiple=!1,e.types=Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_TYPE,JSFilePicker.showOpenFilePicker(e,0,e=>e.forEach(e=>e.getFile().then(e=>{this.openTexture(e)})))}else JSFileChooser.showOpenDialog(""+Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_FORMAT.join(","),JSFileChooser.SINGLE_SELECTION,0,e=>e.forEach(e=>this.openTexture(e)))}openTexture(e){let t=new FileReader;t.onload=e=>{let i=new Image;return i.onload=e=>(this.onbrushchange(!1,i),null),i.src=t.result,null},t.readAsDataURL(e)}onbrushchange(e,t){this.valueIsAdjusting=e,this.value=new Z4BrushPainter(this.width.getValue(),this.thickness.getValue(),t),this.value.getPattern()?(this.pattern.src=this.value.getPattern().src,this.delete.setEnabled(this.enabled)):(this.pattern.removeAttribute("src"),this.delete.setEnabled(!1)),this.onchange()}setValue(e){this.value=e,this.width.setValue(this.value.getWidth()),this.thickness.setValue(this.value.getThickness()),this.value.getPattern()?(this.pattern.src=this.value.getPattern().src,this.delete.setEnabled(this.enabled)):(this.pattern.removeAttribute("src"),this.delete.setEnabled(!1))}setEnabled(e){super.setEnabled(e),this.width.setEnabled(e),this.thickness.setEnabled(e),this.open.setEnabled(e),this.delete.setEnabled(e&&this.value.getPattern())}}class Z4CenteredFigurePainterPanel extends Z4PainterPanel{radios=[];sample=new JSComponent(document.createElement("img"));size=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.VERTICAL);angle1=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.VERTICAL);angle2=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.VERTICAL);tension=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.VERTICAL);multiplicity=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.VERTICAL);hole=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.VERTICAL);whirlpool=new Z4WhirlpoolPanel(Z4WhirlpoolPanelOrientation.VERTICAL);coverSpinner=new JSSpinner;coverSlider=new JSSlider;shadowShiftX=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.HORIZONTAL);shadowShiftY=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.HORIZONTAL);shadowColorPanel=new Z4ColorPanel;borderSize=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.HORIZONTAL);borderColorPanel=new Z4ColorPanel;constructor(){super(),this.cssAddClass("z4centeredfigurepainterpanel");let e=new JSTabbedPane;this.add(e,new GBC(0,0));let t=new JSPanel;t.setLayout(new GridBagLayout),e.addTab(Z4Translations.SHAPE,t),this.sample.cssAddClass("z4centeredfigurepainterpanel-sample"),t.add(this.sample,new GBC(0,0).wy(1));let i=new JSPanel;i.setLayout(new GridLayout(3,2,1,1)),t.add(i,new GBC(0,1).h(3).i(0,0,0,1));let s=new ButtonGroup;this.addRadio(Z4CenteredFigurePainterType.TYPE_0,i,s),this.addRadio(Z4CenteredFigurePainterType.TYPE_3,i,s),this.addRadio(Z4CenteredFigurePainterType.TYPE_1,i,s),this.addRadio(Z4CenteredFigurePainterType.TYPE_4,i,s),this.addRadio(Z4CenteredFigurePainterType.TYPE_2,i,s),this.addRadio(Z4CenteredFigurePainterType.TYPE_5,i,s),this.size.setSignsVisible(!1),this.size.getStyle().setProperty("grid-template-areas",'"p1 p1"\n"p3 p3"\n"p4 p4"\n"p5 p5"\n"p6 p6"'),this.size.setConstantRange(1,50),this.size.setLabel(Z4Translations.DIMENSION),this.size.cssAddClass("z4abstractvaluepanel-titled"),this.size.getChilStyleByQuery("label:nth-child(1)").fontSize="smaller",this.size.addChangeListener(e=>this.onfigurechange(this.size.getValueIsAdjusting(),null,null,this.coverSlider.getValue())),t.add(this.size,new GBC(1,0).h(2).i(1,0,0,1)),this.tension.setSignsVisible(!1),this.tension.getStyle().setProperty("grid-template-areas",'"p1 p1"\n"p3 p3"\n"p4 p4"\n"p5 p5"\n"p6 p6"'),this.tension.setConstantRange(1,100),this.tension.setLabel(Z4Translations.TENSION+" (τ)"),this.tension.cssAddClass("z4abstractvaluepanel-titled"),this.tension.getChilStyleByQuery("label:nth-child(1)").fontSize="smaller",this.tension.addChangeListener(e=>this.onfigurechange(this.tension.getValueIsAdjusting(),null,null,this.coverSlider.getValue())),t.add(this.tension,new GBC(2,0).h(2).i(1,0,0,1)),this.angle1.setSignsVisible(!1),this.angle1.getStyle().setProperty("grid-template-areas",'"p1 p1"\n"p3 p3"\n"p4 p4"\n"p5 p5"\n"p6 p6"'),this.angle1.setConstantRange(0,360),this.angle1.setRandomRange(0,90),this.angle1.setLabel(Z4Translations.ANGLE+" 1 (α1)"),this.angle1.cssAddClass("z4abstractvaluepanel-titled"),this.angle1.getChilStyleByQuery("label:nth-child(1)").fontSize="smaller",this.angle1.addChangeListener(e=>this.onfigurechange(this.angle1.getValueIsAdjusting(),null,null,this.coverSlider.getValue())),t.add(this.angle1,new GBC(3,0).h(2).i(1,0,0,1)),this.angle2.setSignsVisible(!1),this.angle2.getStyle().setProperty("grid-template-areas",'"p1 p1"\n"p3 p3"\n"p4 p4"\n"p5 p5"\n"p6 p6"'),this.angle2.setConstantRange(0,360),this.angle2.setRandomRange(0,90),this.angle2.setLabel(Z4Translations.ANGLE+" 2 (α2)"),this.angle2.cssAddClass("z4abstractvaluepanel-titled"),this.angle2.getChilStyleByQuery("label:nth-child(1)").fontSize="smaller",this.angle2.addChangeListener(e=>this.onfigurechange(this.angle2.getValueIsAdjusting(),null,null,this.coverSlider.getValue())),t.add(this.angle2,new GBC(4,0).h(2).i(1,0,0,1)),this.multiplicity.setSignsVisible(!1),this.multiplicity.getStyle().setProperty("grid-template-areas",'"p1 p1"\n"p3 p3"\n"p4 p4"\n"p5 p5"\n"p6 p6"'),this.multiplicity.setConstantRange(3,10),this.multiplicity.setLabel(Z4Translations.MULTIPLICITY),this.multiplicity.cssAddClass("z4abstractvaluepanel-titled"),this.multiplicity.getChilStyleByQuery("label:nth-child(1)").fontSize="smaller",this.multiplicity.addChangeListener(e=>this.onfigurechange(this.multiplicity.getValueIsAdjusting(),null,null,this.coverSlider.getValue())),t.add(this.multiplicity,new GBC(5,0).h(2).i(1,0,0,1)),this.hole.setSignsVisible(!1),this.hole.getStyle().setProperty("grid-template-areas",'"p1 p1"\n"p3 p3"\n"p4 p4"\n"p5 p5"\n"p6 p6"'),this.hole.setLabel(Z4Translations.HOLE),this.hole.cssAddClass("z4abstractvaluepanel-titled"),this.hole.getChilStyleByQuery("label:nth-child(1)").fontSize="smaller",this.hole.addChangeListener(e=>this.onfigurechange(this.hole.getValueIsAdjusting(),null,null,this.coverSlider.getValue())),t.add(this.hole,new GBC(6,0).h(2).i(1,0,0,1)),this.whirlpool.cssAddClass("z4abstractvaluepanel-titled"),this.whirlpool.getChilStyleByQuery("label:nth-child(1)").fontSize="smaller",this.whirlpool.addChangeListener(e=>this.onfigurechange(this.whirlpool.getValueIsAdjusting(),null,null,this.coverSlider.getValue())),t.add(this.whirlpool,new GBC(7,0).a(GBC.NORTH).h(4).i(1,0,0,0)),Z4UI.addLabel(t,Z4Translations.COVER,new GBC(1,2).w(2).a(GBC.WEST)),this.coverSpinner.cssAddClass("jsspinner_w_4rem"),this.coverSpinner.setModel(new SpinnerNumberModel(100,0,100,1)),this.coverSpinner.addChangeListener(e=>this.onfigurechange(this.coverSpinner.getValueIsAdjusting(),null,null,this.coverSpinner.getValue())),t.add(this.coverSpinner,new GBC(3,2).a(GBC.EAST).i(1,0,0,0)),this.coverSlider.addChangeListener(e=>this.onfigurechange(this.coverSlider.getValueIsAdjusting(),null,null,this.coverSlider.getValue())),t.add(this.coverSlider,new GBC(1,3).w(3).f(GBC.HORIZONTAL)),this.shadowShiftX.setLabel(Z4Translations.DELTA_X),this.shadowShiftX.cssAddClass("z4abstractvaluepanel-titled"),this.shadowShiftX.addChangeListener(e=>this.onfigurechange(this.shadowShiftX.getValueIsAdjusting(),null,null,this.coverSlider.getValue())),this.shadowShiftY.setLabel(Z4Translations.DELTA_Y),this.shadowShiftY.cssAddClass("z4abstractvaluepanel-titled"),this.shadowShiftY.addChangeListener(e=>this.onfigurechange(this.shadowShiftY.getValueIsAdjusting(),null,null,this.coverSlider.getValue())),this.shadowColorPanel.addChangeListener(e=>this.onfigurechange(!1,this.shadowColorPanel.getValue(),null,this.coverSlider.getValue())),this.createPanel(e,Z4Translations.SHADOW,this.shadowShiftX,this.shadowShiftY,this.shadowColorPanel),this.borderSize.setSignsVisible(!1),this.borderSize.setLabel(Z4Translations.DIMENSION),this.borderSize.cssAddClass("z4abstractvaluepanel-titled"),this.borderSize.addChangeListener(e=>this.onfigurechange(this.borderSize.getValueIsAdjusting(),null,null,this.coverSlider.getValue())),this.borderColorPanel.addChangeListener(e=>this.onfigurechange(!1,null,this.borderColorPanel.getValue(),this.coverSlider.getValue())),this.createPanel(e,Z4Translations.BORDER,this.borderSize,null,this.borderColorPanel),this.setValue(new Z4CenteredFigurePainter(Z4CenteredFigurePainterType.TYPE_0,new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),10),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),45),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),45),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),50),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),3),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4Whirlpool(Z4WhirlpoolBehavior.NONE,new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1)),100,new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Color(0,0,0,255),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Color(0,0,0,255)))}addRadio(e,t,i){let s=new JSRadioButton;s.cssAddClass("z4centeredfigurepainterpanel-radio"),s.getStyle().marginBottom="1px",s.setContentAreaFilled(!1),s.setToggle(),s.setIcon(new Z4EmptyImageProducer(e)),s.addActionListener(e=>this.onfigurechange(!1,null,null,this.coverSlider.getValue())),i.add(s),this.radios[""+e]=s,t.add(s,null)}createPanel(e,t,i,s,n){let a=new JSPanel;a.setLayout(new GridBagLayout),e.addTab(t,a),a.add(i,new GBC(0,1).i(1,0,1,0)),s&&a.add(s,new GBC(0,2)),n.setLabel(Z4Translations.FILLING_COLOR),a.add(n,new GBC(0,3).f(GBC.HORIZONTAL))}onfigurechange(e,t,i,s){this.valueIsAdjusting=e,this.coverSpinner.setValue(s),this.coverSlider.setValue(s);let n=null;switch(""+Object.keys(this.radios).find((e,t,i)=>this.radios[e].isSelected())){case"TYPE_0":n=Z4CenteredFigurePainterType.TYPE_0;break;case"TYPE_1":n=Z4CenteredFigurePainterType.TYPE_1;break;case"TYPE_2":n=Z4CenteredFigurePainterType.TYPE_2;break;case"TYPE_3":n=Z4CenteredFigurePainterType.TYPE_3;break;case"TYPE_4":n=Z4CenteredFigurePainterType.TYPE_4;break;case"TYPE_5":n=Z4CenteredFigurePainterType.TYPE_5}this.value=new Z4CenteredFigurePainter(n,this.size.getValue(),this.angle1.getValue(),this.angle2.getValue(),this.tension.getValue(),this.multiplicity.getValue(),this.hole.getValue(),this.whirlpool.getValue(),this.coverSlider.getValue(),this.shadowShiftX.getValue(),this.shadowShiftY.getValue(),t||this.value.getShadowColor(),this.borderSize.getValue(),i||this.value.getBorderColor()),this.sample.cssRemoveClass("z4centeredfigurepainterpanel-sample0_1_2"),this.sample.cssRemoveClass("z4centeredfigurepainterpanel-sample3_4_5"),this.value.getCenteredFigurePainterType()===Z4CenteredFigurePainterType.TYPE_0||this.value.getCenteredFigurePainterType()===Z4CenteredFigurePainterType.TYPE_1||this.value.getCenteredFigurePainterType()===Z4CenteredFigurePainterType.TYPE_2?this.sample.cssAddClass("z4centeredfigurepainterpanel-sample0_1_2"):(this.value.getCenteredFigurePainterType()===Z4CenteredFigurePainterType.TYPE_3||this.value.getCenteredFigurePainterType()===Z4CenteredFigurePainterType.TYPE_4||this.value.getCenteredFigurePainterType()===Z4CenteredFigurePainterType.TYPE_5)&&this.sample.cssAddClass("z4centeredfigurepainterpanel-sample3_4_5"),this.angle1.setEnabled(this.enabled&&this.value.getCenteredFigurePainterType()!==Z4CenteredFigurePainterType.TYPE_5),this.angle2.setEnabled(this.enabled&&(this.value.getCenteredFigurePainterType()===Z4CenteredFigurePainterType.TYPE_3||this.value.getCenteredFigurePainterType()===Z4CenteredFigurePainterType.TYPE_5)),this.tension.setEnabled(this.enabled&&(this.value.getCenteredFigurePainterType()===Z4CenteredFigurePainterType.TYPE_3||this.value.getCenteredFigurePainterType()===Z4CenteredFigurePainterType.TYPE_4||this.value.getCenteredFigurePainterType()===Z4CenteredFigurePainterType.TYPE_5)),this.onchange()}setValue(e){this.value=e,this.radios[""+e.getCenteredFigurePainterType()].setSelected(!0),this.sample.cssRemoveClass("z4centeredfigurepainterpanel-sample0_1_2"),this.sample.cssRemoveClass("z4centeredfigurepainterpanel-sample3_4_5"),this.value.getCenteredFigurePainterType()===Z4CenteredFigurePainterType.TYPE_0||this.value.getCenteredFigurePainterType()===Z4CenteredFigurePainterType.TYPE_1||this.value.getCenteredFigurePainterType()===Z4CenteredFigurePainterType.TYPE_2?this.sample.cssAddClass("z4centeredfigurepainterpanel-sample0_1_2"):(this.value.getCenteredFigurePainterType()===Z4CenteredFigurePainterType.TYPE_3||this.value.getCenteredFigurePainterType()===Z4CenteredFigurePainterType.TYPE_4||this.value.getCenteredFigurePainterType()===Z4CenteredFigurePainterType.TYPE_5)&&this.sample.cssAddClass("z4centeredfigurepainterpanel-sample3_4_5"),this.size.setValue(this.value.getSize()),this.angle1.setValue(this.value.getAngle1()),this.angle1.setEnabled(this.enabled&&this.value.getCenteredFigurePainterType()!==Z4CenteredFigurePainterType.TYPE_5),this.angle2.setValue(this.value.getAngle2()),this.angle2.setEnabled(this.enabled&&(this.value.getCenteredFigurePainterType()===Z4CenteredFigurePainterType.TYPE_3||this.value.getCenteredFigurePainterType()===Z4CenteredFigurePainterType.TYPE_5)),this.tension.setValue(this.value.getTension()),this.tension.setEnabled(this.enabled&&(this.value.getCenteredFigurePainterType()===Z4CenteredFigurePainterType.TYPE_3||this.value.getCenteredFigurePainterType()===Z4CenteredFigurePainterType.TYPE_4||this.value.getCenteredFigurePainterType()===Z4CenteredFigurePainterType.TYPE_5)),this.multiplicity.setValue(this.value.getMultiplicity()),this.hole.setValue(this.value.getHole()),this.whirlpool.setValue(this.value.getWhirlpool()),this.coverSpinner.setValue(this.value.getCover()),this.coverSlider.setValue(this.value.getCover()),this.shadowShiftX.setValue(this.value.getShadowShiftX()),this.shadowShiftY.setValue(this.value.getShadowShiftY()),this.shadowColorPanel.setValue(this.value.getShadowColor()),this.borderSize.setValue(this.value.getBorderSize()),this.borderColorPanel.setValue(this.value.getBorderColor())}setEnabled(e){super.setEnabled(e),Object.keys(this.radios).forEach(t=>this.radios[t].setEnabled(e)),this.size.setEnabled(e),this.angle1.setEnabled(e&&this.value.getCenteredFigurePainterType()!==Z4CenteredFigurePainterType.TYPE_5),this.angle2.setEnabled(e&&(this.value.getCenteredFigurePainterType()===Z4CenteredFigurePainterType.TYPE_3||this.value.getCenteredFigurePainterType()===Z4CenteredFigurePainterType.TYPE_5)),this.tension.setEnabled(e&&(this.value.getCenteredFigurePainterType()===Z4CenteredFigurePainterType.TYPE_3||this.value.getCenteredFigurePainterType()===Z4CenteredFigurePainterType.TYPE_4||this.value.getCenteredFigurePainterType()===Z4CenteredFigurePainterType.TYPE_5)),this.multiplicity.setEnabled(e),this.hole.setEnabled(e),this.whirlpool.setEnabled(e),this.coverSpinner.setEnabled(e),this.coverSlider.setEnabled(e),this.shadowShiftX.setEnabled(e),this.shadowShiftY.setEnabled(e),this.shadowColorPanel.setEnabled(e),this.borderSize.setEnabled(e),this.borderColorPanel.setEnabled(e)}}class Z4DropPainterPanel extends Z4PainterPanel{radios=[];radius=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.HORIZONTAL);intensitySpinner=new JSSpinner;intensitySlider=new JSSlider;gaussianCorrectionSpinner=new JSSpinner;gaussianCorrectionSlider=new JSSlider;constructor(){super(),this.cssAddClass("z4droppainterpanel");let e=new JSPanel;this.add(e,new GBC(0,0).w(2));let t=new ButtonGroup;this.addRadio(Z4DropPainterType.THOUSAND_POINTS,e,t),this.addRadio(Z4DropPainterType.THOUSAND_LINES,e,t),this.addRadio(Z4DropPainterType.THOUSAND_AREAS,e,t),this.radius.setSignsVisible(!1),this.radius.setConstantRange(1,100),this.radius.setLabel(Z4Translations.RADIUS),this.radius.cssAddClass("z4abstractvaluepanel-titled"),this.radius.addChangeListener(e=>this.ondropchange(this.radius.getValueIsAdjusting(),this.intensitySlider.getValue(),this.gaussianCorrectionSlider.getValue())),this.add(this.radius,new GBC(0,1).w(2).i(0,0,1,0)),Z4UI.addLabel(this,Z4Translations.INTENSITY,new GBC(0,2).a(GBC.WEST)),this.intensitySpinner.cssAddClass("jsspinner_w_4rem"),this.intensitySpinner.setModel(new SpinnerNumberModel(20,1,200,1)),this.intensitySpinner.addChangeListener(e=>this.ondropchange(this.intensitySpinner.getValueIsAdjusting(),this.intensitySpinner.getValue(),this.gaussianCorrectionSlider.getValue())),this.add(this.intensitySpinner,new GBC(1,2).a(GBC.EAST)),this.intensitySlider.setMinimum(1),this.intensitySlider.setMaximum(200),this.intensitySlider.addChangeListener(e=>this.ondropchange(this.intensitySlider.getValueIsAdjusting(),this.intensitySlider.getValue(),this.gaussianCorrectionSlider.getValue())),this.add(this.intensitySlider,new GBC(0,3).w(2).f(GBC.HORIZONTAL)),Z4UI.addLabel(this,Z4Translations.GAUSSIAN_CORRECTION,new GBC(0,4).a(GBC.WEST)),this.gaussianCorrectionSpinner.cssAddClass("jsspinner_w_4rem"),this.gaussianCorrectionSpinner.setModel(new SpinnerNumberModel(10,1,100,1)),this.gaussianCorrectionSpinner.addChangeListener(e=>this.ondropchange(this.gaussianCorrectionSpinner.getValueIsAdjusting(),this.intensitySlider.getValue(),this.gaussianCorrectionSpinner.getValue())),this.add(this.gaussianCorrectionSpinner,new GBC(1,4).a(GBC.EAST)),this.gaussianCorrectionSlider.setMinimum(1),this.gaussianCorrectionSlider.setMaximum(100),this.gaussianCorrectionSlider.addChangeListener(e=>this.ondropchange(this.gaussianCorrectionSlider.getValueIsAdjusting(),this.intensitySlider.getValue(),this.gaussianCorrectionSlider.getValue())),this.add(this.gaussianCorrectionSlider,new GBC(0,5).w(2).f(GBC.HORIZONTAL)),this.setValue(new Z4DropPainter(Z4DropPainterType.THOUSAND_POINTS,new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),10),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),20,10))}addRadio(e,t,i){let s=new JSRadioButton;s.cssAddClass("z4droppainterpanel-radio"),s.setContentAreaFilled(!1),s.setToggle(),s.setIcon(new Z4EmptyImageProducer(e)),s.addActionListener(e=>this.ondropchange(!1,this.intensitySlider.getValue(),this.gaussianCorrectionSlider.getValue())),i.add(s),this.radios[""+e]=s,t.add(s,null)}ondropchange(e,t,i){this.valueIsAdjusting=e,this.intensitySpinner.setValue(t),this.intensitySlider.setValue(t),this.gaussianCorrectionSpinner.setValue(i),this.gaussianCorrectionSlider.setValue(i);let s=null;switch(""+Object.keys(this.radios).find((e,t,i)=>this.radios[e].isSelected())){case"THOUSAND_POINTS":s=Z4DropPainterType.THOUSAND_POINTS;break;case"THOUSAND_LINES":s=Z4DropPainterType.THOUSAND_LINES;break;case"THOUSAND_AREAS":s=Z4DropPainterType.THOUSAND_AREAS}this.value=new Z4DropPainter(s,this.radius.getValue(),this.intensitySlider.getValue(),this.gaussianCorrectionSlider.getValue()),this.onchange()}setValue(e){this.value=e,this.radios[""+e.getDropPainterType()].setSelected(!0),this.radius.setValue(this.value.getRadius()),this.intensitySpinner.setValue(this.value.getIntensity()),this.intensitySlider.setValue(this.value.getIntensity()),this.gaussianCorrectionSpinner.setValue(this.value.getGaussianCorrection()),this.gaussianCorrectionSlider.setValue(this.value.getGaussianCorrection())}setEnabled(e){super.setEnabled(e),Object.keys(this.radios).forEach(t=>this.radios[t].setEnabled(e)),this.radius.setEnabled(e),this.intensitySpinner.setEnabled(e),this.intensitySlider.setEnabled(e),this.gaussianCorrectionSpinner.setEnabled(e),this.gaussianCorrectionSlider.setEnabled(e)}}class Z4NaturalFigurePainterPanel extends Z4PainterPanel{radios=[];radiosClosure=[];sample=new JSComponent(document.createElement("img"));size=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.HORIZONTAL);internalAngle1=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.VERTICAL);externalAngle1=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.VERTICAL);internalAngle2=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.VERTICAL);externalAngle2=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.VERTICAL);internalTension1=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.VERTICAL);externalTension1=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.VERTICAL);internalTension2=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.VERTICAL);externalTension2=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.VERTICAL);externalForceAngle=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.HORIZONTAL);externalForceTension=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.HORIZONTAL);indentationSpinner=new JSSpinner;indentationSlider=new JSSlider;shadowShiftX=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.HORIZONTAL);shadowShiftY=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.HORIZONTAL);shadowColorPanel=new Z4ColorPanel;borderSize=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.HORIZONTAL);borderColorPanel=new Z4ColorPanel;constructor(){super(),this.cssAddClass("z4naturalfigurepainterpanel");let e=new JSTabbedPane;this.add(e,new GBC(0,0));let t=new JSPanel;t.setLayout(new GridBagLayout),e.addTab(Z4Translations.BASIC,t);let i=new JSPanel;t.add(i,new GBC(0,0).w(2));let s=new ButtonGroup;this.addRadio(""+Z4NaturalFigurePainterType.TYPE_0,i,this.radios,s),this.addRadio(""+Z4NaturalFigurePainterType.TYPE_1,i,this.radios,s),this.addRadio(""+Z4NaturalFigurePainterType.TYPE_2,i,this.radios,s),this.addRadio(""+Z4NaturalFigurePainterType.TYPE_3,i,this.radios,s),s=new ButtonGroup,this.addRadio(""+Z4NaturalFigurePainterControlPointClosure.CONTROL_POINT_CLOSURE_0,i,this.radiosClosure,s),this.addRadio(""+Z4NaturalFigurePainterControlPointClosure.CONTROL_POINT_CLOSURE_1,i,this.radiosClosure,s),this.addRadio(""+Z4NaturalFigurePainterControlPointClosure.CONTROL_POINT_CLOSURE_2,i,this.radiosClosure,s),this.size.setSignsVisible(!1),this.size.setConstantRange(1,200),this.size.setLabel(Z4Translations.DIMENSION),this.size.cssAddClass("z4abstractvaluepanel-titled"),this.size.addChangeListener(e=>this.onfigurechange(this.size.getValueIsAdjusting(),null,null,this.indentationSlider.getValue())),t.add(this.size,new GBC(0,1).w(2).i(0,0,1,0)),Z4UI.addLabel(t,Z4Translations.INDENTATION,new GBC(0,2).a(GBC.WEST)),this.indentationSpinner.cssAddClass("jsspinner_w_4rem"),this.indentationSpinner.setModel(new SpinnerNumberModel(100,0,100,1)),this.indentationSpinner.addChangeListener(e=>this.onfigurechange(this.indentationSpinner.getValueIsAdjusting(),null,null,this.indentationSpinner.getValue())),t.add(this.indentationSpinner,new GBC(1,2).a(GBC.EAST)),this.indentationSlider.addChangeListener(e=>this.onfigurechange(this.indentationSlider.getValueIsAdjusting(),null,null,this.indentationSlider.getValue())),t.add(this.indentationSlider,new GBC(0,3).w(2).f(GBC.HORIZONTAL)),(t=new JSPanel).setLayout(new GridBagLayout),e.addTab(Z4Translations.POINTS,t),this.sample.cssAddClass("z4naturalfigurepainterpanel-sample"),t.add(this.sample,new GBC(0,0).h(2)),this.createPoint(t,this.internalAngle1,this.internalTension1,Z4Translations.INTERNAL_BASE_POINT,"i1",1),this.createPoint(t,this.externalAngle1,this.externalTension1,Z4Translations.EXTERNAL_BASE_POINT,"e1",3),this.createPoint(t,this.internalAngle2,this.internalTension2,Z4Translations.INTERNAL_TERMINAL_POINT,"i2",5),this.createPoint(t,this.externalAngle2,this.externalTension2,Z4Translations.EXTERNAL_TERMINAL_POINT,"e2",7),(t=new JSPanel).setLayout(new GridBagLayout),e.addTab(Z4Translations.EXTERNAL_FORCE,t),this.externalForceAngle.setConstantRange(0,360),this.externalForceAngle.setRandomRange(0,90),this.externalForceAngle.setLabel(Z4Translations.ANGLE+" (α)"),this.externalForceAngle.cssAddClass("z4abstractvaluepanel-titled"),this.externalForceAngle.addChangeListener(e=>this.onfigurechange(this.externalForceAngle.getValueIsAdjusting(),null,null,this.indentationSlider.getValue())),t.add(this.externalForceAngle,new GBC(0,0).i(1,0,0,1)),this.externalForceTension.setSignsVisible(!1),this.externalForceTension.setConstantRange(0,100),this.externalForceTension.setLabel(Z4Translations.TENSION+" (τ)"),this.externalForceTension.cssAddClass("z4abstractvaluepanel-titled"),this.externalForceTension.addChangeListener(e=>this.onfigurechange(this.externalForceTension.getValueIsAdjusting(),null,null,this.indentationSlider.getValue())),t.add(this.externalForceTension,new GBC(1,0).a(GBC.SOUTH)),this.shadowShiftX.setLabel(Z4Translations.DELTA_X),this.shadowShiftX.cssAddClass("z4abstractvaluepanel-titled"),this.shadowShiftX.addChangeListener(e=>this.onfigurechange(this.shadowShiftX.getValueIsAdjusting(),null,null,this.indentationSlider.getValue())),this.shadowShiftY.setLabel(Z4Translations.DELTA_Y),this.shadowShiftY.cssAddClass("z4abstractvaluepanel-titled"),this.shadowShiftY.addChangeListener(e=>this.onfigurechange(this.shadowShiftY.getValueIsAdjusting(),null,null,this.indentationSlider.getValue())),this.shadowColorPanel.addChangeListener(e=>this.onfigurechange(!1,this.shadowColorPanel.getValue(),null,this.indentationSlider.getValue())),this.createPanel(e,Z4Translations.SHADOW,this.shadowShiftX,this.shadowShiftY,this.shadowColorPanel),this.borderSize.setSignsVisible(!1),this.borderSize.setLabel(Z4Translations.DIMENSION),this.borderSize.cssAddClass("z4abstractvaluepanel-titled"),this.borderSize.addChangeListener(e=>this.onfigurechange(this.borderSize.getValueIsAdjusting(),null,null,this.indentationSlider.getValue())),this.borderColorPanel.addChangeListener(e=>this.onfigurechange(!1,null,this.borderColorPanel.getValue(),this.indentationSlider.getValue())),this.createPanel(e,Z4Translations.BORDER,this.borderSize,null,this.borderColorPanel),this.setValue(new Z4NaturalFigurePainter(Z4NaturalFigurePainterType.TYPE_0,Z4NaturalFigurePainterControlPointClosure.CONTROL_POINT_CLOSURE_1,new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),50),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),45),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),45),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),45),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),45),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),25),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),25),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),25),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),25),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),0,new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Color(0,0,0,255),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Color(0,0,0,255)))}addRadio(e,t,i,s){let n=new JSRadioButton;n.cssAddClass("z4naturalfigurepainterpanel-radio"),n.setContentAreaFilled(!1),n.setToggle(),n.setIcon(new Z4EmptyImageProducer(e)),n.addActionListener(e=>this.onfigurechange(!1,null,null,this.indentationSlider.getValue())),s.add(n),i[e]=n,t.add(n,null)}createPoint(e,t,i,s,n,a){Z4UI.addLabel(e,s,new GBC(a,0).w(2).a(GBC.WEST)).getStyle().fontWeight="bold",t.getStyle().setProperty("grid-template-areas",'"p1 p1"\n"p3 p3"\n"p4 p4"\n"p5 p5"\n"p6 p6"'),t.setSignsVisible(!1),t.setConstantRange(0,360),t.setRandomRange(0,90),t.setLabel(Z4Translations.ANGLE+" (α"+n+")"),t.cssAddClass("z4abstractvaluepanel-titled"),t.getChilStyleByQuery("label:nth-child(1)").fontSize="smaller",t.addChangeListener(e=>this.onfigurechange(t.getValueIsAdjusting(),null,null,this.indentationSlider.getValue())),e.add(t,new GBC(a,1).i(0,0,0,1)),i.getStyle().setProperty("grid-template-areas",'"p1 p1"\n"p3 p3"\n"p4 p4"\n"p5 p5"\n"p6 p6"'),i.setSignsVisible(!1),i.setConstantRange(1,100),i.setLabel(Z4Translations.TENSION+" (τ"+n+")"),i.cssAddClass("z4abstractvaluepanel-titled"),i.getChilStyleByQuery("label:nth-child(1)").fontSize="smaller",i.addChangeListener(e=>this.onfigurechange(i.getValueIsAdjusting(),null,null,this.indentationSlider.getValue())),e.add(i,new GBC(a+1,1).i(0,0,0,1))}createPanel(e,t,i,s,n){let a=new JSPanel;a.setLayout(new GridBagLayout),e.addTab(t,a),a.add(i,new GBC(0,1).i(1,0,1,0)),s&&a.add(s,new GBC(0,2)),n.setLabel(Z4Translations.FILLING_COLOR),a.add(n,new GBC(0,3).f(GBC.HORIZONTAL))}onfigurechange(e,t,i,s){this.valueIsAdjusting=e,this.indentationSpinner.setValue(s),this.indentationSlider.setValue(s);let n=null;switch(""+Object.keys(this.radios).find((e,t,i)=>this.radios[e].isSelected())){case"TYPE_0":n=Z4NaturalFigurePainterType.TYPE_0;break;case"TYPE_1":n=Z4NaturalFigurePainterType.TYPE_1;break;case"TYPE_2":n=Z4NaturalFigurePainterType.TYPE_2;break;case"TYPE_3":n=Z4NaturalFigurePainterType.TYPE_3}let a=null;switch(""+Object.keys(this.radiosClosure).find((e,t,i)=>this.radiosClosure[e].isSelected())){case"CONTROL_POINT_CLOSURE_0":a=Z4NaturalFigurePainterControlPointClosure.CONTROL_POINT_CLOSURE_0;break;case"CONTROL_POINT_CLOSURE_1":a=Z4NaturalFigurePainterControlPointClosure.CONTROL_POINT_CLOSURE_1;break;case"CONTROL_POINT_CLOSURE_2":a=Z4NaturalFigurePainterControlPointClosure.CONTROL_POINT_CLOSURE_2}this.value=new Z4NaturalFigurePainter(n,a,this.size.getValue(),this.internalAngle1.getValue(),this.externalAngle1.getValue(),this.internalAngle2.getValue(),this.externalAngle2.getValue(),this.internalTension1.getValue(),this.externalTension1.getValue(),this.internalTension2.getValue(),this.externalTension2.getValue(),this.indentationSlider.getValue(),this.externalForceAngle.getValue(),this.externalForceTension.getValue(),this.shadowShiftX.getValue(),this.shadowShiftY.getValue(),t||this.value.getShadowColor(),this.borderSize.getValue(),i||this.value.getBorderColor()),this.onchange()}setValue(e){this.value=e,this.radios[""+e.getNaturalFigurePainterType()].setSelected(!0),this.radiosClosure[""+e.getControlPointClosure()].setSelected(!0),this.size.setValue(this.value.getSize()),this.internalAngle1.setValue(this.value.getInternalAngle1()),this.externalAngle1.setValue(this.value.getExternalAngle1()),this.internalAngle2.setValue(this.value.getInternalAngle2()),this.externalAngle2.setValue(this.value.getExternalAngle2()),this.internalTension1.setValue(this.value.getInternalTension1()),this.externalTension1.setValue(this.value.getExternalTension1()),this.internalTension2.setValue(this.value.getInternalTension2()),this.externalTension2.setValue(this.value.getExternalTension2()),this.externalForceAngle.setValue(this.value.getExternalForceAngle()),this.externalForceTension.setValue(this.value.getExternalForceTension()),this.indentationSpinner.setValue(this.value.getIndentation()),this.indentationSlider.setValue(this.value.getIndentation()),this.shadowShiftX.setValue(this.value.getShadowShiftX()),this.shadowShiftY.setValue(this.value.getShadowShiftY()),this.shadowColorPanel.setValue(this.value.getShadowColor()),this.borderSize.setValue(this.value.getBorderSize()),this.borderColorPanel.setValue(this.value.getBorderColor())}setEnabled(e){super.setEnabled(e),Object.keys(this.radios).forEach(t=>this.radios[t].setEnabled(e)),Object.keys(this.radiosClosure).forEach(t=>this.radiosClosure[t].setEnabled(e)),this.size.setEnabled(e),this.internalAngle1.setEnabled(e),this.externalAngle1.setEnabled(e),this.internalAngle2.setEnabled(e),this.externalAngle2.setEnabled(e),this.internalTension1.setEnabled(e),this.externalTension1.setEnabled(e),this.internalTension2.setEnabled(e),this.externalTension2.setEnabled(e),this.externalForceAngle.setEnabled(e),this.externalForceTension.setEnabled(e),this.indentationSpinner.setEnabled(e),this.indentationSlider.setEnabled(e),this.shadowShiftX.setEnabled(e),this.shadowShiftY.setEnabled(e),this.shadowColorPanel.setEnabled(e),this.borderSize.setEnabled(e),this.borderColorPanel.setEnabled(e)}}class Z4PatternPainterPanel extends Z4PainterPanel{panel=new JSComponent(document.createElement("div"));checkBoxs=[];open=new JSButton;delete=new JSButton;randomSequence=new JSCheckBox;multiSize=new JSCheckBox;checkBoxDnD=null;constructor(){super(),this.cssAddClass("z4patternpainterpanel"),Z4UI.addLabel(this,Z4Translations.PATTERNS,new GBC(0,0).w(3).a(GBC.WEST));let e=new JSComponent(document.createElement("div"));e.getStyle().width="400px",e.getStyle().height="200px",e.getStyle().border="2px solid var(--main-action-bgcolor)",e.getStyle().borderRadius="var(--roundness)",e.getStyle().overflowY="auto",this.panel.getStyle().display="flex",this.panel.getStyle().flexFlow="row wrap",this.panel.getStyle().setProperty("gap","10px"),this.panel.addEventListener("dragenter",e=>e.preventDefault()),this.panel.addEventListener("dragover",e=>{e.preventDefault();let t=e,i=this.checkBoxs.findIndex(e=>{let i=e.invoke("getBoundingClientRect()");return t.clientX<i.left+i.width&&t.clientY<i.top+i.height});this.checkBoxs.forEach((e,t,s)=>{e.getStyle().backgroundColor=i===t?"var(--main-action-bgcolor)":"transparent",e.getStyle().borderRadius="var(--roundness)"})}),this.panel.addEventListener("dragleave",e=>{e.preventDefault(),this.checkBoxs.forEach((e,t,i)=>{e.getStyle().removeProperty("backgroundColor"),e.getStyle().removeProperty("borderRadius")})}),this.panel.addEventListener("drop",e=>{e.preventDefault(),this.checkBoxs.forEach((e,t,i)=>{e.getStyle().removeProperty("backgroundColor"),e.getStyle().removeProperty("borderRadius")});let t=e,i=this.checkBoxs.findIndex(e=>{let i=e.invoke("getBoundingClientRect()");return t.clientX<i.left+i.width&&t.clientY<i.top+i.height});this.moveCheckBox(i)}),e.appendChild(this.panel),this.add(e,new GBC(0,1).w(3)),this.open.setText(Z4Translations.OPEN),this.open.addActionListener(e=>this.selectPattern()),this.add(this.open,new GBC(1,2).h(2).a(GBC.NORTH).i(1,0,0,1)),this.delete.setText(Z4Translations.DELETE),this.delete.setEnabled(!1),this.delete.addActionListener(e=>JSOptionPane.showConfirmDialog(Z4Translations.DELETE_PATTERNS_MESSAGE,Z4Translations.DELETE,JSOptionPane.YES_NO_OPTION,JSOptionPane.QUESTION_MESSAGE,e=>{e===JSOptionPane.YES_OPTION&&this.onpatternDelete()})),this.add(this.delete,new GBC(2,2).h(2).a(GBC.NORTH).i(1,0,0,0)),this.randomSequence.setText(Z4Translations.RANDOM_SEQUENCE),this.randomSequence.addActionListener(e=>this.onpatternchange(!1,this.value.getPatterns())),this.add(this.randomSequence,new GBC(0,2).wx(1).a(GBC.WEST)),this.multiSize.setText(Z4Translations.MULTI_DIMENSION),this.multiSize.addActionListener(e=>this.onpatternchange(!1,this.value.getPatterns())),this.add(this.multiSize,new GBC(0,3).a(GBC.WEST)),this.setValue(new Z4PatternPainter([],!1,!1))}selectPattern(){if("function"==typeof window.showOpenFilePicker){let e=new FilePickerOptions;e.excludeAcceptAllOption=!0,e.id=Z4Constants.TEXTURE_FILE_ID,e.multiple=!0,e.types=Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_TYPE,JSFilePicker.showOpenFilePicker(e,0,e=>e.forEach(e=>e.getFile().then(e=>{this.openTexture(e)})))}else JSFileChooser.showOpenDialog(""+Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_FORMAT.join(","),JSFileChooser.SINGLE_SELECTION,0,e=>e.forEach(e=>this.openTexture(e)))}openTexture(e){let t=new FileReader;t.onload=e=>{let i=this.createCheckBox(t.result);this.checkBoxs.push(i),this.panel.appendChild(i);let s=new Image;return s.onload=e=>(i.setTooltip(s.width+"x"+s.height),this.onpatternAdd(s),null),s.src=t.result,null},t.readAsDataURL(e)}onpatternAdd(e){let t=this.value.getPatterns().slice();t.push(e),this.onpatternchange(!1,t)}onpatternDelete(){this.delete.setEnabled(!1);let e=this.value.getPatterns().filter((e,t,i)=>!this.checkBoxs[t].isSelected());this.checkBoxs=this.checkBoxs.filter(e=>!e.isSelected()),this.panel.clearContent(),this.checkBoxs.forEach(e=>this.panel.appendChild(e)),this.onpatternchange(!1,e)}onpatternchange(e,t){this.valueIsAdjusting=e,this.value=new Z4PatternPainter(t,this.randomSequence.isSelected(),this.multiSize.isSelected()),this.onchange()}moveCheckBox(e){let t=Math.min(this.checkBoxs.length,e),i=this.checkBoxs.indexOf(this.checkBoxDnD);if(t<i){let s=this.value.getPatterns().slice();s.splice(t,0,s.splice(i,1)[0]),this.onpatternchange(!1,s),this.setValue(this.value)}else if(t>i){let n=this.value.getPatterns().slice();n.splice(t,0,n[i]),n.splice(i,1),this.onpatternchange(!1,n),this.setValue(this.value)}}setValue(e){this.value=e,this.panel.clearContent(),this.checkBoxs.length=0,this.value.getPatterns().forEach(e=>{let t=this.createCheckBox(e.src);t.setTooltip(e.width+"x"+e.height),this.checkBoxs.push(t),this.panel.appendChild(t)}),this.delete.setEnabled(!1),this.randomSequence.setSelected(this.value.isRandomSequence()),this.multiSize.setSelected(this.value.isMultiSize())}createCheckBox(e){let t=new JSCheckBox;return t.setIcon(new DefaultHTMLImageProducer("",e)),t.getStyle().flexDirection="row-reverse",t.getStyle().marginLeft="5px",t.getChilStyleByQuery("img").width="30px",t.addActionListener(e=>this.delete.setEnabled(!!this.checkBoxs.filter(e=>e.isSelected()).length)),t.setAttribute("draggable","true"),t.addEventListener("dragstart",e=>{e.dataTransfer.effectAllowed="move",this.checkBoxDnD=t}),t}setEnabled(e){super.setEnabled(e),this.checkBoxs.forEach(t=>t.setEnabled(e)),this.open.setEnabled(e),this.delete.setEnabled(e&&this.checkBoxs.filter(e=>e.isSelected()).length),this.randomSequence.setEnabled(e),this.multiSize.setEnabled(e)}}class Z4Shape2DPainterPanel extends Z4PainterPanel{width=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.HORIZONTAL);height=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.HORIZONTAL);regular=new JSCheckBox;star=new JSCheckBox;vertexCounter=new JSSlider;shadowShiftX=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.HORIZONTAL);shadowShiftY=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.HORIZONTAL);shadowColorPanel=new Z4ColorPanel;borderWidth=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.HORIZONTAL);borderHeight=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.HORIZONTAL);borderColorPanel=new Z4ColorPanel;constructor(){super(),this.cssAddClass("z4shape2dpainterpanel");let e=new JSTabbedPane;this.add(e,new GBC(0,0));let t=new JSPanel;t.setLayout(new GridBagLayout),e.addTab(Z4Translations.DIMENSION,t),this.width.setSignsVisible(!1),this.width.setConstantRange(1,50),this.width.setLabel(Z4Translations.WIDTH),this.width.cssAddClass("z4abstractvaluepanel-titled"),this.width.addChangeListener(e=>this.onshape2dchange(this.width.getValueIsAdjusting(),null,null)),t.add(this.width,new GBC(0,0).w(3).a(GBC.WEST).i(1,0,1,0)),this.height.setSignsVisible(!1),this.height.setConstantRange(1,50),this.height.setLabel(Z4Translations.HEIGHT),this.height.cssAddClass("z4abstractvaluepanel-titled"),this.height.addChangeListener(e=>this.onshape2dchange(this.height.getValueIsAdjusting(),null,null)),t.add(this.height,new GBC(0,1).w(3).a(GBC.WEST)),Z4UI.addLabel(t,Z4Translations.VERTICES,new GBC(0,2).wx(1).a(GBC.WEST)),this.regular.setText(Z4Translations.REGULAR),this.regular.addActionListener(e=>this.onshape2dchange(!1,null,null)),t.add(this.regular,new GBC(1,2).a(GBC.EAST).i(0,0,0,5)),this.star.setText(Z4Translations.STAR),this.star.addActionListener(e=>this.onshape2dchange(!1,null,null)),t.add(this.star,new GBC(2,2).a(GBC.EAST));let i=new DefaultSliderModelAndRenderer;for(let s=3;s<10;s++)i.addElement(""+s);i.addElement("∞"),this.vertexCounter.setModelAndRenderer(i),this.vertexCounter.addChangeListener(e=>this.onshape2dchange(!1,null,null)),t.add(this.vertexCounter,new GBC(0,3).w(3).f(GBC.HORIZONTAL)),this.vertexCounter.getChilStyleByQuery("datalist option:nth-child(8)").fontSize="larger",this.shadowShiftX.setLabel(Z4Translations.DELTA_X),this.shadowShiftX.cssAddClass("z4abstractvaluepanel-titled"),this.shadowShiftX.addChangeListener(e=>this.onshape2dchange(this.shadowShiftX.getValueIsAdjusting(),null,null)),this.shadowShiftY.setLabel(Z4Translations.DELTA_Y),this.shadowShiftY.cssAddClass("z4abstractvaluepanel-titled"),this.shadowShiftY.addChangeListener(e=>this.onshape2dchange(this.shadowShiftY.getValueIsAdjusting(),null,null)),this.shadowColorPanel.addChangeListener(e=>this.onshape2dchange(!1,this.shadowColorPanel.getValue(),null)),this.createPanel(e,Z4Translations.SHADOW,this.shadowShiftX,this.shadowShiftY,this.shadowColorPanel),this.borderWidth.setSignsVisible(!1),this.borderWidth.setLabel(Z4Translations.WIDTH),this.borderWidth.cssAddClass("z4abstractvaluepanel-titled"),this.borderWidth.addChangeListener(e=>this.onshape2dchange(this.borderWidth.getValueIsAdjusting(),null,null)),this.borderHeight.setSignsVisible(!1),this.borderHeight.setLabel(Z4Translations.HEIGHT),this.borderHeight.cssAddClass("z4abstractvaluepanel-titled"),this.borderHeight.addChangeListener(e=>this.onshape2dchange(this.borderHeight.getValueIsAdjusting(),null,null)),this.borderColorPanel.addChangeListener(e=>this.onshape2dchange(!1,null,this.borderColorPanel.getValue())),this.createPanel(e,Z4Translations.BORDER,this.borderWidth,this.borderHeight,this.borderColorPanel),this.setValue(new Z4Shape2DPainter(new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),10),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),10),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),!1,!1,-1,new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Color(0,0,0,255),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Color(0,0,0,255)))}createPanel(e,t,i,s,n){let a=new JSPanel;a.setLayout(new GridBagLayout),e.addTab(t,a),a.add(i,new GBC(0,1).i(1,0,1,0)),a.add(s,new GBC(0,2)),n.setLabel(Z4Translations.FILLING_COLOR),a.add(n,new GBC(0,3).f(GBC.HORIZONTAL))}onshape2dchange(e,t,i){this.valueIsAdjusting=e;let s=this.vertexCounter.getValue();this.height.setEnabled(this.enabled&&!this.regular.isSelected()),this.star.setEnabled(this.enabled&&7!==s),this.value=new Z4Shape2DPainter(this.width.getValue(),this.height.getValue(),this.regular.isSelected(),this.star.isSelected(),7===s?-1:s+3,this.shadowShiftX.getValue(),this.shadowShiftY.getValue(),t||this.value.getShadowColor(),this.borderWidth.getValue(),this.borderHeight.getValue(),i||this.value.getBorderColor()),this.onchange()}setValue(e){this.value=e;let t=this.value.getVertices();this.width.setValue(this.value.getWidth()),this.height.setValue(this.value.getHeight()),this.height.setEnabled(this.enabled&&!this.value.isRegular()),this.regular.setSelected(this.value.isRegular()),this.star.setSelected(this.value.isStar()),this.star.setEnabled(this.enabled&&-1!==t),this.vertexCounter.setValue(-1===t?7:t-3),this.shadowShiftX.setValue(this.value.getShadowShiftX()),this.shadowShiftY.setValue(this.value.getShadowShiftY()),this.shadowColorPanel.setValue(this.value.getShadowColor()),this.borderWidth.setValue(this.value.getBorderWidth()),this.borderHeight.setValue(this.value.getBorderHeight()),this.borderColorPanel.setValue(this.value.getBorderColor())}setEnabled(e){super.setEnabled(e),this.width.setEnabled(e),this.height.setEnabled(e&&!this.regular.isSelected()),this.regular.setEnabled(e),this.star.setEnabled(e&&7!==this.vertexCounter.getValue()),this.vertexCounter.setEnabled(e),this.shadowShiftX.setEnabled(e),this.shadowShiftY.setEnabled(e),this.shadowColorPanel.setEnabled(e),this.borderWidth.setEnabled(e),this.borderHeight.setEnabled(e),this.borderColorPanel.setEnabled(e)}}class Z4DrawingToolPanel extends Z4AbstractValuePanel{name=new JSTextField;selectedPointInterator=new JSButton;selectedPainter=new JSButton;selectedSpatioTemporalColor=new JSButton;selectedColorProgression=new JSButton;pane=new JSTabbedPane;transparent1=new JSButton;swatchesPanel1=new JSColorMiniSwatchesPanel;preview1=new JSComponent(document.createElement("canvas"));ctx1=this.preview1.invoke("getContext('2d')");transparent2=new JSButton;swatchesPanel2=new JSColorMiniSwatchesPanel;preview2=new JSComponent(document.createElement("canvas"));ctx2=this.preview2.invoke("getContext('2d')");transparentTryMe=new JSButton;swatchesPanelTryMe=new JSColorMiniSwatchesPanel;previewTryMe=new JSComponent(document.createElement("canvas"));ctxTryMe=this.previewTryMe.invoke("getContext('2d')");radios=[];cardPanel=new JSPanel;cardLayout=new CardLayout(0,0);cardPanels=[];actions=new JSPanel;selectedPointInteratorCard=null;selectedPainterCard=null;selectedSpatioTemporalColorCard=null;valueIsAdjusting=!1;previewColor=null;widthTryMe=700;heightTryMe=600;offscreenObjects=new OffscreenCanvas(this.widthTryMe,this.heightTryMe);offscreenCtxObjects=this.offscreenObjects.getContext("2d");offscreenBounds=new OffscreenCanvas(this.widthTryMe,this.heightTryMe);offscreenCtxBounds=this.offscreenBounds.getContext("2d");pressedTryMe=!1;tabbedPaneID="z4drawingtoolpanel_"+new Date().getTime()+"_"+parseInt(1e3*Math.random());currentTimeoutID=0;constructor(){super(),this.setLayout(new GridBagLayout),this.cssAddClass("z4drawingtoolpanel"),Z4UI.addLabel(this,Z4Translations.DRAWING_TOOL_NAME,new GBC(0,0).w(2).a(GBC.WEST)),this.name.addActionListener(e=>{this.createValue(),this.onchange()}),this.add(this.name,new GBC(0,1).wx(1).f(GBC.HORIZONTAL).i(0,0,5,0));let e=new JSPanel;e.setLayout(new BoxLayout(e,BoxLayout.X_AXIS)),this.setSelectedButton(this.selectedPointInterator),this.selectedPointInterator.addActionListener(e=>this.selectCard(this.selectedPointInteratorCard)),e.add(this.selectedPointInterator,null),this.setSelectedButton(this.selectedPainter),this.selectedPainter.addActionListener(e=>this.selectCard(this.selectedPainterCard)),e.add(this.selectedPainter,null),this.setSelectedButton(this.selectedSpatioTemporalColor),e.add(this.selectedSpatioTemporalColor,null),this.selectedSpatioTemporalColor.addActionListener(e=>this.selectCard(this.selectedSpatioTemporalColorCard)),this.setSelectedButton(this.selectedColorProgression),e.add(this.selectedColorProgression,null),this.selectedColorProgression.addActionListener(e=>this.selectCard("COLOR-PROGRESSION")),this.add(e,new GBC(1,0).h(2).a(GBC.SOUTH).i(0,0,5,0)),this.pane.setID(this.tabbedPaneID),this.pane.setTabPlacement(JSTabbedPane.LEFT),this.add(this.pane,new GBC(0,2).w(2).wxy(1,1).f(GBC.BOTH));let t=new JSPanel;t.setLayout(new GridBagLayout),this.pane.addTab(Z4Translations.SETTINGS,t);let i=new JSPanel;i.setLayout(new GridBagLayout),this.cardPanel.setLayout(this.cardLayout),t.add(this.cardPanel,new GBC(0,0).a(GBC.NORTH).h(2).wxy(1,1));let s=new ButtonGroup,n=new JSPanel;n.setLayout(new BoxLayout(n,BoxLayout.Y_AXIS)),i.add(n,new GBC(0,0).a(GBC.NORTH).i(150,0,0,15)),this.addRadioButton(n,s,"STAMPER"),this.addRadioButton(n,s,"TRACER"),this.addRadioButton(n,s,"AIRBRUSH"),this.addRadioButton(n,s,"SPIROGRAPH"),this.addRadioButton(n,s,"SCATTERER"),(n=new JSPanel).setLayout(new BoxLayout(n,BoxLayout.Y_AXIS)),i.add(n,new GBC(1,0).a(GBC.NORTH).i(150,0,0,15)),this.addRadioButton(n,s,"SHAPE2D"),this.addRadioButton(n,s,"DROP"),this.addRadioButton(n,s,"BRUSH"),this.addRadioButton(n,s,"PATTERN"),this.addRadioButton(n,s,"CENTERED-FIGURE"),this.addRadioButton(n,s,"NATURAL-FIGURE"),(n=new JSPanel).setLayout(new BoxLayout(n,BoxLayout.Y_AXIS)),i.add(n,new GBC(2,0).a(GBC.NORTH).i(150,0,0,5)),this.addRadioButton(n,s,"COLOR"),this.addRadioButton(n,s,"GRADIENT-COLOR"),this.addRadioButton(n,s,"BIGRADIENT-COLOR"),n.add(this.getHLine(),null),this.addRadioButton(n,s,"COLOR-PROGRESSION"),this.addPreview(t,0,2,this.transparent1,this.swatchesPanel1,this.preview1,500,300,new GBC(0,3),!1),this.addPreview(t,1,0,this.transparent2,this.swatchesPanel2,this.preview2,300,500,new GBC(1,1).a(GBC.NORTH).i(0,5,0,0),!0),(t=new JSPanel).setLayout(new GridBagLayout),this.pane.addTab(Z4Translations.TRY_ME,t),this.addTryMe(t),this.actions.setLayout(new GridBagLayout),this.pane.addTab(Z4Translations.ACTIONS,this.actions),this.pane.appendChildInTree(".west ul",i),this.setValue(new Z4DrawingTool(Z4Translations.DRAWING_TOOL,new Z4Stamper(new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),1),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4Rotation(0,new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),Z4RotationBehavior.FIXED,!1)),new Z4Shape2DPainter(new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),10),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),10),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),!1,!1,-1,new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Color(0,0,0,0),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.POSITIVE),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),new Color(0,0,0,0)),Z4SpatioTemporalColor.fromColor(new Color(0,0,0,255)),new Z4ColorProgression(Z4ColorProgressionBehavior.SPATIAL,0,!1,Z4Lighting.NONE)))}setSelectedButton(e){e.setContentAreaFilled(!1),e.getStyle().minHeight="43px",e.getStyle().marginLeft="1px",e.cssAddClass("z4drawingtoolpanel-selected"),e.setIcon(new Z4EmptyImageProducer(""))}addRadioButton(e,t,i){let s=new JSRadioButton;s.setContentAreaFilled(!1),s.getStyle().marginBottom="1px",s.getStyle().minHeight="25px",s.setToggle(),s.cssAddClass("z4drawingtoolpanel-selector"),s.cssAddClass("z4drawingtoolpanel-selector-"+i.toLowerCase()),s.setIcon(new Z4EmptyImageProducer(i)),s.addActionListener(e=>this.selectCard(i)),this.radios[i]=s,t.add(s),e.add(s,null)}selectCard(e){switch(document.querySelector("#"+this.tabbedPaneID+" > .west > ul > li:nth-child(2) input").click(),e){case"STAMPER":case"TRACER":case"AIRBRUSH":case"SPIROGRAPH":case"SCATTERER":["z4drawingtoolpanel-stamper-selected","z4drawingtoolpanel-tracer-selected","z4drawingtoolpanel-airbrush-selected","z4drawingtoolpanel-spirograph-selected","z4drawingtoolpanel-scatterer-selected"].forEach(e=>this.selectedPointInterator.cssRemoveClass(e)),this.selectedPointInteratorCard=this.check(this.selectedPointInterator,e,e.toLowerCase(),null,!0);break;case"SHAPE2D":case"DROP":case"BRUSH":case"PATTERN":case"CENTERED-FIGURE":case"NATURAL-FIGURE":["z4drawingtoolpanel-shape2d-selected","z4drawingtoolpanel-drop-selected","z4drawingtoolpanel-brush-selected","z4drawingtoolpanel-pattern-selected","z4drawingtoolpanel-centered-figure-selected","z4drawingtoolpanel-natural-figure-selected"].forEach(e=>this.selectedPainter.cssRemoveClass(e)),this.selectedPainterCard=this.check(this.selectedPainter,e,e.toLowerCase(),null,!0);break;case"COLOR":case"GRADIENT-COLOR":case"BIGRADIENT-COLOR":["z4drawingtoolpanel-color-selected","z4drawingtoolpanel-gradient-color-selected","z4drawingtoolpanel-bigradient-color-selected"].forEach(e=>this.selectedSpatioTemporalColor.cssRemoveClass(e)),this.selectedSpatioTemporalColorCard=this.check(this.selectedSpatioTemporalColor,e,e.toLowerCase(),null,!0);break;case"COLOR-PROGRESSION":this.check(this.selectedColorProgression,"COLOR-PROGRESSION",null,null,!0)}this.transparent1.getStyle().display="BIGRADIENT-COLOR"===e?"none":"flex",this.swatchesPanel1.getStyle().display="BIGRADIENT-COLOR"===e?"none":"flex",this.preview1.getStyle().display="BIGRADIENT-COLOR"===e?"none":"flex",this.transparent2.getStyle().display="BIGRADIENT-COLOR"===e?"flex":"none",this.swatchesPanel2.getStyle().display="BIGRADIENT-COLOR"===e?"flex":"none",this.preview2.getStyle().display="BIGRADIENT-COLOR"===e?"flex":"none",this.valueIsAdjusting=!1,this.createValue(),this.drawPreview(),this.onchange()}getHLine(){let e=new JSComponent(document.createElement("div"));return e.getStyle().height="1px",e.getStyle().width="100%",e.getStyle().margin="21px 1px 22px 1px",e.getStyle().background="var(--main-action-bgcolor)",e}addPreview(e,t,i,s,n,a,r,o,l,h){let d=new JSPanel;e.add(d,new GBC(t,i)),s.addActionListener(e=>{this.previewColor=null,this.drawPreview()}),s.cssAddClass("z4drawingtoolpanel-transparent"),d.add(s,null),n.addActionListener(e=>{this.previewColor=n.getSelectedColor(),this.drawPreview()}),d.add(n,null),a.setProperty("width",""+r),a.setProperty("height",""+o),a.cssAddClass("z4drawingtoolpanel-preview"),e.add(a,l),h&&(s.getStyle().display="none",n.getStyle().display="none",a.getStyle().display="none")}addTryMe(e){let t=new JSPanel;e.add(t,new GBC(0,0)),this.transparentTryMe.addActionListener(e=>{this.ctxTryMe.clearRect(0,0,this.widthTryMe,this.heightTryMe),this.offscreenCtxObjects.clearRect(0,0,this.widthTryMe,this.heightTryMe),this.offscreenCtxBounds.clearRect(0,0,this.widthTryMe,this.heightTryMe)}),this.transparentTryMe.cssAddClass("z4drawingtoolpanel-transparent"),t.add(this.transparentTryMe,null),this.swatchesPanelTryMe.addActionListener(e=>{this.ctxTryMe.clearRect(0,0,this.widthTryMe,this.heightTryMe),this.offscreenCtxObjects.clearRect(0,0,this.widthTryMe,this.heightTryMe),this.offscreenCtxBounds.clearRect(0,0,this.widthTryMe,this.heightTryMe),this.ctxTryMe.fillStyle=Z4Constants.getStyle(this.swatchesPanelTryMe.getSelectedColor().getRGBA_HEX()),this.ctxTryMe.fillRect(0,0,this.widthTryMe,this.heightTryMe),this.offscreenCtxObjects.fillStyle=Z4Constants.getStyle(this.swatchesPanelTryMe.getSelectedColor().getRGBA_HEX()),this.offscreenCtxObjects.fillRect(0,0,this.widthTryMe,this.heightTryMe)}),t.add(this.swatchesPanelTryMe,null),this.previewTryMe.setProperty("width",""+this.widthTryMe),this.previewTryMe.setProperty("height",""+this.heightTryMe),this.previewTryMe.cssAddClass("z4drawingtoolpanel-preview"),this.previewTryMe.addEventListener("mouseenter",e=>this.onMouse(e,"enter")),this.previewTryMe.addEventListener("mouseleave",e=>this.onMouse(e,"leave")),this.previewTryMe.addEventListener("mousedown",e=>this.onMouse(e,"down")),this.previewTryMe.addEventListener("mousemove",e=>this.onMouse(e,"move")),this.previewTryMe.addEventListener("mouseup",e=>this.onMouse(e,"up")),e.add(this.previewTryMe,new GBC(0,1).wxy(1,1).a(GBC.NORTH))}onMouse(e,t){let i=Math.min(this.widthTryMe,Math.max(0,e.offsetX)),s=Math.min(this.heightTryMe,Math.max(0,e.offsetY));switch(t){case"enter":this.pressedTryMe=1===e.buttons,this.onAction(Z4PointIteratorDrawingAction.START,i,s),this.onAction(Z4PointIteratorDrawingAction.CONTINUE,i,s);break;case"down":this.pressedTryMe=!0,this.onAction(Z4PointIteratorDrawingAction.START,i,s);break;case"move":this.onAction(Z4PointIteratorDrawingAction.CONTINUE,i,s);break;case"up":this.onStop(i,s);break;case"leave":this.pressedTryMe&&this.onStop(i,s)}}onAction(e,t,i){this.pressedTryMe&&this.value.drawAction(e,t,i)&&this.iteratePoints(e)}onStop(e,t){this.pressedTryMe=!1,this.value.drawAction(Z4PointIteratorDrawingAction.STOP,e,t)&&this.iteratePoints(Z4PointIteratorDrawingAction.STOP)}iteratePoints(e){if(e!==Z4PointIteratorDrawingAction.STOP){for(;this.drawNextPoint(););this.value.isInfinitePointGenerator()&&this.pressedTryMe&&setTimeout(()=>this.iteratePoints(e),this.value.getInfinitePointGeneratorSleep())}else this.value.getNextCountOnSTOP()&&(this.ctxTryMe.clearRect(0,0,this.widthTryMe,this.heightTryMe),this.offscreenCtxBounds.clearRect(0,0,this.widthTryMe,this.heightTryMe),this.ctxTryMe.drawImage(this.offscreenObjects,0,0),Z4UI.pleaseWait(this.previewTryMe,!0,!0,!1,!0,"",()=>this.iteratePoint(0)))}iteratePoint(e){Z4UI.setPleaseWaitProgressBarValue(100*e/this.value.getNextCountOnSTOP()),this.drawNextPoint()?Z4UI.pleaseWaitAdvanced(()=>this.iteratePoint(e+1)):Z4UI.pleaseWaitCompleted()}drawNextPoint(){let e=this.value.next();return!!e&&(e.intent===Z4DrawingPointIntent.DRAW_OBJECTS?(this.offscreenCtxObjects.save(),this.offscreenCtxObjects.translate(e.z4Vector.x0,e.z4Vector.y0),this.offscreenCtxObjects.rotate(e.z4Vector.phase),this.value.draw(this.offscreenCtxObjects,e),this.offscreenCtxObjects.restore(),this.ctxTryMe.drawImage(this.offscreenObjects,0,0),!0):(e.intent===Z4DrawingPointIntent.REPLACE_PREVIOUS_BOUNDS&&this.offscreenCtxBounds.clearRect(0,0,this.widthTryMe,this.heightTryMe),this.offscreenCtxBounds.save(),this.offscreenCtxBounds.translate(e.z4Vector.x0,e.z4Vector.y0),this.offscreenCtxBounds.rotate(e.z4Vector.phase),this.value.draw(this.offscreenCtxBounds,e),this.offscreenCtxBounds.restore(),this.ctxTryMe.drawImage(this.offscreenObjects,0,0),this.ctxTryMe.drawImage(this.offscreenBounds,0,0),!0))}addAction(e,t,i){let s=new JSButton;s.setText(e),s.addActionListener(i),this.actions.add(s,t)}getValueIsAdjusting(){return this.valueIsAdjusting}setValue(e){this.value=e,this.name.setText(e.getName()),this.setPointInterator(),this.setPainter(),this.setSpatioTemporalColor(),this.setColorProgression(),this.setColorProgressionSettings(),this.drawPreview()}setPointInterator(){["z4drawingtoolpanel-stamper-selected","z4drawingtoolpanel-tracer-selected","z4drawingtoolpanel-airbrush-selected","z4drawingtoolpanel-spirograph-selected","z4drawingtoolpanel-scatterer-selected"].forEach(e=>this.selectedPointInterator.cssRemoveClass(e)),this.value.getPointIterator().getType()===Z4PointIteratorType.STAMPER?this.selectedPointInteratorCard=this.check(this.selectedPointInterator,"STAMPER","stamper",this.value.getPointIterator(),!0):this.value.getPointIterator().getType()===Z4PointIteratorType.TRACER?this.selectedPointInteratorCard=this.check(this.selectedPointInterator,"TRACER","tracer",this.value.getPointIterator(),!0):this.value.getPointIterator().getType()===Z4PointIteratorType.AIRBRUSH?this.selectedPointInteratorCard=this.check(this.selectedPointInterator,"AIRBRUSH","airbrush",this.value.getPointIterator(),!0):this.value.getPointIterator().getType()===Z4PointIteratorType.SPIROGRAPH?this.selectedPointInteratorCard=this.check(this.selectedPointInterator,"SPIROGRAPH","spirograph",this.value.getPointIterator(),!0):this.value.getPointIterator().getType()===Z4PointIteratorType.SCATTERER&&(this.selectedPointInteratorCard=this.check(this.selectedPointInterator,"SCATTERER","scatterer",this.value.getPointIterator(),!0))}setPainter(){["z4drawingtoolpanel-shape2d-selected","z4drawingtoolpanel-drop-selected","z4drawingtoolpanel-brush-selected","z4drawingtoolpanel-pattern-selected","z4drawingtoolpanel-centered-figure-selected","z4drawingtoolpanel-natural-figure-selected"].forEach(e=>this.selectedPainter.cssRemoveClass(e)),this.value.getPainter().getType()===Z4PainterType.SHAPE_2D?this.selectedPainterCard=this.check(this.selectedPainter,"SHAPE2D","shape2d",this.value.getPainter(),!1):this.value.getPainter().getType()===Z4PainterType.DROP?this.selectedPainterCard=this.check(this.selectedPainter,"DROP","drop",this.value.getPainter(),!1):this.value.getPainter().getType()===Z4PainterType.BRUSH?this.selectedPainterCard=this.check(this.selectedPainter,"BRUSH","brush",this.value.getPainter(),!1):this.value.getPainter().getType()===Z4PainterType.PATTERN?this.selectedPainterCard=this.check(this.selectedPainter,"PATTERN","pattern",this.value.getPainter(),!1):this.value.getPainter().getType()===Z4PainterType.CENTERED_FIGURE?this.selectedPainterCard=this.check(this.selectedPainter,"CENTERED-FIGURE","centered-figure",this.value.getPainter(),!1):this.value.getPainter().getType()===Z4PainterType.NATURAL_FIGURE&&(this.selectedPainterCard=this.check(this.selectedPainter,"NATURAL-FIGURE","natural-figure",this.value.getPainter(),!1))}setSpatioTemporalColor(){["z4drawingtoolpanel-color-selected","z4drawingtoolpanel-gradient-color-selected","z4drawingtoolpanel-bigradient-color-selected"].forEach(e=>this.selectedSpatioTemporalColor.cssRemoveClass(e)),this.value.getSpatioTemporalColor().isColor()?this.selectedSpatioTemporalColorCard=this.check(this.selectedSpatioTemporalColor,"COLOR","color",this.value.getSpatioTemporalColor().getColor(),!1):this.value.getSpatioTemporalColor().isGradientColor()?this.selectedSpatioTemporalColorCard=this.check(this.selectedSpatioTemporalColor,"GRADIENT-COLOR","gradient-color",this.value.getSpatioTemporalColor().getGradientColor(),!1):this.value.getSpatioTemporalColor().isBiGradientColor()&&(this.selectedSpatioTemporalColorCard=this.check(this.selectedSpatioTemporalColor,"BIGRADIENT-COLOR","bigradient-color",this.value.getSpatioTemporalColor().getBiGradientColor(),!1))}setColorProgression(){["z4drawingtoolpanel-spatial-selected","z4drawingtoolpanel-temporal-selected","z4drawingtoolpanel-relativetopath-selected","z4drawingtoolpanel-random-selected","z4drawingtoolpanel-airbrush-spatial-selected","z4drawingtoolpanel-airbrush-temporal-selected","z4drawingtoolpanel-airbrush-relativetopath-selected","z4drawingtoolpanel-airbrush-random-selected"].forEach(e=>this.selectedColorProgression.cssRemoveClass(e));let e=(this.value.getPointIterator().getType()===Z4PointIteratorType.AIRBRUSH?"airbrush-":"")+(""+this.value.getProgression().getColorProgressionBehavior()).toLowerCase().replaceAll("_","");this.check(this.selectedColorProgression,"COLOR-PROGRESSION",e,this.value.getProgression(),!1)}check(e,t,i,s,n){if(i&&e.cssAddClass("z4drawingtoolpanel-"+i+"-selected"),!this.cardPanels[t]){switch(t){case"STAMPER":this.cardPanels[t]=new Z4StamperPanel,this.cardPanels[t].addChangeListener(e=>this.valueIsAdjusting=this.cardPanels[t].getValueIsAdjusting());break;case"TRACER":this.cardPanels[t]=new Z4TracerPanel,this.cardPanels[t].addChangeListener(e=>this.valueIsAdjusting=this.cardPanels[t].getValueIsAdjusting());break;case"AIRBRUSH":this.cardPanels[t]=new Z4AirbrushPanel,this.cardPanels[t].addChangeListener(e=>this.valueIsAdjusting=this.cardPanels[t].getValueIsAdjusting());break;case"SPIROGRAPH":this.cardPanels[t]=new Z4SpirographPanel,this.cardPanels[t].addChangeListener(e=>this.valueIsAdjusting=this.cardPanels[t].getValueIsAdjusting());break;case"SCATTERER":this.cardPanels[t]=new Z4ScattererPanel,this.cardPanels[t].addChangeListener(e=>this.valueIsAdjusting=this.cardPanels[t].getValueIsAdjusting());break;case"SHAPE2D":this.cardPanels[t]=new Z4Shape2DPainterPanel,this.cardPanels[t].addChangeListener(e=>this.valueIsAdjusting=this.cardPanels[t].getValueIsAdjusting());break;case"DROP":this.cardPanels[t]=new Z4DropPainterPanel,this.cardPanels[t].addChangeListener(e=>this.valueIsAdjusting=this.cardPanels[t].getValueIsAdjusting());break;case"BRUSH":this.cardPanels[t]=new Z4BrushPainterPanel,this.cardPanels[t].addChangeListener(e=>this.valueIsAdjusting=this.cardPanels[t].getValueIsAdjusting());break;case"PATTERN":this.cardPanels[t]=new Z4PatternPainterPanel,this.cardPanels[t].addChangeListener(e=>this.valueIsAdjusting=this.cardPanels[t].getValueIsAdjusting());break;case"CENTERED-FIGURE":this.cardPanels[t]=new Z4CenteredFigurePainterPanel,this.cardPanels[t].addChangeListener(e=>this.valueIsAdjusting=this.cardPanels[t].getValueIsAdjusting());break;case"NATURAL-FIGURE":this.cardPanels[t]=new Z4NaturalFigurePainterPanel,this.cardPanels[t].addChangeListener(e=>this.valueIsAdjusting=this.cardPanels[t].getValueIsAdjusting());break;case"COLOR":this.cardPanels[t]=new Z4ColorPanel,this.cardPanels[t].getStyle().minWidth="15rem";break;case"GRADIENT-COLOR":this.cardPanels[t]=new Z4GradientColorPanel,this.cardPanels[t].addChangeListener(e=>this.valueIsAdjusting=this.cardPanels[t].getValueIsAdjusting());break;case"BIGRADIENT-COLOR":this.cardPanels[t]=new Z4BiGradientColorPanel,this.cardPanels[t].addChangeListener(e=>this.valueIsAdjusting=this.cardPanels[t].getValueIsAdjusting());break;case"COLOR-PROGRESSION":this.cardPanels[t]=new Z4ColorProgressionPanel(Z4ColorProgressionPanelOrientation.HORIZONTALLY_COMPACT),this.cardPanels[t].addChangeListener(e=>this.valueIsAdjusting=this.cardPanels[t].getValueIsAdjusting())}this.cardPanels[t].addChangeListener(e=>{this.createValue(),this.drawPreview(),this.onchange()}),this.cardPanel.add(this.cardPanels[t],t)}return s&&this.cardPanels[t].setValue(s),n&&(this.radios[t].setSelected(!0),this.cardLayout.show(this.cardPanel,t)),t}createValue(){let e=this.cardPanels[this.selectedPointInteratorCard].getValue(),t={};e.getType()===Z4PointIteratorType.SPIROGRAPH&&(t.drawWhileMoving=e.isDrawWhileMoving());let i=this.cardPanels[this.selectedPainterCard].getValue(),s=null,n=this.cardPanels["COLOR-PROGRESSION"];switch(this.selectedSpatioTemporalColorCard){case"COLOR":s=Z4SpatioTemporalColor.fromColor(this.cardPanels[this.selectedSpatioTemporalColorCard].getValue()),n.setProgressionSettings(e.getType(),t,!0,!1,!1);break;case"GRADIENT-COLOR":s=Z4SpatioTemporalColor.fromGradientColor(this.cardPanels[this.selectedSpatioTemporalColorCard].getValue()),n.setProgressionSettings(e.getType(),t,!1,!0,!1);break;case"BIGRADIENT-COLOR":s=Z4SpatioTemporalColor.fromBiGradientColor(this.cardPanels[this.selectedSpatioTemporalColorCard].getValue()),n.setProgressionSettings(e.getType(),t,!1,!1,!0)}let a=n.getValue(),r=this.name.getText();this.value=new Z4DrawingTool(r||Z4Translations.DRAWING_TOOL,e,i,s,a),this.setColorProgression()}setColorProgressionSettings(){let e={};this.value.getPointIterator().getType()===Z4PointIteratorType.SPIROGRAPH&&(e.drawWhileMoving=this.value.getPointIterator().isDrawWhileMoving()),this.cardPanels["COLOR-PROGRESSION"].setProgressionSettings(this.value.getPointIterator().getType(),e,this.value.getSpatioTemporalColor().isColor(),this.value.getSpatioTemporalColor().isGradientColor(),this.value.getSpatioTemporalColor().isBiGradientColor())}drawPreview(){clearTimeout(this.currentTimeoutID),this.currentTimeoutID=setTimeout(()=>{"none"!==this.preview1.getStyle().display?(this.ctx1.clearRect(0,0,500,300),this.previewColor&&(this.ctx1.fillStyle=Z4Constants.getStyle(this.previewColor.getRGBA_HEX()),this.ctx1.fillRect(0,0,500,300)),this.value.getPointIterator().drawDemo(this.ctx1,this.value.getPainter(),this.value.getSpatioTemporalColor(),this.value.getProgression(),500,300,this.valueIsAdjusting)):(this.ctx2.clearRect(0,0,300,500),this.previewColor&&(this.ctx2.fillStyle=Z4Constants.getStyle(this.previewColor.getRGBA_HEX()),this.ctx2.fillRect(0,0,300,500)),this.value.getPointIterator().drawDemo(this.ctx2,this.value.getPainter(),this.value.getSpatioTemporalColor(),this.value.getProgression(),300,500,this.valueIsAdjusting))},0)}}class Z4FontSelectionPanel extends Z4AbstractValuePanel{filter=new JSTextField;radios=[];size=new JSSpinner;sample=new JSLabel;bold=new JSCheckBox;italic=new JSCheckBox;fonts=null;constructor(e){super(),this.setLayout(new GridBagLayout),this.cssAddClass("z4fontselectionpanel"),this.fonts=e,Z4UI.addLabel(this,Z4Translations.FILTER,new GBC(0,0).a(GBC.WEST)),this.filter.addActionListener(e=>{let t=this.filter.getText().toLowerCase();this.radios.forEach((e,i,s)=>{e.setSelected(!1),e.getStyle().display=-1!==this.fonts[i].toLowerCase().indexOf(t)?"flex":"none"}),this.onFontChange()}),this.add(this.filter,new GBC(0,1).a(GBC.WEST).wx(1)),Z4UI.addLabel(this,Z4Translations.DIMENSION,new GBC(1,0).a(GBC.WEST)),this.size.cssAddClass("jsspinner_w_4rem"),this.size.setModel(new SpinnerNumberModel(12,7,400,1)),this.size.addChangeListener(e=>this.onFontChange()),this.add(this.size,new GBC(1,1).a(GBC.WEST).i(0,0,0,5)),this.bold.setText(Z4Translations.BOLD),this.bold.addActionListener(e=>this.onFontChange()),this.add(this.bold,new GBC(2,1).i(0,0,0,5)),this.italic.setText(Z4Translations.ITALIC),this.italic.addActionListener(e=>this.onFontChange()),this.add(this.italic,new GBC(3,1));let t=new JSPanel;t.setLayout(new BoxLayout(t,BoxLayout.Y_AXIS)),t.cssAddClass("z4fontselectionpanel-fontlist"),this.add(t,new GBC(0,2).w(4));let i=new ButtonGroup;e.forEach(e=>this.addFont(e,i,t)),this.sample.cssAddClass("z4fontselectionpanel-sample"),this.add(this.sample,new GBC(0,3).w(4).i(5,0,0,0))}addFont(e,t,i){let s=new JSRadioButton;s.setText(e),s.addActionListener(e=>this.onFontChange()),this.radios.push(s),t.add(s),i.add(s,null)}onFontChange(){let e=this.radios.findIndex(e=>e.isSelected()&&"none"!==e.getStyle().display);-1!==e?(this.value=new Z4Font(this.fonts[e],parseInt(this.size.getValue()),this.bold.isSelected(),this.italic.isSelected()),this.setSample()):(this.value=null,this.sample.setText("")),this.onchange()}setValue(e){this.value=e;let t=this.fonts.findIndex(t=>t===e.family);-1!==t?(this.radios[t].setSelected(!0),setTimeout(()=>this.radios[t].invoke("scrollIntoView()"),0)):this.radios.forEach(e=>e.setSelected(!1)),this.size.setValue(e.size),this.bold.setSelected(e.bold),this.italic.setSelected(e.italic),this.setSample()}setSample(){this.sample.setText(Z4Translations.STRING_EXAMPLE),this.sample.getStyle().fontFamily=this.value.family,this.sample.getStyle().fontSize=this.value.size+"px",this.sample.getStyle().fontStyle=this.value.italic?"italic":"normal",this.sample.getStyle().fontWeight=this.value.bold?"bold":"normal"}}class Z4CanvasGridPanel extends JSDropDown{showGridLabel=new JSComponent(document.createElement("img"));dottedGridLabel=new JSComponent(document.createElement("img"));magneticGridLabel=new JSComponent(document.createElement("img"));colorPanelLabel=new Z4ColorPanel;xLabel=new JSLabel;yLabel=new JSLabel;distanceLabel=new JSLabel;angleLabel=new JSLabel;deltaXLabel=new JSLabel;deltaYLabel=new JSLabel;vline1=null;vline2=null;vline3=null;showGridCheckBox=new JSCheckBox;dottedGridCheckBox=new JSCheckBox;magneticGridCheckBox=new JSCheckBox;colorPanel=new Z4ColorPanel;offsetXSlider=new JSSlider;offsetXSpinner=new JSSpinner;offsetYSlider=new JSSlider;offsetYSpinner=new JSSpinner;plotWidthSlider=new JSSlider;plotWidthSpinner=new JSSpinner;canvas=null;center=null;constructor(){super(".z4canvasgridpanel-editor"),this.cssAddClass("z4canvasgridpanel");let e=new JSPanel;e.setLayout(new GridBagLayout),this.showGridLabel.cssAddClass("z4canvasgridpanel-showgrid"),e.add(this.showGridLabel,new GBC(0,0).h(2).i(0,0,0,5)),this.dottedGridLabel.cssAddClass("z4canvasgridpanel-dottedgrid"),e.add(this.dottedGridLabel,new GBC(1,0).h(2).i(0,0,0,5)),this.magneticGridLabel.cssAddClass("z4canvasgridpanel-magneticgrid"),e.add(this.magneticGridLabel,new GBC(2,0).h(2).i(0,0,0,5)),this.colorPanelLabel.setEditButtonVisible(!1),this.colorPanelLabel.getChilStyleByQuery(".jscolorpreview").height="14px",this.colorPanelLabel.getStyle().width="14px",e.add(this.colorPanelLabel,new GBC(3,0).h(2)),this.vline1=Z4UI.addVLine(e,new GBC(4,0).h(2).f(GBC.VERTICAL).i(1,5,1,5)),this.xLabel.getStyle().fontFamily="monospace",this.xLabel.getStyle().fontSize="smaller",e.add(this.xLabel,new GBC(5,0)),this.yLabel.getStyle().fontFamily="monospace",this.yLabel.getStyle().fontSize="smaller",e.add(this.yLabel,new GBC(5,1).a(GBC.WEST)),this.vline2=Z4UI.addVLine(e,new GBC(6,0).h(2).f(GBC.VERTICAL).i(1,5,1,5)),this.distanceLabel.getStyle().fontFamily="monospace",this.distanceLabel.getStyle().fontSize="smaller",e.add(this.distanceLabel,new GBC(7,0)),this.angleLabel.getStyle().fontFamily="monospace",this.angleLabel.getStyle().fontSize="smaller",e.add(this.angleLabel,new GBC(7,1)),this.vline3=Z4UI.addVLine(e,new GBC(8,0).h(2).f(GBC.VERTICAL).i(1,5,1,5)),this.deltaXLabel.getStyle().fontFamily="monospace",this.deltaXLabel.getStyle().fontSize="smaller",e.add(this.deltaXLabel,new GBC(9,0)),this.deltaYLabel.getStyle().fontFamily="monospace",this.deltaYLabel.getStyle().fontSize="smaller",e.add(this.deltaYLabel,new GBC(9,1).a(GBC.WEST)),this.appendChildInTree("summary",e);let t=new JSPanel;t.cssAddClass("z4canvasgridpanel-editor"),t.setLayout(new GridBagLayout),this.showGridCheckBox.setText(Z4Translations.SHOW_GRID),this.showGridCheckBox.addActionListener(e=>this.onchange(!1,null,null)),t.add(this.showGridCheckBox,new GBC(0,7).w(2).a(GBC.WEST)),this.dottedGridCheckBox.setText(Z4Translations.DOTTED_GRID),this.dottedGridCheckBox.addActionListener(e=>this.onchange(!1,null,null)),t.add(this.dottedGridCheckBox,new GBC(0,6).w(2).a(GBC.WEST)),this.magneticGridCheckBox.setText(Z4Translations.MAGNETIC_GRID),this.magneticGridCheckBox.addActionListener(e=>this.onchange(!1,null,null)),t.add(this.magneticGridCheckBox,new GBC(0,5).w(2).a(GBC.WEST)),this.colorPanel.setLabel(Z4Translations.COLOR),this.colorPanel.setOpacityVisible(!1),this.colorPanel.addChangeListener(e=>this.onchange(!1,null,null)),t.add(this.colorPanel,new GBC(0,4).w(2).a(GBC.WEST).f(GBC.HORIZONTAL)),this.plotWidthSlider.addChangeListener(e=>this.onchange(!1,this.plotWidthSpinner,this.plotWidthSlider)),t.add(this.plotWidthSlider,new GBC(0,3).w(2).f(GBC.HORIZONTAL)),this.plotWidthSpinner.cssAddClass("jsspinner_w_4rem"),this.plotWidthSpinner.addChangeListener(e=>this.onchange(!0,this.plotWidthSpinner,this.plotWidthSlider)),t.add(this.plotWidthSpinner,new GBC(1,2).a(GBC.EAST)),Z4UI.addLabel(t,Z4Translations.PLOT_WIDTH,new GBC(0,2).a(GBC.WEST)),this.offsetXSlider.getStyle().minWidth="20.4rem",this.offsetXSlider.addChangeListener(e=>this.onchange(!1,this.offsetXSpinner,this.offsetXSlider)),t.add(this.offsetXSlider,new GBC(0,1).w(2).f(GBC.HORIZONTAL)),this.offsetXSpinner.cssAddClass("jsspinner_w_4rem"),this.offsetXSpinner.addChangeListener(e=>this.onchange(!0,this.offsetXSpinner,this.offsetXSlider)),t.add(this.offsetXSpinner,new GBC(1,0).a(GBC.EAST)),Z4UI.addLabel(t,Z4Translations.OFFSET_X,new GBC(0,0).a(GBC.WEST)),Z4UI.addVLine(t,new GBC(2,0).h(8).f(GBC.VERTICAL).i(1,2,1,2)),Z4UI.addLabel(t,Z4Translations.OFFSET_Y,new GBC(3,4).h(4).a(GBC.SOUTH)).cssAddClass("jslabel-vertical"),this.offsetYSpinner.cssAddClass("jsspinner-vertical"),this.offsetYSpinner.cssAddClass("jsspinner_h_4rem"),this.offsetYSpinner.setChildPropertyByQuery("*:nth-child(2)","textContent","▶"),this.offsetYSpinner.setChildPropertyByQuery("*:nth-child(3)","textContent","◀"),this.offsetYSpinner.addChangeListener(e=>this.onchange(!0,this.offsetYSpinner,this.offsetYSlider)),t.add(this.offsetYSpinner,new GBC(3,0).h(4).a(GBC.NORTH)),this.offsetYSlider.setOrientation(JSSlider.VERTICAL),this.offsetYSlider.setInverted(!0),this.offsetYSlider.getStyle().minWidth="1.5rem",this.offsetYSlider.addChangeListener(e=>this.onchange(!1,this.offsetYSpinner,this.offsetYSlider)),t.add(this.offsetYSlider,new GBC(4,0).h(8).wy(1).a(GBC.NORTH).f(GBC.VERTICAL)),this.appendChild(t),this.reset(Z4Constants.DEFAULT_IMAGE_SIZE,Z4Constants.DEFAULT_IMAGE_SIZE,!1)}onchange(e,t,i){t&&e?i.setValue(t.getValue()):t&&t.setValue(i.getValue()),this.center=new Point(this.offsetXSlider.getValue(),this.offsetYSlider.getValue()),this.showGridLabel.cssRemoveClass("z4canvasgridpanel-showgrid-on"),this.showGridLabel.cssRemoveClass("z4canvasgridpanel-showgrid-off"),this.showGridLabel.cssAddClass("z4canvasgridpanel-showgrid-"+(this.showGridCheckBox.isSelected()?"on":"off")),this.dottedGridLabel.getStyle().visibility=this.showGridCheckBox.isSelected()?"visible":"hidden",this.dottedGridLabel.cssRemoveClass("z4canvasgridpanel-dottedgrid-on"),this.dottedGridLabel.cssRemoveClass("z4canvasgridpanel-dottedgrid-off"),this.dottedGridLabel.cssAddClass("z4canvasgridpanel-dottedgrid-"+(this.dottedGridCheckBox.isSelected()?"on":"off")),this.dottedGridCheckBox.setEnabled(this.showGridCheckBox.isSelected()),this.magneticGridLabel.getStyle().visibility=this.showGridCheckBox.isSelected()?"visible":"hidden",this.magneticGridLabel.cssRemoveClass("z4canvasgridpanel-magneticgrid-on"),this.magneticGridLabel.cssRemoveClass("z4canvasgridpanel-magneticgrid-off"),this.magneticGridLabel.cssAddClass("z4canvasgridpanel-magneticgrid-"+(this.magneticGridCheckBox.isSelected()?"on":"off")),this.magneticGridCheckBox.setEnabled(this.showGridCheckBox.isSelected()),this.colorPanelLabel.getStyle().visibility=this.showGridCheckBox.isSelected()?"visible":"hidden",this.colorPanelLabel.setValue(this.colorPanel.getValue()),this.colorPanel.setEnabled(this.showGridCheckBox.isSelected()),this.xLabel.getStyle().visibility=this.showGridCheckBox.isSelected()?"visible":"hidden",this.xLabel.setText("X: "+new Number(this.center.x).toFixed(0).padStart(4,"\xa0")+"px"),this.yLabel.getStyle().visibility=this.showGridCheckBox.isSelected()?"visible":"hidden",this.yLabel.setText("Y: "+new Number(this.center.y).toFixed(0).padStart(4,"\xa0")+"px"),this.distanceLabel.getStyle().visibility=this.showGridCheckBox.isSelected()?"visible":"hidden",this.angleLabel.getStyle().visibility=this.showGridCheckBox.isSelected()?"visible":"hidden",this.deltaXLabel.getStyle().visibility=this.showGridCheckBox.isSelected()?"visible":"hidden",this.deltaYLabel.getStyle().visibility=this.showGridCheckBox.isSelected()?"visible":"hidden",this.vline1.getStyle().visibility=this.showGridCheckBox.isSelected()?"visible":"hidden",this.vline2.getStyle().visibility=this.showGridCheckBox.isSelected()?"visible":"hidden",this.vline3.getStyle().visibility=this.showGridCheckBox.isSelected()?"visible":"hidden",this.plotWidthSpinner.setEnabled(this.showGridCheckBox.isSelected()),this.plotWidthSlider.setEnabled(this.showGridCheckBox.isSelected()),this.offsetXSpinner.setEnabled(this.showGridCheckBox.isSelected()),this.offsetXSlider.setEnabled(this.showGridCheckBox.isSelected()),this.offsetYSpinner.setEnabled(this.showGridCheckBox.isSelected()),this.offsetYSlider.setEnabled(this.showGridCheckBox.isSelected()),this.canvas.setGrid(this.showGridCheckBox.isSelected(),this.center,this.plotWidthSlider.getValue(),this.dottedGridCheckBox.isSelected(),this.magneticGridCheckBox.isSelected(),this.colorPanelLabel.getValue())}setCanvas(e){this.canvas=e}setMousePosition(x,y){let distance=Z4Math.distance(this.center.x,this.center.y,x,y),angle=Z4Math.rad2deg(Z4Math.atan(this.center.x,this.center.y,x,y)),deltaX=Math.abs(this.center.x-x),deltaY=Math.abs(this.center.y-y),diff=0;eval("diff = Z4Translations.DISTANCE.length - Z4Translations.ANGLE.length;"),this.distanceLabel.setText(Z4Translations.DISTANCE+": "+new Number(distance).toFixed(2).padStart(7+(diff<0?-diff:0),"\xa0")+"px"),this.angleLabel.setText(Z4Translations.ANGLE+": "+new Number(angle).toFixed(2).padStart(7+(diff>0?diff:0),"\xa0")+"\xb0\xa0"),this.deltaXLabel.setText(Z4Translations.DELTA_X+": "+new Number(deltaX).toFixed(0).padStart(4,"\xa0")+"px"),this.deltaYLabel.setText(Z4Translations.DELTA_Y+": "+new Number(deltaY).toFixed(0).padStart(4,"\xa0")+"px")}reset(e,t,i){let s=0;i?s=this.plotWidthSpinner.getValue():(this.showGridLabel.cssRemoveClass("z4canvasgridpanel-showgrid-on"),this.showGridLabel.cssAddClass("z4canvasgridpanel-showgrid-off"),this.showGridCheckBox.setSelected(!1),this.dottedGridLabel.getStyle().visibility="hidden",this.dottedGridLabel.cssRemoveClass("z4canvasgridpanel-dottedgrid-on"),this.dottedGridLabel.cssAddClass("z4canvasgridpanel-dottedgrid-off"),this.dottedGridCheckBox.setSelected(!1),this.dottedGridCheckBox.setEnabled(!1),this.magneticGridLabel.getStyle().visibility="hidden",this.magneticGridLabel.cssRemoveClass("z4canvasgridpanel-magneticgrid-on"),this.magneticGridLabel.cssAddClass("z4canvasgridpanel-magneticgrid-off"),this.magneticGridCheckBox.setSelected(!1),this.magneticGridCheckBox.setEnabled(!1),this.colorPanelLabel.getStyle().visibility="hidden",this.colorPanelLabel.setValue(new Color(0,0,0,255)),this.colorPanel.setEnabled(!1),this.colorPanel.setValue(new Color(0,0,0,255)),this.xLabel.getStyle().visibility="hidden",this.yLabel.getStyle().visibility="hidden",this.distanceLabel.getStyle().visibility="hidden",this.angleLabel.getStyle().visibility="hidden",this.deltaXLabel.getStyle().visibility="hidden",this.deltaYLabel.getStyle().visibility="hidden",this.vline1.getStyle().visibility="hidden",this.vline2.getStyle().visibility="hidden",this.vline3.getStyle().visibility="hidden",s=20),this.plotWidthSpinner.setEnabled(!1),this.plotWidthSpinner.setModel(new SpinnerNumberModel(s,5,parseInt(Math.min(e,t)/2),1)),this.plotWidthSlider.setEnabled(!1),this.plotWidthSlider.setMinimum(5),this.plotWidthSlider.setMaximum(parseInt(Math.min(e,t)/2)),this.plotWidthSlider.setValue(s),this.center=new Point(parseInt(e/2),parseInt(t/2)),this.offsetXSpinner.setEnabled(!1),this.offsetXSpinner.setModel(new SpinnerNumberModel(this.center.x,0,e,1)),this.offsetXSlider.setEnabled(!1),this.offsetXSlider.setMaximum(e),this.offsetXSlider.setValue(this.center.x),this.offsetYSpinner.setEnabled(!1),this.offsetYSpinner.setModel(new SpinnerNumberModel(this.center.y,0,t,1)),this.offsetYSlider.setEnabled(!1),this.offsetYSlider.setMaximum(t),this.offsetYSlider.setValue(this.center.y)}}class Z4ExportToFilePanel extends JSPanel{filename=new JSTextField;png=new JSRadioButton;jpg=new JSRadioButton;qualitySlider=new JSSlider;qualitySpinner=new JSSpinner;listeners=[];constructor(){super(),this.cssAddClass("z4exporttofilepanel"),this.setLayout(new GridBagLayout),Z4UI.addLabel(this,Z4Translations.FILENAME,new GBC(0,0).a(GBC.WEST)),this.filename.addActionListener(e=>this.onchange()),this.add(this.filename,new GBC(0,1).w(2).f(GBC.HORIZONTAL).wx(1));let e=new ButtonGroup;e.add(this.png),e.add(this.jpg),this.addRadio(this.png,!0,"PNG",0),this.addRadio(this.jpg,!1,"JPG",1),Z4UI.addLabel(this,Z4Translations.QUALITY,new GBC(0,3).a(GBC.WEST)),this.qualitySlider.setEnabled(!1),this.qualitySlider.setValue(100),this.qualitySlider.addChangeListener(e=>this.qualitySpinner.setValue(this.qualitySlider.getValue())),this.add(this.qualitySlider,new GBC(0,4).w(2).f(GBC.HORIZONTAL).wx(1)),this.qualitySpinner.cssAddClass("jsspinner_w_3rem"),this.qualitySpinner.setEnabled(!1),this.qualitySpinner.setModel(new SpinnerNumberModel(100,0,100,1)),this.qualitySpinner.addChangeListener(e=>this.qualitySlider.setValue(this.qualitySpinner.getValue())),this.add(this.qualitySpinner,new GBC(1,3).a(GBC.EAST))}onchange(){let e=new ChangeEvent;this.listeners.forEach(t=>{"function"==typeof t?t(e):t.stateChanged(e)})}addRadio(e,t,i,s){e.setSelected(t),e.setText(i),e.addActionListener(e=>{this.qualitySlider.setEnabled(!t),this.qualitySpinner.setEnabled(!t)}),this.add(e,new GBC(s,2).a(GBC.WEST))}addChangeListener(e){this.listeners.push(e)}isValid(){return!!this.filename.getText()}setFilename(e){this.filename.setText(e)}getFilename(){return this.filename.getText()}setFilenameEditable(e){this.filename.setEditable(e)}getFileExtension(){return this.png.isSelected()?".png":".jpg"}setFileExtension(e){switch(e){case".png":this.png.setSelected(!0);break;case".jpg":this.jpg.setSelected(!0)}this.qualitySlider.setEnabled(".jpg"===e),this.qualitySpinner.setEnabled(".jpg"===e)}setFileExtensionEnabled(e){this.png.setEnabled(e),this.jpg.setEnabled(e)}getQuality(){return this.qualitySpinner.getValue()/100}}class Z4FillingPanel extends JSPanel{cardFillerSelectors=["FLAT","LINEAR","VERTEX","CONIC","SPIRAL","BEZIER","SINUSOIDAL","TEXTURE","BIGRADIENT"];cardFillerPanels=[new JSPanel,null,null,null,null,null,null,null,new JSPanel];cardFillerEvalPanels=["","new Z4LinearFillerPanel()","new Z4VertexBasedFillerPanel()","new Z4ConicFillerPanel()","new Z4SpiralFillerPanel()","new Z4BezierFillerPanel()","new Z4SinusoidalFillerPanel()","new Z4TextureFillerPanel()",""];cardColorSelectors=["FLAT","GRADIENT","NONE","BIGRADIENT"];cardColorPanels=[new Z4ColorPanel,new Z4GradientColorPanel,new JSPanel,new Z4BiGradientColorPanel];width=Z4Constants.DEFAULT_IMAGE_SIZE;height=Z4Constants.DEFAULT_IMAGE_SIZE;selectedFillerSelector="FLAT";selectedFillerPanel=this.cardFillerPanels[0];constructor(){super(),this.setLayout(new GridBagLayout),this.cssAddClass("z4fillingpanel");let panelRadio=new JSPanel;panelRadio.setLayout(new BoxLayout(panelRadio,BoxLayout.Y_AXIS)),this.add(panelRadio,new GBC(0,0).wy(1)),Z4UI.addVLine(this,new GBC(1,0).wy(1).a(GBC.NORTH).f(GBC.VERTICAL).i(1,5,1,5));let panelColor=new JSPanel,cardColor=new CardLayout(0,0);panelColor.setLayout(cardColor),this.add(panelColor,new GBC(2,0).wxy(1,1).a(GBC.NORTH).i(5,0,0,0)),Z4UI.addVLine(this,new GBC(3,0).wy(1).a(GBC.NORTH).f(GBC.VERTICAL).i(1,5,1,5));let panelFiller=new JSPanel,cardFiller=new CardLayout(0,0);panelFiller.setLayout(cardFiller),panelFiller.getStyle().display="none",this.add(panelFiller,new GBC(4,0).wxy(1,1).a(GBC.NORTH));let colorPanel=this.cardColorPanels[0];colorPanel.setLabel(Z4Translations.FILLING_COLOR),colorPanel.setValue(new Color(255,255,255,255)),colorPanel.getStyle().minWidth="15rem";let gradientColorPanel=this.cardColorPanels[1];gradientColorPanel.addChangeListener(e=>{switch(this.selectedFillerSelector){case"FLAT":case"TEXTURE":break;case"LINEAR":case"VERTEX":case"CONIC":case"SPIRAL":case"BEZIER":case"SINUSOIDAL":this.selectedFillerPanel.setGradientColor(gradientColorPanel.getValue()),this.selectedFillerPanel.drawPreview(gradientColorPanel.getValueIsAdjusting())}}),this.cardColorPanels[3].setSpaceTimeLabelsVisible(!1);let buttonGroup=new ButtonGroup;this.cardFillerSelectors.forEach((card,index,array)=>{let radio=new JSRadioButton;switch(radio.setContentAreaFilled(!1),radio.getStyle().marginBottom="1px",radio.setToggle(),radio.setSelected(0===index),radio.setIcon(new Z4EmptyImageProducer(index)),radio.addActionListener(event=>{this.selectedFillerSelector=card,this.cardFillerPanels[index]?(this.selectedFillerPanel=this.cardFillerPanels[index],this.afterSelection(panelFiller,cardFiller,card,panelColor,cardColor)):"BEZIER"===card?Z4UI.pleaseWait(this,!1,!1,!1,!1,"",()=>{this.selectedFillerPanel=eval(this.cardFillerEvalPanels[index]),this.afterEval(panelFiller,card,index,gradientColorPanel),this.afterSelection(panelFiller,cardFiller,card,panelColor,cardColor)}):(this.selectedFillerPanel=eval(this.cardFillerEvalPanels[index]),this.afterEval(panelFiller,card,index,gradientColorPanel),this.afterSelection(panelFiller,cardFiller,card,panelColor,cardColor))}),buttonGroup.add(radio),panelRadio.add(radio,null),card){case"FLAT":case"BIGRADIENT":panelFiller.add(this.cardFillerPanels[index],card)}}),this.cardColorSelectors.forEach((e,t,i)=>panelColor.add(this.cardColorPanels[t],e))}afterEval(e,t,i,s){this.selectedFillerPanel.setSize(this.width,this.height),this.selectedFillerPanel.setGradientColor(s.getValue()),this.cardFillerPanels[i]=this.selectedFillerPanel,e.add(this.selectedFillerPanel,t)}afterSelection(e,t,i,s,n){switch(t.show(e,i),i){case"FLAT":n.show(s,"FLAT"),e.getStyle().display="none",s.getStyle().display="block";break;case"LINEAR":case"VERTEX":case"CONIC":case"SPIRAL":case"BEZIER":case"SINUSOIDAL":n.show(s,"GRADIENT"),e.getStyle().display="block",s.getStyle().display="block",this.selectedFillerPanel.drawPreview(!1);break;case"TEXTURE":n.show(s,"NONE"),e.getStyle().display="block",s.getStyle().display="none";break;case"BIGRADIENT":n.show(s,"BIGRADIENT"),e.getStyle().display="none",s.getStyle().display="block"}}getSelectedFilling(){switch(this.selectedFillerSelector){case"FLAT":return this.cardColorPanels[0].getValue();case"LINEAR":case"VERTEX":case"CONIC":case"SPIRAL":case"BEZIER":case"SINUSOIDAL":case"TEXTURE":return this.selectedFillerPanel.getSelectedFiller();case"BIGRADIENT":return this.cardColorPanels[3].getValue();default:return null}}setSize(e,t){e>0&&t>0&&(this.width=e,this.height=t,this.cardFillerSelectors.forEach((i,s,n)=>{switch(i){case"FLAT":break;case"LINEAR":case"VERTEX":case"CONIC":case"SPIRAL":case"BEZIER":case"SINUSOIDAL":case"TEXTURE":this.cardFillerPanels[s]&&this.cardFillerPanels[s].setSize(e,t)}}),this.cardColorSelectors.forEach((i,s,n)=>{switch(i){case"FLAT":case"GRADIENT":case"NONE":break;case"BIGRADIENT":this.cardColorPanels[s].setSize(e,t)}}))}}class Z4MergeLayerPanel extends JSPanel{checkboxes=[];layers=[];listeners=[];constructor(){super(),this.cssAddClass("z4mergelayerpanel"),this.setLayout(new GridBagLayout);let e=new JSButton;e.setText(Z4Translations.MERGE_VISIBLE_LAYERS),e.addActionListener(e=>{this.layers.forEach((e,t,i)=>this.checkboxes[t].setSelected(!e.isHidden())),this.onchange()}),this.add(e,new GBC(0,0).i(0,0,0,2)),(e=new JSButton).setText(Z4Translations.MERGE_ALL_LAYERS),e.addActionListener(e=>{this.checkboxes.forEach((e,t,i)=>e.setSelected(!0)),this.onchange()}),this.add(e,new GBC(1,0).i(0,2,0,0))}getSelectedLayers(){let e=[];return this.checkboxes.forEach((t,i,s)=>{t.isSelected()&&e.push(this.layers[i])}),e}setCanvas(e){for(let t=0;t<e.getLayersCount();t++){let i=e.getLayerAt(t),s=new JSLabel;s.setText(Z4LayerPreview.VISIBLE_LAYER_CONTENT),i.isHidden()||(s.getStyle().color="var(--main-action-bgcolor)"),this.add(s,new GBC(0,t+1).a(GBC.EAST).i(0,0,0,2));let n=new JSCheckBox;n.setText(i.getName()),n.addActionListener(e=>this.onchange()),this.add(n,new GBC(1,t+1).a(GBC.WEST)),this.checkboxes.push(n),this.layers.push(i)}}onchange(){let e=new ChangeEvent;this.listeners.forEach(t=>{"function"==typeof t?t(e):t.stateChanged(e)})}addChangeListener(e){this.listeners.push(e)}}class Z4NewImagePanel extends JSTabbedPane{width=new JSSpinner;height=new JSSpinner;resolution=new JSSpinner;dimensionMM=new JSLabel;dimensionIN=new JSLabel;fillingPanel=new Z4FillingPanel;listeners=[];constructor(){super(),this.cssAddClass("z4newimagepanel"),this.getStyle().width="60rem",this.getStyle().height="45rem";let e=new JSPanel;e.setLayout(new GridBagLayout),this.addTab(Z4Translations.DIMENSION,e),Z4UI.addLabel(e,Z4Translations.WIDTH+" (px)",new GBC(1,0).a(GBC.WEST).i(5,0,0,5)),this.addSpinner(e,this.width,Z4Constants.DEFAULT_IMAGE_SIZE,Z4Constants.MAX_IMAGE_SIZE,1,1),Z4UI.addLabel(e,Z4Translations.HEIGHT+" (px)",new GBC(2,0).a(GBC.WEST).i(5,5,0,5)),this.addSpinner(e,this.height,Z4Constants.DEFAULT_IMAGE_SIZE,Z4Constants.MAX_IMAGE_SIZE,2,1),Z4UI.addLabel(e,Z4Translations.RESOLUTION+" (dpi)",new GBC(3,0).a(GBC.WEST).i(5,0,0,5)),this.addSpinner(e,this.resolution,Z4Constants.DEFAULT_DPI,Z4Constants.MAX_DPI,3,1),e.add(this.dimensionMM,new GBC(1,2).w(3).f(GBC.HORIZONTAL).i(2,0,0,0)),e.add(this.dimensionIN,new GBC(1,3).w(3).f(GBC.HORIZONTAL).i(2,0,0,0));let t=new JSPanel;t.setLayout(new FlowLayout(FlowLayout.LEFT,5,5)),Z4Constants.STANDARD_IMAGE_SIZE.forEach(e=>this.addButton(t,e)),e.add(t,new GBC(0,4).w(5).i(5,0,0,0));let i=new JSPanel;i.setLayout(new FlowLayout(FlowLayout.LEFT,5,5)),Z4Constants.STANDARD_IMAGE_SIZE.forEach(e=>this.addButton(i,new Dimension(e.height,e.width))),e.add(i,new GBC(0,5).w(5).wy(1).a(GBC.NORTH).i(5,0,0,0)),this.addTab(Z4Translations.FILLING,this.fillingPanel),this.setDimensions()}addSpinner(e,t,i,s,n,a){t.setModel(new SpinnerNumberModel(i,1,s,1)),t.getStyle().minWidth="6.6rem",t.getChilStyleByQuery("input[type=number]").minWidth="5.5rem",t.getChilStyleByQuery("input[type=number]").width="5.5rem",t.addChangeListener(e=>this.setDimensions()),e.add(t,new GBC(n,a).a(GBC.WEST).i(0,0,0,5))}addButton(e,t){let i=new JSButton;i.setText(t.width+" x "+t.height),i.addActionListener(e=>{this.width.setValue(t.width),this.height.setValue(t.height),this.setDimensions()}),e.add(i,null)}setDimensions(){let e=this.width.getValue(),t=this.height.getValue(),i=this.resolution.getValue(),s=e/i,n=t/i;this.dimensionMM.setText(new Number(25.4*s).toFixed(2)+" x "+new Number(25.4*n).toFixed(2)+" mm"),this.dimensionIN.setText(new Number(s).toFixed(2)+" x "+new Number(n).toFixed(2)+" inch"),this.fillingPanel.setSize(e,t),this.onchange()}setSelectedSize(e,t){this.width.setValue(e),this.height.setValue(t),this.setDimensions()}getSelectedSize(){return new Dimension(this.width.getValue(),this.height.getValue())}getSelectedFilling(){return this.fillingPanel.getSelectedFilling()}addChangeListener(e){this.listeners.push(e)}onchange(){let e=new ChangeEvent;this.listeners.forEach(t=>{"function"==typeof t?t(e):t.stateChanged(e)})}}class Z4OpenDrawingToolsFromLibraryPanel extends JSPanel{checkboxes=[];drawingTools=[];listeners=[];constructor(){super(),this.cssAddClass("z4opendrawingtoolsfromlibrarypanel"),this.setLayout(new GridBagLayout);let json=null;eval("json = z4drawingtool_library"),json.sort((obj1,obj2)=>{let name1=obj1[Z4Translations.CURRENT_LANGUAGE.key],name2=obj2[Z4Translations.CURRENT_LANGUAGE.key],response=0;return eval("response = name1 < name2 ? -1 : +1"),response}).forEach((e,t,i)=>{let s=new JSCheckBox;s.setText(e[Z4Translations.CURRENT_LANGUAGE.key]),s.addActionListener(e=>this.onchange()),this.add(s,new GBC(0,t).a(GBC.WEST)),this.checkboxes.push(s);let n=e.z4drawingtool;n.name=e[Z4Translations.CURRENT_LANGUAGE.key],this.drawingTools.push(n)})}getSelectedDrawingTools(){let e=[];return this.checkboxes.forEach((t,i,s)=>{t.isSelected()&&e.push(this.drawingTools[i])}),e}onchange(){let e=new ChangeEvent;this.listeners.forEach(t=>{"function"==typeof t?t(e):t.stateChanged(e)})}addChangeListener(e){this.listeners.push(e)}}class Z4ResizeImagePanel extends JSPanel{containerWidth=new JSSpinner;containerHeight=new JSSpinner;containerResolution=new JSSpinner;containerLockRatio=new JSCheckBox;containerDimensionMM=new JSLabel;containerDimensionIN=new JSLabel;contentWidth=new JSSpinner;contentHeight=new JSSpinner;contentResolution=new JSSpinner;contentLockRatio=new JSCheckBox;contentDimensionMM=new JSLabel;contentDimensionIN=new JSLabel;contentOffsetX=new JSSpinner;contentOffsetY=new JSSpinner;centerContent=new JSButton;resizeLayerAdaptContent=new JSRadioButton;resizeLayerAndContent=new JSRadioButton;resizeLayer=new JSRadioButton;resizeContent=new JSRadioButton;preview=new JSComponent(document.createElement("canvas"));ctx=this.preview.invoke("getContext('2d')");canvas=null;canvasWidth=Z4Constants.DEFAULT_IMAGE_SIZE;canvasHeight=Z4Constants.DEFAULT_IMAGE_SIZE;canvasRatio=1;listeners=[];static SIZE=150;constructor(){super(),this.cssAddClass("z4resizeimagepanel"),this.setLayout(new GridBagLayout),Z4UI.addLabel(this,Z4Translations.CONTAINER,new GBC(0,0).a(GBC.WEST).w(3)).getStyle().fontWeight="bold",Z4UI.addLabel(this,Z4Translations.WIDTH+" (px)",new GBC(0,1).a(GBC.WEST)),this.addSpinner(this.containerWidth,Z4Constants.DEFAULT_IMAGE_SIZE,1,Z4Constants.MAX_IMAGE_SIZE,0,2,this.containerWidth,this.containerHeight,this.containerLockRatio),Z4UI.addLabel(this,Z4Translations.HEIGHT+" (px)",new GBC(1,1).a(GBC.WEST)),this.addSpinner(this.containerHeight,Z4Constants.DEFAULT_IMAGE_SIZE,1,Z4Constants.MAX_IMAGE_SIZE,1,2,this.containerWidth,this.containerHeight,this.containerLockRatio),Z4UI.addLabel(this,Z4Translations.RESOLUTION+" (dpi)",new GBC(2,1).a(GBC.WEST)),this.addSpinner(this.containerResolution,Z4Constants.DEFAULT_DPI,1,Z4Constants.MAX_DPI,2,2,this.containerWidth,this.containerHeight,this.containerLockRatio),this.add(this.containerDimensionMM,new GBC(0,3).w(3).f(GBC.HORIZONTAL).i(2,0,0,0)),this.add(this.containerDimensionIN,new GBC(0,4).w(3).f(GBC.HORIZONTAL).i(2,0,0,0)),this.addCheckBox(this.containerLockRatio,this.containerWidth,this.containerHeight),this.add(this.containerLockRatio,new GBC(0,5).a(GBC.WEST).w(3)),Z4UI.addLabel(this,Z4Translations.CONTENT,new GBC(0,6).a(GBC.WEST).w(3)).getStyle().fontWeight="bold",Z4UI.addLabel(this,Z4Translations.WIDTH+" (px)",new GBC(0,7).a(GBC.WEST)),this.addSpinner(this.contentWidth,Z4Constants.DEFAULT_IMAGE_SIZE,1,Z4Constants.MAX_IMAGE_SIZE,0,8,this.contentWidth,this.contentHeight,this.contentLockRatio),Z4UI.addLabel(this,Z4Translations.HEIGHT+" (px)",new GBC(1,7).a(GBC.WEST)),this.addSpinner(this.contentHeight,Z4Constants.DEFAULT_IMAGE_SIZE,1,Z4Constants.MAX_IMAGE_SIZE,1,8,this.contentWidth,this.contentHeight,this.contentLockRatio),Z4UI.addLabel(this,Z4Translations.RESOLUTION+" (dpi)",new GBC(2,7).a(GBC.WEST)),this.addSpinner(this.contentResolution,Z4Constants.DEFAULT_DPI,1,Z4Constants.MAX_DPI,2,8,this.contentWidth,this.contentHeight,this.contentLockRatio),this.add(this.contentDimensionMM,new GBC(0,9).w(3).f(GBC.HORIZONTAL).i(2,0,0,0)),this.add(this.contentDimensionIN,new GBC(0,10).w(3).f(GBC.HORIZONTAL).i(2,0,0,0)),this.addCheckBox(this.contentLockRatio,this.contentWidth,this.contentHeight),this.add(this.contentLockRatio,new GBC(0,11).a(GBC.WEST).w(3)),Z4UI.addLabel(this,Z4Translations.OFFSET_X,new GBC(0,12).a(GBC.WEST)),this.addSpinner(this.contentOffsetX,0,-Z4Constants.MAX_IMAGE_SIZE,Z4Constants.MAX_IMAGE_SIZE,0,13,this.contentWidth,this.contentHeight,this.contentLockRatio),Z4UI.addLabel(this,Z4Translations.OFFSET_Y,new GBC(1,12).a(GBC.WEST)),this.addSpinner(this.contentOffsetY,0,-Z4Constants.MAX_IMAGE_SIZE,Z4Constants.MAX_IMAGE_SIZE,1,13,this.contentWidth,this.contentHeight,this.contentLockRatio),this.centerContent.setContentAreaFilled(!1),this.centerContent.setText(Z4Translations.CENTER_VERB),this.centerContent.addActionListener(e=>{this.contentOffsetX.setValue(parseInt((this.containerWidth.getValue()-this.contentWidth.getValue())/2)),this.contentOffsetY.setValue(parseInt((this.containerHeight.getValue()-this.contentHeight.getValue())/2)),this.setDimensions()}),this.add(this.centerContent,new GBC(2,13));let e=new JSPanel;e.setLayout(new BoxLayout(e,BoxLayout.Y_AXIS)),this.add(e,new GBC(3,0).h(6).a(GBC.NORTHWEST));let t=new ButtonGroup;this.addRadio(e,this.resizeLayerAdaptContent,t,Z4Translations.RESIZE_CONTAINER_AND_ADAPT_CONTENT,!0),this.addRadio(e,this.resizeLayerAndContent,t,Z4Translations.RESIZE_CONTAINER_AND_CONTENT,!1),this.addRadio(e,this.resizeLayer,t,Z4Translations.RESIZE_CONTAINER,!1),this.addRadio(e,this.resizeContent,t,Z4Translations.RESIZE_CONTENT,!1),this.add(this.preview,new GBC(3,6).h(8).wxy(1,1)),this.setDimensions()}addSpinner(e,t,i,s,n,a,r,o,l){e.setModel(new SpinnerNumberModel(t,i,s,1)),e.getStyle().minWidth="6.6rem",e.getChilStyleByQuery("input[type=number]").minWidth="5.5rem",e.getChilStyleByQuery("input[type=number]").width="5.5rem",e.addChangeListener(t=>{let i=this.computeDimension(r,o,l.isSelected(),e===r,e===o);r.setValue(i.width),o.setValue(i.height),this.setDimensions()}),this.add(e,new GBC(n,a).a(GBC.WEST).i(0,0,0,5))}addCheckBox(e,t,i){e.setText(Z4Translations.LOCK_ASPECT_RATIO),e.setSelected(!0),e.addActionListener(s=>{let n=this.computeDimension(t,i,e.isSelected(),!0,!1);t.setValue(n.width),i.setValue(n.height),this.setDimensions()})}addRadio(e,t,i,s,n){t.setText(s),t.setSelected(n),t.addActionListener(e=>this.setDimensions()),i.add(t),e.add(t,null)}computeDimension(e,t,i,s,n){let a=e.getValue(),r=t.getValue();return i&&(s?(r=parseInt(a/this.canvasRatio))<1?(a=parseInt(this.canvasRatio),r=1):r>Z4Constants.MAX_IMAGE_SIZE&&(a=parseInt(Z4Constants.MAX_IMAGE_SIZE*this.canvasRatio),r=Z4Constants.MAX_IMAGE_SIZE):n&&((a=parseInt(r*this.canvasRatio))<1?(a=1,r=parseInt(1/this.canvasRatio)):a>Z4Constants.MAX_IMAGE_SIZE&&(a=Z4Constants.MAX_IMAGE_SIZE,r=parseInt(Z4Constants.MAX_IMAGE_SIZE/this.canvasRatio)))),new Dimension(a,r)}setDimensions(){this.resizeLayerAdaptContent.isSelected()?(this.setComponentsEnabled(!0,!1,!1),this.contentWidth.setValue(this.containerWidth.getValue()),this.contentHeight.setValue(this.containerHeight.getValue()),this.contentOffsetX.setValue(0),this.contentOffsetY.setValue(0)):this.resizeLayerAndContent.isSelected()?this.setComponentsEnabled(!0,!0,!0):this.resizeLayer.isSelected()?(this.setComponentsEnabled(!0,!1,!0),this.contentWidth.setValue(this.canvasWidth),this.contentHeight.setValue(this.canvasHeight)):this.resizeContent.isSelected()&&(this.setComponentsEnabled(!1,!0,!0),this.containerWidth.setValue(this.canvasWidth),this.containerHeight.setValue(this.canvasHeight)),this.setLabels(this.containerWidth,this.containerHeight,this.containerResolution,this.containerDimensionMM,this.containerDimensionIN),this.setLabels(this.contentWidth,this.contentHeight,this.contentResolution,this.contentDimensionMM,this.contentDimensionIN);let e=this.containerWidth.getValue(),t=this.containerHeight.getValue(),i=e/t,s=i>1?Z4ResizeImagePanel.SIZE:Z4ResizeImagePanel.SIZE*i,n=i>1?Z4ResizeImagePanel.SIZE/i:Z4ResizeImagePanel.SIZE;if(this.preview.setProperty("width",""+parseInt(s)),this.preview.setProperty("height",""+parseInt(n)),this.canvas){let a=s/e,r=n/t;this.ctx.save(),this.ctx.scale(a,r),this.ctx.drawImage(this.canvas,this.contentOffsetX.getValue(),this.contentOffsetY.getValue(),this.contentWidth.getValue(),this.contentHeight.getValue()),this.ctx.restore()}this.onchange()}setComponentsEnabled(e,t,i){this.containerWidth.setEnabled(e),this.containerHeight.setEnabled(e),this.containerLockRatio.setEnabled(e),this.contentWidth.setEnabled(t),this.contentHeight.setEnabled(t),this.contentLockRatio.setEnabled(t),this.contentOffsetX.setEnabled(i),this.contentOffsetY.setEnabled(i),this.centerContent.setEnabled(i)}setLabels(e,t,i,s,n){let a=e.getValue(),r=t.getValue(),o=i.getValue(),l=a/o,h=r/o;s.setText(new Number(25.4*l).toFixed(2)+" x "+new Number(25.4*h).toFixed(2)+" mm"),n.setText(new Number(l).toFixed(2)+" x "+new Number(h).toFixed(2)+" inch")}setCanvas(e,t,i){this.canvas=e,this.canvasWidth=t,this.canvasHeight=i,this.canvasRatio=t/i,this.containerWidth.setValue(t),this.containerHeight.setValue(i),this.contentWidth.setValue(t),this.contentHeight.setValue(i),this.setDimensions()}getResizeOptions(){return new Z4ResizeOptions(this.containerWidth.getValue(),this.containerHeight.getValue(),this.contentWidth.getValue(),this.contentHeight.getValue(),this.contentOffsetX.getValue(),this.contentOffsetY.getValue())}addChangeListener(e){this.listeners.push(e)}onchange(){let e=new ChangeEvent;this.listeners.forEach(t=>{"function"==typeof t?t(e):t.stateChanged(e)})}}class Z4StatusPanel extends JSPanel{canvas=null;projectName=new JSLabel;projectSize=new JSLabel;zoom=new JSComboBox;mousePosition=new JSLabel;projectColor=new JSLabel;layerColor=new JSLabel;projectColorPreview=new JSColorPreview;layerColorPreview=new JSColorPreview;pickProjectColor=new JSToggleButton;pickLayerColor=new JSToggleButton;drawingDirection=new JSButton;canvasGridPanel=new Z4CanvasGridPanel;constructor(){super(),this.cssAddClass("z4statuspanel"),this.setLayout(new GridBagLayout),this.projectName.cssAddClass("z4statuspanel-projectname"),this.projectName.setText(Z4Translations.PROJECT_NAME+": "),this.add(this.projectName,new GBC(0,0).w(2).a(GBC.WEST).i(0,5,0,0)),this.projectSize.setText(Z4Translations.DIMENSION+": "+Z4Constants.DEFAULT_IMAGE_SIZE+" x "+Z4Constants.DEFAULT_IMAGE_SIZE),this.add(this.projectSize,new GBC(0,1).a(GBC.WEST).i(0,5,0,0));let e=new DefaultKeyValueComboBoxModelAndRenderer;Z4Constants.ZOOM_LEVEL.forEach(t=>e.addElement(new KeyValue(""+t,parseInt(100*t)+"%"))),e.addElement(new KeyValue("FIT",Z4Translations.FIT)),this.zoom.cssAddClass("z4statuspanel-zoom"),this.zoom.setModelAndRenderer(e),this.zoom.setSelectedItem(new KeyValue("1","")),this.zoom.addActionListener(e=>this.onZoom()),this.add(this.zoom,new GBC(1,1).a(GBC.EAST)),Z4UI.addVLine(this,new GBC(2,0).h(2).f(GBC.VERTICAL).i(1,5,1,5)),this.mousePosition.getStyle().fontFamily="monospace",this.setMousePosition(0,0),this.add(this.mousePosition,new GBC(3,0).h(2).i(0,0,0,5)),this.projectColor.getStyle().fontFamily="monospace",this.add(this.projectColor,new GBC(4,0)),this.layerColor.getStyle().fontFamily="monospace",this.add(this.layerColor,new GBC(4,1)),this.projectColorPreview.getStyle().visibility="hidden",this.add(this.projectColorPreview,new GBC(5,0)),this.layerColorPreview.getStyle().visibility="hidden",this.add(this.layerColorPreview,new GBC(5,1)),this.pickProjectColor.cssAddClass("z4statuspanel-colorpicker"),this.pickProjectColor.setContentAreaFilled(!1),this.pickProjectColor.setTooltip(Z4Translations.PICK_COLOR),this.pickProjectColor.setIcon(new Z4EmptyImageProducer("")),this.pickProjectColor.addActionListener(e=>this.pickColor(this.pickProjectColor)),this.add(this.pickProjectColor,new GBC(6,0)),this.pickLayerColor.cssAddClass("z4statuspanel-colorpicker"),this.pickLayerColor.setContentAreaFilled(!1),this.pickLayerColor.setTooltip(Z4Translations.PICK_COLOR),this.pickLayerColor.setIcon(new Z4EmptyImageProducer("")),this.pickLayerColor.addActionListener(e=>this.pickColor(this.pickLayerColor)),this.add(this.pickLayerColor,new GBC(6,1)),Z4UI.addVLine(this,new GBC(7,0).h(2).f(GBC.VERTICAL).i(1,5,1,5)),this.drawingDirection.setContentAreaFilled(!1),this.drawingDirection.setTooltip(Z4Translations.DRAWING_DIRECTION),this.drawingDirection.setIcon(new Z4EmptyImageProducer("")),this.drawingDirection.cssAddClass("z4statuspanel-drawingdirection"),this.drawingDirection.cssAddClass("z4statuspanel-drawingdirection-free"),this.drawingDirection.addActionListener(e=>this.setDrawingDirection(null)),this.add(this.drawingDirection,new GBC(8,0).h(2)),this.add(this.canvasGridPanel,new GBC(9,0).h(2).f(GBC.VERTICAL).i(0,5,0,0)),this.add(new JSLabel,new GBC(10,0).wx(1))}pickColor(e){let t=e.isSelected();this.pickProjectColor.setContentAreaFilled(!1),this.pickProjectColor.setSelected(!1),this.pickLayerColor.setContentAreaFilled(!1),this.pickLayerColor.setSelected(!1),e.setContentAreaFilled(t),e.setSelected(t),t?this.canvas.addCanvasOverlayMode(Z4CanvasOverlayMode.PICK_COLOR):this.canvas.removeCanvasOverlayMode(Z4CanvasOverlayMode.PICK_COLOR)}colorPicked(e,t){this.pickProjectColor.isSelected()&&e?(Color.pushHistory(e),this.colorPickedMessage()):this.pickLayerColor.isSelected()&&t&&(Color.pushHistory(t),this.colorPickedMessage()),this.pickProjectColor.setContentAreaFilled(!1),this.pickProjectColor.setSelected(!1),this.pickLayerColor.setContentAreaFilled(!1),this.pickLayerColor.setSelected(!1),setTimeout(()=>this.canvas.removeCanvasOverlayMode(Z4CanvasOverlayMode.PICK_COLOR),0)}colorPickedMessage(){if(!localStorage.getItem("z4pickcolormessage")){let e=new JSPanel;e.setLayout(new GridBagLayout);let t=new JSLabel;t.setText(Z4Translations.COLOR_STORED_IN_HISTORY),e.add(t,new GBC(0,0).a(GBC.WEST));let i=new JSCheckBox;i.setText(Z4Translations.DO_NOT_SHOW_AGAIN_MESSAGE),e.add(i,new GBC(0,1).a(GBC.WEST).i(20,0,0,0)),JSOptionPane.showMessageDialog(e,Z4Translations.PICK_COLOR,JSOptionPane.INFORMATION_MESSAGE,()=>{i.isSelected()&&localStorage.setItem("z4pickcolormessage","true")})}}setCanvas(e){this.canvas=e,this.canvasGridPanel.setCanvas(e)}setProjectName(e){this.projectName.setText(Z4Translations.PROJECT_NAME+": "+e),this.projectName.setAttribute("title",e)}setProjectSize(e,t){this.projectSize.setText(Z4Translations.DIMENSION+": "+e+" x "+t)}setMousePosition(x,y){this.mousePosition.setText(new Number(x).toFixed(0).padStart(4,"\xa0")+" x "+new Number(y).toFixed(0).padEnd(4,"\xa0")),this.canvasGridPanel.setMousePosition(x,y);let diff=0;eval("diff = Z4Translations.PROJECT.length - Z4Translations.LAYER.length;");let color=this.canvas?this.canvas.getColorAt(x,y):null;this.setColor(this.projectColor,this.projectColorPreview,color,Z4Translations.PROJECT,diff<0?-diff:0),color=this.canvas?this.canvas.getSelectedLayerColorAt(x,y):null,this.setColor(this.layerColor,this.layerColorPreview,color,Z4Translations.LAYER,diff>0?diff:0)}setColor(e,t,i,s,n){e.setText(s+": "+new String("").padStart(n,"\xa0")+"("+(i?new Number(i.red).toFixed(0).padStart(3,"\xa0"):"---")+", "+(i?new Number(i.green).toFixed(0).padStart(3,"\xa0"):"---")+", "+(i?new Number(i.blue).toFixed(0).padStart(3,"\xa0"):"---")+", "+(i?new Number(i.alpha).toFixed(0).padStart(3,"\xa0"):"---")+")"),t.getStyle().visibility=i?"visible":"hidden",i&&t.setColor(i)}setZoom(e){-1!==Z4Constants.ZOOM_LEVEL.indexOf(e)?this.zoom.setSelectedItem(new KeyValue(""+e,"")):this.zoom.setSelectedItem(new KeyValue("FIT",""))}setDrawingDirection(e){this.drawingDirection.cssRemoveClass("z4statuspanel-drawingdirection-free"),this.drawingDirection.cssRemoveClass("z4statuspanel-drawingdirection-horizontal"),this.drawingDirection.cssRemoveClass("z4statuspanel-drawingdirection-vertical"),e===Z4DrawingDirection.FREE?this.drawingDirection.cssAddClass("z4statuspanel-drawingdirection-free"):e===Z4DrawingDirection.HORIZONTAL?this.drawingDirection.cssAddClass("z4statuspanel-drawingdirection-horizontal"):e===Z4DrawingDirection.VERTICAL?this.drawingDirection.cssAddClass("z4statuspanel-drawingdirection-vertical"):this.canvas.getDrawingDirection()===Z4DrawingDirection.FREE?(this.drawingDirection.cssAddClass("z4statuspanel-drawingdirection-horizontal"),this.canvas.setDrawingDirection(Z4DrawingDirection.HORIZONTAL)):this.canvas.getDrawingDirection()===Z4DrawingDirection.HORIZONTAL?(this.drawingDirection.cssAddClass("z4statuspanel-drawingdirection-vertical"),this.canvas.setDrawingDirection(Z4DrawingDirection.VERTICAL)):this.canvas.getDrawingDirection()===Z4DrawingDirection.VERTICAL&&(this.drawingDirection.cssAddClass("z4statuspanel-drawingdirection-free"),this.canvas.setDrawingDirection(Z4DrawingDirection.FREE))}resetCanvasGridPanel(e,t,i){this.canvasGridPanel.reset(e,t,i)}onZoom(){let e=this.zoom.getSelectedItem().key;"FIT"===e?this.canvas.fitZoom():this.canvas.setZoom(parseFloat(e))}}class Z4Ribbon extends JSTabbedPane{projectPanel=new Z4RibbonProjectPanel;layerPanel=new Z4RibbonLayerPanel;drawingToolPanel=new Z4RibbonDrawingToolPanel;textPanel=new Z4RibbonTextPanel;historyPanel=new Z4RibbonHistoryPanel;settingsPanel=new Z4RibbonSettingsPanel;helpPanel=new Z4RibbonHelpPanel;canvas=null;constructor(){super(),this.cssAddClass("z4ribbon"),this.addTab(Z4Translations.PROJECT,this.projectPanel),this.addTab(Z4Translations.LAYER,this.layerPanel),this.addTab(Z4Translations.DRAWING_TOOL,this.drawingToolPanel),this.addTab(Z4Translations.TEXT,this.textPanel),this.addTab(Z4Translations.HISTORY,this.historyPanel),this.addTab(Z4Translations.SETTINGS,this.settingsPanel),this.addTab(Z4Translations.HELP,this.helpPanel),this.addChangeListener(e=>{"none"!==this.textPanel.getStyle().display?this.textPanel.checkFonts():this.canvas.removeCanvasOverlayMode(Z4CanvasOverlayMode.DRAW_TEXT)}),this.settingsPanel.setHistoryPanel(this.historyPanel)}setCanvas(e){this.canvas=e,e.setRibbonPanels(this.projectPanel,this.layerPanel,this.drawingToolPanel,this.textPanel,this.historyPanel)}setStatusPanel(e){this.projectPanel.setStatusPanel(e),this.layerPanel.setStatusPanel(e),this.drawingToolPanel.setStatusPanel(e),this.historyPanel.setStatusPanel(e)}}class Z4Constants{static IMAGE_FILE_ID="IMAGE_FILE_FOLDER_ID";static TOOL_FILE_ID="TOOL_FILE_FOLDER_ID";static TEXTURE_FILE_ID="TEXTURE_FILE_FOLDER_ID";static ACCEPTED_OPEN_IMAGE_FILE_FORMAT=[".gif",".png",".apng",".jpeg",".jpg",".jfif",".pjpeg",".pjp",".bmp",".svg",".webp",".avif"];static ACCEPTED_OPEN_IMAGE_FILE_TYPE=[];static ACCEPTED_SAVE_IMAGE_FILE_TYPE=[];static PIZZAPAZZA_PROJECT_FILE_TYPE=[];static PIZZAPAZZA_OPEN_TOOLS_FILE_TYPE=[];static PIZZAPAZZA_SAVE_TOOL_FILE_TYPE=[];static PIZZAPAZZA_SAVE_TOOLS_FILE_TYPE=[];static ZOOM_LEVEL=[.25,.33,.5,.66,1,1.5,2,3,4];static MAGNETISM_PERCENTAGE=.25;static COMPOSITE_OPERATION=[["source-over","source-in","source-out","source-atop"],["destination-over","destination-in","destination-out","destination-atop"],["lighter"],["copy"],["xor"],["multiply","screen","overlay"],["darken","lighten"],["color-dodge","color-burn"],["hard-light","soft-light"],["difference","exclusion"],["hue","saturation","color","luminosity"]];static DEFAULT_IMAGE_SIZE=500;static MAX_IMAGE_SIZE=2500;static DEFAULT_DPI=150;static MAX_DPI=1500;static STANDARD_IMAGE_SIZE=[new Dimension(640,480),new Dimension(800,600),new Dimension(1024,768),new Dimension(1080,720),new Dimension(1080,1080),new Dimension(1152,864),new Dimension(1280,720),new Dimension(1280,1024),new Dimension(1800,1200),new Dimension(1920,1080),new Dimension(2100,1500)];constructor(){}static configureAcceptedFileTypeArrays(){let e=new FilePickerOptionsType;e.description=Z4Translations.IMAGE_FILE,e.pushAccept("image/z4i",Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_FORMAT),Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_TYPE.push(e),Z4Constants.pushACCEPTED_IMAGE_FILE_TYPE(Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_TYPE,"image/gif",[".gif"]),Z4Constants.pushACCEPTED_IMAGE_FILE_TYPE(Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_TYPE,"image/png",[".png",".apng"]),Z4Constants.pushACCEPTED_IMAGE_FILE_TYPE(Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_TYPE,"image/jpg",[".jpeg",".jpg",".jfif",".pjpeg",".pjp"]),Z4Constants.pushACCEPTED_IMAGE_FILE_TYPE(Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_TYPE,"image/bmp",[".bmp"]),Z4Constants.pushACCEPTED_IMAGE_FILE_TYPE(Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_TYPE,"image/svg+xml",[".svg"]),Z4Constants.pushACCEPTED_IMAGE_FILE_TYPE(Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_TYPE,"image/webp",[".webp"]),Z4Constants.pushACCEPTED_IMAGE_FILE_TYPE(Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_TYPE,"image/avif",[".avif"]),Z4Constants.pushACCEPTED_IMAGE_FILE_TYPE(Z4Constants.ACCEPTED_SAVE_IMAGE_FILE_TYPE,"image/png",[".png"]),Z4Constants.pushACCEPTED_IMAGE_FILE_TYPE(Z4Constants.ACCEPTED_SAVE_IMAGE_FILE_TYPE,"image/jpg",[".jpeg",".jpg"]);let t=new FilePickerOptionsType;t.description=Z4Translations.PIZZAPAZZA_PROJECT,t.pushAccept("application/z4i",[".z4i"]),Z4Constants.PIZZAPAZZA_PROJECT_FILE_TYPE.push(t);let i=new FilePickerOptionsType;i.description=Z4Translations.PIZZAPAZZA_DRAWING_TOOL,i.pushAccept("application/z4t",[".z4t"]),Z4Constants.PIZZAPAZZA_SAVE_TOOL_FILE_TYPE.push(i);let s=new FilePickerOptionsType;s.description=Z4Translations.PIZZAPAZZA_DRAWING_TOOLS,s.pushAccept("application/z4ts",[".z4ts"]),Z4Constants.PIZZAPAZZA_SAVE_TOOLS_FILE_TYPE.push(s),(e=new FilePickerOptionsType).description=Z4Translations.PIZZAPAZZA_DRAWING_TOOLS,e.pushAccept("application/z4tx",[".z4t",".z4ts"]),Z4Constants.PIZZAPAZZA_OPEN_TOOLS_FILE_TYPE.push(e),Z4Constants.PIZZAPAZZA_OPEN_TOOLS_FILE_TYPE.push(i),Z4Constants.PIZZAPAZZA_OPEN_TOOLS_FILE_TYPE.push(s)}static pushACCEPTED_IMAGE_FILE_TYPE(e,t,i){let s=new FilePickerOptionsType,n=t.indexOf("/")+1,a=t.indexOf("+");s.description=-1!==a?t.substring(n,a).toUpperCase():t.substring(n).toUpperCase(),s.pushAccept(t,i),e.push(s)}static getStyle(e){return e}static pushHistory(e){e instanceof Z4AbstractFiller?Z4Constants.pushHistory(e.getFillingColor()):e instanceof Color?Color.pushHistory(e):e instanceof Z4GradientColor?Z4GradientColor.pushHistory(e):e instanceof Z4BiGradientColor?Z4BiGradientColor.pushHistory(e):e instanceof Z4SpatioTemporalColor&&(e.isColor()?Color.pushHistory(e.getColor()):e.isGradientColor()?Z4GradientColor.pushHistory(e.getGradientColor()):e.isBiGradientColor()&&Z4BiGradientColor.pushHistory(e.getBiGradientColor()))}}class Z4EmptyImageProducer extends AbstractHTMLImageProducer{constructor(e){super(e)}produce(){return document.createElement("img")}}class Z4Font{family=null;size=0;bold=!1;italic=!1;constructor(e,t,i,s){this.family=e,this.size=t,this.bold=i,this.italic=s}}class Z4JSONable{toJSON(){}}class Z4AbstractGradientColor extends Z4JSONable{colors=[];colorPositions=[];ripple=0;addColor(e,t){let i=this.colorPositions.findIndex(e=>e===t);-1!==i?this.colors[i]=e:-1!==(i=this.colorPositions.findIndex(e=>e>t))?(this.colors.splice(i,0,e),this.colorPositions.splice(i,0,t)):(this.colors.push(e),this.colorPositions.push(t))}removeColor(e){let t=this.colorPositions.findIndex(t=>t===e);-1!==t&&(this.colors.splice(t,1),this.colorPositions.splice(t,1))}isPositionOccupied(e,t){return!!this.colorPositions.filter(i=>Math.abs(i-e)<=t).length}getPosition(e,t){let i=this.colorPositions.filter(i=>Math.abs(i-e)<=t);return i.length?i[0]:-1}getColorPositionAtIndex(e){return this.colorPositions[e]}getColorAtIndex(e){return this.colors[e]}getColorCount(){return this.colors.length}mirror(){this.colors.slice().splice(0,this.colors.length-1).reverse().forEach(e=>this.colors.push(this.cloneColor(e)));for(let e=0;e<this.colorPositions.length;e++)this.colorPositions[e]=this.colorPositions[e]/2;this.colorPositions.slice().splice(0,this.colorPositions.length-1).reverse().forEach(e=>this.colorPositions.push(1-e))}cloneColor(e){}reverse(){this.colors.reverse(),this.colorPositions.reverse().forEach((e,t,i)=>this.colorPositions[t]=1-e)}setRipple(e){this.ripple=e}getRipple(){return this.ripple}getColorAt(e,t){}toJSON(){let e={};return e.ripple=this.ripple,e.colorsAndPositions=this.colors.map((e,t,i)=>this.mapColor(e,t)),e}mapColor(e,t){}}class Z4BiGradientColor extends Z4AbstractGradientColor{static history=[];constructor(){super(),this.addColor(new Z4GradientColor,0),this.addColor(new Z4GradientColor,1)}cloneColor(e){return Z4GradientColor.fromJSON(e.toJSON())}gradientMirror(){this.colors.forEach(e=>e.mirror())}gradientReverse(){this.colors.forEach(e=>e.reverse())}setGradientRipple(e){this.colors.forEach(t=>t.setRipple(e))}getGradientRipple(){return this.colors[0].getRipple()}getColorAt(e,t){t&&this.getRipple()&&(e=Z4Math.ripple(e,0,1,this.getRipple()));let i=e,s=this.colorPositions.findIndex(e=>e>=i,null);if(this.colorPositions[s]===e)return this.colors[s];if(this.colorPositions[s-1]===e)return this.colors[s-1];{let n=(e-this.colorPositions[s-1])/(this.colorPositions[s]-this.colorPositions[s-1]),a=this.colors[s-1],r=this.colors[s],o=new Z4GradientColor;return o.setRipple(this.getGradientRipple()),a.colors.forEach((e,t,i)=>{let s=a.colorPositions[t],l=r.getColorAt(s,!1);this.addInGradientColor(o,e,l,n,s)}),r.colors.forEach((e,t,i)=>{let s=r.colorPositions[t];if(-1===o.colorPositions.findIndex(e=>e===s)){let l=a.getColorAt(s,!1);this.addInGradientColor(o,l,e,n,s)}}),o}}addInGradientColor(e,t,i,s,n){e.addColor(new Color(parseInt((i.red-t.red)*s+t.red),parseInt((i.green-t.green)*s+t.green),parseInt((i.blue-t.blue)*s+t.blue),parseInt((i.alpha-t.alpha)*s+t.alpha)),n)}mapColor(e,t){let i={};return i.gradientColor=e.toJSON(),i.position=this.colorPositions[t],i}static fromJSON(e){let t=new Z4BiGradientColor;return t.setRipple(e.ripple),e.colorsAndPositions.forEach(e=>t.addColor(Z4GradientColor.fromJSON(e.gradientColor),e.position)),t}static pushHistory(e){let t=Z4BiGradientColor.history.findIndex(t=>JSON.stringify(t.toJSON())===JSON.stringify(e.toJSON()));-1!==t&&Z4BiGradientColor.history.splice(t,1),Z4BiGradientColor.history.unshift(e),Z4BiGradientColor.history.splice(48)}static getHistory(){return Z4BiGradientColor.history.map(e=>e)}static resetHistory(){Z4BiGradientColor.history.length=0}}class Z4GradientColor extends Z4AbstractGradientColor{static history=[];constructor(){super(),this.addColor(new Color(255,255,255,255),0),this.addColor(new Color(0,0,0,255),1)}cloneColor(e){return new Color(e.red,e.green,e.blue,e.alpha)}getColorAt(e,t){t&&this.getRipple()&&(e=Z4Math.ripple(e,0,1,this.getRipple()));let i=e,s=this.colorPositions.findIndex(e=>e>=i,null);if(this.colorPositions[s]===e)return this.colors[s];if(this.colorPositions[s-1]===e)return this.colors[s-1];{let n=(e-this.colorPositions[s-1])/(this.colorPositions[s]-this.colorPositions[s-1]);return new Color(parseInt((this.colors[s].red-this.colors[s-1].red)*n+this.colors[s-1].red),parseInt((this.colors[s].green-this.colors[s-1].green)*n+this.colors[s-1].green),parseInt((this.colors[s].blue-this.colors[s-1].blue)*n+this.colors[s-1].blue),parseInt((this.colors[s].alpha-this.colors[s-1].alpha)*n+this.colors[s-1].alpha))}}mapColor(e,t){let i=e.getJSON();return i.position=this.colorPositions[t],i}mergeOverlapping(e){for(let t=this.colorPositions.length-1;t>0;t--){let i=this.colorPositions[t-1],s=this.colorPositions[t];if(Math.abs(s-i)<=e){let n=(i+s)/2,a=this.getColorAt(n,!1);this.removeColor(i),this.removeColor(s),this.addColor(a,n)}}}createLinearGradient(e,t,i,s,n){let a=e.createLinearGradient(t,i,s,n);return this.colors.forEach((e,t,i)=>a.addColorStop(this.colorPositions[t],e.getRGBA_HEX())),a}lighted(e){let t=new Z4GradientColor;return this.colors.forEach((i,s,n)=>t.addColor(i.lighted(e?this.colorPositions[s]:1-this.colorPositions[s]),this.colorPositions[s])),t}darkened(e){let t=new Z4GradientColor;return this.colors.forEach((i,s,n)=>t.addColor(i.darkened(e?this.colorPositions[s]:1-this.colorPositions[s]),this.colorPositions[s])),t}static fromJSON(e){let t=new Z4GradientColor;return t.setRipple(e.ripple),e.colorsAndPositions.forEach(e=>t.addColor(Color.fromJSON(e),e.position)),t}static pushHistory(e){let t=Z4GradientColor.history.findIndex(t=>JSON.stringify(t.toJSON())===JSON.stringify(e.toJSON()));-1!==t&&Z4GradientColor.history.splice(t,1),Z4GradientColor.history.unshift(e),Z4GradientColor.history.splice(48)}static getHistory(){return Z4GradientColor.history.map(e=>e)}static resetHistory(){Z4GradientColor.history.length=0}}class Z4SpatioTemporalColor extends Z4JSONable{color=null;gradientColor=null;biGradientColor=null;static fromColor(e){return new Z4SpatioTemporalColor(e,null,null)}static fromGradientColor(e){return new Z4SpatioTemporalColor(null,e,null)}static fromBiGradientColor(e){return new Z4SpatioTemporalColor(null,null,e)}constructor(e,t,i){super(),this.color=e,this.gradientColor=t,this.biGradientColor=i}isColor(){return!!this.color}isGradientColor(){return!!this.gradientColor}isBiGradientColor(){return!!this.biGradientColor}getColor(){return this.color}getGradientColor(){return this.gradientColor}getBiGradientColor(){return this.biGradientColor}getColorAt(e,t){return this.color?this.color:this.gradientColor?this.gradientColor.getColorAt(t,!0):this.biGradientColor?this.biGradientColor.getColorAt(e,!0).getColorAt(t,!0):null}getGradientColorAt(e){return this.color?null:this.gradientColor?this.gradientColor:this.biGradientColor?this.biGradientColor.getColorAt(e,!0):null}toJSON(){let e={};return this.color?e.color=this.color.getJSON():this.gradientColor?e.gradientColor=this.gradientColor.toJSON():this.biGradientColor&&(e.biGradientColor=this.biGradientColor.toJSON()),e}static fromJSON(e){return e.color?Z4SpatioTemporalColor.fromColor(Color.fromJSON(e.color)):e.gradientColor?Z4SpatioTemporalColor.fromGradientColor(Z4GradientColor.fromJSON(e.gradientColor)):e.biGradientColor?Z4SpatioTemporalColor.fromBiGradientColor(Z4BiGradientColor.fromJSON(e.biGradientColor)):null}}class Z4Nextable extends Z4JSONable{next(){}}class Z4FancifulValue extends Z4Nextable{constant=null;random=null;uniformSign=!1;constructor(e,t,i){super(),this.constant=e,this.random=t,this.uniformSign=i}getConstant(){return this.constant}getRandom(){return this.random}isUniformSign(){return this.uniformSign}next(){return this.uniformSign?this.constant.getSign().next()*(this.constant.getValue()+this.random.getValue().next()):this.constant.next()+this.random.next()}toJSON(){let e={};return e.constant=this.constant.toJSON(),e.random=this.random.toJSON(),e.uniform=this.uniformSign,e}static fromJSON(e){return new Z4FancifulValue(Z4SignedValue.fromJSON(e.constant),Z4SignedRandomValue.fromJSON(e.random),e.uniform)}}class Z4RandomValue extends Z4Nextable{value=0;behavior=null;length=0;step=0;prevRandom=0;controlRandom=0;nextRandom=0;bezierCurve=null;constructor(e,t,i){super(),this.value=e,this.behavior=t,this.length=i,this.step=1,this.prevRandom=Math.random(),this.controlRandom=1,this.nextRandom=Math.random(),this.behavior===Z4RandomValueBehavior.BEZIER&&this.createBezierCurve()}createBezierCurve(){this.bezierCurve=new Bezier(0,this.prevRandom,this.length/2,this.controlRandom,1,this.nextRandom)}getValue(){return this.value}getRandomValueBehavior(){return this.behavior}getLength(){return this.length}next(){return this.behavior===Z4RandomValueBehavior.CLASSIC?this.value*Math.random():this.behavior===Z4RandomValueBehavior.BEZIER?(this.step>=this.length?(this.step=1,this.prevRandom=this.nextRandom,this.controlRandom=1===this.controlRandom?0:1,this.nextRandom=Math.random(),this.createBezierCurve()):this.step++,this.value*this.bezierCurve.get(this.step/this.length).y):this.behavior===Z4RandomValueBehavior.POLYLINE?(this.step>=this.length?(this.step=1,this.prevRandom=this.nextRandom,this.nextRandom=Math.random()):this.step++,this.value*((this.nextRandom-this.prevRandom)*this.step/this.length+this.prevRandom)):this.behavior===Z4RandomValueBehavior.STEPPED?(this.step>=this.length?(this.step=1,this.prevRandom=Math.random()):this.step++,this.value*this.prevRandom):0}toJSON(){let e={};return e.value=this.value,e.behavior=this.behavior,e.length=this.length,e}static fromJSON(e){switch(""+e.behavior){case"CLASSIC":return new Z4RandomValue(e.value,Z4RandomValueBehavior.CLASSIC,e.length);case"BEZIER":return new Z4RandomValue(e.value,Z4RandomValueBehavior.BEZIER,e.length);case"POLYLINE":return new Z4RandomValue(e.value,Z4RandomValueBehavior.POLYLINE,e.length);case"STEPPED":return new Z4RandomValue(e.value,Z4RandomValueBehavior.STEPPED,e.length);default:return null}}}class Z4Sign extends Z4Nextable{behavior=null;sign=0;constructor(e){super(),this.behavior=e,e===Z4SignBehavior.POSITIVE?this.sign=1:e===Z4SignBehavior.NEGATIVE?this.sign=-1:e===Z4SignBehavior.RANDOM?this.sign=0:e===Z4SignBehavior.ALTERNATE&&(this.sign=-2)}getSignBehavior(){return this.behavior}next(){switch(this.sign){case 1:case -1:return this.sign;case 0:default:return Math.random()>.5?1:-1;case 2:case -2:return this.sign*=-1,this.sign/2}}toJSON(){let e={};return e.behavior=this.behavior,e}static fromJSON(e){switch(""+e.behavior){case"POSITIVE":return new Z4Sign(Z4SignBehavior.POSITIVE);case"NEGATIVE":return new Z4Sign(Z4SignBehavior.NEGATIVE);case"RANDOM":return new Z4Sign(Z4SignBehavior.RANDOM);case"ALTERNATE":return new Z4Sign(Z4SignBehavior.ALTERNATE);default:return null}}}class Z4SignedRandomValue extends Z4Nextable{sign=null;value=null;constructor(e,t){super(),this.sign=e,this.value=t}getSign(){return this.sign}getValue(){return this.value}next(){return this.sign.next()*this.value.next()}toJSON(){let e={};return e.sign=this.sign.toJSON(),e.value=this.value.toJSON(),e}static fromJSON(e){return new Z4SignedRandomValue(Z4Sign.fromJSON(e.sign),Z4RandomValue.fromJSON(e.value))}}class Z4SignedValue extends Z4Nextable{sign=null;value=0;constructor(e,t){super(),this.sign=e,this.value=t}getSign(){return this.sign}getValue(){return this.value}next(){return this.sign.next()*this.value}toJSON(){let e={};return e.sign=this.sign.toJSON(),e.value=this.value,e}static fromJSON(e){return new Z4SignedValue(Z4Sign.fromJSON(e.sign),e.value)}}class Z4DrawingTool extends Z4Nextable{name=null;pointIterator=null;painter=null;spatioTemporalColor=null;progression=null;constructor(e,t,i,s,n){super(),this.name=e,this.pointIterator=t,this.painter=i,this.spatioTemporalColor=s,this.progression=n}getName(){return this.name}getPointIterator(){return this.pointIterator}getPainter(){return this.painter}getSpatioTemporalColor(){return this.spatioTemporalColor}getProgression(){return this.progression}drawAction(e,t,i){return this.pointIterator.drawAction(e,this.progression,t,i)}next(){return this.pointIterator.next(this.spatioTemporalColor,this.progression)}draw(e,t){this.painter.draw(e,t,this.spatioTemporalColor,this.progression)}getNextCountOnSTOP(){return this.pointIterator.getNextCountOnSTOP()}isInfinitePointGenerator(){return this.pointIterator.isInfinitePointGenerator()}getInfinitePointGeneratorSleep(){return this.pointIterator.getInfinitePointGeneratorSleep()}toJSON(){let e={};return e.name=this.name,e.pointIterator=this.pointIterator.toJSON(),e.painter=this.painter.toJSON(),e.spatioTemporalColor=this.spatioTemporalColor.toJSON(),e.progression=this.progression.toJSON(),e}static fromJSON(e){let t=null,i=null,s=e.pointIterator;switch(""+s.type){case"STAMPER":t=Z4Stamper.fromJSON(s);break;case"TRACER":t=Z4Tracer.fromJSON(s);break;case"AIRBRUSH":t=Z4Airbrush.fromJSON(s);break;case"SPIROGRAPH":t=Z4Spirograph.fromJSON(s);break;case"SCATTERER":t=Z4Scatterer.fromJSON(s)}let n=e.painter;switch(""+n.type){case"ARROW":i=new Z4ArrowPainter;break;case"SHAPE_2D":i=Z4Shape2DPainter.fromJSON(n);break;case"DROP":i=Z4DropPainter.fromJSON(n);break;case"BRUSH":i=Z4BrushPainter.fromJSON(n);break;case"PATTERN":i=Z4PatternPainter.fromJSON(n);break;case"CENTERED_FIGURE":i=Z4CenteredFigurePainter.fromJSON(n);break;case"NATURAL_FIGURE":i=Z4NaturalFigurePainter.fromJSON(n)}return new Z4DrawingTool(e.name,t,i,Z4SpatioTemporalColor.fromJSON(e.spatioTemporalColor),Z4ColorProgression.fromJSON(e.progression))}}class Z4NextableWithParam extends Z4JSONable{next(e){}}class Z4ColorProgression extends Z4NextableWithParam{behavior=null;temporalStepProgression=0;resetOnStartMoving=!1;lighting=null;constructor(e,t,i,s){super(),this.behavior=e,this.temporalStepProgression=t,this.resetOnStartMoving=i,this.lighting=s}getColorProgressionBehavior(){return this.behavior}getTemporalStepProgression(){return this.temporalStepProgression}isResetOnStartMoving(){return this.resetOnStartMoving}getLighting(){return this.lighting}next(e){return(e=-1===e?0:e+this.temporalStepProgression)>1&&(e-=1),e}toJSON(){let e={};return e.behavior=this.behavior,e.temporalStepProgression=this.temporalStepProgression,e.resetOnStartMoving=this.resetOnStartMoving,e.lighting=this.lighting,e}static fromJSON(e){let t=null;switch(""+e.lighting){case"NONE":t=Z4Lighting.NONE;break;case"LIGHTED_IN_OUT":t=Z4Lighting.LIGHTED_IN_OUT;break;case"DARKENED_IN_OUT":t=Z4Lighting.DARKENED_IN_OUT;break;case"LIGHTED_OUT_IN":t=Z4Lighting.LIGHTED_OUT_IN;break;case"DARKENED_OUT_IN":t=Z4Lighting.DARKENED_OUT_IN;break;default:t=null}switch(""+e.behavior){case"SPATIAL":return new Z4ColorProgression(Z4ColorProgressionBehavior.SPATIAL,e.temporalStepProgression,e.resetOnStartMoving,t);case"TEMPORAL":return new Z4ColorProgression(Z4ColorProgressionBehavior.TEMPORAL,e.temporalStepProgression,e.resetOnStartMoving,t);case"RELATIVE_TO_PATH":return new Z4ColorProgression(Z4ColorProgressionBehavior.RELATIVE_TO_PATH,e.temporalStepProgression,e.resetOnStartMoving,t);case"RANDOM":return new Z4ColorProgression(Z4ColorProgressionBehavior.RANDOM,e.temporalStepProgression,e.resetOnStartMoving,t);default:return null}}}class Z4Rotation extends Z4NextableWithParam{startAngle=0;angle=null;behavior=null;delayed=!1;rotationNext=0;constructor(e,t,i,s){super(),this.startAngle=e,this.delayed=s,this.behavior=i,this.angle=t}getStartAngle(){return this.startAngle}getAngle(){return this.angle}getRotationBehavior(){return this.behavior}isDelayed(){return this.delayed}next(e){let t=Z4Math.deg2rad(this.startAngle+this.angle.next());return this.behavior===Z4RotationBehavior.FIXED?t+(this.delayed?Math.PI:0):this.behavior===Z4RotationBehavior.CUMULATIVE?(this.rotationNext+=t,this.rotationNext+(this.delayed?Math.PI:0)):this.behavior===Z4RotationBehavior.RELATIVE_TO_PATH?t+e+(this.delayed?Math.PI:0):0}computeSide(e,t){return this.behavior===Z4RotationBehavior.FIXED||this.behavior===Z4RotationBehavior.CUMULATIVE?new Z4Sign(Z4SignBehavior.POSITIVE):this.behavior===Z4RotationBehavior.RELATIVE_TO_PATH?new Z4Sign(t?t.direction(e):Z4SignBehavior.RANDOM):null}toJSON(){let e={};return e.startAngle=this.startAngle,e.angle=this.angle.toJSON(),e.behavior=this.behavior,e.delayed=this.delayed,e}static fromJSON(e){switch(""+e.behavior){case"FIXED":return new Z4Rotation(e.startAngle,Z4FancifulValue.fromJSON(e.angle),Z4RotationBehavior.FIXED,e.delayed);case"CUMULATIVE":return new Z4Rotation(e.startAngle,Z4FancifulValue.fromJSON(e.angle),Z4RotationBehavior.CUMULATIVE,e.delayed);case"RELATIVE_TO_PATH":return new Z4Rotation(e.startAngle,Z4FancifulValue.fromJSON(e.angle),Z4RotationBehavior.RELATIVE_TO_PATH,e.delayed);default:return null}}}class Z4NextableWithTwoParams extends Z4JSONable{next(e,t){}}class Z4PointIterator extends Z4NextableWithTwoParams{rotation=null;nextdDrawingPoint=null;hasNext=!1;currentPoint=null;constructor(e){super(),this.rotation=e}getType(){}getRotation(){return this.rotation}drawAction(e,t,i,s){}next(e,t){}getNextCountOnSTOP(){}isInfinitePointGenerator(){}getInfinitePointGeneratorSleep(){}drawDemo(e,t,i,s,n,a,r){}toJSON(){let e={};return e.type=this.getType(),e.rotation=this.rotation.toJSON(),e}}class Z4Airbrush extends Z4PointIterator{multiplicity=null;radius=0;speed=0;gaussianCorrection=0;currentMultiplicityCounter=0;currentMultiplicityTotal=0;constructor(e,t,i,s,n){super(n),this.multiplicity=e,this.radius=t,this.speed=i,this.gaussianCorrection=s}getType(){return Z4PointIteratorType.AIRBRUSH}getMultiplicity(){return this.multiplicity}getRadius(){return this.radius}getSpeed(){return this.speed}getGaussianCorrection(){return this.gaussianCorrection}drawAction(e,t,i,s){return e===Z4PointIteratorDrawingAction.START?(this.currentMultiplicityCounter=0,this.currentMultiplicityTotal=parseInt(this.multiplicity.next()),this.currentPoint=new Z4Point(i,s),this.hasNext=!0,t.isResetOnStartMoving()&&(this.nextdDrawingPoint=null),!0):e===Z4PointIteratorDrawingAction.CONTINUE?(this.currentPoint=new Z4Point(i,s),this.hasNext=!0,!1):e===Z4PointIteratorDrawingAction.STOP&&(this.hasNext=!1,!1)}next(e,t){if(!this.hasNext)return this.currentMultiplicityCounter=0,this.currentMultiplicityTotal=parseInt(this.multiplicity.next()),this.hasNext=!0,null;{this.currentMultiplicityCounter++,this.hasNext=this.currentMultiplicityCounter<this.currentMultiplicityTotal;let i=this.radius*Z4Math.randomCorrected(this.gaussianCorrection/10),s=Z4Math.TWO_PI*Math.random(),n=this.rotation.next(s),a=Z4Vector.fromVector(this.currentPoint.x+i*Math.cos(s),i*Math.sin(s)+this.currentPoint.y,1,n),r=this.nextdDrawingPoint?this.nextdDrawingPoint.temporalPosition:-1;return t.getColorProgressionBehavior()===Z4ColorProgressionBehavior.TEMPORAL&&1===this.currentMultiplicityCounter?r=t.next(r):t.getColorProgressionBehavior()===Z4ColorProgressionBehavior.RELATIVE_TO_PATH?r=i/this.radius:t.getColorProgressionBehavior()===Z4ColorProgressionBehavior.RANDOM&&(r=Math.random()),this.nextdDrawingPoint=new Z4DrawingPoint(a,1,r,Z4DrawingPointIntent.DRAW_OBJECTS,this.rotation.computeSide(a,null),!1),this.nextdDrawingPoint}}getNextCountOnSTOP(){return 0}isInfinitePointGenerator(){return!0}getInfinitePointGeneratorSleep(){return parseInt(250/this.speed)}drawDemo(e,t,i,s,n,a,r){t=t||new Z4ArrowPainter,i=i||Z4SpatioTemporalColor.fromColor(new Color(0,0,0,255)),s=s||new Z4ColorProgression(Z4ColorProgressionBehavior.SPATIAL,0,!1,Z4Lighting.NONE),this.drawAction(Z4PointIteratorDrawingAction.START,s,n/2,a/2);let o=null;for(;null!==(o=this.next(i,s));)r&&(o=new Z4DrawingPoint(o.z4Vector,o.intensity,o.temporalPosition,Z4DrawingPointIntent.DRAW_BOUNDS,o.side,o.useVectorModuleAsSize)),e.save(),e.translate(o.z4Vector.x0,o.z4Vector.y0),e.rotate(o.z4Vector.phase),t.draw(e,o,i,s),e.restore();this.drawAction(Z4PointIteratorDrawingAction.STOP,s,n/2,a/2)}toJSON(){let e=super.toJSON();return e.multiplicity=this.multiplicity.toJSON(),e.radius=this.radius,e.speed=this.speed,e.gaussianCorrection=this.gaussianCorrection,e}static fromJSON(e){return new Z4Airbrush(Z4FancifulValue.fromJSON(e.multiplicity),e.radius,e.speed,e.gaussianCorrection,Z4Rotation.fromJSON(e.rotation))}}class Z4Scatterer extends Z4PointIterator{multiplicity=null;scattering=null;before=null;currentMultiplicityCounter=0;currentMultiplicityTotal=0;constructor(e,t,i){super(i),this.multiplicity=e,this.scattering=t}getType(){return Z4PointIteratorType.SCATTERER}getMultiplicity(){return this.multiplicity}getScattering(){return this.scattering}drawAction(e,t,i,s){return e===Z4PointIteratorDrawingAction.START?(this.currentMultiplicityCounter=0,this.currentMultiplicityTotal=parseInt(this.multiplicity.next()),this.currentPoint=new Z4Point(i,s),this.before=this.currentPoint,this.hasNext=!1,t.isResetOnStartMoving()&&(this.nextdDrawingPoint=null),!1):e===Z4PointIteratorDrawingAction.CONTINUE?(this.currentMultiplicityCounter=0,this.currentMultiplicityTotal=parseInt(this.multiplicity.next()),this.currentPoint=new Z4Point(i,s),this.hasNext=!0,!0):e!==Z4PointIteratorDrawingAction.STOP&&!1}next(e,t){if(!this.hasNext)return null;{this.currentMultiplicityCounter++,this.hasNext=this.currentMultiplicityCounter<this.currentMultiplicityTotal;let i=this.scattering.next()/10,s=Z4Vector.fromPoints(this.before.x,this.before.y,this.currentPoint.x,this.currentPoint.y),n=this.rotation.next(s.phase),a=Z4Vector.fromVector(this.currentPoint.x+s.module*i*Math.cos(n),this.currentPoint.y+s.module*i*Math.sin(n),1,n),r=this.nextdDrawingPoint?this.nextdDrawingPoint.temporalPosition:-1;return t.getColorProgressionBehavior()===Z4ColorProgressionBehavior.TEMPORAL?r=t.next(r):t.getColorProgressionBehavior()===Z4ColorProgressionBehavior.RANDOM&&(r=Math.random()),this.nextdDrawingPoint=new Z4DrawingPoint(a,1,r,Z4DrawingPointIntent.DRAW_OBJECTS,this.rotation.computeSide(a,s),!1),this.nextdDrawingPoint}}getNextCountOnSTOP(){return 0}isInfinitePointGenerator(){return!1}getInfinitePointGeneratorSleep(){return 0}drawDemo(e,t,i,s,n,a,r){let o=t||new Z4ArrowPainter,l=i||Z4SpatioTemporalColor.fromColor(new Color(0,0,0,255)),h=s||new Z4ColorProgression(Z4ColorProgressionBehavior.SPATIAL,0,!1,Z4Lighting.NONE);this.initDraw(n,a).forEach((t,s,n)=>{this.drawAction(s?Z4PointIteratorDrawingAction.CONTINUE:Z4PointIteratorDrawingAction.START,h,t.x,t.y),e.save(),e.lineWidth=1,e.fillStyle=Z4Constants.getStyle("black"),e.beginPath(),e.arc(this.currentPoint.x,this.currentPoint.y,2,0,Z4Math.TWO_PI),e.fill(),e.restore();let a=null;for(;null!==(a=this.next(i,h));)r&&(a=new Z4DrawingPoint(a.z4Vector,a.intensity,a.temporalPosition,Z4DrawingPointIntent.DRAW_BOUNDS,a.side,a.useVectorModuleAsSize)),e.save(),e.translate(a.z4Vector.x0,a.z4Vector.y0),e.rotate(a.z4Vector.phase),o.draw(e,a,l,h),e.restore()})}initDraw(e,t){let i=[],s=[1,49,2,48,4,47,7,42,10,40,12,38,15,42];for(let n=0;n<s.length;n+=2)i.push(new Z4Point(e*s[n]/50,t*s[n+1]/50));return i}toJSON(){let e=super.toJSON();return e.multiplicity=this.multiplicity.toJSON(),e.scattering=this.scattering.toJSON(),e}static fromJSON(e){return new Z4Scatterer(Z4FancifulValue.fromJSON(e.multiplicity),Z4FancifulValue.fromJSON(e.scattering),Z4Rotation.fromJSON(e.rotation))}}class Z4Spirograph extends Z4PointIterator{drawWhileMoving=!1;center=null;clones=[];clonePos=0;fromClones=!1;constructor(e,t){super(t),this.drawWhileMoving=e}getType(){return Z4PointIteratorType.SPIROGRAPH}isDrawWhileMoving(){return this.drawWhileMoving}drawAction(e,t,i,s){return e===Z4PointIteratorDrawingAction.START?(this.center=new Z4Point(i,s),this.hasNext=!1,this.clones=[],this.fromClones=!1,t.isResetOnStartMoving()&&(this.nextdDrawingPoint=null),!1):e===Z4PointIteratorDrawingAction.CONTINUE?(this.currentPoint=new Z4Point(i,s),this.hasNext=!0,!0):e===Z4PointIteratorDrawingAction.STOP&&(this.fromClones=!0,this.clonePos=this.clones.length-1,this.hasNext=-1!==this.clonePos,!0)}next(e,t){if(!this.hasNext)return null;if(this.fromClones){let i=this.clones[this.clonePos];return this.nextdDrawingPoint=new Z4DrawingPoint(i.z4Vector,i.intensity,this.clonePos/this.clones.length,Z4DrawingPointIntent.DRAW_OBJECTS,i.side,i.useVectorModuleAsSize),this.clonePos--,this.hasNext=-1!==this.clonePos,this.nextdDrawingPoint}{let s=Z4Vector.fromPoints(this.center.x,this.center.y,this.currentPoint.x,this.currentPoint.y),n=this.rotation.next(s.phase),a=Z4Vector.fromVector(this.center.x,this.center.y,s.module,n),r=this.drawWhileMoving?Z4DrawingPointIntent.DRAW_OBJECTS:Z4DrawingPointIntent.REPLACE_PREVIOUS_BOUNDS,o=this.nextdDrawingPoint?this.nextdDrawingPoint.temporalPosition:-1;return t.getColorProgressionBehavior()===Z4ColorProgressionBehavior.TEMPORAL?o=t.next(o):this.drawWhileMoving&&t.getColorProgressionBehavior()===Z4ColorProgressionBehavior.RELATIVE_TO_PATH?r=Z4DrawingPointIntent.DRAW_BOUNDS:t.getColorProgressionBehavior()===Z4ColorProgressionBehavior.RANDOM&&(o=Math.random()),this.hasNext=!1,this.nextdDrawingPoint=new Z4DrawingPoint(a,1,o,r,this.rotation.computeSide(a,s),!0),this.nextdDrawingPoint.intent===Z4DrawingPointIntent.REPLACE_PREVIOUS_BOUNDS?this.clones=Array(this.nextdDrawingPoint):this.nextdDrawingPoint.intent===Z4DrawingPointIntent.DRAW_BOUNDS&&this.clones.push(this.nextdDrawingPoint),this.nextdDrawingPoint}}getNextCountOnSTOP(){return this.clones.length}isInfinitePointGenerator(){return!1}getInfinitePointGeneratorSleep(){return 0}drawDemo(e,t,i,s,n,a,r){let o=t||new Z4ArrowPainter,l=i||Z4SpatioTemporalColor.fromColor(new Color(0,0,0,255)),h=s||new Z4ColorProgression(Z4ColorProgressionBehavior.SPATIAL,0,!1,Z4Lighting.NONE),d=this.initDraw(n,a),c=d[0];this.drawAction(Z4PointIteratorDrawingAction.START,h,c.x,c.y),d.slice(1).forEach(t=>{this.drawAction(Z4PointIteratorDrawingAction.CONTINUE,h,t.x,t.y),this.drawDemoPoint(e,o,l,h,r)});let g=d[d.length-1];this.drawAction(Z4PointIteratorDrawingAction.STOP,h,g.x,g.y),this.drawDemoPoint(e,o,l,h,r)}initDraw(e,t){let i=e/2,s=t/2,n=Math.min(e,t)/16,a=parseInt(e*t/1e4),r=[];for(let o=0;o<a;o++){let l=Z4Math.TWO_PI*o/a;r.push(new Z4Point(i+n*l*Math.cos(l),s+n*l*Math.sin(l)))}return r}drawDemoPoint(e,t,i,s,n){let a=null;for(;null!==(a=this.next(i,s));)n&&(a=new Z4DrawingPoint(a.z4Vector,a.intensity,a.temporalPosition,Z4DrawingPointIntent.DRAW_BOUNDS,a.side,a.useVectorModuleAsSize)),(a.intent===Z4DrawingPointIntent.DRAW_OBJECTS||n)&&(e.save(),e.translate(a.z4Vector.x0,a.z4Vector.y0),e.rotate(a.z4Vector.phase),t.draw(e,a,i,s),e.restore())}toJSON(){let e=super.toJSON();return e.drawWhileMoving=this.drawWhileMoving,e}static fromJSON(e){return new Z4Spirograph(e.drawWhileMoving,Z4Rotation.fromJSON(e.rotation))}}class Z4Stamper extends Z4PointIterator{multiplicity=null;push=null;currentMultiplicityCounter=0;currentMultiplicityTotal=0;constructor(e,t,i){super(i),this.multiplicity=e,this.push=t}getType(){return Z4PointIteratorType.STAMPER}getMultiplicity(){return this.multiplicity}getPush(){return this.push}drawAction(e,t,i,s){return e===Z4PointIteratorDrawingAction.START&&(this.currentMultiplicityCounter=0,this.currentMultiplicityTotal=parseInt(this.multiplicity.next()),this.currentPoint=new Z4Point(i,s),this.hasNext=!0,t.isResetOnStartMoving()&&(this.nextdDrawingPoint=null),!0)}next(e,t){if(!this.hasNext)return null;{this.currentMultiplicityCounter++,this.hasNext=this.currentMultiplicityCounter<this.currentMultiplicityTotal;let i=null,s=this.rotation.next(0),n=this.push.next();if(n){let a=Z4Vector.fromVector(this.currentPoint.x,this.currentPoint.y,n,s);i=Z4Vector.fromVector(a.x,a.y,1,s)}else i=Z4Vector.fromVector(this.currentPoint.x,this.currentPoint.y,1,s);let r=this.nextdDrawingPoint?this.nextdDrawingPoint.temporalPosition:-1;return t.getColorProgressionBehavior()===Z4ColorProgressionBehavior.TEMPORAL?r=t.next(r):t.getColorProgressionBehavior()===Z4ColorProgressionBehavior.RANDOM&&(r=Math.random()),this.nextdDrawingPoint=new Z4DrawingPoint(i,1,r,Z4DrawingPointIntent.DRAW_OBJECTS,this.rotation.computeSide(i,null),!1),this.nextdDrawingPoint}}getNextCountOnSTOP(){return 0}isInfinitePointGenerator(){return!1}getInfinitePointGeneratorSleep(){return 0}drawDemo(e,t,i,s,n,a,r){let o=t||new Z4ArrowPainter,l=i||Z4SpatioTemporalColor.fromColor(new Color(0,0,0,255)),h=s||new Z4ColorProgression(Z4ColorProgressionBehavior.SPATIAL,0,!1,Z4Lighting.NONE);this.initDraw(n,a).forEach(t=>{this.drawAction(Z4PointIteratorDrawingAction.START,h,t.x,t.y),e.save(),e.lineWidth=1,e.fillStyle=Z4Constants.getStyle("black"),e.beginPath(),e.arc(this.currentPoint.x,this.currentPoint.y,2,0,Z4Math.TWO_PI),e.fill(),e.restore();let s=null;for(;null!==(s=this.next(i,h));)r&&(s=new Z4DrawingPoint(s.z4Vector,s.intensity,s.temporalPosition,Z4DrawingPointIntent.DRAW_BOUNDS,s.side,s.useVectorModuleAsSize)),e.save(),e.translate(s.z4Vector.x0,s.z4Vector.y0),e.rotate(s.z4Vector.phase),o.draw(e,s,l,h),e.restore()})}initDraw(e,t){let i=[];for(let s=50;s<=e;s+=100)for(let n=50;n<=t;n+=100)i.push(new Z4Point(s,n));return i}toJSON(){let e=super.toJSON();return e.multiplicity=this.multiplicity.toJSON(),e.push=this.push.toJSON(),e}static fromJSON(e){return new Z4Stamper(Z4FancifulValue.fromJSON(e.multiplicity),Z4FancifulValue.fromJSON(e.push),Z4Rotation.fromJSON(e.rotation))}}class Z4Tracer extends Z4PointIterator{multiplicity=null;push=null;attack=null;sustain=null;release=null;endlessSustain=!1;step=null;assistedDrawing=!1;path=null;before=null;envelopeA=0;envelopeS=0;envelopeR=0;envelopeAS=0;envelopeASR=0;envelopePosition=0;envelopeStep=0;clones=[];clonePos=0;fromClones=!1;surplus=0;connect=!1;currentVector=null;currentMultiplicityCounter=0;currentMultiplicityTotal=0;constructor(e,t,i,s,n,a,r,o,l){super(l),this.multiplicity=e,this.push=t,this.attack=i,this.sustain=s,this.release=n,this.endlessSustain=a,this.step=r,this.assistedDrawing=o}getType(){return Z4PointIteratorType.TRACER}getMultiplicity(){return this.multiplicity}getPush(){return this.push}getAttack(){return this.attack}getRelease(){return this.release}getSustain(){return this.sustain}isEndlessSustain(){return this.endlessSustain}getStep(){return this.step}isAssistedDrawing(){return this.assistedDrawing}drawAction(e,t,i,s){if(e===Z4PointIteratorDrawingAction.START)return this.currentPoint=new Z4Point(i,s),this.hasNext=!1,this.path=null,this.envelopeA=this.attack.next(),this.envelopeS=this.sustain.next(),this.envelopeR=this.release.next(),this.envelopeAS=this.envelopeA+this.envelopeS,this.envelopeASR=this.envelopeA+this.envelopeS+this.envelopeR,this.envelopePosition=0,this.envelopeStep=this.step.next(),this.clones=[],this.fromClones=!1,this.surplus=0,this.connect=!1,t.isResetOnStartMoving()&&(this.nextdDrawingPoint=null),!1;if(e===Z4PointIteratorDrawingAction.CONTINUE){this.currentMultiplicityCounter=0,this.currentMultiplicityTotal=parseInt(this.multiplicity.next());let n=Z4Math.distance(this.currentPoint.x,this.currentPoint.y,i,s);if(this.assistedDrawing){if(n>=10){let a=Z4Math.atan(this.currentPoint.x,this.currentPoint.y,i,s),r=Z4Vector.fromVector(this.currentPoint.x,this.currentPoint.y,2*n/3,a),o=new Z4Point(r.x,r.y);this.connect?(r=Z4Vector.fromVector(this.currentPoint.x,this.currentPoint.y,n/3,a),this.path=Z4TracerPath.fromQuadAndLine(this.before.x,this.before.y,this.currentPoint.x,this.currentPoint.y,r.x,r.y,o.x,o.y,this.surplus,this.envelopeStep)):this.path=Z4TracerPath.fromLine(this.currentPoint.x,this.currentPoint.y,r.x,r.y,this.surplus,this.envelopeStep),this.connect=!0,this.before=o,this.currentPoint=new Z4Point(i,s),this.hasNext=this.path.hasNext(),this.hasNext||(this.surplus=this.path.getNewSurplus())}else this.hasNext=!1}else this.path=Z4TracerPath.fromLine(this.currentPoint.x,this.currentPoint.y,i,s,this.surplus,this.envelopeStep),this.connect=!0,this.currentPoint=new Z4Point(i,s),this.hasNext=this.path.hasNext(),this.hasNext||(this.surplus=this.path.getNewSurplus());return!0}return e===Z4PointIteratorDrawingAction.STOP&&(this.fromClones=!0,this.clonePos=0,this.hasNext=this.clonePos<this.clones.length,!0)}next(e,t){if(!this.hasNext)return null;if(this.fromClones){let i=this.clones[this.clonePos];return this.clonePos++,this.hasNext=this.clonePos<this.clones.length,new Z4DrawingPoint(i.z4Vector,i.intensity,this.clonePos/this.clones.length,Z4DrawingPointIntent.DRAW_OBJECTS,i.side,i.useVectorModuleAsSize)}{this.currentMultiplicityCounter||(this.currentVector=this.path.next());let s=null,n=this.rotation.next(this.currentVector.phase),a=this.push.next();if(a){let r=Z4Vector.fromVector(this.currentVector.x0,this.currentVector.y0,a,n);s=Z4Vector.fromVector(r.x,r.y,1,n)}else s=Z4Vector.fromVector(this.currentVector.x0,this.currentVector.y0,1,n);let o=Z4DrawingPointIntent.DRAW_OBJECTS,l=this.nextdDrawingPoint?this.nextdDrawingPoint.temporalPosition:-1;return t.getColorProgressionBehavior()===Z4ColorProgressionBehavior.TEMPORAL?l=t.next(l):t.getColorProgressionBehavior()===Z4ColorProgressionBehavior.RELATIVE_TO_PATH?o=Z4DrawingPointIntent.DRAW_BOUNDS:t.getColorProgressionBehavior()===Z4ColorProgressionBehavior.RANDOM&&(l=Math.random()),this.currentMultiplicityCounter++,this.currentMultiplicityCounter>=this.currentMultiplicityTotal&&(this.currentMultiplicityCounter=0,this.hasNext=this.path.hasNext(),this.hasNext||(this.surplus=this.path.getNewSurplus())),this.nextdDrawingPoint=new Z4DrawingPoint(s,this.nextEnvelope(),l,o,this.rotation.computeSide(s,this.currentVector),!1),this.nextdDrawingPoint.intent===Z4DrawingPointIntent.DRAW_BOUNDS&&this.nextdDrawingPoint.intensity>0&&this.clones.push(this.nextdDrawingPoint),this.nextdDrawingPoint}}nextEnvelope(){return this.envelopePosition<this.envelopeA?(this.envelopePosition++,this.envelopePosition/this.envelopeA):this.envelopePosition<this.envelopeAS||this.endlessSustain?(this.envelopePosition++,1):this.envelopePosition<this.envelopeASR?(this.envelopePosition++,1-(this.envelopePosition-this.envelopeAS)/this.envelopeR):0}getNextCountOnSTOP(){return this.clones.length}isInfinitePointGenerator(){return!1}getInfinitePointGeneratorSleep(){return 0}drawDemo(e,t,i,s,n,a,r){t=t||new Z4ArrowPainter,i=i||Z4SpatioTemporalColor.fromColor(new Color(0,0,0,255)),s=s||new Z4ColorProgression(Z4ColorProgressionBehavior.SPATIAL,0,!1,Z4Lighting.NONE);let o=n>a?new Bezier(n/10,a/3,n/2,3*a/2,n/2,-a/2,9*n/10,a/2):new Bezier(n/3,9*a/10,3*n/2,a/2,-n/2,a/2,n/2,a/10),l=o.get(0);this.drawAction(Z4PointIteratorDrawingAction.START,s,l.x,l.y);for(let h=.1;h<1;h+=.1)l=o.get(h),this.drawAction(Z4PointIteratorDrawingAction.CONTINUE,s,l.x,l.y),this.drawDemoPoint(e,l,t,i,s,r);l=o.get(1),this.drawAction(Z4PointIteratorDrawingAction.CONTINUE,s,l.x,l.y),this.drawDemoPoint(e,l,t,i,s,r),this.drawAction(Z4PointIteratorDrawingAction.STOP,s,l.x,l.y),this.drawDemoPoint(e,l,t,i,s,r)}drawDemoPoint(e,t,i,s,n,a){e.save(),e.lineWidth=1,e.fillStyle=Z4Constants.getStyle("black"),e.beginPath(),e.arc(t.x,t.y,2,0,Z4Math.TWO_PI),e.fill(),e.restore();let r=null;for(;null!==(r=this.next(s,n));)a&&(r=new Z4DrawingPoint(r.z4Vector,r.intensity,r.temporalPosition,Z4DrawingPointIntent.DRAW_BOUNDS,r.side,r.useVectorModuleAsSize)),(r.intent===Z4DrawingPointIntent.DRAW_OBJECTS||a)&&(e.save(),e.translate(r.z4Vector.x0,r.z4Vector.y0),e.rotate(r.z4Vector.phase),i.draw(e,r,s,n),e.restore())}toJSON(){let e=super.toJSON();return e.multiplicity=this.multiplicity.toJSON(),e.push=this.push.toJSON(),e.attack=this.attack.toJSON(),e.sustain=this.sustain.toJSON(),e.release=this.release.toJSON(),e.endlessSustain=this.endlessSustain,e.step=this.step.toJSON(),e.assistedDrawing=this.assistedDrawing,e}static fromJSON(e){return new Z4Tracer(Z4FancifulValue.fromJSON(e.multiplicity),Z4FancifulValue.fromJSON(e.push),Z4FancifulValue.fromJSON(e.attack),Z4FancifulValue.fromJSON(e.sustain),Z4FancifulValue.fromJSON(e.release),e.endlessSustain,Z4FancifulValue.fromJSON(e.step),e.assistedDrawing,Z4Rotation.fromJSON(e.rotation))}}class Z4Whirlpool extends Z4JSONable{behavior=null;angle=null;constructor(e,t){super(),this.behavior=e,this.angle=t}getWhirlpoolBehavior(){return this.behavior}getAngle(){return this.angle}toJSON(){let e={};return e.behavior=this.behavior,e.angle=this.angle.toJSON(),e}static fromJSON(e){return new Z4Whirlpool(e.behavior,Z4FancifulValue.fromJSON(e.angle))}}class Z4Painter extends Z4JSONable{getType(){}draw(e,t,i,s){}toJSON(){let e={};return e.type=this.getType(),e}}class Z4ArrowPainter extends Z4Painter{module=30;bool=!1;getType(){return Z4PainterType.ARROW}draw(e,t,i,s){this.bool=!this.bool;let n=t.intensity*(t.useVectorModuleAsSize?t.z4Vector.module:this.module);e.save(),e.lineWidth=2,e.strokeStyle=Z4Constants.getStyle("black"),e.beginPath(),e.arc(0,0,2,0,Z4Math.TWO_PI),e.stroke(),e.strokeStyle=Z4Constants.getStyle(this.bool?"blue":"red"),e.beginPath(),e.moveTo(0,0),e.lineTo(n,0),e.lineTo(n-10,-5),e.lineTo(n-10,5),e.lineTo(n,0),e.stroke(),e.restore()}}class Z4BrushPainter extends Z4Painter{width=null;thickness=null;pattern=null;constructor(e,t,i){super(),this.width=e,this.thickness=t,this.pattern=i}getType(){return Z4PainterType.BRUSH}getWidth(){return this.width}getThickness(){return this.thickness}getPattern(){return this.pattern}draw(e,t,i,s){if(t.intent!==Z4DrawingPointIntent.DRAW_OBJECTS){let n=t.intensity*(t.useVectorModuleAsSize?t.z4Vector.module:this.width.getConstant().getValue()),a=t.intensity*this.thickness.getConstant().getValue();this.drawBounds(e,n,a)}else{let r=t.intensity*(t.useVectorModuleAsSize?t.z4Vector.module:this.width.next()),o=t.intensity*this.thickness.next();if(r>0&&o>0){if(i.isColor()){let l=i.getColorAt(-1,-1);this.drawWithColors(e,t,r,o,null,l,s.getLighting())}else if(i.isGradientColor()){if(s.getColorProgressionBehavior()===Z4ColorProgressionBehavior.SPATIAL)this.drawWithColors(e,t,r,o,i.getGradientColorAt(-1),null,s.getLighting());else{let h=i.getGradientColorAt(-1).getColorAt(s.getColorProgressionBehavior()===Z4ColorProgressionBehavior.RANDOM?Math.random():t.temporalPosition,!0);this.drawWithColors(e,t,r,o,null,h,s.getLighting())}}else if(i.isBiGradientColor()){let d=i.getGradientColorAt(s.getColorProgressionBehavior()===Z4ColorProgressionBehavior.RANDOM?Math.random():t.temporalPosition);this.drawWithColors(e,t,r,o,d,null,s.getLighting())}}}}drawWithColors(e,t,i,s,n,a,r){if(a){if(r===Z4Lighting.NONE)this.drawPath(e,i,s,a.getRGBA_HEX());else if(r===Z4Lighting.LIGHTED_IN_OUT){let o=e.createLinearGradient(-i/2,0,i/2,0);o.addColorStop(0,a.getRGBA_HEX()),o.addColorStop(1,"#FFFFFFFF"),this.drawPath(e,i,s,o)}else if(r===Z4Lighting.DARKENED_IN_OUT){let l=e.createLinearGradient(-i/2,0,i/2,0);l.addColorStop(0,a.getRGBA_HEX()),l.addColorStop(1,"#000000FF"),this.drawPath(e,i,s,l)}else if(r===Z4Lighting.LIGHTED_OUT_IN){let h=e.createLinearGradient(-i/2,0,i/2,0);h.addColorStop(0,"#FFFFFFFF"),h.addColorStop(1,a.getRGBA_HEX()),this.drawPath(e,i,s,h)}else if(r===Z4Lighting.DARKENED_OUT_IN){let d=e.createLinearGradient(-i/2,0,i/2,0);d.addColorStop(0,"#000000FF"),d.addColorStop(1,a.getRGBA_HEX()),this.drawPath(e,i,s,d)}}else n&&(r===Z4Lighting.NONE?this.drawPath(e,i,s,n.createLinearGradient(e,-i/2,0,i/2,0)):r===Z4Lighting.LIGHTED_IN_OUT?this.drawPath(e,i,s,n.lighted(!0).createLinearGradient(e,-i/2,0,i/2,0)):r===Z4Lighting.DARKENED_IN_OUT?this.drawPath(e,i,s,n.darkened(!0).createLinearGradient(e,-i/2,0,i/2,0)):r===Z4Lighting.LIGHTED_OUT_IN?this.drawPath(e,i,s,n.lighted(!1).createLinearGradient(e,-i/2,0,i/2,0)):r===Z4Lighting.DARKENED_OUT_IN&&this.drawPath(e,i,s,n.darkened(!1).createLinearGradient(e,-i/2,0,i/2,0)));this.pattern&&this.drawPattern(e,t,i,s,e.createPattern(this.pattern,"repeat"))}drawPath(e,t,i,s){e.save(),e.rotate(Z4Math.HALF_PI),e.lineCap="round",e.lineWidth=i,e.strokeStyle=Z4Constants.getStyle(s),e.beginPath(),e.moveTo(-t/2,0),e.lineTo(+t/2,0),e.stroke(),e.restore()}drawPattern(e,t,i,s,n){e.save(),e.rotate(-t.z4Vector.phase),e.translate(-t.z4Vector.x0,-t.z4Vector.y0),e.lineCap="round",e.lineWidth=s+2,e.strokeStyle=Z4Constants.getStyle(n),e.beginPath();let a=Z4Math.rotoTranslate(-i/2,0,Z4Math.HALF_PI+t.z4Vector.phase,t.z4Vector.x0,t.z4Vector.y0);e.moveTo(a.x,a.y),a=Z4Math.rotoTranslate(i/2,0,Z4Math.HALF_PI+t.z4Vector.phase,t.z4Vector.x0,t.z4Vector.y0),e.lineTo(a.x,a.y),e.stroke(),e.restore()}drawBounds(e,t,i){e.save(),e.rotate(Z4Math.HALF_PI),e.lineCap="round",e.lineWidth=i,e.strokeStyle=Z4Constants.getStyle("gray"),e.beginPath(),e.moveTo(-t/2,0),e.lineTo(+t/2,0),e.stroke(),e.strokeStyle=Z4Constants.getStyle("black"),e.beginPath(),e.translate(1,1),e.moveTo(-t/2,0),e.lineTo(+t/2,0),e.stroke(),e.restore()}toJSON(){let e=super.toJSON();if(e.width=this.width.toJSON(),e.thickness=this.thickness.toJSON(),this.pattern){let t=document.createElement("canvas");t.width=this.pattern.width,t.height=this.pattern.height;t.getContext("2d").drawImage(this.pattern,0,0),e.pattern=t.toDataURL("image/png",1)}return e}static fromJSON(e){let t=null;return e.pattern&&((t=new Image).src=e.pattern),new Z4BrushPainter(Z4FancifulValue.fromJSON(e.width),Z4FancifulValue.fromJSON(e.thickness),t)}}class Z4CenteredFigurePainter extends Z4Painter{centeredFigurePainterType=null;size=null;angle1=null;angle2=null;tension=null;multiplicity=null;hole=null;whirlpool=null;cover=0;shadowShiftX=null;shadowShiftY=null;shadowColor=null;borderSize=null;borderColor=null;path1e=null;path1i=null;path2e=null;path2i=null;c1e=null;c1i=null;c2e=null;c2i=null;pF=null;pathForShadowBorderE=null;pathForShadowBorderI=null;constructor(e,t,i,s,n,a,r,o,l,h,d,c,g,u){super(),this.centeredFigurePainterType=e,this.size=t,this.angle1=i,this.angle2=s,this.tension=n,this.multiplicity=a,this.hole=r,this.whirlpool=o,this.cover=l,this.shadowShiftX=h,this.shadowShiftY=d,this.shadowColor=c,this.borderSize=g,this.borderColor=u}getType(){return Z4PainterType.CENTERED_FIGURE}getCenteredFigurePainterType(){return this.centeredFigurePainterType}getSize(){return this.size}getAngle1(){return this.angle1}getAngle2(){return this.angle2}getTension(){return this.tension}getMultiplicity(){return this.multiplicity}getHole(){return this.hole}getWhirlpool(){return this.whirlpool}getCover(){return this.cover}getShadowShiftX(){return this.shadowShiftX}getShadowShiftY(){return this.shadowShiftY}getShadowColor(){return this.shadowColor}getBorderSize(){return this.borderSize}getBorderColor(){return this.borderColor}draw(e,t,i,s){if(t.intent!==Z4DrawingPointIntent.DRAW_OBJECTS){let n=t.intensity*(t.useVectorModuleAsSize?t.z4Vector.module:this.size.getConstant().getValue()),a=Z4Math.deg2rad(this.whirlpool.getAngle().getConstant().getValue()),r=this.hole.getConstant().getValue(),o=this.checkWhirlpool1(a,r,n);t=new Z4DrawingPoint(Z4Vector.fromPoints(r,0,o.x,o.y),t.intensity,t.temporalPosition,t.intent,t.side,t.useVectorModuleAsSize),this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_0||this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_1||this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_2?this.type0_1_2(t,1,!1):(this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_3||this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_4||this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_5)&&this.type3_4_5(t,a,r,1,!1),this.drawBounds(e,t)}else{let l=t.intensity*(t.useVectorModuleAsSize?t.z4Vector.module:this.size.next());if(l>0){let h=Z4Math.deg2rad(this.whirlpool.getAngle().next()),d=this.hole.next(),c=this.cover/100,g=this.multiplicity.next(),u=this.checkWhirlpool1(h,d,l);t=new Z4DrawingPoint(Z4Vector.fromPoints(d,0,u.x,u.y),t.intensity,t.temporalPosition,t.intent,t.side,t.useVectorModuleAsSize);let T=this.shadowShiftX.next(),S=this.shadowShiftY.next(),p=this.borderSize.next(),E=T||S||p>0;this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_0||this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_1||this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_2?this.type0_1_2(t,c,E):(this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_3||this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_4||this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_5)&&this.type3_4_5(t,h,d,c,E),this.drawFigures(e,t,g,i,s,T,S,p)}}}drawBounds(e,t){for(let i=0;i<this.multiplicity.getConstant().getValue();i++)e.save(),e.rotate(Z4Math.TWO_PI*i/this.multiplicity.getConstant().getValue()),this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_0||this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_1||this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_2?this.drawBezier(e,t,this.c1e,this.c2e,this.path1e,this.path2e,0,1,new Color(128,128,128,255)):(this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_3||this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_4||this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_5)&&(this.drawBezier(e,t,this.c1i,this.c2i,this.path1i,this.path2i,0,1,new Color(128,128,128,255)),this.drawBezier(e,t,this.c1e,this.c2e,this.path1e,this.path2e,0,1,new Color(128,128,128,255))),e.translate(1,1),this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_0||this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_1||this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_2?this.drawBezier(e,t,this.c1e,this.c2e,this.path1e,this.path2e,0,1,new Color(0,0,0,255)):(this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_3||this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_4||this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_5)&&(this.drawBezier(e,t,this.c1i,this.c2i,this.path1i,this.path2i,0,1,new Color(0,0,0,255)),this.drawBezier(e,t,this.c1e,this.c2e,this.path1e,this.path2e,0,1,new Color(0,0,0,255))),e.restore()}type0_1_2(e,t,i){this.pF=new Z4Point(e.z4Vector.x0,e.z4Vector.y0);let s=Z4Math.butterfly(e.z4Vector,Z4Math.deg2rad(this.angle1.next()));if(this.c1e=s[0],this.c2e=s[1],this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_0)this.path1e=this.findControlPointPath(this.c1e.x,this.c1e.y,e.z4Vector.x0,e.z4Vector.y0,t),this.path2e=this.findControlPointPath(this.c2e.x,this.c2e.y,e.z4Vector.x0,e.z4Vector.y0,t);else if(this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_1)this.path1e=this.findControlPointPath(this.c1e.x,this.c1e.y,e.z4Vector.x,e.z4Vector.y,t),this.path2e=this.findControlPointPath(this.c2e.x,this.c2e.y,e.z4Vector.x,e.z4Vector.y,t);else if(this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_2){let n=(this.c1e.x+this.c2e.x)/2,a=(this.c1e.y+this.c2e.y)/2;this.path1e=this.findControlPointPath(this.c1e.x,this.c1e.y,n,a,t),this.path2e=this.findControlPointPath(this.c2e.x,this.c2e.y,n,a,t)}i&&(this.pathForShadowBorderE=new Path2D,this.pathForShadowBorderE.moveTo(e.z4Vector.x0,e.z4Vector.y0),this.pathForShadowBorderE.bezierCurveTo(this.c1e.x,this.c1e.y,this.c2e.x,this.c2e.y,e.z4Vector.x0,e.z4Vector.y0))}type3_4_5(e,t,i,s,n){this.pF=new Z4Point(e.z4Vector.x,e.z4Vector.y),this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_3?(this.c1e=this.setControlPoint(e,i,0,Z4Math.deg2rad(this.angle1.next()),1,this.tension.next()),this.c1i=this.setControlPoint(e,i,0,Z4Math.deg2rad(this.angle1.next()),-1,this.tension.next()),this.c2e=this.setControlPoint(e,i,-Math.PI,Z4Math.deg2rad(this.angle2.next()),-1,this.tension.next()),this.c2i=this.setControlPoint(e,i,-Math.PI,Z4Math.deg2rad(this.angle2.next()),1,this.tension.next()),this.c2e=new Z4Point(e.z4Vector.module+this.c2e.x,this.c2e.y),this.c2i=new Z4Point(e.z4Vector.module+this.c2i.x,this.c2i.y),this.c1e=this.checkWhirlpool2(e,this.c1e,t,i),this.c1i=this.checkWhirlpool2(e,this.c1i,t,i),this.c2e=this.checkWhirlpool2(e,this.c2e,t,i),this.c2i=this.checkWhirlpool2(e,this.c2i,t,i),this.path1e=this.findControlPointPath(this.c1e.x,this.c1e.y,e.z4Vector.x0,e.z4Vector.y0,s),this.path1i=this.findControlPointPath(this.c1i.x,this.c1i.y,e.z4Vector.x0,e.z4Vector.y0,s),this.path2e=this.findControlPointPath(this.c2e.x,this.c2e.y,e.z4Vector.x,e.z4Vector.y,s),this.path2i=this.findControlPointPath(this.c2i.x,this.c2i.y,e.z4Vector.x,e.z4Vector.y,s)):this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_4?(this.c1e=this.setControlPoint(e,i,0,Z4Math.deg2rad(this.angle1.next()),1,this.tension.next()),this.c1i=this.setControlPoint(e,i,0,Z4Math.deg2rad(this.angle1.next()),-1,this.tension.next()),this.c2e=new Z4Point(e.z4Vector.x0,e.z4Vector.y0),this.c2i=new Z4Point(e.z4Vector.x0,e.z4Vector.y0),this.c1e=this.checkWhirlpool2(e,this.c1e,t,i),this.c1i=this.checkWhirlpool2(e,this.c1i,t,i),this.path1e=this.findControlPointPath(this.c1e.x,this.c1e.y,e.z4Vector.x0,e.z4Vector.y0,s),this.path1i=this.findControlPointPath(this.c1i.x,this.c1i.y,e.z4Vector.x0,e.z4Vector.y0,s),this.path2e=new Z4Point(0,0),this.path2i=new Z4Point(0,0)):this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_5&&(this.c1e=new Z4Point(e.z4Vector.x,e.z4Vector.y),this.c1i=new Z4Point(e.z4Vector.x,e.z4Vector.y),this.c2e=this.setControlPoint(e,i,-Math.PI,Z4Math.deg2rad(this.angle2.next()),-1,this.tension.next()),this.c2i=this.setControlPoint(e,i,-Math.PI,Z4Math.deg2rad(this.angle2.next()),1,this.tension.next()),this.c2e=new Z4Point(e.z4Vector.module+this.c2e.x,this.c2e.y),this.c2i=new Z4Point(e.z4Vector.module+this.c2i.x,this.c2i.y),this.c2e=this.checkWhirlpool2(e,this.c2e,t,i),this.c2i=this.checkWhirlpool2(e,this.c2i,t,i),this.path1e=new Z4Point(0,0),this.path1i=new Z4Point(0,0),this.path2e=this.findControlPointPath(this.c2e.x,this.c2e.y,e.z4Vector.x,e.z4Vector.y,s),this.path2i=this.findControlPointPath(this.c2i.x,this.c2i.y,e.z4Vector.x,e.z4Vector.y,s)),n&&(this.pathForShadowBorderE=new Path2D,this.pathForShadowBorderE.moveTo(e.z4Vector.x0,e.z4Vector.y0),this.pathForShadowBorderE.bezierCurveTo(this.c1e.x,this.c1e.y,this.c2e.x,this.c2e.y,e.z4Vector.x,e.z4Vector.y),this.pathForShadowBorderI=new Path2D,this.pathForShadowBorderI.moveTo(e.z4Vector.x0,e.z4Vector.y0),this.pathForShadowBorderI.bezierCurveTo(this.c1i.x,this.c1i.y,this.c2i.x,this.c2i.y,e.z4Vector.x,e.z4Vector.y))}findControlPointPath(e,t,i,s,n){let a=Z4Math.distance(e,t,i,s),r=Z4Math.atan(e,t,i,s);return new Z4Point(a*n*Math.cos(r),a*n*Math.sin(r))}setControlPoint(e,t,i,s,n,a){return Z4Math.rotoTranslate(a/100*e.intensity*e.z4Vector.module,0,i+n*s,t,0)}checkWhirlpool1(e,t,i){return 0===t||0===e||this.whirlpool.getWhirlpoolBehavior()===Z4WhirlpoolBehavior.NONE?new Z4Point(i+t,0):this.whirlpool.getWhirlpoolBehavior()===Z4WhirlpoolBehavior.FORWARD?Z4Math.rotoTranslate(i,0,e,t,0):this.whirlpool.getWhirlpoolBehavior()===Z4WhirlpoolBehavior.BACKWARD?Z4Math.rotoTranslate(i,0,-e,t,0):null}checkWhirlpool2(e,t,i,s){return 0===s||0===i||this.whirlpool.getWhirlpoolBehavior()===Z4WhirlpoolBehavior.NONE?new Z4Point(t.x+e.z4Vector.x0,t.y+e.z4Vector.y0):this.whirlpool.getWhirlpoolBehavior()===Z4WhirlpoolBehavior.FORWARD?Z4Math.rotoTranslate(t.x,t.y,i,e.z4Vector.x0,e.z4Vector.y0):this.whirlpool.getWhirlpoolBehavior()===Z4WhirlpoolBehavior.BACKWARD?Z4Math.rotoTranslate(t.x,t.y,-i,e.z4Vector.x0,e.z4Vector.y0):null}drawFigures(e,t,i,s,n,a,r,o){for(let l=0;l<i;l++)e.save(),e.rotate(Z4Math.TWO_PI*l/i),this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_0||this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_1||this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_2?this.drawFigure(e,t,this.c1e,this.c2e,this.path1e,this.path2e,s,n,this.pathForShadowBorderE,a,r,o):(this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_3||this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_4||this.centeredFigurePainterType===Z4CenteredFigurePainterType.TYPE_5)&&(this.drawFigure(e,t,this.c1i,this.c2i,this.path1i,this.path2i,s,n,this.pathForShadowBorderI,a,r,o),this.drawFigure(e,t,this.c1e,this.c2e,this.path1e,this.path2e,s,n,this.pathForShadowBorderE,a,r,o)),e.restore()}drawFigure(e,t,i,s,n,a,r,o,l,h,d,c){if((h||d)&&this.drawShadow(e,l,h,d,c),c>0&&this.drawBorder(e,l,c),r.isColor()){let g=r.getColorAt(-1,-1);this.drawFigureWithColors(e,t,i,s,n,a,null,null,g,o.getLighting())}else if(r.isGradientColor()){if(o.getColorProgressionBehavior()===Z4ColorProgressionBehavior.SPATIAL)this.drawFigureWithColors(e,t,i,s,n,a,r,null,null,o.getLighting());else{let u=r.getGradientColorAt(-1).getColorAt(o.getColorProgressionBehavior()===Z4ColorProgressionBehavior.RANDOM?Math.random():t.temporalPosition,!0);this.drawFigureWithColors(e,t,i,s,n,a,null,null,u,o.getLighting())}}else if(r.isBiGradientColor()){let T=r.getGradientColorAt(o.getColorProgressionBehavior()===Z4ColorProgressionBehavior.RANDOM?Math.random():t.temporalPosition);this.drawFigureWithColors(e,t,i,s,n,a,null,T,null,o.getLighting())}}drawFigureWithColors(e,t,i,s,n,a,r,o,l,h){let d=Math.max(Z4Math.distance(n.x,n.y,0,0),Z4Math.distance(a.x,a.y,0,0));for(let c=0;c<d;c+=3){let g=c/d;if(l&&h===Z4Lighting.NONE)this.drawBezier(e,t,i,s,n,a,g,3,l);else{let u=l;r?u=r.getColorAt(-1,g):o&&(u=o.getColorAt(g,!0)),h===Z4Lighting.NONE?this.drawBezier(e,t,i,s,n,a,g,3,u):h===Z4Lighting.LIGHTED_IN_OUT?this.drawBezier(e,t,i,s,n,a,g,3,u.lighted(1-g)):h===Z4Lighting.DARKENED_IN_OUT?this.drawBezier(e,t,i,s,n,a,g,3,u.darkened(1-g)):h===Z4Lighting.LIGHTED_OUT_IN?this.drawBezier(e,t,i,s,n,a,g,3,u.lighted(g)):h===Z4Lighting.DARKENED_OUT_IN&&this.drawBezier(e,t,i,s,n,a,g,3,u.darkened(g))}}}drawBezier(e,t,i,s,n,a,r,o,l){e.save(),e.lineWidth=o,e.strokeStyle=Z4Constants.getStyle(l.getRGBA_HEX()),e.beginPath(),e.moveTo(t.z4Vector.x0,0),e.bezierCurveTo(i.x+n.x*r,i.y+n.y*r,s.x+a.x*r,s.y+a.y*r,this.pF.x,this.pF.y),e.stroke(),e.restore()}drawShadow(e,t,i,s,n){e.save(),e.translate(i,s),n>0&&(e.lineWidth=n,e.strokeStyle=Z4Constants.getStyle(this.shadowColor.getRGBA_HEX()),e.stroke(t)),e.fillStyle=Z4Constants.getStyle(this.shadowColor.getRGBA_HEX()),e.fill(t),e.restore()}drawBorder(e,t,i){e.save(),e.lineWidth=i,e.strokeStyle=Z4Constants.getStyle(this.borderColor.getRGBA_HEX()),e.stroke(t),e.restore()}toJSON(){let e=super.toJSON();return e.centeredFigurePainterType=this.centeredFigurePainterType,e.size=this.size.toJSON(),e.angle1=this.angle1.toJSON(),e.angle2=this.angle2.toJSON(),e.tension=this.tension.toJSON(),e.multiplicity=this.multiplicity.toJSON(),e.hole=this.hole.toJSON(),e.whirlpool=this.whirlpool.toJSON(),e.cover=this.cover,e.shadowShiftX=this.shadowShiftX.toJSON(),e.shadowShiftY=this.shadowShiftY.toJSON(),e.shadowColor=this.shadowColor.getJSON(),e.borderSize=this.borderSize.toJSON(),e.borderColor=this.borderColor.getJSON(),e}static fromJSON(e){return new Z4CenteredFigurePainter(e.centeredFigurePainterType,Z4FancifulValue.fromJSON(e.size),Z4FancifulValue.fromJSON(e.angle1),Z4FancifulValue.fromJSON(e.angle2),Z4FancifulValue.fromJSON(e.tension),Z4FancifulValue.fromJSON(e.multiplicity),Z4FancifulValue.fromJSON(e.hole),Z4Whirlpool.fromJSON(e.whirlpool),e.cover,Z4FancifulValue.fromJSON(e.shadowShiftX),Z4FancifulValue.fromJSON(e.shadowShiftY),Color.fromJSON(e.shadowColor),Z4FancifulValue.fromJSON(e.borderSize),Color.fromJSON(e.borderColor))}}class Z4DropPainter extends Z4Painter{dropPainterType=null;radius=null;intensity=0;gaussianCorrection=0;constructor(e,t,i,s){super(),this.dropPainterType=e,this.radius=t,this.intensity=i,this.gaussianCorrection=s}getType(){return Z4PainterType.DROP}getDropPainterType(){return this.dropPainterType}getRadius(){return this.radius}getIntensity(){return this.intensity}getGaussianCorrection(){return this.gaussianCorrection}draw(e,t,i,s){if(t.intent!==Z4DrawingPointIntent.DRAW_OBJECTS){let n=t.intensity*(t.useVectorModuleAsSize?t.z4Vector.module:this.radius.getConstant().getValue());this.drawBounds(e,n)}else{let a=t.intensity*(t.useVectorModuleAsSize?t.z4Vector.module:this.radius.next());if(a>0){if(i.isColor()){let r=i.getColorAt(-1,-1);this.drawWithColors(e,a,null,null,r,s.getLighting())}else if(i.isGradientColor()){if(s.getColorProgressionBehavior()===Z4ColorProgressionBehavior.SPATIAL)this.drawWithColors(e,a,i,null,null,s.getLighting());else{let o=i.getGradientColorAt(-1).getColorAt(s.getColorProgressionBehavior()===Z4ColorProgressionBehavior.RANDOM?Math.random():t.temporalPosition,!0);this.drawWithColors(e,a,null,null,o,s.getLighting())}}else if(i.isBiGradientColor()){let l=i.getGradientColorAt(s.getColorProgressionBehavior()===Z4ColorProgressionBehavior.RANDOM?Math.random():t.temporalPosition);this.drawWithColors(e,a,null,l,null,s.getLighting())}}}}drawWithColors(e,t,i,s,n,a){let r=t*this.intensity/2;for(let o=0;o<r;o++){let l=t*Z4Math.randomCorrected(this.gaussianCorrection/10);if(n&&a===Z4Lighting.NONE)this.drawPath(e,l,n);else{let h=n;i?h=i.getColorAt(-1,l/t):s&&(h=s.getColorAt(l/t,!0)),a===Z4Lighting.NONE?this.drawPath(e,l,h):a===Z4Lighting.LIGHTED_IN_OUT?this.drawPath(e,l,h.lighted(l/t)):a===Z4Lighting.DARKENED_IN_OUT?this.drawPath(e,l,h.darkened(l/t)):a===Z4Lighting.LIGHTED_OUT_IN?this.drawPath(e,l,h.lighted(1-l/t)):a===Z4Lighting.DARKENED_OUT_IN&&this.drawPath(e,l,h.darkened(1-l/t))}}}drawPath(e,t,i){e.save(),e.fillStyle=Z4Constants.getStyle(i.getRGBA_HEX()),e.strokeStyle=Z4Constants.getStyle(i.getRGBA_HEX());let s=Math.random()*Z4Math.TWO_PI,n=t*Math.cos(s),a=t*Math.sin(s);e.beginPath(),this.dropPainterType===Z4DropPainterType.THOUSAND_POINTS?(e.arc(n,a,1,0,Z4Math.TWO_PI),e.fill()):this.dropPainterType===Z4DropPainterType.THOUSAND_LINES?(e.moveTo(n+Z4Math.SQRT_OF_2,a),e.lineTo(n-Z4Math.SQRT_OF_2,a),e.stroke()):this.dropPainterType===Z4DropPainterType.THOUSAND_AREAS&&(e.arc(n,a,2,0,Z4Math.TWO_PI),e.fill()),e.restore()}drawBounds(e,t){e.save(),e.strokeStyle=Z4Constants.getStyle("gray"),e.beginPath(),e.arc(0,0,t,0,Z4Math.TWO_PI),e.stroke(),e.strokeStyle=Z4Constants.getStyle("black"),e.beginPath(),e.arc(1,1,t,0,Z4Math.TWO_PI),e.stroke(),e.restore()}toJSON(){let e=super.toJSON();return e.dropPainterType=this.dropPainterType,e.radius=this.radius.toJSON(),e.intensity=this.intensity,e.gaussianCorrection=this.gaussianCorrection,e}static fromJSON(e){return new Z4DropPainter(e.dropPainterType,Z4FancifulValue.fromJSON(e.radius),e.intensity,e.gaussianCorrection)}}class Z4NaturalFigurePainter extends Z4Painter{naturalFigurePainterType=null;controlPointClosure=null;size=null;internalAngle1=null;externalAngle1=null;internalAngle2=null;externalAngle2=null;internalTension1=null;externalTension1=null;internalTension2=null;externalTension2=null;indentation=0;externalForceAngle=null;externalForceTension=null;shadowShiftX=null;shadowShiftY=null;shadowColor=null;borderSize=null;borderColor=null;path1=null;path2=null;c1e=null;c1i=null;c2e=null;c2i=null;pF=null;pathForShadowBorder=null;constructor(e,t,i,s,n,a,r,o,l,h,d,c,g,u,T,S,p,E,w){super(),this.naturalFigurePainterType=e,this.controlPointClosure=t,this.size=i,this.internalAngle1=s,this.externalAngle1=n,this.internalAngle2=a,this.externalAngle2=r,this.internalTension1=o,this.externalTension1=l,this.internalTension2=h,this.externalTension2=d,this.indentation=c,this.externalForceAngle=g,this.externalForceTension=u,this.shadowShiftX=T,this.shadowShiftY=S,this.shadowColor=p,this.borderSize=E,this.borderColor=w}getType(){return Z4PainterType.NATURAL_FIGURE}getNaturalFigurePainterType(){return this.naturalFigurePainterType}getControlPointClosure(){return this.controlPointClosure}getSize(){return this.size}getInternalAngle1(){return this.internalAngle1}getExternalAngle1(){return this.externalAngle1}getInternalAngle2(){return this.internalAngle2}getExternalAngle2(){return this.externalAngle2}getInternalTension1(){return this.internalTension1}getExternalTension1(){return this.externalTension1}getInternalTension2(){return this.internalTension2}getExternalTension2(){return this.externalTension2}getIndentation(){return this.indentation}getExternalForceAngle(){return this.externalForceAngle}getExternalForceTension(){return this.externalForceTension}getShadowShiftX(){return this.shadowShiftX}getShadowShiftY(){return this.shadowShiftY}getShadowColor(){return this.shadowColor}getBorderSize(){return this.borderSize}getBorderColor(){return this.borderColor}draw(e,t,i,s){if(t.intent!==Z4DrawingPointIntent.DRAW_OBJECTS){let n=t.intensity*(t.useVectorModuleAsSize?t.z4Vector.module:this.size.getConstant().getValue()),a=t.z4Vector.phase,r=this.externalForceAngle.getConstant().getValue(),o=this.externalForceTension.getConstant().getValue();t=new Z4DrawingPoint(Z4Vector.fromVector(0,0,n,0),t.intensity,t.temporalPosition,t.intent,t.side,t.useVectorModuleAsSize),this.evalForce(t,a,r,o),this.c1e=this.setControlPoint(0,Z4Math.deg2rad(this.externalAngle1.getConstant().getValue()),1,this.externalTension1.getConstant().getValue(),t.intensity,t.side.next()),this.c1i=this.setControlPoint(0,Z4Math.deg2rad(this.internalAngle1.getConstant().getValue()),-1,this.internalTension1.getConstant().getValue(),t.intensity,t.side.next()),this.c2e=this.setControlPoint(-Math.PI,Z4Math.deg2rad(this.externalAngle2.getConstant().getValue()),-1,this.externalTension2.getConstant().getValue(),t.intensity,t.side.next()),this.c2i=this.setControlPoint(-Math.PI,Z4Math.deg2rad(this.internalAngle2.getConstant().getValue()),1,this.internalTension2.getConstant().getValue(),t.intensity,t.side.next()),this.evalPointClosure(t),this.naturalFigurePainterType===Z4NaturalFigurePainterType.TYPE_0?this.type0(e,t,null,null,!1,0,0,0,!0):this.naturalFigurePainterType===Z4NaturalFigurePainterType.TYPE_1?this.type1(e,t,null,null,!1,0,0,0,!0):this.naturalFigurePainterType===Z4NaturalFigurePainterType.TYPE_2?this.type2(e,t,null,null,!1,0,0,0,!0):this.naturalFigurePainterType===Z4NaturalFigurePainterType.TYPE_3&&this.type3(e,t,null,null,!1,0,0,0,!0)}else{let l=t.intensity*(t.useVectorModuleAsSize?t.z4Vector.module:this.size.next());if(l>0){let h=t.z4Vector.phase,d=this.externalForceAngle.next(),c=this.externalForceTension.next();t=new Z4DrawingPoint(Z4Vector.fromVector(0,0,l,0),t.intensity,t.temporalPosition,t.intent,t.side,t.useVectorModuleAsSize),this.evalForce(t,h,d,c),this.c1e=this.setControlPoint(0,Z4Math.deg2rad(this.externalAngle1.next()),1,this.externalTension1.next(),t.intensity,t.side.next()),this.c1i=this.setControlPoint(0,Z4Math.deg2rad(this.internalAngle1.next()),-1,this.internalTension1.next(),t.intensity,t.side.next()),this.c2e=this.setControlPoint(-Math.PI,Z4Math.deg2rad(this.externalAngle2.next()),-1,this.externalTension2.next(),t.intensity,t.side.next()),this.c2i=this.setControlPoint(-Math.PI,Z4Math.deg2rad(this.internalAngle2.next()),1,this.internalTension2.next(),t.intensity,t.side.next()),this.evalPointClosure(t);let g=this.shadowShiftX.next(),u=this.shadowShiftY.next(),T=this.borderSize.next(),S=g||u||T>0;this.naturalFigurePainterType===Z4NaturalFigurePainterType.TYPE_0?this.type0(e,t,i,s,S,g,u,T,!1):this.naturalFigurePainterType===Z4NaturalFigurePainterType.TYPE_1?this.type1(e,t,i,s,S,g,u,T,!1):this.naturalFigurePainterType===Z4NaturalFigurePainterType.TYPE_2?this.type2(e,t,i,s,S,g,u,T,!1):this.naturalFigurePainterType===Z4NaturalFigurePainterType.TYPE_3&&this.type3(e,t,i,s,S,g,u,T,!1)}}}evalForce(e,t,i,s){if(s>0){let n=Z4Math.deg2rad(i)-t,a=e.intensity*s;this.pF=new Z4Point(e.z4Vector.x+a*Math.cos(n),e.z4Vector.y+a*Math.sin(n))}else this.pF=new Z4Point(e.z4Vector.x,e.z4Vector.y)}setControlPoint(e,t,i,s,n,a){return Z4Math.rotate(n*s,0,e+i*a*t)}evalPointClosure(e){this.controlPointClosure===Z4NaturalFigurePainterControlPointClosure.CONTROL_POINT_CLOSURE_0?(this.c1e=new Z4Point(this.c1e.x+e.z4Vector.x,this.c1e.y+e.z4Vector.y),this.c1i=new Z4Point(this.c1i.x+e.z4Vector.x,this.c1i.y+e.z4Vector.y),this.c2e=new Z4Point(this.c2e.x+e.z4Vector.x,this.c2e.y+e.z4Vector.y),this.c2i=new Z4Point(this.c2i.x+e.z4Vector.x,this.c2i.y+e.z4Vector.y)):this.controlPointClosure===Z4NaturalFigurePainterControlPointClosure.CONTROL_POINT_CLOSURE_1?(this.c2e=new Z4Point(this.c2e.x+e.z4Vector.x,this.c2e.y+e.z4Vector.y),this.c2i=new Z4Point(this.c2i.x+e.z4Vector.x,this.c2i.y+e.z4Vector.y)):(this.controlPointClosure,Z4NaturalFigurePainterControlPointClosure.CONTROL_POINT_CLOSURE_2)}type0(e,t,i,s,n,a,r,o,l){this.path1=this.findControlPointPath(this.c1e.x,this.c1e.y,this.c1i.x,this.c1i.y),this.path2=this.findControlPointPath(this.c2e.x,this.c2e.y,this.c2i.x,this.c2i.y),n&&(this.pathForShadowBorder=new Path2D,this.pathForShadowBorder.moveTo(t.z4Vector.x0,t.z4Vector.y0),this.pathForShadowBorder.bezierCurveTo(this.c1e.x,this.c1e.y,this.c2e.x,this.c2e.y,this.pF.x,this.pF.y),this.pathForShadowBorder.bezierCurveTo(this.c2i.x,this.c2i.y,this.c1i.x,this.c1i.y,t.z4Vector.x0,t.z4Vector.y0)),this.drawFigure(e,t,this.c1e,this.c2e,i,s,a,r,o,l)}type1(e,t,i,s,n,a,r,o,l){this.path1=this.findControlPointPath(this.c1i.x,this.c1i.y,0,0),this.path2=this.findControlPointPath(this.c2i.x,this.c2i.y,this.pF.x,this.pF.y),n&&(this.pathForShadowBorder=new Path2D,this.pathForShadowBorder.moveTo(t.z4Vector.x0,t.z4Vector.y0),pathForShadowBorder.bezierCurveTo(this.c1i.x,this.c1i.y,this.c2i.x,this.c2i.y,this.pF.x,this.pF.y)),this.drawFigure(e,t,this.c1i,this.c2i,i,s,a,r,o,l),this.path1=this.findControlPointPath(this.c1e.x,this.c1e.y,0,0),this.path2=this.findControlPointPath(this.c2e.x,this.c2e.y,this.pF.x,this.pF.y),n&&(this.pathForShadowBorder=new Path2D,this.pathForShadowBorder.moveTo(t.z4Vector.x0,t.z4Vector.y0),pathForShadowBorder.bezierCurveTo(this.c1e.x,this.c1e.y,this.c2e.x,this.c2e.y,this.pF.x,this.pF.y)),this.drawFigure(e,t,this.c1e,this.c2e,i,s,a,r,o,l)}type2(e,t,i,s,n,a,r,o,l){this.path1=this.findControlPointPath(this.c2i.x,this.c2i.y,0,0),this.path2=this.findControlPointPath(this.c1i.x,this.c1i.y,this.pF.x,this.pF.y),n&&(this.pathForShadowBorder=new Path2D,this.pathForShadowBorder.moveTo(t.z4Vector.x0,t.z4Vector.y0),pathForShadowBorder.bezierCurveTo(this.c2i.x,this.c2i.y,this.c1i.x,this.c1i.y,this.pF.x,this.pF.y)),this.drawFigure(e,t,this.c2i,this.c1i,i,s,a,r,o,l),this.path1=this.findControlPointPath(this.c2e.x,this.c2e.y,0,0),this.path2=this.findControlPointPath(this.c1e.x,this.c1e.y,this.pF.x,this.pF.y),n&&(this.pathForShadowBorder=new Path2D,this.pathForShadowBorder.moveTo(t.z4Vector.x0,t.z4Vector.y0),pathForShadowBorder.bezierCurveTo(this.c2e.x,this.c2e.y,this.c1e.x,this.c1e.y,this.pF.x,this.pF.y)),this.drawFigure(e,t,this.c2e,this.c1e,i,s,a,r,o,l)}type3(e,t,i,s,n,a,r,o,l){this.path1=this.findControlPointPath(this.c1e.x,this.c1e.y,this.c1i.x,this.c1i.y),this.path2=this.findControlPointPath(this.c2i.x,this.c2i.y,this.c2e.x,this.c2e.y),n&&(this.pathForShadowBorder=new Path2D,this.pathForShadowBorder.moveTo(t.z4Vector.x0,t.z4Vector.y0),this.pathForShadowBorder.bezierCurveTo(this.c1e.x,this.c1e.y,this.c2i.x,this.c2i.y,this.pF.x,this.pF.y),this.pathForShadowBorder.bezierCurveTo(this.c2e.x,this.c2e.y,this.c1i.x,this.c1i.y,t.z4Vector.x0,t.z4Vector.y0)),this.drawFigure(e,t,this.c1e,this.c2i,i,s,a,r,o,l)}findControlPointPath(e,t,i,s){let n=Z4Vector.fromPoints(e,t,i,s);return Z4Math.rotate(n.module,0,n.phase)}drawFigure(e,t,i,s,n,a,r,o,l,h){if((r||o)&&this.drawShadow(e,r,o,l),l>0&&this.drawBorder(e,l),h)this.drawFigureWithColors(e,t,i,s,null,null,null,null,h);else if(n.isColor()){let d=n.getColorAt(-1,-1);this.drawFigureWithColors(e,t,i,s,null,null,d,a.getLighting(),h)}else if(n.isGradientColor()){if(a.getColorProgressionBehavior()===Z4ColorProgressionBehavior.SPATIAL)this.drawFigureWithColors(e,t,i,s,n,null,null,a.getLighting(),h);else{let c=n.getGradientColorAt(-1).getColorAt(a.getColorProgressionBehavior()===Z4ColorProgressionBehavior.RANDOM?Math.random():t.temporalPosition,!0);this.drawFigureWithColors(e,t,i,s,null,null,c,a.getLighting(),h)}}else if(n.isBiGradientColor()){let g=n.getGradientColorAt(a.getColorProgressionBehavior()===Z4ColorProgressionBehavior.RANDOM?Math.random():t.temporalPosition);this.drawFigureWithColors(e,t,i,s,null,g,null,a.getLighting(),h)}}drawFigureWithColors(e,t,i,s,n,a,r,o,l){let h=Math.max(Z4Math.distance(this.path1.x,this.path1.y,0,0),Z4Math.distance(this.path2.x,this.path2.y,0,0));if(l){let d=this.indentation*Math.random(),c=Z4Math.TWO_PI*Math.random();e.save(),this.drawBezier(e,t,i,s,0,d,c,1,new Color(128,128,128,255)),this.drawBezier(e,t,i,s,1,d,c,1,new Color(128,128,128,255)),e.translate(1,1),this.drawBezier(e,t,i,s,0,d,c,1,new Color(0,0,0,255)),this.drawBezier(e,t,i,s,1,d,c,1,new Color(0,0,0,255)),e.restore()}else for(let g=0;g<h;g+=3){let u=g/h,T=r;r&&o===Z4Lighting.NONE||(n?T=n.getColorAt(-1,u):a&&(T=a.getColorAt(u,!0))),o===Z4Lighting.NONE||(o===Z4Lighting.LIGHTED_IN_OUT?T=T.lighted(1-u):o===Z4Lighting.DARKENED_IN_OUT?T=T.darkened(1-u):o===Z4Lighting.LIGHTED_OUT_IN?T=T.lighted(u):o===Z4Lighting.DARKENED_OUT_IN&&(T=T.darkened(u))),this.drawBezier(e,t,i,s,u,this.indentation*Math.random(),Z4Math.TWO_PI*Math.random(),3,T)}}drawBezier(e,t,i,s,n,a,r,o,l){let h=a>0?a*Math.cos(r):0,d=a>0?a*Math.sin(r):0;e.save(),e.lineWidth=o,e.strokeStyle=Z4Constants.getStyle(l.getRGBA_HEX()),e.beginPath(),e.moveTo(t.z4Vector.x0,0),e.bezierCurveTo(i.x+this.path1.x*n,i.y+this.path1.y*n,s.x+this.path2.x*n,s.y+this.path2.y*n,this.pF.x+h,this.pF.y+d),e.stroke(),e.restore()}drawShadow(e,t,i,s){e.save(),e.translate(t,i),s>0&&(e.lineWidth=s,e.strokeStyle=Z4Constants.getStyle(this.shadowColor.getRGBA_HEX()),e.stroke(this.pathForShadowBorder)),e.fillStyle=Z4Constants.getStyle(this.shadowColor.getRGBA_HEX()),e.fill(this.pathForShadowBorder),e.restore()}drawBorder(e,t){e.save(),e.lineWidth=t,e.strokeStyle=Z4Constants.getStyle(this.borderColor.getRGBA_HEX()),e.stroke(this.pathForShadowBorder),e.restore()}toJSON(){let e=super.toJSON();return e.naturalFigurePainterType=this.naturalFigurePainterType,e.controlPointClosure=this.controlPointClosure,e.size=this.size.toJSON(),e.internalAngle1=this.internalAngle1.toJSON(),e.externalAngle1=this.externalAngle1.toJSON(),e.internalAngle2=this.internalAngle2.toJSON(),e.externalAngle2=this.externalAngle2.toJSON(),e.internalTension1=this.internalTension1.toJSON(),e.externalTension1=this.externalTension1.toJSON(),e.internalTension2=this.internalTension2.toJSON(),e.externalTension2=this.externalTension2.toJSON(),e.indentation=this.indentation,e.externalForceAngle=this.externalForceAngle.toJSON(),e.externalForceTension=this.externalForceTension.toJSON(),e.shadowShiftX=this.shadowShiftX.toJSON(),e.shadowShiftY=this.shadowShiftY.toJSON(),e.shadowColor=this.shadowColor.getJSON(),e.borderSize=this.borderSize.toJSON(),e.borderColor=this.borderColor.getJSON(),e}static fromJSON(e){return new Z4NaturalFigurePainter(e.naturalFigurePainterType,e.controlPointClosure,Z4FancifulValue.fromJSON(e.size),Z4FancifulValue.fromJSON(e.internalAngle1),Z4FancifulValue.fromJSON(e.externalAngle1),Z4FancifulValue.fromJSON(e.internalAngle2),Z4FancifulValue.fromJSON(e.externalAngle2),Z4FancifulValue.fromJSON(e.internalTension1),Z4FancifulValue.fromJSON(e.externalTension1),Z4FancifulValue.fromJSON(e.internalTension2),Z4FancifulValue.fromJSON(e.externalTension2),e.indentation,Z4FancifulValue.fromJSON(e.externalForceAngle),Z4FancifulValue.fromJSON(e.externalForceTension),Z4FancifulValue.fromJSON(e.shadowShiftX),Z4FancifulValue.fromJSON(e.shadowShiftY),Color.fromJSON(e.shadowColor),Z4FancifulValue.fromJSON(e.borderSize),Color.fromJSON(e.borderColor))}}class Z4PatternPainter extends Z4Painter{patterns=null;randomSequence=!1;multiSize=!1;index=-1;constructor(e,t,i){super(),this.patterns=e,this.randomSequence=t,this.multiSize=i}getType(){return Z4PainterType.PATTERN}getPatterns(){return this.patterns}isRandomSequence(){return this.randomSequence}isMultiSize(){return this.multiSize}draw(e,t,i,s){if(this.patterns.length){this.randomSequence?this.index=parseInt(this.patterns.length*Math.random()):(this.index++,this.index%=this.patterns.length);let n=this.multiSize?Math.random():1,a=t.intensity*(t.useVectorModuleAsSize?t.z4Vector.module:n*this.patterns[this.index].width),r=t.intensity*(t.useVectorModuleAsSize?t.z4Vector.module:n*this.patterns[this.index].height);t.intent!==Z4DrawingPointIntent.DRAW_OBJECTS?this.drawBounds(e,a,r):this.drawPattern(e,this.patterns[this.index],a,r)}}drawPattern(e,t,i,s){e.save(),e.drawImage(t,-i/2,-s/2,i,s),e.restore()}drawBounds(e,t,i){e.save(),e.strokeStyle=Z4Constants.getStyle("gray"),e.beginPath(),e.ellipse(0,0,t/2,i/2,0,0,Z4Math.TWO_PI),e.stroke(),e.strokeStyle=Z4Constants.getStyle("black"),e.beginPath(),e.translate(1,1),e.ellipse(0,0,t/2,i/2,0,0,Z4Math.TWO_PI),e.stroke(),e.restore()}toJSON(){let e=super.toJSON(),t=[];return this.patterns.forEach(e=>{let i=document.createElement("canvas");i.width=e.width,i.height=e.height;i.getContext("2d").drawImage(e,0,0),t.push(i.toDataURL("image/png",1))}),e.patterns=t,e.randomSequence=this.randomSequence,e.multiSize=this.multiSize,e}static fromJSON(e){let t=[];return e.patterns.forEach(e=>{let i=new Image;i.src=e,t.push(i)}),new Z4PatternPainter(t,e.randomSequence,e.multiSize)}}class Z4Shape2DPainter extends Z4Painter{width=null;height=null;regular=!1;star=!1;vertices=0;shadowShiftX=null;shadowShiftY=null;shadowColor=null;borderWidth=null;borderHeight=null;borderColor=null;path=new Path2D;constructor(e,t,i,s,n,a,r,o,l,h,d){super(),this.width=e,this.height=t,this.regular=i,this.star=s,this.vertices=n,this.shadowShiftX=a,this.shadowShiftY=r,this.shadowColor=o,this.borderWidth=l,this.borderHeight=h,this.borderColor=d,-1===n?this.path.arc(0,0,1,0,Z4Math.TWO_PI):s?Z4Math.getStarVertices(n).forEach((e,t,i)=>{t?this.path.lineTo(e.x,e.y):this.path.moveTo(e.x,e.y)}):Z4Math.getPolygonVertices(n).forEach((e,t,i)=>{t?this.path.lineTo(e.x,e.y):this.path.moveTo(e.x,e.y)}),this.path.closePath()}getType(){return Z4PainterType.SHAPE_2D}getWidth(){return this.width}getHeight(){return this.height}isRegular(){return this.regular}isStar(){return this.star}getVertices(){return this.vertices}getShadowShiftX(){return this.shadowShiftX}getShadowShiftY(){return this.shadowShiftY}getShadowColor(){return this.shadowColor}getBorderWidth(){return this.borderWidth}getBorderHeight(){return this.borderHeight}getBorderColor(){return this.borderColor}draw(e,t,i,s){if(t.intent!==Z4DrawingPointIntent.DRAW_OBJECTS){let n=t.intensity*(t.useVectorModuleAsSize?t.z4Vector.module:this.width.getConstant().getValue()),a=this.regular?n:t.intensity*(t.useVectorModuleAsSize?t.z4Vector.module:this.height.getConstant().getValue());this.drawBounds(e,n,a)}else{let r=t.intensity*(t.useVectorModuleAsSize?t.z4Vector.module:this.width.next()),o=this.regular?r:t.intensity*(t.useVectorModuleAsSize?t.z4Vector.module:this.height.next());if(r>0&&o>0){let l=this.shadowShiftX.next(),h=this.shadowShiftY.next(),d=this.borderWidth.next(),c=this.borderHeight.next();if((l||h)&&(e.save(),e.translate(l,h),this.drawPath(e,r+(d>0?d:0),o+(c>0?c:0),this.shadowColor),e.restore()),(d>0||c>0)&&(e.save(),this.drawPath(e,r+d,o+c,this.borderColor),e.restore()),i.isColor()){let g=i.getColorAt(-1,-1);this.drawPathWithColors(e,r,o,null,null,g,s.getLighting())}else if(i.isGradientColor()){if(s.getColorProgressionBehavior()===Z4ColorProgressionBehavior.SPATIAL)this.drawPathWithColors(e,r,o,i,null,null,s.getLighting());else{let u=i.getGradientColorAt(-1).getColorAt(s.getColorProgressionBehavior()===Z4ColorProgressionBehavior.RANDOM?Math.random():t.temporalPosition,!0);this.drawPathWithColors(e,r,o,null,null,u,s.getLighting())}}else if(i.isBiGradientColor()){let T=i.getGradientColorAt(s.getColorProgressionBehavior()===Z4ColorProgressionBehavior.RANDOM?Math.random():t.temporalPosition);this.drawPathWithColors(e,r,o,null,T,null,s.getLighting())}}}}drawPathWithColors(e,t,i,s,n,a,r){if(a&&r===Z4Lighting.NONE)this.drawPath(e,t,i,a);else{let o=Math.max(t,i);for(let l=o;l>0;l--)s?a=s.getColorAt(-1,l/o):n&&(a=n.getColorAt(l/o,!0)),r===Z4Lighting.NONE?this.drawPath(e,t*l/o,i*l/o,a):r===Z4Lighting.LIGHTED_IN_OUT?this.drawPath(e,t*l/o,i*l/o,a.lighted(l/o)):r===Z4Lighting.DARKENED_IN_OUT?this.drawPath(e,t*l/o,i*l/o,a.darkened(l/o)):r===Z4Lighting.LIGHTED_OUT_IN?this.drawPath(e,t*l/o,i*l/o,a.lighted(1-l/o)):r===Z4Lighting.DARKENED_OUT_IN&&this.drawPath(e,t*l/o,i*l/o,a.darkened(1-l/o))}}drawPath(e,t,i,s){e.save(),e.scale(t,i),e.fillStyle=Z4Constants.getStyle(s.getRGBA_HEX()),e.fill(this.path),e.restore()}drawBounds(e,t,i){e.save(),e.scale(t,i),e.lineWidth=1/Math.min(t,i),e.strokeStyle=Z4Constants.getStyle("gray"),e.stroke(this.path),e.strokeStyle=Z4Constants.getStyle("black"),e.translate(1/t,1/i),e.stroke(this.path),e.restore()}toJSON(){let e=super.toJSON();return e.width=this.width.toJSON(),e.height=this.height.toJSON(),e.regular=this.regular,e.star=this.star,e.vertices=this.vertices,e.shadowShiftX=this.shadowShiftX.toJSON(),e.shadowShiftY=this.shadowShiftY.toJSON(),e.shadowColor=this.shadowColor.getJSON(),e.borderWidth=this.borderWidth.toJSON(),e.borderHeight=this.borderHeight.toJSON(),e.borderColor=this.borderColor.getJSON(),e}static fromJSON(e){return new Z4Shape2DPainter(Z4FancifulValue.fromJSON(e.width),Z4FancifulValue.fromJSON(e.height),e.regular,e.star,e.vertices,Z4FancifulValue.fromJSON(e.shadowShiftX),Z4FancifulValue.fromJSON(e.shadowShiftY),Color.fromJSON(e.shadowColor),Z4FancifulValue.fromJSON(e.borderWidth),Z4FancifulValue.fromJSON(e.borderHeight),Color.fromJSON(e.borderColor))}}class Z4Layer{offscreen=null;offscreenCtx=null;layerPreview=null;blob=null;name=null;offsetX=0;offsetY=0;opacity=1;compositeOperation="source-over";width=0;height=0;hidden=!1;showBounds=!1;constructor(e,t,i,s,n,a){if(this.name=e,this.offscreen=new OffscreenCanvas(t,i),this.offscreenCtx=this.offscreen.getContext("2d"),s instanceof Color)this.offscreenCtx.fillStyle=Z4Constants.getStyle(s.getRGBA_HEX()),this.offscreenCtx.fillRect(0,0,t,i);else if(s instanceof Z4AbstractFiller){let r=this.offscreenCtx.createImageData(t,i);s.fill(r),this.offscreenCtx.putImageData(r,0,0)}else if(s instanceof Z4BiGradientColor){let o=this.offscreenCtx.createImageData(t,i),l=o.data;for(let h=0;h<i;h++){let d=s.getColorAt(h/i,!0);for(let c=0;c<t;c++){let g=d.getColorAt(c/t,!0),u=(h*t+c)*4;l[u]=g.red,l[u+1]=g.green,l[u+2]=g.blue,l[u+3]=g.alpha}}this.offscreenCtx.putImageData(o,0,0)}this.offsetX=(n-t)/2,this.offsetY=(a-i)/2,this.width=t,this.height=i}static fromImage(e,t,i,s){let n=new Z4Layer(e,t.width,t.height,new Color(0,0,0,0),i,s);return n.offscreenCtx.drawImage(t,0,0),n}setLayerPreview(e){this.layerPreview=e}getLayerPreview(){return this.layerPreview}convertToBlob(e){if(this.blob)e(this.blob);else{let t={};t.type="image/png",this.offscreen.convertToBlob(t).then(t=>{this.blob=t,e(this.blob)})}}shift(e,t){this.offsetX+=e,this.offsetY+=t}setOpacity(e){this.opacity=e}getOpacity(){return this.opacity}setCompositeOperation(e){this.compositeOperation=e}getCompositeOperation(){return this.compositeOperation}setHidden(e){this.hidden=e}isHidden(){return this.hidden}setShowBounds(e){this.showBounds=e}isShowBounds(){return this.showBounds}move(e,t){this.offsetX=e,this.offsetY=t}setName(e){this.name=e}getName(){return this.name}getOffset(){return new Point(this.offsetX,this.offsetY)}getSize(){return new Dimension(this.width,this.height)}getColorAt(e,t){if(e-=this.offsetX,t-=this.offsetY,!(0<=e)||!(e<this.width)||!(0<=t)||!(t<this.height))return null;{let i=this.offscreenCtx.getImageData(e,t,1,1).data;return new Color(parseInt(i[0]),parseInt(i[1]),parseInt(i[2]),parseInt(i[3]))}}draw(e,t){(t||!this.hidden)&&(e.save(),t||(e.globalAlpha=this.opacity,e.globalCompositeOperation=this.compositeOperation),e.drawImage(this.offscreen,t?0:this.offsetX,t?0:this.offsetY),e.restore())}drawTool(e,t){this.offscreenCtx.save(),this.offscreenCtx.translate(t.z4Vector.x0-this.offsetX,t.z4Vector.y0-this.offsetY),this.offscreenCtx.rotate(t.z4Vector.phase),e.draw(this.offscreenCtx,t),this.offscreenCtx.restore(),this.blob=null}flipHorizonal(){let e=this.offscreenCtx.getImageData(0,0,this.width,this.height),t=e.data;for(let i=0;i<this.height;i++)for(let s=0;s<this.width/2;s++){let n=(i*this.width+s)*4,a=(i*this.width+this.width-1-s)*4;this.flipValue(t,n,a)}this.offscreenCtx.putImageData(e,0,0),this.blob=null}flipVertical(){let e=this.offscreenCtx.getImageData(0,0,this.width,this.height),t=e.data;for(let i=0;i<this.height/2;i++)for(let s=0;s<this.width;s++){let n=(i*this.width+s)*4,a=((this.height-1-i)*this.width+s)*4;this.flipValue(t,n,a)}this.offscreenCtx.putImageData(e,0,0),this.blob=null}flipValue(e,t,i){let s=e[t],n=e[t+1],a=e[t+2],r=e[t+3];e[t]=e[i],e[t+1]=e[i+1],e[t+2]=e[i+2],e[t+3]=e[i+3],e[i]=s,e[i+1]=n,e[i+2]=a,e[i+3]=r}rotatePlus90(){let e=new OffscreenCanvas(this.height,this.width),t=e.getContext("2d"),i=this.offscreenCtx.getImageData(0,0,this.width,this.height).data,s=t.createImageData(this.height,this.width),n=s.data;for(let a=0;a<this.height;a++)for(let r=0;r<this.width;r++){let o=(a*this.width+r)*4,l=(r*this.height+this.height-1-a)*4;n[l]=i[o],n[l+1]=i[o+1],n[l+2]=i[o+2],n[l+3]=i[o+3]}t.putImageData(s,0,0),this.offscreen=e,this.offscreenCtx=t,this.offsetX+=parseInt(this.width/2-this.height/2),this.offsetY+=parseInt(this.height/2-this.width/2);let h=this.width;this.width=this.height,this.height=h,this.blob=null}resize(e){let t=new OffscreenCanvas(e.containerWidth,e.containerHeight),i=t.getContext("2d");i.drawImage(this.offscreen,e.contentOffsetX,e.contentOffsetY,e.contentWidth,e.contentHeight),this.offscreen=t,this.offscreenCtx=i,this.offsetX=0,this.offsetY=0,this.width=e.containerWidth,this.height=e.containerHeight,this.blob=null}}class Z4Paper{layers=[];getLayersCount(){return this.layers.length}getLayerAt(e){return this.layers[e]}addLayer(e,t,i,s,n,a){this.layers.push(new Z4Layer(e,t,i,s,n,a))}addLayerFromImage(e,t,i,s){this.layers.push(Z4Layer.fromImage(e,t,i,s))}deleteLayer(e){let t=this.layers.indexOf(e);return this.layers.splice(t,1),t}moveLayer(e,t){let i=Math.min(this.layers.length,t),s=this.layers.indexOf(e);return i<s?(this.layers.splice(i,0,this.layers.splice(s,1)[0]),!0):i>s&&(this.layers.splice(i,0,this.layers[s]),this.layers.splice(s,1),!0)}reset(){this.layers.length=0}draw(e,t){this.layers.forEach(i=>i.draw(e,t))}}class Z4ResizeOptions{containerWidth=0;containerHeight=0;contentWidth=0;contentHeight=0;contentOffsetX=0;contentOffsetY=0;constructor(e,t,i,s,n,a){this.containerWidth=e,this.containerHeight=t,this.contentWidth=i,this.contentHeight=s,this.contentOffsetX=n,this.contentOffsetY=a}}class Z4TextInfo{font=null;textText=null;textEmpty=!1;textBorder=0;textBorderColor=null;textShearX=0;textShearY=0;shadow=!1;shadowText=null;shadowEmpty=!1;shadowShearX=0;shadowShearY=0}class Z4Translations{static CURRENT_LANGUAGE=null;static DEPENDENCIES="<a href='https://repository.jsweet.org/artifactory/libs-release-local/org/jsweet/jsweet-core' target='_blank'>jsweet-core</a>, <a href='https://github.com/gianpierodiblasi/swing.js' target='_blank'>swing.js</a>, <a href='https://pomax.github.io/bezierjs' target='_blank'>Bezier.js</a>, <a href='https://stuk.github.io/jszip' target='_blank'>JSZip</a>, <a href='https://github.com/eligrey/FileSaver.js' target='_blank'>FileSaver.js</a>.";static PROJECT="";static NEW_PROJECT="";static CREATE="";static FROM_CLIPBOARD="";static FROM_FILE="";static OPEN="";static OPEN_PROJECT="";static SAVE="";static SAVE_PROJECT="";static SAVE_PROJECT_AS="";static EXPORT="";static PROJECT_NOT_SAVED_MESSAGE="";static IMAGE_FILE="";static PIZZAPAZZA_PROJECT="";static LAYER="";static LAYER_NAME="";static NEW_LAYER="";static BACKGROUND_LAYER="";static DELETE_LAYER_MESSAGE="";static MERGE_VISIBLE_LAYERS="";static MERGE_ALL_LAYERS="";static SHOW_LAYER_BOUNDS="";static NEW_DRAWING_TOOL="";static DRAWING_TOOL="";static DRAWING_TOOL_NAME="";static SAVE_DRAWING_TOOL_AS="";static SAVE_DRAWING_TOOLS_AS="";static PIZZAPAZZA_DRAWING_TOOL="";static PIZZAPAZZA_DRAWING_TOOLS="";static DELETE_DRAWING_TOOL_MESSAGE="";static FROM_LIBRARY="";static TEXT="";static HISTORY="";static UNDO="";static REDO="";static CONSOLIDATE="";static CONSOLIDATE_MESSAGE="";static SETTINGS="";static LANGUAGE="";static LANGUAGE_ENGLISH_NATIVE="";static LANGUAGE_ITALIAN_NATIVE="";static THEME="";static THEME_AUTO="";static THEME_LIGHT="";static THEME_DARK="";static THEME_COLOR="";static HISTORY_MANAGEMENT="";static STANDARD_POLICY="";static STANDARD_POLICY_DESCRIPTION="";static TIMER_POLICY="";static TIMER_POLICY_DESCRIPTION="";static MANUAL_POLICY="";static MANUAL_POLICY_DESCRIPTION="";static TOOL_POLICY="";static TOOL_POLICY_DESCRIPTION="";static SAVING_INTERVAL="";static SAVING_DELAY="";static REFRESH_PAGE_MESSAGE="";static HELP="";static ABOUT="";static BASED_ON="";static INSTALL="";static CHECK_UPDATE="";static PROJECT_NAME="";static FILENAME="";static QUALITY="";static RESET="";static WIDTH="";static HEIGHT="";static RESOLUTION="";static PATTERN="";static PATTERNS="";static EDIT="";static FIT="";static OFFSET_X="";static OFFSET_Y="";static BASIC="";static ADVANCED="";static STAR="";static VERTICES="";static REGULAR="";static DIMENSION="";static FREE="";static LOCK_ASPECT_RATIO="";static LOCK="";static RIPPLE="";static DELETE="";static DUPLICATE="";static TRANSFORM="";static FLIP_HORIZONTAL="";static FLIP_VERTICAL="";static ROTATE_PLUS_90="";static ROTATE_MINUS_90="";static ROTATE_180="";static SPACE="";static TIME="";static FILLING="";static MERGE="";static NONE_HIM="";static NONE_HER="";static BORDER="";static SHADOW="";static DELTA_X="";static DELTA_Y="";static VISIBLE="";static SELECTED="";static MOVE_UP="";static MOVE_DOWN="";static MOVE_BOTTOM="";static MOVE_TOP="";static TRY_ME="";static ACTIONS="";static DRAWING_DIRECTION="";static SHOW_GRID="";static MAGNETIC_GRID="";static DOTTED_GRID="";static PLOT_WIDTH="";static RESET_ON_START_MOVING="";static RESIZE="";static CONTAINER="";static CONTENT="";static RESIZE_CONTAINER_AND_CONTENT="";static RESIZE_CONTAINER_AND_ADAPT_CONTENT="";static RESIZE_CONTAINER="";static RESIZE_CONTENT="";static IMAGE_TOO_BIG_MESSAGE="";static IMAGE_OPEN_ERROR_MESSAGE="";static DRAWING_TOOL_OPEN_ERROR_MESSAGE="";static DO_NOT_SHOW_AGAIN_MESSAGE="";static FILTER="";static EMPTY="";static SHEARING="";static HORIZONTAL="";static VERTICAL="";static BOLD="";static ITALIC="";static STRING_EXAMPLE="";static FONT_SELECTION="";static COLOR="";static FILLING_COLOR="";static BACKGROUND_COLOR="";static MIRRORED="";static INVERTED="";static DELETE_COLOR_MESSAGE="";static LIGHTED="";static DARKENED="";static SPATIAL="";static TEMPORAL="";static LIGHTING="";static PICK_COLOR="";static COLOR_STORED_IN_HISTORY="";static MULTIPLICITY="";static PUSH="";static ROTATION="";static ATTACK="";static SUSTAIN="";static RELEASE="";static ENDLESS="";static RADIUS="";static SPEED="";static DRAW_WHILE_MOVING="";static SCATTERING="";static ASSISTED_DRAWING="";static TENSION="";static HOLE="";static COVER="";static WHIRLPOOL="";static POINTS="";static INTERNAL_BASE_POINT="";static EXTERNAL_BASE_POINT="";static INTERNAL_TERMINAL_POINT="";static EXTERNAL_TERMINAL_POINT="";static INDENTATION="";static EXTERNAL_FORCE="";static INTENSITY="";static GAUSSIAN_CORRECTION="";static THICKNESS="";static DELETE_PATTERN_MESSAGE="";static DELETE_PATTERNS_MESSAGE="";static RANDOM_SEQUENCE="";static MULTI_DIMENSION="";static POSITIVE="";static NEGATIVE="";static ALTERNATE="";static CONSTANT="";static RANDOM="";static CLASSIC="";static STEPPED="";static POLYLINE="";static BEZIER="";static LENGTH="";static UNIFORM_SIGN="";static FIXED="";static VARIABLE="";static CUMULATIVE="";static RELATIVE_TO_PATH="";static DELAYED="";static STEP="";static SHAPE="";static ANGLE="";static FORWARD="";static BACKWARD="";static DISTANCE="";static CENTER_VERB="";static COMPOSITE_OPERATION="";static COMPOSITE_OPERATION_SOURCE_OVER="";static COMPOSITE_OPERATION_SOURCE_IN="";static COMPOSITE_OPERATION_SOURCE_OUT="";static COMPOSITE_OPERATION_SOURCE_ATOP="";static COMPOSITE_OPERATION_DESTINATION_OVER="";static COMPOSITE_OPERATION_DESTINATION_IN="";static COMPOSITE_OPERATION_DESTINATION_OUT="";static COMPOSITE_OPERATION_DESTINATION_ATOP="";static COMPOSITE_OPERATION_LIGHTER="";static COMPOSITE_OPERATION_COPY="";static COMPOSITE_OPERATION_XOR="";static COMPOSITE_OPERATION_MULTIPLY="";static COMPOSITE_OPERATION_SCREEN="";static COMPOSITE_OPERATION_OVERLAY="";static COMPOSITE_OPERATION_DARKEN="";static COMPOSITE_OPERATION_LIGHTEN="";static COMPOSITE_OPERATION_COLOR_DODGE="";static COMPOSITE_OPERATION_COLOR_BURN="";static COMPOSITE_OPERATION_HARD_LIGHT="";static COMPOSITE_OPERATION_SOFT_LIGHT="";static COMPOSITE_OPERATION_DIFFERENCE="";static COMPOSITE_OPERATION_EXCLUSION="";static COMPOSITE_OPERATION_HUE="";static COMPOSITE_OPERATION_SATURATION="";static COMPOSITE_OPERATION_COLOR="";static COMPOSITE_OPERATION_LUMINOSITY="";static{switch(navigator.language.substring(0,2)){case"en":default:Z4Translations.setEnglish();break;case"it":Z4Translations.setItalian()}}constructor(){}static setEnglish(){Z4Translations.PROJECT="Project",Z4Translations.NEW_PROJECT="New Project",Z4Translations.CREATE="Create",Z4Translations.FROM_CLIPBOARD="From Clipboard",Z4Translations.FROM_FILE="From File",Z4Translations.OPEN="Open",Z4Translations.OPEN_PROJECT="Open Project",Z4Translations.SAVE="Save",Z4Translations.SAVE_PROJECT="Save Project",Z4Translations.SAVE_PROJECT_AS="Save Project As",Z4Translations.EXPORT="Export",Z4Translations.PROJECT_NOT_SAVED_MESSAGE="Project not saved, do you want to save your changes?",Z4Translations.IMAGE_FILE="Image File",Z4Translations.PIZZAPAZZA_PROJECT="pizzApazzA Project",Z4Translations.LAYER="Layer",Z4Translations.LAYER_NAME="Layer Name",Z4Translations.NEW_LAYER="New Layer",Z4Translations.BACKGROUND_LAYER="Bkgrd",Z4Translations.DELETE_LAYER_MESSAGE="Do you really want to delete the layer?",Z4Translations.MERGE_VISIBLE_LAYERS="Merge Visible Layers",Z4Translations.MERGE_ALL_LAYERS="Merge All Layers",Z4Translations.SHOW_LAYER_BOUNDS="Show Layer Bounds",Z4Translations.NEW_DRAWING_TOOL="New Drawing Tool",Z4Translations.DRAWING_TOOL="Drawing Tool",Z4Translations.DRAWING_TOOL_NAME="Drawing Tool Name",Z4Translations.SAVE_DRAWING_TOOL_AS="Save As",Z4Translations.SAVE_DRAWING_TOOLS_AS="Save All As",Z4Translations.PIZZAPAZZA_DRAWING_TOOL="pizzApazzA Drawing Tool",Z4Translations.PIZZAPAZZA_DRAWING_TOOLS="pizzApazzA Drawing Tools",Z4Translations.DELETE_DRAWING_TOOL_MESSAGE="Do you really want to delete the drawing tool?",Z4Translations.FROM_LIBRARY="From Library",Z4Translations.TEXT="Text",Z4Translations.HISTORY="History",Z4Translations.UNDO="Undo",Z4Translations.REDO="Redo",Z4Translations.CONSOLIDATE="Consolidate",Z4Translations.CONSOLIDATE_MESSAGE="Consolidation will remove all history, do you want to proceed?",Z4Translations.SETTINGS="Settings",Z4Translations.LANGUAGE="Language",Z4Translations.LANGUAGE_ENGLISH_NATIVE="English",Z4Translations.LANGUAGE_ITALIAN_NATIVE="Italiano",Z4Translations.THEME="Theme",Z4Translations.THEME_AUTO="Auto",Z4Translations.THEME_LIGHT="Light",Z4Translations.THEME_DARK="Dark",Z4Translations.THEME_COLOR="Color",Z4Translations.HISTORY_MANAGEMENT="History Management",Z4Translations.STANDARD_POLICY="Standard",Z4Translations.STANDARD_POLICY_DESCRIPTION='The history is updated at each conclusion of a drawing operation and at each "global" operation on the drawing',Z4Translations.TIMER_POLICY="Time Based",Z4Translations.TIMER_POLICY_DESCRIPTION="The history is updated at regular intervals (only if the drawing has been modified)",Z4Translations.MANUAL_POLICY="Manual",Z4Translations.MANUAL_POLICY_DESCRIPTION="The history is manually updated (only if the drawing has been modified)",Z4Translations.TOOL_POLICY="On Drawing Tool Change",Z4Translations.TOOL_POLICY_DESCRIPTION='The history is updated when the drawing tool is changed (only if the drawing has been modified) and at each "global" operation on the drawing',Z4Translations.SAVING_INTERVAL="Saving Interval",Z4Translations.SAVING_DELAY="Saving Delay",Z4Translations.REFRESH_PAGE_MESSAGE="Refresh the page to make the changes",Z4Translations.HELP="Help",Z4Translations.ABOUT="About",Z4Translations.BASED_ON="<p>pizzApazzA<sup>&#8734;</sup> Version $version$ is based on pizzApazzA VB6 by Ettore Luzio and is licensed under <a href='https://unlicense.org/'>Unlicense license</a>.</p><p>Developed in Java by Gianpiero Di Blasi, transpilled in JavaScript by means of <a href='https://github.com/gianpierodiblasi/josetta' target='_blank'>josetta</a> (<a href='https://github.com/gianpierodiblasi/pizzApazzAinfinity' target='_blank'>github repository</a>).</p><p>Ettore Luzio and Gianpiero Di Blasi are the founders of <a href='https://sites.google.com/view/gruppoz4/home'>GruppoZ4</a>.</p><p>Dependencies: "+Z4Translations.DEPENDENCIES+"</p>",Z4Translations.INSTALL="<span>Install pizzApazzA<sup>&#8734;</sup></span>",Z4Translations.CHECK_UPDATE="Check for Updates",Z4Translations.PROJECT_NAME="Project Name",Z4Translations.FILENAME="File Name",Z4Translations.QUALITY="Quality",Z4Translations.RESET="Reset",Z4Translations.WIDTH="Width",Z4Translations.HEIGHT="Height",Z4Translations.RESOLUTION="Resolution",Z4Translations.PATTERN="Pattern",Z4Translations.PATTERNS="Patterns",Z4Translations.EDIT="Edit",Z4Translations.FIT="Fit",Z4Translations.OFFSET_X="Offset X",Z4Translations.OFFSET_Y="Offset Y",Z4Translations.BASIC="Basic",Z4Translations.ADVANCED="Advanced",Z4Translations.STAR="Star",Z4Translations.VERTICES="Vertices",Z4Translations.REGULAR="Regular",Z4Translations.DIMENSION="Dimension",Z4Translations.FREE="Free",Z4Translations.LOCK_ASPECT_RATIO="Lock Aspect Ratio",Z4Translations.LOCK="Lock",Z4Translations.RIPPLE="Ripple",Z4Translations.DELETE="Delete",Z4Translations.DUPLICATE="Duplicate",Z4Translations.TRANSFORM="Transform",Z4Translations.FLIP_HORIZONTAL="Flip Horizontal",Z4Translations.FLIP_VERTICAL="Flip Vertical",Z4Translations.ROTATE_PLUS_90="Rotate +90\xb0",Z4Translations.ROTATE_MINUS_90="Rotate -90\xb0",Z4Translations.ROTATE_180="Rotate 180\xb0",Z4Translations.SPACE="Space →",Z4Translations.TIME="← Time",Z4Translations.FILLING="Filling",Z4Translations.MERGE="Merge",Z4Translations.NONE_HIM="None",Z4Translations.NONE_HER="None",Z4Translations.BORDER="Border",Z4Translations.SHADOW="Shadow",Z4Translations.DELTA_X="Delta X",Z4Translations.DELTA_Y="Delta Y",Z4Translations.VISIBLE="Visible",Z4Translations.SELECTED="Selected",Z4Translations.MOVE_UP="Move Up",Z4Translations.MOVE_DOWN="Move Down",Z4Translations.MOVE_BOTTOM="Move to Bottom",Z4Translations.MOVE_TOP="Move to Top",Z4Translations.TRY_ME="Try Me",Z4Translations.ACTIONS="Actions",Z4Translations.DRAWING_DIRECTION="Drawing Direction",Z4Translations.SHOW_GRID="Show Grid",Z4Translations.MAGNETIC_GRID="Magnetic Grid",Z4Translations.DOTTED_GRID="Dotted Grid",Z4Translations.PLOT_WIDTH="Plot Width",Z4Translations.RESET_ON_START_MOVING="Reset on Start Moving",Z4Translations.RESIZE="Resize",Z4Translations.CONTAINER="Container",Z4Translations.CONTENT="Content",Z4Translations.RESIZE_CONTAINER_AND_CONTENT="Resize Container and Content",Z4Translations.RESIZE_CONTAINER_AND_ADAPT_CONTENT="Resize Container and Adapt Content",Z4Translations.RESIZE_CONTAINER="Resize Container",Z4Translations.RESIZE_CONTENT="Resize Content",Z4Translations.IMAGE_TOO_BIG_MESSAGE="The image is too big to be loaded; image size = $image_size$, max image size = $max_image_size$",Z4Translations.IMAGE_OPEN_ERROR_MESSAGE="It is not possible to open the image",Z4Translations.DRAWING_TOOL_OPEN_ERROR_MESSAGE="It is not possible to open the drawing tool",Z4Translations.DO_NOT_SHOW_AGAIN_MESSAGE="Do not show this message again",Z4Translations.FILTER="Filter",Z4Translations.EMPTY="Empty",Z4Translations.SHEARING="Shearing",Z4Translations.HORIZONTAL="Horizontal",Z4Translations.VERTICAL="Vertical",Z4Translations.BOLD="Bold",Z4Translations.ITALIC="Italic",Z4Translations.STRING_EXAMPLE="Sample string of the selected font",Z4Translations.FONT_SELECTION="Font Selection",Z4Translations.COLOR="Color",Z4Translations.FILLING_COLOR="Filling Color",Z4Translations.BACKGROUND_COLOR="Background Color",Z4Translations.MIRRORED="Mirrored",Z4Translations.INVERTED="Inverted",Z4Translations.DELETE_COLOR_MESSAGE="Do you really want to delete the color?",Z4Translations.LIGHTED="Lighted",Z4Translations.DARKENED="Darkened",Z4Translations.SPATIAL="Spatial",Z4Translations.TEMPORAL="Temporal",Z4Translations.LIGHTING="Lighting",Z4Translations.PICK_COLOR="Pick Color",Z4Translations.COLOR_STORED_IN_HISTORY="The color has been stored in the color history",Z4Translations.MULTIPLICITY="Multiplicity",Z4Translations.PUSH="Push",Z4Translations.ROTATION="Rotation",Z4Translations.ATTACK="Attack",Z4Translations.SUSTAIN="Sustain",Z4Translations.RELEASE="Release",Z4Translations.ENDLESS="Endless",Z4Translations.RADIUS="Radius",Z4Translations.SPEED="Speed",Z4Translations.DRAW_WHILE_MOVING="Draw While Moving",Z4Translations.SCATTERING="Scattering",Z4Translations.ASSISTED_DRAWING="Assisted Drawing",Z4Translations.TENSION="Tension",Z4Translations.HOLE="Hole",Z4Translations.COVER="Cover",Z4Translations.WHIRLPOOL="Whirlpool",Z4Translations.POINTS="Points",Z4Translations.INTERNAL_BASE_POINT="Internal Base Point",Z4Translations.EXTERNAL_BASE_POINT="External Base Point",Z4Translations.INTERNAL_TERMINAL_POINT="Internal Terminal Point",Z4Translations.EXTERNAL_TERMINAL_POINT="External Terminal Point",Z4Translations.INDENTATION="Indentation",Z4Translations.EXTERNAL_FORCE="External Force",Z4Translations.INTENSITY="Intensity",Z4Translations.GAUSSIAN_CORRECTION="Gaussian Correction",Z4Translations.THICKNESS="Thickness",Z4Translations.DELETE_PATTERN_MESSAGE="Do you really want to delete the pattern?",Z4Translations.DELETE_PATTERNS_MESSAGE="Do you really want to delete the selected patterns?",Z4Translations.RANDOM_SEQUENCE="Random Sequence",Z4Translations.MULTI_DIMENSION="Multi Dimension",Z4Translations.POSITIVE="Positive",Z4Translations.NEGATIVE="Negative",Z4Translations.ALTERNATE="Alternate",Z4Translations.CONSTANT="Constant",Z4Translations.RANDOM="Random",Z4Translations.CLASSIC="Classic",Z4Translations.STEPPED="Stepped",Z4Translations.POLYLINE="Polyline",Z4Translations.BEZIER="Bezier",Z4Translations.LENGTH="Length",Z4Translations.UNIFORM_SIGN="Uniform Sign",Z4Translations.FIXED="Fixed",Z4Translations.VARIABLE="Variable",Z4Translations.CUMULATIVE="Cumulative",Z4Translations.RELATIVE_TO_PATH="Relative to Path",Z4Translations.DELAYED="Delayed",Z4Translations.STEP="Step",Z4Translations.SHAPE="Shape",Z4Translations.ANGLE="Angle",Z4Translations.FORWARD="Forward",Z4Translations.BACKWARD="Backward",Z4Translations.DISTANCE="Distance",Z4Translations.CENTER_VERB="Center",Z4Translations.COMPOSITE_OPERATION="Composite Operation",Z4Translations.COMPOSITE_OPERATION_SOURCE_OVER="This is the default setting and draws the layer on top of the existing content",Z4Translations.COMPOSITE_OPERATION_SOURCE_IN="The layer is drawn only where both the layer and the destination content overlap; everything else is made transparent",Z4Translations.COMPOSITE_OPERATION_SOURCE_OUT="The layer is drawn where it doesn't overlap the existing content",Z4Translations.COMPOSITE_OPERATION_SOURCE_ATOP="The layer is only drawn where it overlaps the existing content",Z4Translations.COMPOSITE_OPERATION_DESTINATION_OVER="The layer is drawn behind the existing content",Z4Translations.COMPOSITE_OPERATION_DESTINATION_IN="The existing content is kept where both the layer and existing content overlap; everything else is made transparent",Z4Translations.COMPOSITE_OPERATION_DESTINATION_OUT="The existing content is kept where it doesn't overlap the layer",Z4Translations.COMPOSITE_OPERATION_DESTINATION_ATOP="The existing content is only kept where it overlaps the layer; the layer is drawn behind the content",Z4Translations.COMPOSITE_OPERATION_LIGHTER="Where both layer and existing content overlap the color is determined by adding color values",Z4Translations.COMPOSITE_OPERATION_COPY="Only the layer is shown",Z4Translations.COMPOSITE_OPERATION_XOR="Layer and existing content are made transparent where both overlap and drawn normal everywhere else",Z4Translations.COMPOSITE_OPERATION_MULTIPLY="The pixels of the layer are multiplied with the corresponding pixel of the existing content; a darker picture is the result",Z4Translations.COMPOSITE_OPERATION_SCREEN="The pixels are inverted, multiplied, and inverted again; a lighter picture is the result (opposite of 'multiply')",Z4Translations.COMPOSITE_OPERATION_OVERLAY="A combination of 'multiply' and 'screen'; dark parts on the existing content become darker, and light parts become lighter",Z4Translations.COMPOSITE_OPERATION_DARKEN="Retains the darkest pixels of both layer and existing content",Z4Translations.COMPOSITE_OPERATION_LIGHTEN="Retains the lightest pixels of both layer and existing content",Z4Translations.COMPOSITE_OPERATION_COLOR_DODGE="Divides the existing content by the inverted layer",Z4Translations.COMPOSITE_OPERATION_COLOR_BURN="Divides the inverted existing content by the layer, and then inverts the result",Z4Translations.COMPOSITE_OPERATION_HARD_LIGHT="A combination of 'multiply' and 'screen' like 'overlay', but with layer and existing content swapped",Z4Translations.COMPOSITE_OPERATION_SOFT_LIGHT="A softer version of 'hard-light'; pure black or white does not result in pure black or white",Z4Translations.COMPOSITE_OPERATION_DIFFERENCE="Subtracts the existing content from the layer or the other way round to always get a positive value",Z4Translations.COMPOSITE_OPERATION_EXCLUSION="Like 'difference', but with lower contrast",Z4Translations.COMPOSITE_OPERATION_HUE="Preserves the luma and chroma of the existing content, while adopting the hue of the layer",Z4Translations.COMPOSITE_OPERATION_SATURATION="Preserves the luma and hue of the existing content, while adopting the chroma of the layer",Z4Translations.COMPOSITE_OPERATION_COLOR="Preserves the luma of the existing content, while adopting the hue and chroma of the layer",Z4Translations.COMPOSITE_OPERATION_LUMINOSITY="Preserves the hue and chroma of the existing content, while adopting the luma of the layer",Z4Translations.CURRENT_LANGUAGE=new KeyValue("en",Z4Translations.LANGUAGE_ENGLISH_NATIVE)}static setItalian(){Z4Translations.PROJECT="Progetto",Z4Translations.NEW_PROJECT="Nuovo Progetto",Z4Translations.CREATE="Crea",Z4Translations.FROM_CLIPBOARD="Dagli Appunti",Z4Translations.FROM_FILE="Da File",Z4Translations.OPEN="Apri",Z4Translations.OPEN_PROJECT="Apri Progetto",Z4Translations.SAVE="Salva",Z4Translations.SAVE_PROJECT="Salva Progetto",Z4Translations.SAVE_PROJECT_AS="Salva Progetto con Nome",Z4Translations.EXPORT="Esporta",Z4Translations.PROJECT_NOT_SAVED_MESSAGE="Progetto non salvato, vuoi salvare le modifiche?",Z4Translations.IMAGE_FILE="File Immagine",Z4Translations.PIZZAPAZZA_PROJECT="Progetto pizzApazzA",Z4Translations.LAYER="Livello",Z4Translations.LAYER_NAME="Nome Livello",Z4Translations.NEW_LAYER="Nuovo Livello",Z4Translations.BACKGROUND_LAYER="Sfondo",Z4Translations.DELETE_LAYER_MESSAGE="Vuoi davvero eliminare il livello?",Z4Translations.MERGE_VISIBLE_LAYERS="Fondi Livelli Visibili",Z4Translations.MERGE_ALL_LAYERS="Fondi Tutti i Livelli",Z4Translations.SHOW_LAYER_BOUNDS="Mostra Bordi Livello",Z4Translations.NEW_DRAWING_TOOL="Nuovo Strumento di Disegno",Z4Translations.DRAWING_TOOL="Strumento di Disegno",Z4Translations.DRAWING_TOOL_NAME="Nome Strumento di Disegno",Z4Translations.SAVE_DRAWING_TOOL_AS="Salva con Nome",Z4Translations.SAVE_DRAWING_TOOLS_AS="Salva Tutti con Nome",Z4Translations.PIZZAPAZZA_DRAWING_TOOL="Strumento di Disegno pizzApazzA",Z4Translations.PIZZAPAZZA_DRAWING_TOOLS="Strumenti di Disegno pizzApazzA",Z4Translations.DELETE_DRAWING_TOOL_MESSAGE="Vuoi davvero eliminare lo strumento di disegno?",Z4Translations.FROM_LIBRARY="Da Libreria",Z4Translations.TEXT="Testo",Z4Translations.HISTORY="Cronologia",Z4Translations.UNDO="Annulla",Z4Translations.REDO="Ripeti",Z4Translations.CONSOLIDATE="Consolida",Z4Translations.CONSOLIDATE_MESSAGE="La consolidazione rimuover\xe0 tutta la cronologia, vuoi proseguire?",Z4Translations.SETTINGS="Impostazioni",Z4Translations.LANGUAGE="Lingua",Z4Translations.LANGUAGE_ENGLISH_NATIVE="English",Z4Translations.LANGUAGE_ITALIAN_NATIVE="Italiano",Z4Translations.THEME="Tema",Z4Translations.THEME_AUTO="Auto",Z4Translations.THEME_LIGHT="Chiaro",Z4Translations.THEME_DARK="Scuro",Z4Translations.THEME_COLOR="Colore",Z4Translations.HISTORY_MANAGEMENT="Gestione Cronologia",Z4Translations.STANDARD_POLICY="Standard",Z4Translations.STANDARD_POLICY_DESCRIPTION='La cronologia viene aggiornata ad ogni conclusione di un\'operazione di disegno ed ad ogni operazione "globale" sul disegno',Z4Translations.TIMER_POLICY="A Tempo",Z4Translations.TIMER_POLICY_DESCRIPTION="La cronologia viene aggiornata ad intervalli regolari (solo se il disegno \xe8 stato modificato)",Z4Translations.MANUAL_POLICY="Manuale",Z4Translations.MANUAL_POLICY_DESCRIPTION="La cronologia viene aggiornata manualmente (solo se il disegno \xe8 stato modificato)",Z4Translations.TOOL_POLICY="Su Cambio Strumento di Disegno",Z4Translations.TOOL_POLICY_DESCRIPTION='La cronologia viene aggiornata quando viene cambiato lo strumento di disegno (solo se il disegno \xe8 stato modificato) ed ad ogni operazione "globale" sul disegno',Z4Translations.SAVING_INTERVAL="Intervallo di Salvataggio",Z4Translations.SAVING_DELAY="Ritardo di Salvataggio",Z4Translations.REFRESH_PAGE_MESSAGE="Aggiorna la pagina per eseguire le modifiche",Z4Translations.HELP="Aiuto",Z4Translations.ABOUT="Informazioni su",Z4Translations.BASED_ON="<p>pizzApazzA<sup>&#8734;</sup> Versione $version$ \xe8 basato su pizzApazzA VB6 di Ettore Luzio ed \xe8 distribuito con <a href='https://unlicense.org/' target='_blank'>licenza Unlicense</a>.</p><p>Sviluppato in Java da Gianpiero Di Blasi, tradotto in JavaScript tramite <a href='https://github.com/gianpierodiblasi/josetta' target='_blank'>josetta</a> (<a href='https://github.com/gianpierodiblasi/pizzApazzAinfinity' target='_blank'>repository github</a>).</p><p>Ettore Luzio e Gianpiero Di Blasi sono i fondatori del <a href='https://sites.google.com/view/gruppoz4/home'>GruppoZ4</a>.</p><p>Dipendenze: "+Z4Translations.DEPENDENCIES+"</p>",Z4Translations.INSTALL="<span>Installa pizzApazzA<sup>&#8734;</sup></span>",Z4Translations.CHECK_UPDATE="Controlla gli Aggiornamenti",Z4Translations.PROJECT_NAME="Nome Progetto",Z4Translations.FILENAME="Nome File",Z4Translations.QUALITY="Qualit\xe0",Z4Translations.RESET="Ripristina",Z4Translations.WIDTH="Larghezza",Z4Translations.HEIGHT="Altezza",Z4Translations.RESOLUTION="Risoluzione",Z4Translations.PATTERN="Trama",Z4Translations.PATTERNS="Trame",Z4Translations.EDIT="Modifica",Z4Translations.FIT="Adatta",Z4Translations.OFFSET_X="Offset X",Z4Translations.OFFSET_Y="Offset Y",Z4Translations.BASIC="Base",Z4Translations.ADVANCED="Avanzato",Z4Translations.STAR="Stella",Z4Translations.VERTICES="Vertici",Z4Translations.REGULAR="Regolare",Z4Translations.DIMENSION="Dimensione",Z4Translations.FREE="Libero",Z4Translations.LOCK_ASPECT_RATIO="Blocca Proporzioni",Z4Translations.LOCK="Blocca",Z4Translations.RIPPLE="Caoticit\xe0",Z4Translations.DELETE="Elimina",Z4Translations.DUPLICATE="Duplica",Z4Translations.TRANSFORM="Trasforma",Z4Translations.FLIP_HORIZONTAL="Rifletti Orizzontale",Z4Translations.FLIP_VERTICAL="Rifletti Verticale",Z4Translations.ROTATE_PLUS_90="Ruota +90\xb0",Z4Translations.ROTATE_MINUS_90="Ruota -90\xb0",Z4Translations.ROTATE_180="Ruota 180\xb0",Z4Translations.SPACE="Spazio →",Z4Translations.TIME="← Tempo",Z4Translations.FILLING="Riempimento",Z4Translations.MERGE="Fondi",Z4Translations.NONE_HIM="Nessuno",Z4Translations.NONE_HER="Nessuna",Z4Translations.BORDER="Bordo",Z4Translations.SHADOW="Ombra",Z4Translations.DELTA_X="Delta X",Z4Translations.DELTA_Y="Delta Y",Z4Translations.VISIBLE="Visibile",Z4Translations.SELECTED="Selezionato",Z4Translations.MOVE_UP="Muovi Su",Z4Translations.MOVE_DOWN="Muovi Gi\xf9",Z4Translations.MOVE_BOTTOM="Muovi in Fondo",Z4Translations.MOVE_TOP="Muovi in Cima",Z4Translations.TRY_ME="Provami",Z4Translations.ACTIONS="Azioni",Z4Translations.DRAWING_DIRECTION="Direzione di Disegno",Z4Translations.SHOW_GRID="Mostra Griglia",Z4Translations.MAGNETIC_GRID="Griglia Magnetica",Z4Translations.DOTTED_GRID="Griglia Punteggiata",Z4Translations.PLOT_WIDTH="Larghezza Trama",Z4Translations.RESET_ON_START_MOVING="Riavvia su Inizio del Movimento",Z4Translations.RESIZE="Ridimensiona",Z4Translations.CONTAINER="Contenitore",Z4Translations.CONTENT="Contenuto",Z4Translations.RESIZE_CONTAINER_AND_CONTENT="Ridimensiona Contenitore e Contenuto",Z4Translations.RESIZE_CONTAINER_AND_ADAPT_CONTENT="Ridimensiona Contenitore ed Adatta Contenuto",Z4Translations.RESIZE_CONTAINER="Ridimensiona Contenitore",Z4Translations.RESIZE_CONTENT="Ridimensiona Contenuto",Z4Translations.IMAGE_TOO_BIG_MESSAGE="L'immagine \xe8 troppo grande per essere caricata; dimensione immagine = $image_size$, dimensione massima immagine = $max_image_size$",Z4Translations.IMAGE_OPEN_ERROR_MESSAGE="Non \xe8 possibile aprire l'immagine",Z4Translations.DRAWING_TOOL_OPEN_ERROR_MESSAGE="Non \xe8 possibile aprire lo strumento di disegno",Z4Translations.DO_NOT_SHOW_AGAIN_MESSAGE="Non mostrare pi\xf9 questo messaggio",Z4Translations.FILTER="Filtra",Z4Translations.EMPTY="Vuoto",Z4Translations.SHEARING="Inclinazione",Z4Translations.HORIZONTAL="Orizzontale",Z4Translations.VERTICAL="Verticale",Z4Translations.BOLD="Grassetto",Z4Translations.ITALIC="Corsivo",Z4Translations.STRING_EXAMPLE="Stringa di esempio del font selezionato",Z4Translations.FONT_SELECTION="Selezione Font",Z4Translations.COLOR="Colore",Z4Translations.FILLING_COLOR="Colore di Riempimento",Z4Translations.BACKGROUND_COLOR="Colore di Sfondo",Z4Translations.MIRRORED="Riflesso",Z4Translations.INVERTED="Invertito",Z4Translations.DELETE_COLOR_MESSAGE="Vuoi davvero eliminare il colore?",Z4Translations.LIGHTED="Illuminato",Z4Translations.DARKENED="Incupito",Z4Translations.SPATIAL="Spaziale",Z4Translations.TEMPORAL="Temporale",Z4Translations.LIGHTING="Illuminazione",Z4Translations.PICK_COLOR="Preleva Colore",Z4Translations.COLOR_STORED_IN_HISTORY="Il colore \xe8 stato conservato nella cronologia dei colori",Z4Translations.MULTIPLICITY="Molteplicit\xe0",Z4Translations.PUSH="Spinta",Z4Translations.ROTATION="Rotazione",Z4Translations.ATTACK="Attacco",Z4Translations.SUSTAIN="Sostegno",Z4Translations.RELEASE="Rilascio",Z4Translations.ENDLESS="Infinito",Z4Translations.RADIUS="Raggio",Z4Translations.SPEED="Velocit\xe0",Z4Translations.DRAW_WHILE_MOVING="Disegna Durante il Movimento",Z4Translations.SCATTERING="Dispersione",Z4Translations.ASSISTED_DRAWING="Disegno Assistito",Z4Translations.TENSION="Tensione",Z4Translations.HOLE="Buco",Z4Translations.COVER="Copertura",Z4Translations.WHIRLPOOL="Vortice",Z4Translations.POINTS="Punti",Z4Translations.INTERNAL_BASE_POINT="Punto Base Interno",Z4Translations.EXTERNAL_BASE_POINT="Punto Base Esterno",Z4Translations.INTERNAL_TERMINAL_POINT="Punto Terminale Interno",Z4Translations.EXTERNAL_TERMINAL_POINT="Punto Terminale Esterno",Z4Translations.INDENTATION="Frastagliatura",Z4Translations.EXTERNAL_FORCE="Forza Esterna",Z4Translations.INTENSITY="Intensit\xe0",Z4Translations.GAUSSIAN_CORRECTION="Correzione Gaussiana",Z4Translations.THICKNESS="Spessore",Z4Translations.DELETE_PATTERN_MESSAGE="Vuoi davvero eliminare la trama?",Z4Translations.DELETE_PATTERNS_MESSAGE="Vuoi davvero eliminare le trame selezionate?",Z4Translations.RANDOM_SEQUENCE="Sequenza Casuale",Z4Translations.MULTI_DIMENSION="Multi Dimensione",Z4Translations.POSITIVE="Positivo",Z4Translations.NEGATIVE="Negativo",Z4Translations.ALTERNATE="Alternato",Z4Translations.CONSTANT="Costante",Z4Translations.RANDOM="Random",Z4Translations.CLASSIC="Classico",Z4Translations.STEPPED="A Gradino",Z4Translations.POLYLINE="Polilinea",Z4Translations.BEZIER="Bezier",Z4Translations.LENGTH="Lunghezza",Z4Translations.UNIFORM_SIGN="Segno Uniforme",Z4Translations.FIXED="Fisso",Z4Translations.VARIABLE="Variabile",Z4Translations.CUMULATIVE="Cumulativo",Z4Translations.RELATIVE_TO_PATH="Relativo al Percorso",Z4Translations.DELAYED="Ritardato",Z4Translations.STEP="Passo",Z4Translations.SHAPE="Forma",Z4Translations.ANGLE="Angolo",Z4Translations.FORWARD="In Avanti",Z4Translations.BACKWARD="Indietro",Z4Translations.DISTANCE="Distanza",Z4Translations.CENTER_VERB="Centra",Z4Translations.COMPOSITE_OPERATION="Operazione Composita",Z4Translations.COMPOSITE_OPERATION_SOURCE_OVER="Questa \xe8 l'impostazione predefinita e disegna il livello sopra il contenuto esistente",Z4Translations.COMPOSITE_OPERATION_SOURCE_IN="Il livello viene disegnato solo dove si sovrappongono sia il livello che il contenuto di destinazione; tutto il resto \xe8 reso trasparente",Z4Translations.COMPOSITE_OPERATION_SOURCE_OUT="Il livello viene disegnato dove non si sovrappone al contenuto esistente",Z4Translations.COMPOSITE_OPERATION_SOURCE_ATOP="Il livello viene disegnato solo dove si sovrappone al contenuto esistente",Z4Translations.COMPOSITE_OPERATION_DESTINATION_OVER="Il livello viene disegnato dietro il contenuto esistente",Z4Translations.COMPOSITE_OPERATION_DESTINATION_IN="Il contenuto esistente viene mantenuto dove sia il livello che il contenuto esistente si sovrappongono; tutto il resto \xe8 reso trasparente",Z4Translations.COMPOSITE_OPERATION_DESTINATION_OUT="Il contenuto esistente viene mantenuto dove non si sovrappone al livello",Z4Translations.COMPOSITE_OPERATION_DESTINATION_ATOP="Il contenuto esistente viene mantenuto solo dove si sovrappone al livello; il livello viene disegnato dietro il contenuto",Z4Translations.COMPOSITE_OPERATION_LIGHTER="Laddove sia il livello che il contenuto esistente si sovrappongono, il colore viene determinato sommando i colori",Z4Translations.COMPOSITE_OPERATION_COPY="Viene mostrato solo il livello",Z4Translations.COMPOSITE_OPERATION_XOR="Il livello e il contenuto esistente vengono resi trasparenti laddove entrambi si sovrappongono e vengono disegnati normali altrove",Z4Translations.COMPOSITE_OPERATION_MULTIPLY="I pixel del layer vengono moltiplicati per il pixel corrispondente del contenuto esistente; il risultato \xe8 un'immagine pi\xf9 scura",Z4Translations.COMPOSITE_OPERATION_SCREEN="I pixel vengono invertiti, moltiplicati e nuovamente invertiti; il risultato \xe8 un'immagine pi\xf9 chiara (opposto di 'multiply')",Z4Translations.COMPOSITE_OPERATION_OVERLAY="Una combinazione di 'multiply' e 'screen'; le parti scure del contenuto esistente diventano pi\xf9 scure e le parti chiare diventano pi\xf9 chiare",Z4Translations.COMPOSITE_OPERATION_DARKEN="Mantiene i pixel pi\xf9 scuri sia del livello che del contenuto esistente",Z4Translations.COMPOSITE_OPERATION_LIGHTEN="Mantiene i pixel pi\xf9 chiari sia del livello che del contenuto esistente",Z4Translations.COMPOSITE_OPERATION_COLOR_DODGE="Divide il contenuto esistente per il livello invertito",Z4Translations.COMPOSITE_OPERATION_COLOR_BURN="Divide il contenuto esistente invertito per il livello, quindi inverte il risultato",Z4Translations.COMPOSITE_OPERATION_HARD_LIGHT="Una combinazione di 'multiply' e 'screen' come 'overlay', ma con il livello e il contenuto esistente scambiati",Z4Translations.COMPOSITE_OPERATION_SOFT_LIGHT="Una versione pi\xf9 morbida della 'hard-light'; il nero o il bianco puro non risultano in bianco o nero puro",Z4Translations.COMPOSITE_OPERATION_DIFFERENCE="Sottrae il contenuto esistente dal livello o viceversa per ottenere sempre un valore positivo",Z4Translations.COMPOSITE_OPERATION_EXCLUSION="Come 'difference', ma con contrasto inferiore",Z4Translations.COMPOSITE_OPERATION_HUE="Preserva la luminanza e la crominanza del contenuto esistente, adottando la tonalit\xe0 del livello",Z4Translations.COMPOSITE_OPERATION_SATURATION="Preserva la luminanza e la tonalit\xe0 del contenuto esistente, adottando la crominanza del livello",Z4Translations.COMPOSITE_OPERATION_COLOR="Preserva la luminanza del contenuto esistente, adottando la tonalit\xe0 e la saturazione del livello",Z4Translations.COMPOSITE_OPERATION_LUMINOSITY="Preserva la tonalit\xe0 e il croma del contenuto esistente, adottando la luminanza del livello",Z4Translations.CURRENT_LANGUAGE=new KeyValue("it",Z4Translations.LANGUAGE_ITALIAN_NATIVE)}}class Z4UI{static PLEASE_WAIT=new JSPanel;static PROGRESS_BAR=new JSProgressBar;static{Z4UI.PLEASE_WAIT.cssAddClass("please-wait"),Z4UI.PLEASE_WAIT.setLayout(new GridBagLayout),Z4UI.PLEASE_WAIT.add(Z4UI.PROGRESS_BAR,new GBC(0,0).wx(1).f(GBC.HORIZONTAL).i(0,25,0,25)),Z4UI.PROGRESS_BAR.getStyle().display="none"}static pleaseWait(e,t,i,s,n,a,r){Z4UI.PROGRESS_BAR.getStyle().display=i?"grid":"none",i?(Z4UI.PROGRESS_BAR.setIndeterminate(s),Z4UI.PROGRESS_BAR.setStringPainted(n),Z4UI.PROGRESS_BAR.setValue(0),Z4UI.PROGRESS_BAR.setString(a)):(Z4UI.PROGRESS_BAR.setIndeterminate(!1),Z4UI.PROGRESS_BAR.setStringPainted(!1),Z4UI.PROGRESS_BAR.setValue(0),Z4UI.PROGRESS_BAR.setString(""));let o=Color.fromRGB_HEX(window.getComputedStyle(document.body).getPropertyValue("--main-action-bgcolor"));Z4UI.PLEASE_WAIT.getStyle().background=new Color(o.red,o.green,o.blue,64).getRGBA_HEX(),Z4UI.PLEASE_WAIT.appendInBody(),Z4UI.PLEASE_WAIT.cssAddClass("please-wait-visible"),e.cssAddClass("please-wait-request");let l=document.querySelector(".jsdialog:has(.please-wait-request)");l||(l=document.querySelector(".jsframe:has(.please-wait-request)")),l.appendChild(document.querySelector(".please-wait")),e.cssRemoveClass("please-wait-request"),setTimeout(()=>{r(),t||Z4UI.pleaseWaitCompleted()},0)}static pleaseWaitAdvanced(e){setTimeout(()=>e(),0)}static pleaseWaitCompleted(){Z4UI.PLEASE_WAIT.cssRemoveClass("please-wait-visible")}static setPleaseWaitProgressBarValue(e){Z4UI.PROGRESS_BAR.setValue(e)}static setPleaseWaitProgressBarString(e){Z4UI.PROGRESS_BAR.setString(e)}static addLabel(e,t,i){let s=new JSLabel;return s.setText(t),e.add(s,i),s}static addVLine(e,t){let i=new JSComponent(document.createElement("div"));return i.getStyle().width="1px",i.getStyle().background="var(--main-action-bgcolor)",e.add(i,t),i}static addHLine(e,t){let i=new JSComponent(document.createElement("div"));return i.getStyle().height="1px",i.getStyle().background="var(--main-action-bgcolor)",e.add(i,t),i}constructor(){}}