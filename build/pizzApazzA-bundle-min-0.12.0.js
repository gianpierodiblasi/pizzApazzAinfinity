window.onload=()=>{switch(window.addEventListener("wheel",e=>{e.ctrlKey&&e.preventDefault()},{passive:!1}),window.addEventListener("keydown",e=>{e.ctrlKey&&("+"===e.key||"-"===e.key)&&(e.preventDefault(),document.querySelector(".z4canvas").dispatchEvent(new e.constructor(e.type,e)))}),localStorage.getItem("z4language")){case"en":Translations.setEnglish(),Z4Translations.setEnglish();break;case"it":Translations.setItalian(),Z4Translations.setItalian()}switch(localStorage.getItem("z4theme")){case"light":break;case"dark":SwingJS.instance().darkMode(!0).build();break;default:SwingJS.instance().darkMode(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches).build()}let e=localStorage.getItem("z4color");e&&SwingJS.instance().mainActionBGColor(e).build(),SwingJS.instance().fontSize(12).build(),Z4Constants.configureAcceptedImageFileTypeArrays();var t=new Z4Frame;if("launchQueue"in window&&"files"in LaunchParams.prototype&&launchQueue.setConsumer(e=>{e.files[0]&&e.files[0].getFile().then(e=>{e.name.toLowerCase().endsWith(".z4i")?t.canvas.openProject(e):t.canvas.createFromFile(e)})}),"serviceWorker"in navigator){let i,s;navigator.serviceWorker.register("service-worker.js").then(e=>{e.onupdatefound=()=>{(i=e.installing).onstatechange=()=>{"installed"===i.state&&navigator.serviceWorker.controller&&(document.querySelector(".z4ribbonhelppanel .z4check-update").style.display="flex",document.querySelector(".z4ribbonhelppanel .z4check-update").onclick=()=>i.postMessage({action:"skipWaiting"}))}}}),navigator.serviceWorker.oncontrollerchange=()=>{s||(caches.keys().then(e=>e.forEach(e=>caches.delete(e))),window.location.reload(),s=!0)},window.addEventListener("beforeinstallprompt",e=>{document.querySelector(".z4ribbonhelppanel .z4check-install").style.display="flex",document.querySelector(".z4ribbonhelppanel .z4check-install").onclick=()=>e.prompt()}),window.addEventListener("appinstalled",()=>document.querySelector(".z4ribbonhelppanel .z4check-install").style.display="none"),(navigator.standalone||window.matchMedia("(display-mode: standalone)").matches)&&(document.head.title="")}};class Z4GradientColorProgressionBehavior{static SPATIAL="SPATIAL";static TEMPORAL="TEMPORAL";static RELATIVE_TO_PATH="RELATIVE_TO_PATH";static RANDOM="RANDOM"}class Z4Lighting{static NONE="NONE";static LIGHTED="LIGHTED";static DARKENED="DARKENED"}class Z4AbstractFiller{fill(e){}}class Z4AbstractGradientColorFiller extends Z4AbstractFiller{gradientColor=null;constructor(e){super(),this.gradientColor=e}fill(e){let t=e.data;for(let i=0;i<e.height;i++)for(let s=0;s<e.width;s++){let a=this.getColorPositionAt(s,i);if(-1!==a){let n=this.gradientColor.getColorAt(a,!0),r=(i*e.width+s)*4;t[r]=n.red,t[r+1]=n.green,t[r+2]=n.blue,t[r+3]=n.alpha}}}getColorPositionAt(e,t){}}class Z4AbstractBoundaryBehaviorFiller extends Z4AbstractGradientColorFiller{boundaryBehavior=null;constructor(e,t){super(e),this.boundaryBehavior=t}getColorPositionAt(e,t){return this.getColorPositionAtWithBoundaryBehavior(e,t,this.boundaryBehavior)}getColorPositionAtWithBoundaryBehavior(e,t,i){}}class Z4AbstractDistanceBasedBoundaryBehaviorFiller extends Z4AbstractBoundaryBehaviorFiller{constructor(e,t){super(e,t)}getDistance(e,t){}getColorPositionAtWithBoundaryBehavior(e,t,i){let s=this.getDistance(e,t);if(s<=1)return s;if(i===Z4BoundaryBehavior.STOP_AT_BOUNDARY)return -1;if(i===Z4BoundaryBehavior.FILL_AT_BOUNDARY)return 1;if(i===Z4BoundaryBehavior.SYMMETRIC_AT_BOUNDARY){let a=Math.floor(s);return s-=a,a%2&&(s=1-s),s}if(i===Z4BoundaryBehavior.REPEAT_AT_BOUNDARY)return s-Math.floor(s);else return -1}}class Z4BezierFiller extends Z4AbstractDistanceBasedBoundaryBehaviorFiller{x1=0;y1=0;ctrlx1=0;ctrly1=0;ctrlx2=0;ctrly2=0;x2=0;y2=0;radius=0;bezier=null;constructor(e,t,i,s,a,n,r,o,l,h,d){super(e,d),this.x1=t,this.y1=i,this.ctrlx1=s,this.ctrly1=a,this.ctrlx2=n,this.ctrly2=r,this.x2=o,this.y2=l,this.radius=h,this.bezier=new Bezier(this.x1,this.y1,this.ctrlx1,this.ctrly1,this.ctrlx2,this.ctrly2,this.x2,this.y2)}getDistance(e,t){let i=this.bezier.project(new Z4Point(e,t));return Z4Math.distance(i.x,i.y,e,t)/this.radius}}class Z4EllipticFiller extends Z4AbstractDistanceBasedBoundaryBehaviorFiller{cx=0;cy=0;rx=0;ry=0;angle=0;constructor(e,t,i,s,a,n,r){super(e,r),this.cx=t,this.cy=i,this.rx=s,this.ry=a,this.angle=n}getDistance(e,t){let i=Z4Math.rotate(e-this.cx,t-this.cy,this.angle);return Math.hypot(i.x/this.rx,i.y/this.ry)}}class Z4SinusoidalFiller extends Z4AbstractDistanceBasedBoundaryBehaviorFiller{x=0;y=0;waveLength=0;period=0;amplitude=0;angle=0;two_PI_over_period=0;constructor(e,t,i,s,a,n,r,o){super(e,o),this.x=t,this.y=i,this.waveLength=s,this.period=a,this.amplitude=n,this.angle=r,this.two_PI_over_period=Z4Math.TWO_PI/this.period}getDistance(e,t){let i=Z4Math.rotate(e-this.x,t-this.y,this.angle);return Math.abs(i.y-this.amplitude*Math.sin(i.x*this.two_PI_over_period))/this.waveLength}}class Z4AbstractEllipseInscribedFiller extends Z4AbstractBoundaryBehaviorFiller{cx=0;cy=0;rx=0;ry=0;angle=0;vertexCount=0;edges=null;d00=0;ctx=new OffscreenCanvas(1,1).getContext("2d");constructor(e,t,i,s,a,n,r,o){super(e,o),this.cx=t,this.cy=i,this.rx=s,this.ry=a,this.angle=n,this.vertexCount=r,this.edges=this.createEdges(this.vertexCount),this.ctx.beginPath(),this.edges.forEach((e,t,i)=>{0===t?this.ctx.moveTo(e.x1,e.y1):this.ctx.lineTo(e.x1,e.y1)}),this.ctx.closePath(),this.d00=this.edges.map(e=>Z4Math.ptSegDist(e.x1,e.y1,e.x2,e.y2,0,0)).reduce((e,t,i,s)=>Math.min(e,t))}createEdges(e){}getColorPositionAtWithBoundaryBehavior(e,t,i){let s=Z4Math.rotate(e-this.cx,t-this.cy,this.angle),a=s.x/this.rx,n=s.y/this.ry;if(i===Z4BoundaryBehavior.STOP_AT_BOUNDARY||i===Z4BoundaryBehavior.FILL_AT_BOUNDARY)return this.ctx.isPointInPath(a,n)?1-this.getDistance(a,n,1):i===Z4BoundaryBehavior.STOP_AT_BOUNDARY?-1:1;if(i!==Z4BoundaryBehavior.SYMMETRIC_AT_BOUNDARY&&i!==Z4BoundaryBehavior.REPEAT_AT_BOUNDARY)return -1;{let r=1,o=a/r,l=n/r,h=this.getDistance(o,l,r);for(;h>1||!this.ctx.isPointInPath(o,l);)o=a/++r,l=n/r,h=this.getDistance(o,l,r);return i===Z4BoundaryBehavior.REPEAT_AT_BOUNDARY?1-h:r%2?1-h:h}}getDistance(e,t,i){return this.edges.map(i=>Z4Math.ptSegDist(i.x1,i.y1,i.x2,i.y2,e,t)).reduce((e,t,i,s)=>Math.min(e,t))/(this.d00/i)}}class Z4PolygonFiller extends Z4AbstractEllipseInscribedFiller{constructor(e,t,i,s,a,n,r,o){super(e,t,i,s,a,n,r,o)}createEdges(e){let t=[];for(let i=0;i<e-1;i++)t.push(new Z4Line(Math.cos(i*Z4Math.TWO_PI/e),Math.sin(i*Z4Math.TWO_PI/e),Math.cos((i+1)*Z4Math.TWO_PI/e),Math.sin((i+1)*Z4Math.TWO_PI/e)));return t.push(new Z4Line(Math.cos((e-1)*Z4Math.TWO_PI/e),Math.sin((e-1)*Z4Math.TWO_PI/e),1,0)),t}}class Z4StarFiller extends Z4AbstractEllipseInscribedFiller{constructor(e,t,i,s,a,n,r,o){super(e,t,i,s,a,n,r,o)}createEdges(e){let t=[];for(let i=0;i<e;i++){let s=i*Z4Math.TWO_PI/e;t.push(new Z4Point(Math.cos(s),Math.sin(s))),s=(i*Z4Math.TWO_PI+Math.PI)/e,t.push(new Z4Point(Math.cos(s)/Z4Math.SQUARE_GOLD_SECTION,Math.sin(s)/Z4Math.SQUARE_GOLD_SECTION))}t.push(new Z4Point(1,0));let a=[];for(let n=0;n<t.length-1;n++)a.push(new Z4Line(t[n].x,t[n].y,t[n+1].x,t[n+1].y));return a}}class Z4LinearFiller extends Z4AbstractBoundaryBehaviorFiller{p1x=0;p1y=0;p2x=0;p2y=0;angle=0;distance=0;line1x=0;line1y=0;line2x=0;line2y=0;constructor(e,t,i,s,a,n){super(e,n),this.p1x=t,this.p1y=i,this.p2x=s,this.p2y=a,this.angle=Z4Math.atan(this.p1x,this.p1y,this.p2x,this.p2y)+Z4Math.HALF_PI,this.distance=Z4Math.distance(this.p1x,this.p1y,this.p2x,this.p2y),this.line1x=this.p1x+Math.cos(this.angle),this.line1y=this.p1y+Math.sin(this.angle),this.line2x=this.p2x+Math.cos(this.angle),this.line2y=this.p2y+Math.sin(this.angle)}getColorPositionAtWithBoundaryBehavior(e,t,i){let s=Z4Math.ptLineDist(this.p1x,this.p1y,this.line1x,this.line1y,e,t)/this.distance,a=Z4Math.ptLineDist(this.p2x,this.p2y,this.line2x,this.line2y,e,t)/this.distance;if(s<=1&&a<=1)return s;if(i===Z4BoundaryBehavior.STOP_AT_BOUNDARY)return -1;if(i===Z4BoundaryBehavior.FILL_AT_BOUNDARY)return s<a?0:1;if(i===Z4BoundaryBehavior.SYMMETRIC_AT_BOUNDARY){let n=s<a?s:a,r=Math.floor(n);return n-=r,(s<a&&r%2||s>a&&!(r%2))&&(n=1-n),n}{if(i!==Z4BoundaryBehavior.REPEAT_AT_BOUNDARY)return -1;let o=s<a?s:a;return o-=Math.floor(o),s<a&&(o=1-o),o}}}class Z4ConicFiller extends Z4AbstractGradientColorFiller{cx=0;cy=0;angle=0;symmetric=!1;constructor(e,t,i,s,a){super(e),this.cx=t,this.cy=i,this.angle=s,this.symmetric=a}getColorPositionAt(e,t){let i=Z4Math.rotate(e-this.cx,t-this.cy,this.angle),s=Math.atan2(i.y,i.x)/Z4Math.TWO_PI;return(s<0&&(s+=1),this.symmetric)?2*(s<.5?s:1-s):s}}class Z4SpiralFiller extends Z4AbstractGradientColorFiller{cx=0;cy=0;radius=0;angle=0;logarithmic=!1;constructor(e,t,i,s,a,n){super(e),this.cx=t,this.cy=i,this.radius=s,this.angle=a,this.logarithmic=n}getColorPositionAt(e,t){let i=Z4Math.rotate(e-this.cx,t-this.cy,this.angle),s=Math.hypot(i.x,i.y),a=Z4Math.TWO_PI*(this.logarithmic?Math.log(s/this.radius):s/this.radius),n=s*Math.cos(a),r=s*Math.sin(a);return isNaN(s=Z4Math.distance(i.x,i.y,n,r)/(2*s))?0:s}}class Z4TextureFiller extends Z4AbstractFiller{texture=null;x1=0;y1=0;x2=0;y2=0;color=null;symmetric=!1;textureData=null;left=0;top=0;width=0;height=0;scaleW=0;scaleH=0;constructor(e,t,i,s,a,n,r){if(super(),this.texture=e,this.x1=t,this.y1=i,this.x2=s,this.y2=a,this.color=n,this.symmetric=r,this.symmetric){this.textureData=new Uint8Array(16*this.texture.width*this.texture.height);for(let o=0;o<this.texture.height;o++)for(let l=0;l<this.texture.width;l++){let h=(o*this.texture.width+l)*4,d=(o*this.texture.width*2+l)*4;this.textureData[d]=this.texture.data[h],this.textureData[d+1]=this.texture.data[h+1],this.textureData[d+2]=this.texture.data[h+2],this.textureData[d+3]=this.texture.data[h+3],d=(o*this.texture.width*2+(2*this.texture.width-1-l))*4,this.textureData[d]=this.texture.data[h],this.textureData[d+1]=this.texture.data[h+1],this.textureData[d+2]=this.texture.data[h+2],this.textureData[d+3]=this.texture.data[h+3],d=((2*this.texture.height-1-o)*this.texture.width*2+l)*4,this.textureData[d]=this.texture.data[h],this.textureData[d+1]=this.texture.data[h+1],this.textureData[d+2]=this.texture.data[h+2],this.textureData[d+3]=this.texture.data[h+3],d=((2*this.texture.height-o-1)*this.texture.width*2+(2*this.texture.width-1-l))*4,this.textureData[d]=this.texture.data[h],this.textureData[d+1]=this.texture.data[h+1],this.textureData[d+2]=this.texture.data[h+2],this.textureData[d+3]=this.texture.data[h+3]}}else this.textureData=this.texture.data;this.left=Math.min(t,s),this.top=Math.min(i,a),this.width=Math.abs(s-t),this.height=Math.abs(a-i),this.scaleW=(this.symmetric?2:1)*this.texture.width/this.width,this.scaleH=(this.symmetric?2:1)*this.texture.height/this.height}fill(e){if(!this.width||!this.height)return;let t=e.data;for(let i=0;i<e.height;i++)for(let s=0;s<e.width;s++){let a=(i*e.width+s)*4,n=this.computeRect(s,i),r=parseInt(this.scaleW*(s-n.x)),o=(parseInt(this.scaleH*(i-n.y))*(this.symmetric?2:1)*this.texture.width+r)*4;this.textureData[o+3]?(t[a]=this.textureData[o],t[a+1]=this.textureData[o+1],t[a+2]=this.textureData[o+2],t[a+3]=this.textureData[o+3]):(t[a]=this.color.red,t[a+1]=this.color.green,t[a+2]=this.color.blue,t[a+3]=this.color.alpha)}}computeRect(e,t){let i=this.left,s=this.top,a=i+this.width,n=s+this.height;for(;e<i;)i-=this.width,a=i+this.width;for(;e>=a;)i+=this.width,a=i+this.width;for(;t<s;)s-=this.height,n=s+this.height;for(;t>=n;)s+=this.height,n=s+this.height;return new Point(i,s)}}class Z4BoundaryBehavior{static STOP_AT_BOUNDARY="STOP_AT_BOUNDARY";static FILL_AT_BOUNDARY="FILL_AT_BOUNDARY";static SYMMETRIC_AT_BOUNDARY="SYMMETRIC_AT_BOUNDARY";static REPEAT_AT_BOUNDARY="REPEAT_AT_BOUNDARY"}class Z4PointIteratorDrawingAction{static START="START";static CONTINUE="CONTINUE";static STOP="STOP"}class Z4DrawingPoint{z4Vector=null;intensity=0;lighting=null;colorPosition=0;drawBounds=!1;side=null;useVectorModuleAsSize=!1;constructor(e,t,i,s,a,n,r){this.z4Vector=e,this.intensity=t,this.lighting=i,this.colorPosition=s,this.drawBounds=a,this.side=n,this.useVectorModuleAsSize=r}}class Z4Line{x1=0;y1=0;x2=0;y2=0;constructor(e,t,i,s){this.x1=e,this.y1=t,this.x2=i,this.y2=s}}class Z4Math{static TWO_PI=2*Math.PI;static HALF_PI=Math.PI/2;static GOLD_SECTION=(1+Math.sqrt(5))/2;static SQUARE_GOLD_SECTION=Z4Math.GOLD_SECTION*Z4Math.GOLD_SECTION;static RAD2DEG=180/Math.PI;static DEG2RAD=Math.PI/180;static rad2deg(e){return e*Z4Math.RAD2DEG}static deg2rad(e){return e*Z4Math.DEG2RAD}static distance(e,t,i,s){let a=e-i,n=t-s;return Math.sqrt(a*a+n*n)}static ptLineDist(e,t,i,s,a,n){return Math.sqrt(Z4Math.ptLineDistSq(e,t,i,s,a,n))}static ptLineDistSq(e,t,i,s,a,n){i-=e,s-=t;let r=(a-=e)*i+(n-=t)*s,o=a*a+n*n-r*r/(i*i+s*s);return o<0?0:o}static ptSegDist(e,t,i,s,a,n){return Math.sqrt(Z4Math.ptSegDistSq(e,t,i,s,a,n))}static ptSegDistSq(e,t,i,s,a,n){i-=e,s-=t;let r=(a-=e)*i+(n-=t)*s,o=0;o=r<=0?0:(r=(a=i-a)*i+(n=s-n)*s)<=0?0:r*r/(i*i+s*s);let l=a*a+n*n-o;return l<0?0:l}static atan(e,t,i,s){let a=Math.atan2(s-t,i-e);return a<0?a+Z4Math.TWO_PI:a}static rotate(e,t,i){let s=Math.cos(i),a=Math.sin(i);return new Z4Point(e*s+t*a,e*a-t*s)}static ripple(e,t,i,s){let a=(i-t)*s*Math.random();return(e+=Math.random()>.5?a:-a)<t?t:e>i?i:e}constructor(){}}class Z4Point{x=0;y=0;constructor(e,t){this.x=e,this.y=t}}class Z4RandomValueBehavior{static CLASSIC="CLASSIC";static BEZIER="BEZIER";static POLYLINE="POLYLINE";static STEPPED="STEPPED"}class Z4RotationBehavior{static FIXED="FIXED";static CUMULATIVE="CUMULATIVE";static RELATIVE_TO_PATH="RELATIVE_TO_PATH"}class Z4SignBehavior{static POSITIVE="POSITIVE";static NEGATIVE="NEGATIVE";static RANDOM="RANDOM";static ALTERNATE="ALTERNATE"}class Z4Vector{x0=0;y0=0;x=0;y=0;module=0;phase=0;constructor(e,t,i,s,a,n){this.x0=e,this.y0=t,this.x=i,this.y=s,this.module=a,this.phase=n}static fromPoints(e,t,i,s){return new Z4Vector(e,t,i,s,Z4Math.distance(e,t,i,s),Z4Math.atan(e,t,i,s))}static fromVector(e,t,i,s){return new Z4Vector(e,t,e+i*Math.cos(s),t+i*Math.sin(s),i,s)}direction(e){let t=this.x-this.x0,i=this.y-this.y0,s=e.x-e.x0,a=e.y-e.y0;return Math.atan2(t*a-i*s,t*s+i*a)>=0?Z4SignBehavior.POSITIVE:Z4SignBehavior.NEGATIVE}}class Z4Canvas extends JSComponent{canvas=document.createElement("canvas");ctx=this.canvas.getContext("2d");ribbonFilePanel=null;ribbonLayerPanel=null;ribbonHistoryPanel=null;statusPanel=null;projectName=null;handle=null;width=0;height=0;zoom=1;zooming=!1;saved=!0;changed=!1;pressed=!1;paper=new Z4Paper;selectedLayer=null;drawingTool=null;constructor(){super(document.createElement("div")),this.cssAddClass("z4canvas"),this.appendNodeChild(this.canvas),this.canvas.addEventListener("mouseenter",e=>this.onMouse(e,"enter")),this.canvas.addEventListener("mouseleave",e=>this.onMouse(e,"leave")),this.canvas.addEventListener("mousedown",e=>this.onMouse(e,"down")),this.canvas.addEventListener("mousemove",e=>this.onMouse(e,"move")),this.canvas.addEventListener("mouseup",e=>this.onMouse(e,"up")),this.addEventListener("wheel",e=>{let t=e;t.ctrlKey&&(t.deltaY<0?this.zoomIn():t.ctrlKey&&t.deltaY>0&&this.zoomOut())}),this.addEventListener("keydown",e=>{let t=e;t.ctrlKey&&("+"===t.key?(t.stopPropagation(),this.zoomIn()):"-"===t.key&&(t.stopPropagation(),this.zoomOut()))})}setRibbonPanels(e,t,i){this.ribbonFilePanel=e,this.ribbonHistoryPanel=i,this.ribbonLayerPanel=t,this.ribbonFilePanel.setCanvas(this),this.ribbonHistoryPanel.setCanvas(this),this.ribbonLayerPanel.setCanvas(this)}setStatusPanel(e){this.statusPanel=e,this.statusPanel.setCanvas(this)}create(e,t,i){this.paper.reset(),this.paper.addLayer(Z4Translations.BACKGROUND_LAYER,e,t,i,e,t),this.width=e,this.height=t,this.selectedLayer=this.paper.getLayerAt(this.getLayersCount()-1),this.ribbonLayerPanel.reset(),this.ribbonLayerPanel.addLayerPreview(this.selectedLayer),this.ribbonHistoryPanel.resetHistory(()=>{this.afterCreate("",e,t),this.toHistory(e=>this.ribbonHistoryPanel.addHistory(e,e=>this.ribbonHistoryPanel.setCurrentKey(e),!1))})}createFromHandle(e){e.getFile().then(e=>{this.createFromFile(e)})}createFromFile(e){let t=new FileReader;t.onload=i=>this.createFromURL(e.name.substring(0,e.name.lastIndexOf(".")),t.result),t.readAsDataURL(e)}createFromClipboard(){navigator.clipboard.read().then(e=>{e.forEach(e=>{let t=e.types.find((e,t,i)=>e.startsWith("image/"));e.getType(t).then(e=>{this.createFromURL("",URL.createObjectURL(e))})})})}createFromURL(e,t){let i=document.createElement("img");return i.onload=t=>(this.paper.reset(),this.paper.addLayerFromImage(Z4Translations.BACKGROUND_LAYER,i,i.width,i.height),this.width=i.width,this.height=i.height,this.selectedLayer=this.paper.getLayerAt(this.getLayersCount()-1),this.ribbonLayerPanel.reset(),this.ribbonLayerPanel.addLayerPreview(this.selectedLayer),this.ribbonHistoryPanel.resetHistory(()=>{this.afterCreate(e,i.width,i.height),this.toHistory(e=>this.ribbonHistoryPanel.addHistory(e,e=>this.ribbonHistoryPanel.setCurrentKey(e),!1))}),null),i.src=t,null}afterCreate(e,t,i){this.projectName=e,this.statusPanel.setProjectName(e),this.statusPanel.setProjectSize(t,i),this.statusPanel.setZoom(1),this.zoom=1,this.setSaved(!0),this.changed=!1,this.canvas.width=t,this.canvas.height=i,this.drawCanvas()}openProjectFromHandle(e){this.handle=e,e.getFile().then(e=>{this.openProjectFromFile(e)})}openProjectFromFile(e){Z4UI.pleaseWait(this,!0,!0,!1,!0,"",()=>{new JSZip().loadAsync(e).then(e=>{e.file("manifest.json").async("string",null).then(t=>{this.paper.reset(),this.ribbonLayerPanel.reset(),this.ribbonHistoryPanel.resetHistory(()=>{let i=JSON.parse(""+t);this.width=i.width,this.height=i.height,this.openLayer(e,i,i.layers,0)})})})})}openLayer(e,t,i,s){e.file("layers/layer"+s+".png").async("blob",e=>Z4UI.setPleaseWaitProgressBarValue(e.percent)).then(a=>{let n=document.createElement("img");n.onload=a=>(this.paper.addLayerFromImage(i[s].name,n,n.width,n.height),this.selectedLayer=this.paper.getLayerAt(s),this.selectedLayer.setOpacity(i[s].opacity),this.selectedLayer.setCompositeOperation(i[s].compositeOperation),this.selectedLayer.setHidden(i[s].hidden),this.selectedLayer.move(i[s].offsetX,i[s].offsetY),this.ribbonLayerPanel.addLayerPreview(this.selectedLayer),s+1<i.length?this.openLayer(e,t,i,s+1):t.history?this.jsonToHistory(e,t,0,t.currentKeyHistory,0):(this.afterCreate(t.projectName,t.width,t.height),this.toHistory(e=>this.ribbonHistoryPanel.addHistory(e,e=>this.ribbonHistoryPanel.setCurrentKey(e),!1)),Z4UI.pleaseWaitCompleted()),null),n.src=URL.createObjectURL(a)})}jsonToHistory(e,t,i,s,a){let n=t.history[i],r="history/history_"+n+"/";e.file(r+"manifest.json").async("string",null).then(o=>{let l=JSON.parse(""+o);this.layerToHistory(e,t,i,s,a,r,l,0,n)})}layerToHistory(e,t,i,s,a,n,r,o,l){e.file(n+"layers/layer"+o+".png").async("blob",e=>Z4UI.setPleaseWaitProgressBarValue(e.percent)).then(h=>{let d=r.layers;d[o].data=h,o+1<d.length?this.layerToHistory(e,t,i,s,a,n,r,o+1,l):i+1<t.history.length?this.ribbonHistoryPanel.addHistory(r,n=>this.jsonToHistory(e,t,i+1,s,s===l?n:a),!0):this.ribbonHistoryPanel.addHistory(r,e=>{this.ribbonHistoryPanel.setCurrentKey(s===l?e:a),this.afterCreate(t.projectName,t.width,t.height),Z4UI.pleaseWaitCompleted()},!0)})}openFromHistory(e){this.paper.reset(),this.ribbonLayerPanel.reset(),this.width=e.width,this.height=e.height,this.openLayerFromHistory(e,e.layers,0)}openLayerFromHistory(e,t,i){let s=document.createElement("img");s.onload=a=>(this.paper.addLayerFromImage(t[i].name,s,s.width,s.height),this.selectedLayer=this.paper.getLayerAt(i),this.selectedLayer.setOpacity(t[i].opacity),this.selectedLayer.setCompositeOperation(t[i].compositeOperation),this.selectedLayer.setHidden(t[i].hidden),this.selectedLayer.move(t[i].offsetX,t[i].offsetY),this.ribbonLayerPanel.addLayerPreview(this.selectedLayer),i+1<t.length?this.openLayerFromHistory(e,t,i+1):(this.afterCreate(e.projectName,e.width,e.height),this.setSaved(!1)),null),s.src=URL.createObjectURL(t[i].data)}saveProjectToHandle(e,t){this.handle=e,this.saveProject(e.name.substring(0,e.name.lastIndexOf(".")),(t,i)=>e.createWritable(new FileSystemWritableFileStreamCreateOptions).then(e=>{e.write(t),e.close()}),t)}saveProjectToFile(e,t){this.saveProject(e,(e,t)=>saveAs(e,t),t)}saveProject(e,t,i){Z4UI.pleaseWait(this,!0,!0,!1,!0,"",()=>{this.projectName=e,this.statusPanel.setProjectName(e);let s=new JSZip;this.layerToJSON(s,[],0,e=>{let a=()=>{s.file("manifest.json",JSON.stringify(e),null);let a={};a.type="blob",a.compression="DEFLATE",a.streamFiles=!0;let n={};n.level=9,a.compressionOptions=n,s.generateAsync(a,e=>Z4UI.setPleaseWaitProgressBarValue(e.percent)).then(e=>{t(e,this.projectName+".z4i"),this.setSaved(!0),Z4UI.pleaseWaitCompleted(),i&&i()})};e.currentKeyHistory=this.ribbonHistoryPanel.getCurrentKey(),e.history=[],this.historyToJSON(s,e,a)})})}historyToJSON(e,t,i){this.ribbonHistoryPanel.iterateHistoryBuffer((s,a,n)=>{if(-1!==s){t.history.push(s);let r="history/history_"+s+"/";a.layers.forEach((t,i,s)=>{e.file(r+"layers/layer"+i+".png",t.data,null),t.data=null}),e.file(r+"manifest.json",JSON.stringify(a),null),n()}else i()})}saveHistory(e){this.ribbonHistoryPanel.saveHistory(e)}toHistory(e){this.layerToJSON(null,[],0,e)}layerToJSON(e,t,i,s){let a=this.paper.getLayerAt(i);a.convertToBlob(n=>{e&&e.file("layers/layer"+i+".png",n,null);let r=a.getOffset(),o={};if(e||(o.data=n),o.name=a.getName(),o.opacity=a.getOpacity(),o.compositeOperation=a.getCompositeOperation(),o.hidden=a.isHidden(),o.offsetX=r.x,o.offsetY=r.y,t[i]=o,i+1===this.getLayersCount()){let l={};l.projectName=this.projectName,l.width=this.width,l.height=this.height,l.layers=t,s(l)}else this.layerToJSON(e,t,i+1,s)})}exportToFile(e,t,i){this.exportTo(t,i,i=>{let s=document.createElement("a");s.setAttribute("href",URL.createObjectURL(i)),s.setAttribute("download",e+t),document.body.appendChild(s);let a=document.createEvent("MouseEvents");a.initEvent("click",!1,!1),s.dispatchEvent(a),document.body.removeChild(s)})}exportToHandle(e,t){e.getFile().then(i=>{this.exportTo(i.name.toLowerCase().substring(i.name.toLowerCase().lastIndexOf(".")),t,t=>e.createWritable(new FileSystemWritableFileStreamCreateOptions).then(e=>{e.write(t),e.close()}))})}exportTo(e,t,i){Z4UI.pleaseWait(this,!1,!1,!1,!1,"",()=>{let s=new OffscreenCanvas(this.width,this.height),a=s.getContext("2d");this.paper.draw(a,!1,!1);let n={};n.type=".png"===e?"image/png":"image/jpeg",n.quality=t,s.convertToBlob(n).then(e=>{i(e)})})}getLayerAt(e){return this.paper.getLayerAt(e)}addLayer(e,t,i){this.paper.addLayer(this.findLayerName(),e,t,i,this.width,this.height),this.afterAddLayer(),this.drawCanvas()}addLayerFromHandle(e){e.getFile().then(e=>{this.addLayerFromFile(e)})}addLayerFromFile(e){let t=e.name.substring(0,e.name.lastIndexOf(".")),i=new FileReader;i.onload=e=>this.addLayerFromURL(t,i.result),i.readAsDataURL(e)}addLayerFromClipboard(){navigator.clipboard.read().then(e=>{e.forEach(e=>{let t=e.types.find((e,t,i)=>e.startsWith("image/"));e.getType(t).then(e=>{this.addLayerFromURL(this.findLayerName(),URL.createObjectURL(e))})})})}findLayerName(){let e=0,t="";for(;!t;){t=Z4Translations.LAYER+"_"+e;for(let i=0;i<this.getLayersCount();i++)t===this.paper.getLayerAt(i).getName()&&(t="");e++}return t}addLayerFromURL(e,t){let i=document.createElement("img");return i.onload=t=>(this.paper.addLayerFromImage(e,i,this.width,this.height),this.afterAddLayer(),this.drawCanvas(),null),i.src=t,null}afterAddLayer(){this.changed=!0,this.ribbonHistoryPanel.saveHistory("standard,tool"),this.selectedLayer=this.paper.getLayerAt(this.getLayersCount()-1),this.ribbonLayerPanel.addLayerPreview(this.selectedLayer),this.setSaved(!1)}duplicateLayer(e){let t=e.getOffset();e.convertToBlob(i=>{let s=document.createElement("img");s.onload=i=>(this.paper.addLayerFromImage(this.findLayerName(),s,this.width,this.height),this.selectedLayer=this.paper.getLayerAt(this.getLayersCount()-1),this.selectedLayer.setOpacity(e.getOpacity()),this.selectedLayer.setCompositeOperation(e.getCompositeOperation()),this.selectedLayer.setHidden(e.isHidden()),this.selectedLayer.move(t.x,t.y),this.ribbonLayerPanel.addLayerPreview(this.selectedLayer),this.setSaved(!1),this.drawCanvas(),null),s.src=URL.createObjectURL(i)})}deleteLayer(e){let t=this.paper.deleteLayer(e);if(this.selectedLayer===e){let i=this.getLayersCount();this.selectedLayer=this.paper.getLayerAt(i-1),document.querySelector(".z4layerpreview:nth-child("+(i+(t<i?1:0))+") .z4layerpreview-selector").textContent=Z4LayerPreview.SELECTED_LAYER_CONTENT,document.querySelector(".z4layerpreview:nth-child("+(i+(t<i?1:0))+")").scrollIntoView()}return this.setSaved(!1),this.drawCanvas(),t}moveLayer(e,t){return!!this.paper.moveLayer(e,t)&&(this.changed=!0,this.ribbonHistoryPanel.saveHistory("standard,tool"),this.setSaved(!1),this.drawCanvas(),!0)}mergeLayers(e){let t=new OffscreenCanvas(this.width,this.height),i=t.getContext("2d");e.forEach(e=>e.draw(i,!1,!1));let s={};s.type="image/png",t.convertToBlob(s).then(e=>{this.addLayerFromURL(this.findLayerName(),URL.createObjectURL(e))})}setSelectedLayer(e){this.selectedLayer=e}getLayersCount(){return this.paper.getLayersCount()}getProjectName(){return this.projectName}getHandle(){return this.handle}getSize(){return new Dimension(this.width,this.height)}isSaved(){return this.saved}setSaved(e){this.saved=e,this.ribbonFilePanel.setSaveEnabled(!this.saved)}isChanged(){return this.changed}setChanged(e){this.changed=e}setZoom(e){this.zoom=e,this.canvas.width=this.width*e,this.canvas.height=this.height*e,this.drawCanvas()}fitZoom(){this.setZoom(Math.min((this.canvas.parentElement.clientWidth-20)/this.width,(this.canvas.parentElement.clientHeight-20)/this.height))}zoomIn(){if(this.zooming);else{this.zooming=!0;let e=Z4Constants.ZOOM_LEVEL.find(e=>e>this.zoom,null);e&&(this.zoom=e,this.canvas.width=this.width*e,this.canvas.height=this.height*e,this.statusPanel.setZoom(this.zoom),this.drawCanvas()),this.zooming=!1}}zoomOut(){if(this.zooming);else{this.zooming=!0;let e=Z4Constants.ZOOM_LEVEL.filter(e=>e<this.zoom).pop();e&&(this.zoom=e,this.canvas.width=this.width*e,this.canvas.height=this.height*e,this.statusPanel.setZoom(this.zoom),this.drawCanvas()),this.zooming=!1}}drawCanvas(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.ctx.scale(this.zoom,this.zoom),this.paper.draw(this.ctx,!1,!1),this.ctx.restore()}onMouse(e,t){let i=Math.min(this.width,Math.max(0,e.offsetX/this.zoom)),s=Math.min(this.height,Math.max(0,e.offsetY/this.zoom));switch(t){case"enter":this.pressed=1===e.buttons,this.pressed&&this.drawingTool.drawAction(Z4PointIteratorDrawingAction.CONTINUE,i,s)&&this.iteratePoint(Z4PointIteratorDrawingAction.CONTINUE);break;case"down":this.pressed=!0,this.drawingTool.drawAction(Z4PointIteratorDrawingAction.START,i,s)&&this.iteratePoint(Z4PointIteratorDrawingAction.START);break;case"move":this.statusPanel.setMousePosition(parseInt(i),parseInt(s)),this.pressed&&this.drawingTool.drawAction(Z4PointIteratorDrawingAction.CONTINUE,i,s)&&this.iteratePoint(Z4PointIteratorDrawingAction.CONTINUE);break;case"up":case"leave":this.pressed=!1,this.drawingTool.drawAction(Z4PointIteratorDrawingAction.STOP,i,s)&&this.iteratePoint(Z4PointIteratorDrawingAction.STOP)}}iteratePoint(e){e!==Z4PointIteratorDrawingAction.STOP&&this.ribbonHistoryPanel.stopStandard();let t=null;for(;null!==(t=this.drawingTool.next());)t.drawBounds?(this.ctx.save(),this.ctx.translate(t.z4Vector.x0,t.z4Vector.y0),this.ctx.rotate(t.z4Vector.phase),this.drawingTool.draw(this.ctx,t),this.ctx.restore()):(this.selectedLayer.drawTool(this.drawingTool,t),this.ribbonHistoryPanel.saveHistory("standard"),this.drawCanvas());this.drawingTool.isInfinitePointGenerator()&&this.pressed?setTimeout(()=>this.iteratePoint(Z4PointIteratorDrawingAction.CONTINUE),this.drawingTool.getInfinitePointGeneratorSleep()):e===Z4PointIteratorDrawingAction.STOP&&this.ribbonHistoryPanel.startStandard()}}class Z4ColorPreview extends JSComponent{component=new JSComponent(document.createElement("div"));componentOpacity=new JSComponent(document.createElement("div"));constructor(){super(document.createElement("div")),this.cssAddClass("z4colorpreview"),this.component.cssAddClass("z4colorpreview-opaque"),this.appendChild(this.component),this.componentOpacity.cssAddClass("z4colorpreview-transparent"),this.appendChild(this.componentOpacity),this.setColor(new Color(0,0,0,255))}setColor(e){this.component.getStyle().backgroundColor=e.getRGB_String(),this.componentOpacity.getStyle().backgroundColor=e.getRGBA_String();let t=[],i=[];t[0]=e.red,t[1]=e.green,t[2]=e.blue,Color.RGBtoHSL(t,i),this.getStyle().border="1px solid "+(i[2]>.5?e.darkened(.1).getRGB_HEX():e.lighted(.1).getRGB_HEX())}}class Z4HistoryPreview extends JSDropDown{summary=new JSPanel;preview=new JSComponent(document.createElement("canvas"));previewBig=new JSComponent(document.createElement("canvas"));ctx=this.preview.invoke("getContext('2d')");ctxBig=this.previewBig.invoke("getContext('2d')");ribbonHistoryPanel=null;canvas=null;key=0;json=null;zoom=1;zoomBig=1;static PREVIEW_SIZE=50;static PREVIEW_BIG_SIZE=500;static SELECTED_HISTORY_CONTENT="☑";static UNSELECTED_HISTORY_CONTENT="☐";constructor(){super(".z4historypreview-editor"),this.cssAddClass("z4historypreview"),this.summary.setLayout(new GridBagLayout),this.preview.setAttribute("width",""+Z4HistoryPreview.PREVIEW_SIZE),this.preview.setAttribute("height",""+Z4HistoryPreview.PREVIEW_SIZE),this.summary.add(this.preview,new GBC(0,0));let e=new JSButton;e.setText(Z4HistoryPreview.UNSELECTED_HISTORY_CONTENT),e.cssAddClass("z4historypreview-selector"),e.getStyle().color="var(--main-action-bgcolor)",e.setContentAreaFilled(!1),e.addActionListener(e=>{this.ribbonHistoryPanel.setCurrentKey(this.key),this.canvas.openFromHistory(this.json)}),this.summary.add(e,new GBC(1,0).a(GBC.NORTH).i(0,2,0,0)),this.appendChildInTree("summary",this.summary),this.previewBig.setAttribute("width",""+Z4HistoryPreview.PREVIEW_BIG_SIZE),this.previewBig.setAttribute("height",""+Z4HistoryPreview.PREVIEW_BIG_SIZE);let t=new JSPanel;t.cssAddClass("z4historypreview-editor"),t.add(this.previewBig,null),this.appendChild(t)}setRibbonHistoryPanel(e){this.ribbonHistoryPanel=e}setHistory(e,t,i){this.key=e,this.json=t,this.canvas=i,this.cssAddClass("z4historypreview-"+e);let s=new Dimension(t.width,t.height);this.zoom=this.setSize(this.preview,s,Z4HistoryPreview.PREVIEW_SIZE),this.zoomBig=this.setSize(this.previewBig,s,Z4HistoryPreview.PREVIEW_BIG_SIZE),this.drawHistory(this.ctx,this.zoom),this.drawHistory(this.ctxBig,this.zoomBig)}setSize(e,t,i){let s=t.width/t.height,a=0,n=0;return s>1?(a=i,n=i/s):(a=i*s,n=i),e.setAttribute("width",""+a),e.setAttribute("height",""+n),e.getStyle().marginTop=(i-n-1)/2+"px",e.getStyle().marginBottom=(i-n-1)/2+"px",e.getStyle().marginLeft=(i-a-1)/2+"px",e.getStyle().marginRight=(i-a-1)/2+"px",Math.min(a/t.width,n/t.height)}drawHistory(e,t){e.scale(t,t),this.drawLayer(e,this.json.layers,0)}drawLayer(e,t,i){let s=t[i];if(s.hidden)i<t.length-1&&this.drawLayer(e,t,i+1);else{let a=document.createElement("img");a.onload=n=>(e.save(),e.globalAlpha=s.opacity,e.globalCompositeOperation=s.compositeOperation,e.drawImage(a,s.offsetX,s.offsetY),e.restore(),i<t.length-1&&this.drawLayer(e,t,i+1),null),a.src=URL.createObjectURL(s.data)}}}class Z4LayerPreview extends JSDropDown{summary=new JSPanel;name=new JSLabel;eye=new JSButton;preview=new JSComponent(document.createElement("canvas"));ctx=this.preview.invoke("getContext('2d')");editor=new JSTabbedPane;editName=new JSTextField;offsetXSlider=new JSSlider;offsetXSpinner=new JSSpinner;offsetYSlider=new JSSlider;offsetYSpinner=new JSSpinner;opacitySlider=new JSSlider;opacitySpinner=new JSSpinner;compositeOperations=[];compositeOperationsGroup=new ButtonGroup;delete=new JSButton;ribbonLayerPanel=null;canvas=null;layer=null;zoom=1;changed=!1;static SELECTED_LAYER_CONTENT="☑";static UNSELECTED_LAYER_CONTENT="☐";static VISIBLE_LAYER_CONTENT="\uD83D\uDC41";static PREVIEW_SIZE=50;constructor(){super(".z4layerpreview-editor"),this.cssAddClass("z4layerpreview"),this.addEventListener("toggle",e=>{""+this.getProperty("open")=="true"?(this.changed=!1,this.delete.setEnabled(this.canvas.getLayersCount()>1)):this.changed&&(this.canvas.setChanged(!0),this.canvas.saveHistory("standard,tool"))}),this.name.getStyle().width=Z4LayerPreview.PREVIEW_SIZE+35+"px",this.preview.setAttribute("width",""+Z4LayerPreview.PREVIEW_SIZE),this.preview.setAttribute("height",""+Z4LayerPreview.PREVIEW_SIZE),this.summary.setLayout(new GridBagLayout),this.summary.add(this.name,new GBC(0,0).w(3)),this.summary.add(this.preview,new GBC(1,1).h(3).f(GBC.BOTH)),this.eye.setText(Z4LayerPreview.VISIBLE_LAYER_CONTENT),this.eye.setContentAreaFilled(!1),this.eye.addActionListener(e=>{let t=!this.layer.isHidden();t?this.eye.getStyle().removeProperty("color"):this.eye.getStyle().color="var(--main-action-bgcolor)",this.layer.setHidden(t),this.canvas.setChanged(!0),this.canvas.setSaved(!1),this.canvas.drawCanvas()}),this.summary.add(this.eye,new GBC(0,1).f(GBC.BOTH).i(0,0,0,2));let e=new JSButton;e.setText(Z4LayerPreview.SELECTED_LAYER_CONTENT),e.cssAddClass("z4layerpreview-selector"),e.getStyle().color="var(--main-action-bgcolor)",e.setContentAreaFilled(!1),e.addActionListener(t=>{document.querySelectorAll(".z4layerpreview .z4layerpreview-selector").forEach(e=>e.textContent=Z4LayerPreview.UNSELECTED_LAYER_CONTENT),e.setText(Z4LayerPreview.SELECTED_LAYER_CONTENT),this.canvas.setSelectedLayer(this.layer)}),this.summary.add(e,new GBC(2,1).f(GBC.BOTH).i(0,2,0,0));let t=new JSButton;t.setText("\uD83E\uDC08"),t.getStyle().color="var(--main-action-bgcolor)",t.setContentAreaFilled(!1),t.addActionListener(e=>this.move(-1)),this.summary.add(t,new GBC(0,2).f(GBC.BOTH).i(0,0,0,2)),(t=new JSButton).setText("⯬"),t.getStyle().color="var(--main-action-bgcolor)",t.setContentAreaFilled(!1),t.addActionListener(e=>this.ribbonLayerPanel.moveLayer(this,this.layer,0)),this.summary.add(t,new GBC(0,3).f(GBC.BOTH).i(0,0,0,2)),(t=new JSButton).setText("\uD83E\uDC0A"),t.getStyle().color="var(--main-action-bgcolor)",t.setContentAreaFilled(!1),t.addActionListener(e=>this.move(2)),this.summary.add(t,new GBC(2,2).f(GBC.BOTH).i(0,2,0,0)),(t=new JSButton).setText("⯮"),t.getStyle().color="var(--main-action-bgcolor)",t.setContentAreaFilled(!1),t.addActionListener(e=>this.ribbonLayerPanel.moveLayer(this,this.layer,this.canvas.getLayersCount())),this.summary.add(t,new GBC(2,3).f(GBC.BOTH).i(0,2,0,0)),Z4UI.addVLine(this.summary,new GBC(3,0).h(4).f(GBC.VERTICAL).i(1,2,1,2)),this.appendChildInTree("summary",this.summary),this.editor.cssAddClass("z4layerpreview-editor"),this.editor.addChangeListener(e=>this.computePopupPosition());let i=new JSPanel;i.setLayout(new GridBagLayout),this.editName.addActionListener(e=>{let t=this.editName.getText();t&&(this.changed=!0,this.canvas.setSaved(!1),this.name.setText(t),this.layer.setName(t),this.setChildAttributeByQuery("summary","title",t))}),Z4UI.addLabel(i,Z4Translations.LAYER_NAME,new GBC(0,0).a(GBC.WEST)),i.add(this.editName,new GBC(0,1).w(5).a(GBC.WEST).f(GBC.HORIZONTAL).i(0,0,5,0)),Z4UI.addLabel(i,Z4Translations.OFFSET_X,new GBC(0,2).a(GBC.WEST)),this.offsetXSpinner.cssAddClass("jsspinner_w_4rem"),this.offsetXSpinner.addChangeListener(e=>this.onChange(!0,this.offsetXSpinner.getValueIsAdjusting(),this.offsetXSpinner,this.offsetXSlider)),i.add(this.offsetXSpinner,new GBC(1,2).a(GBC.EAST)),this.offsetXSlider.getStyle().minWidth="20rem",this.offsetXSlider.addChangeListener(e=>this.onChange(!1,this.offsetXSlider.getValueIsAdjusting(),this.offsetXSpinner,this.offsetXSlider)),i.add(this.offsetXSlider,new GBC(0,3).w(2).a(GBC.NORTH).f(GBC.HORIZONTAL)),Z4UI.addLabel(i,Translations.JSColorChooser_OPACITY,new GBC(0,4).a(GBC.WEST)),this.opacitySpinner.cssAddClass("jsspinner_w_4rem"),this.opacitySpinner.addChangeListener(e=>this.onChange(!0,this.opacitySpinner.getValueIsAdjusting(),this.opacitySpinner,this.opacitySlider)),i.add(this.opacitySpinner,new GBC(1,4).a(GBC.EAST)),this.opacitySlider.addChangeListener(e=>this.onChange(!1,this.opacitySlider.getValueIsAdjusting(),this.opacitySpinner,this.opacitySlider)),this.opacitySlider.getStyle().minWidth="20rem",i.add(this.opacitySlider,new GBC(0,5).w(2).a(GBC.NORTH).f(GBC.HORIZONTAL)),Z4UI.addVLine(i,new GBC(2,2).h(5).f(GBC.VERTICAL).i(1,2,1,2)),Z4UI.addLabel(i,Z4Translations.OFFSET_Y,new GBC(3,6).a(GBC.SOUTH)).cssAddClass("jslabel-vertical"),this.offsetYSpinner.cssAddClass("jsspinner-vertical"),this.offsetYSpinner.cssAddClass("jsspinner_h_4rem"),this.offsetYSpinner.setChildPropertyByQuery("*:nth-child(2)","textContent","▶"),this.offsetYSpinner.setChildPropertyByQuery("*:nth-child(3)","textContent","◀"),this.offsetYSpinner.addChangeListener(e=>this.onChange(!0,this.offsetYSpinner.getValueIsAdjusting(),this.offsetYSpinner,this.offsetYSlider)),i.add(this.offsetYSpinner,new GBC(3,2).h(3).a(GBC.NORTH)),this.offsetYSlider.setOrientation(JSSlider.VERTICAL),this.offsetYSlider.setInverted(!0),this.offsetYSlider.getStyle().minHeight="20rem",this.offsetYSlider.getStyle().minWidth="1.5rem",this.offsetYSlider.addChangeListener(e=>this.onChange(!1,this.offsetYSlider.getValueIsAdjusting(),this.offsetYSpinner,this.offsetYSlider)),i.add(this.offsetYSlider,new GBC(4,2).h(5).wy(1).a(GBC.NORTH)),(t=new JSButton).setText(Z4Translations.DUPLICATE),t.addActionListener(e=>{this.changed=!0,this.canvas.duplicateLayer(this.layer),this.removeAttribute("open")}),i.add(t,new GBC(0,6).a(GBC.SOUTHWEST)),this.delete.setText(Z4Translations.DELETE),this.delete.addActionListener(e=>JSOptionPane.showConfirmDialog(Z4Translations.DELETE_LAYER_MESSAGE,Z4Translations.DELETE,JSOptionPane.YES_NO_OPTION,JSOptionPane.QUESTION_MESSAGE,e=>{if(e===JSOptionPane.YES_OPTION){this.changed=!0;let t=this.canvas.deleteLayer(this.layer);document.querySelector(".z4layerpreview:nth-child("+(t+1)+")").remove()}})),i.add(this.delete,new GBC(1,6).a(GBC.SOUTHEAST)),this.editor.addTab(Z4Translations.BASIC,i);let s=new JSPanel;s.setLayout(new GridBagLayout),Z4UI.addLabel(s,Z4Translations.COMPOSITE_OPERATION,new GBC(0,0).a(GBC.WEST)),Z4Constants.COMPOSITE_OPERATION.forEach((e,t,i)=>{e.forEach((e,i,a)=>{let n=new JSRadioButton;n.setContentAreaFilled(!1),n.setToggle(),n.setText(e),n.setTooltip(Z4Translations["COMPOSITE_OPERATION_"+e.toUpperCase().replace("-","_")]),n.addActionListener(t=>this.onAction(e)),this.compositeOperations.push(n),this.compositeOperationsGroup.add(n),s.add(n,new GBC(i,t+1).a(GBC.WEST).f(GBC.HORIZONTAL).i(1,1,1,1))})}),this.editor.addTab(Z4Translations.ADVANCED,s);let a=new JSPanel;a.setLayout(new GridBagLayout),this.editor.addTab(Z4Translations.TRANSFORM,a),this.addButton(a,Z4Translations.FLIP_HORIZONTAL,0,0,()=>this.layer.flipHorizonal()),this.addButton(a,Z4Translations.FLIP_VERTICAL,1,0,()=>this.layer.flipVertical()),this.addButton(a,Z4Translations.ROTATE_PLUS_90,0,1,()=>{this.layer.rotatePlus90(),this.setLayer(this.canvas,this.layer)}),this.addButton(a,Z4Translations.ROTATE_MINUS_90,1,1,()=>{this.layer.rotatePlus90(),this.layer.rotatePlus90(),this.layer.rotatePlus90(),this.setLayer(this.canvas,this.layer)}),this.addButton(a,Z4Translations.ROTATE_180,0,2,()=>{this.layer.rotatePlus90(),this.layer.rotatePlus90(),this.setLayer(this.canvas,this.layer)}),this.appendChild(this.editor)}addButton(e,t,i,s,a){let n=new JSButton;n.setText(t),n.setContentAreaFilled(!1),n.addActionListener(e=>{this.changed=!0,a(),this.drawLayer(),this.canvas.setSaved(!1),this.canvas.drawCanvas()}),e.add(n,new GBC(i,s).f(GBC.HORIZONTAL).i(1,1,1,1))}onChange(e,t,i,s){this.changed=!0,this.canvas.setSaved(!1),e?s.setValue(i.getValue()):i.setValue(s.getValue()),t?this.editor.setAttribute("offset","true"):this.editor.removeAttribute("offset"),this.layer.setOpacity(this.opacitySpinner.getValue()/100),this.layer.move(this.offsetXSlider.getValue(),this.offsetYSlider.getValue()),this.canvas.drawCanvas()}onAction(e){this.changed=!0,this.canvas.setSaved(!1),this.layer.setCompositeOperation(e),this.canvas.drawCanvas()}move(e){this.cssAddClass("z4layerpreview-move");let t=-1,i=document.querySelector(".z4layerpreview-move");for(let s=0;s<i.parentElement.children.length;s++)i===i.parentElement.children.item(s)&&(t=s);(e<0&&t>0||e>0&&t<this.canvas.getLayersCount()-1)&&(this.removeAttribute("open"),this.ribbonLayerPanel.moveLayer(this,this.layer,t+e)),this.cssRemoveClass("z4layerpreview-move")}setRibbonLayerPanel(e){this.ribbonLayerPanel=e}setLayer(e,t){this.canvas=e,this.layer=t,this.name.setText(this.layer.getName()),this.editName.setText(this.layer.getName()),this.setChildAttributeByQuery("summary","title",this.layer.getName()),this.layer.isHidden()?this.eye.getStyle().removeProperty("color"):this.eye.getStyle().color="var(--main-action-bgcolor)";let i=t.getSize(),s=i.width/i.height,a=0,n=0;s>1?(a=Z4LayerPreview.PREVIEW_SIZE,n=Z4LayerPreview.PREVIEW_SIZE/s):(a=Z4LayerPreview.PREVIEW_SIZE*s,n=Z4LayerPreview.PREVIEW_SIZE),this.zoom=Math.min(a/i.width,n/i.height),this.preview.setAttribute("width",""+a),this.preview.setAttribute("height",""+n),this.preview.getStyle().marginTop=(Z4LayerPreview.PREVIEW_SIZE-n-1)/2+"px",this.preview.getStyle().marginBottom=(Z4LayerPreview.PREVIEW_SIZE-n-1)/2+"px",this.preview.getStyle().marginLeft=(Z4LayerPreview.PREVIEW_SIZE-a-1)/2+"px",this.preview.getStyle().marginRight=(Z4LayerPreview.PREVIEW_SIZE-a-1)/2+"px";let r=t.getOffset(),o=this.canvas.getSize();this.offsetXSlider.setMinimum(-i.width),this.offsetXSlider.setMaximum(o.width),this.offsetXSlider.setValue(r.x),this.offsetXSpinner.setModel(new SpinnerNumberModel(r.x,-i.width,o.width,1)),this.offsetYSlider.setMinimum(-i.height),this.offsetYSlider.setMaximum(o.height),this.offsetYSlider.setValue(r.y),this.offsetYSpinner.setModel(new SpinnerNumberModel(r.y,-i.height,o.height,1)),this.opacitySlider.setValue(parseInt(100*t.getOpacity())),this.opacitySpinner.setModel(new SpinnerNumberModel(parseInt(100*t.getOpacity()),0,100,1)),this.compositeOperations.forEach(e=>e.setSelected(e.getText()===t.getCompositeOperation())),this.drawLayer()}drawLayer(){this.layer&&(this.ctx.save(),this.ctx.scale(this.zoom,this.zoom),this.layer.draw(this.ctx,!0,!0),this.ctx.restore())}}class Z4Frame extends JSFrame{ribbon=new Z4Ribbon;canvas=new Z4Canvas;statusPanel=new Z4StatusPanel;constructor(){super(),this.cssAddClass("z4frame"),this.getContentPane().setLayout(new BorderLayout(5,5)),this.ribbon.setCanvas(this.canvas),this.ribbon.setStatusPanel(this.statusPanel),this.canvas.setStatusPanel(this.statusPanel),this.getContentPane().add(this.ribbon,BorderLayout.NORTH),this.getContentPane().add(this.canvas,BorderLayout.CENTER),this.getContentPane().add(this.statusPanel,BorderLayout.SOUTH),this.canvas.create(Z4Constants.DEFAULT_IMAGE_SIZE,Z4Constants.DEFAULT_IMAGE_SIZE,new Color(0,0,0,0)),window.onbeforeunload=e=>this.canvas.isSaved()?null:(e.preventDefault(),e.returnValue=Z4Translations.PROJECT_NOT_SAVED_MESSAGE,e.returnValue)}}class Z4BiGradientColorPanel extends JSPanel{preview=new JSComponent(document.createElement("canvas"));ctx=this.preview.invoke("getContext('2d')");biRippleSpinner=new JSSpinner;biRippleSlider=new JSSlider;rippleSpinner=new JSSpinner;rippleSlider=new JSSlider;colorPreview=new Z4ColorPreview;biDelete=new JSButton;delete=new JSButton;space=null;time=null;biGradientColor=new Z4BiGradientColor;biSelectedIndex=0;selectedIndex=0;pressed=!1;width=Z4BiGradientColorPanel.SIZE;height=Z4BiGradientColorPanel.SIZE;static SELECTOR_RADIUS=7;static SIZE=200;static TOLERANCE=.1;constructor(){super(),this.cssAddClass("z4bigradientcolorpanel"),this.setLayout(new GridBagLayout),this.add(new JSLabel,new GBC(0,0).w(3).wy(1)),this.space=Z4UI.addLabel(this,Z4Translations.SPACE,new GBC(1,1).w(2).a(GBC.SOUTHEAST)),this.time=Z4UI.addLabel(this,Z4Translations.TIME,new GBC(0,2).wh(3,2).a(GBC.SOUTHEAST)),this.time.cssAddClass("jslabel-vertical"),this.preview.setProperty("width",""+this.width),this.preview.setProperty("height",""+this.height),this.preview.addEventListener("mouseenter",e=>this.onMouse(e,"enter")),this.preview.addEventListener("mouseleave",e=>this.onMouse(e,"leave")),this.preview.addEventListener("mousedown",e=>this.onMouse(e,"down")),this.preview.addEventListener("mousemove",e=>this.onMouse(e,"move")),this.preview.addEventListener("mouseup",e=>this.onMouse(e,"up")),this.add(this.preview,new GBC(1,2).wh(2,2)),Z4UI.addLabel(this,Z4Translations.RIPPLE,new GBC(3,3).h(2).a(GBC.SOUTH)).cssAddClass("jslabel-vertical"),this.biRippleSpinner.cssAddClass("jsspinner-vertical"),this.biRippleSpinner.cssAddClass("jsspinner_h_4rem"),this.biRippleSpinner.setModel(new SpinnerNumberModel(0,0,100,1)),this.biRippleSpinner.setChildPropertyByQuery("*:nth-child(2)","textContent","▶"),this.biRippleSpinner.setChildPropertyByQuery("*:nth-child(3)","textContent","◀"),this.biRippleSpinner.addChangeListener(e=>this.onChange(!0,this.biRippleSpinner.getValueIsAdjusting(),this.biRippleSpinner,this.biRippleSlider,!0)),this.add(this.biRippleSpinner,new GBC(3,0).h(3).a(GBC.NORTHEAST).i(0,5,0,0)),this.biRippleSlider.setValue(0),this.biRippleSlider.setOrientation(JSSlider.VERTICAL),this.biRippleSlider.setInverted(!0),this.biRippleSlider.getStyle().minHeight="20rem",this.biRippleSlider.getStyle().minWidth="1.5rem",this.biRippleSlider.addChangeListener(e=>this.onChange(!1,this.biRippleSlider.getValueIsAdjusting(),this.biRippleSpinner,this.biRippleSlider,!0)),this.add(this.biRippleSlider,new GBC(4,0).h(5).a(GBC.EAST));let e=new JSPanel;e.cssAddClass("jspanel-vertical"),this.add(e,new GBC(5,0).h(5).a(GBC.NORTH).f(GBC.BOTH));let t=new JSButton;t.cssAddClass("jsbutton-vertical"),t.setText(Z4Translations.MIRRORED),t.addActionListener(e=>{this.biGradientColor.mirror(),this.afterOperation(this.biGradientColor.getColorAtIndex(this.biSelectedIndex))}),e.add(t,null),(t=new JSButton).cssAddClass("jsbutton-vertical"),t.setText(Z4Translations.INVERTED),t.addActionListener(e=>{this.biGradientColor.reverse(),this.drawPreview(!1)}),e.add(t,null),this.biDelete.cssAddClass("jsbutton-vertical"),this.biDelete.setText(Z4Translations.DELETE),this.biDelete.setEnabled(!1),this.biDelete.addActionListener(e=>JSOptionPane.showConfirmDialog(Z4Translations.DELETE_COLOR_MESSAGE,Z4Translations.DELETE,JSOptionPane.YES_NO_OPTION,JSOptionPane.QUESTION_MESSAGE,e=>{e===JSOptionPane.YES_OPTION&&(this.biGradientColor.removeColor(this.biGradientColor.getColorPositionAtIndex(this.biSelectedIndex)),this.biSelectedIndex=0,this.afterOperation(this.biGradientColor.getColorAtIndex(this.biSelectedIndex)))})),e.add(this.biDelete,null),this.add(new JSLabel,new GBC(0,4).w(3).wy(1)),Z4UI.addHLine(this,new GBC(0,5).w(6).a(GBC.WEST).f(GBC.HORIZONTAL).i(2,1,2,1)),this.colorPreview.setColor(this.biGradientColor.getColorAtIndex(this.biSelectedIndex).getColorAtIndex(this.selectedIndex)),this.add(this.colorPreview,new GBC(0,6).w(2).wx(1).f(GBC.HORIZONTAL)),(t=new JSButton).setText(Z4Translations.EDIT),t.addActionListener(e=>this.selectColor()),this.add(t,new GBC(2,6).w(2).a(GBC.WEST).i(0,5,0,0)),this.delete.setText(Z4Translations.DELETE),this.delete.setEnabled(!1),this.delete.addActionListener(e=>JSOptionPane.showConfirmDialog(Z4Translations.DELETE_COLOR_MESSAGE,Z4Translations.DELETE,JSOptionPane.YES_NO_OPTION,JSOptionPane.QUESTION_MESSAGE,e=>{if(e===JSOptionPane.YES_OPTION){let t=this.biGradientColor.getColorAtIndex(this.biSelectedIndex);t.removeColor(t.getColorPositionAtIndex(this.selectedIndex)),this.selectedIndex=0,this.afterOperation(t)}})),this.add(this.delete,new GBC(4,6).w(2).a(GBC.EAST).i(0,5,0,0)),Z4UI.addLabel(this,Z4Translations.RIPPLE,new GBC(0,7).w(2).a(GBC.WEST)),this.rippleSpinner.setModel(new SpinnerNumberModel(0,0,100,1)),this.rippleSpinner.cssAddClass("jsspinner_w_4rem"),this.rippleSpinner.addChangeListener(e=>this.onChange(!0,this.rippleSpinner.getValueIsAdjusting(),this.rippleSpinner,this.rippleSlider,!1)),this.add(this.rippleSpinner,new GBC(3,7).w(3).a(GBC.EAST).i(5,0,0,0)),this.rippleSlider.setValue(0),this.rippleSlider.getStyle().minWidth="20rem",this.rippleSlider.addChangeListener(e=>this.onChange(!1,this.rippleSlider.getValueIsAdjusting(),this.rippleSpinner,this.rippleSlider,!1)),this.add(this.rippleSlider,new GBC(0,8).w(6).a(GBC.NORTH).f(GBC.HORIZONTAL)),e=new JSPanel,this.add(e,new GBC(0,9).w(6).a(GBC.NORTH).f(GBC.HORIZONTAL)),(t=new JSButton).setText(Z4Translations.MIRRORED),t.addActionListener(e=>{let t=this.biGradientColor.getColorAtIndex(this.biSelectedIndex);t.mirror(),this.afterOperation(t)}),e.add(t,null),(t=new JSButton).setText(Z4Translations.INVERTED),t.addActionListener(e=>{let t=this.biGradientColor.getColorAtIndex(this.biSelectedIndex);t.reverse(),this.afterOperation(t)}),e.add(t,null),this.drawPreview(!1)}onMouse(e,t){switch(t){case"enter":break;case"down":for(let i=0;i<this.biGradientColor.getColorCount();i++){let s=this.biGradientColor.getColorPositionAtIndex(i),a=this.biGradientColor.getColorAtIndex(i);for(let n=0;n<a.getColorCount();n++){let r=a.getColorPositionAtIndex(n);Z4Math.distance(r*this.width,s*this.height,e.offsetX,e.offsetY)<=Z4BiGradientColorPanel.SELECTOR_RADIUS&&(this.pressed=!0,this.biSelectedIndex=i,this.selectedIndex=n,this.afterOperation(a))}}if(!this.pressed&&!this.biGradientColor.isPositionOccupied(e.offsetY/this.height,Z4BiGradientColorPanel.TOLERANCE)){let o=this.biGradientColor.getColorAt(e.offsetY/this.height,!1);for(;o.getColorCount()>2;)o.removeColor(o.getColorPositionAtIndex(1));o.isPositionOccupied(e.offsetX/this.width,Z4BiGradientColorPanel.TOLERANCE)||o.addColor(o.getColorAt(e.offsetX/this.width,!1),e.offsetX/this.width),o.mergeOverlapping(Z4BiGradientColorPanel.TOLERANCE),this.biGradientColor.addColor(o,e.offsetY/this.height),this.pressed=!0,this.setPointer(e,!0)}if(!this.pressed){let l=this.biGradientColor.getPosition(e.offsetY/this.height,Z4BiGradientColorPanel.TOLERANCE),h=this.biGradientColor.getColorAt(l,!1);h.isPositionOccupied(e.offsetX/this.width,Z4BiGradientColorPanel.TOLERANCE)||(h.addColor(h.getColorAt(e.offsetX/this.width,!1),e.offsetX/this.width),this.setPointer(e,!0))}break;case"move":if(this.pressed){let d=this.biGradientColor.getColorPositionAtIndex(this.biSelectedIndex),c=this.biGradientColor.getColorPositionAtIndex(this.biSelectedIndex-1),g=this.biGradientColor.getColorPositionAtIndex(this.biSelectedIndex+1),u=e.offsetY/this.height,E=this.biGradientColor.getColorAtIndex(this.biSelectedIndex),T=E.getColorPositionAtIndex(this.selectedIndex),p=E.getColorPositionAtIndex(this.selectedIndex-1),S=E.getColorPositionAtIndex(this.selectedIndex+1),A=e.offsetX/this.width;if(0!==this.biSelectedIndex&&this.biSelectedIndex!==this.biGradientColor.getColorCount()-1&&c<u-Z4BiGradientColorPanel.TOLERANCE&&g>u+Z4BiGradientColorPanel.TOLERANCE&&(this.biGradientColor.removeColor(d),this.biGradientColor.addColor(E,u),this.drawPreview(!0)),0!==this.selectedIndex&&this.selectedIndex!==E.getColorCount()-1&&p<A-Z4BiGradientColorPanel.TOLERANCE&&S>A+Z4BiGradientColorPanel.TOLERANCE){let I=E.getColorAtIndex(this.selectedIndex);E.removeColor(T),E.addColor(I,A),this.drawPreview(!0)}}else if(this.preview.getStyle().cursor="default",this.setPointer(e,!1),"default"!==this.preview.getStyle().cursor||this.biGradientColor.isPositionOccupied(e.offsetY/this.height,Z4BiGradientColorPanel.TOLERANCE)||(this.preview.getStyle().cursor="copy"),"default"===this.preview.getStyle().cursor){let P=this.biGradientColor.getPosition(e.offsetY/this.height,Z4BiGradientColorPanel.TOLERANCE);this.biGradientColor.getColorAt(P,!1).isPositionOccupied(e.offsetX/this.width,Z4BiGradientColorPanel.TOLERANCE)||(this.preview.getStyle().cursor="copy")}break;case"up":case"leave":this.pressed=!1,this.drawPreview(!1)}}setPointer(e,t){for(let i=0;i<this.biGradientColor.getColorCount();i++){let s=this.biGradientColor.getColorPositionAtIndex(i),a=this.biGradientColor.getColorAtIndex(i);for(let n=0;n<a.getColorCount();n++){let r=a.getColorPositionAtIndex(n);Z4Math.distance(r*this.width,s*this.height,e.offsetX,e.offsetY)<=Z4BiGradientColorPanel.SELECTOR_RADIUS&&(t&&(this.biSelectedIndex=i,this.selectedIndex=n,this.afterOperation(a)),this.preview.getStyle().cursor="pointer")}}}onChange(e,t,i,s,a){e?s.setValue(i.getValue()):i.setValue(s.getValue()),a?this.biGradientColor.setRipple(s.getValue()/100):this.biGradientColor.setGradientRipple(s.getValue()/100),this.drawPreview(t)}selectColor(){JSColorChooser.showDialog(Z4Translations.COLOR,this.biGradientColor.getColorAtIndex(this.biSelectedIndex).getColorAtIndex(this.selectedIndex),!0,null,e=>{let t=this.biGradientColor.getColorAtIndex(this.biSelectedIndex);t.addColor(e,t.getColorPositionAtIndex(this.selectedIndex)),this.colorPreview.setColor(e),this.drawPreview(!1)})}afterOperation(e){this.colorPreview.setColor(this.biGradientColor.getColorAtIndex(this.biSelectedIndex).getColorAtIndex(this.selectedIndex)),this.biDelete.setEnabled(0!==this.biSelectedIndex&&this.biSelectedIndex!==this.biGradientColor.getColorCount()-1),this.delete.setEnabled(0!==this.selectedIndex&&this.selectedIndex!==e.getColorCount()-1),this.drawPreview(!1)}drawPreview(e){if(this.width>0&&this.height>0){let t=this.ctx.createImageData(this.width,this.height),i=t.data;for(let s=0;s<this.height;s++){let a=this.biGradientColor.getColorAt(s/this.height,!0);for(let n=0;n<this.width;n++){let r=a.getColorAt(n/this.width,!0),o=(s*this.width+n)*4;i[o]=r.red,i[o+1]=r.green,i[o+2]=r.blue,i[o+3]=r.alpha}}this.ctx.putImageData(t,0,0);for(let l=0;l<this.biGradientColor.getColorCount();l++){let h=this.biGradientColor.getColorPositionAtIndex(l),d=this.biGradientColor.getColorAtIndex(l);for(let c=0;c<d.getColorCount();c++)this.drawCircle(h,d.getColorPositionAtIndex(c),l,c)}}}drawCircle(e,t,i,s){let a=[];this.ctx.beginPath(),this.ctx.arc(t*this.width,e*this.height,Z4BiGradientColorPanel.SELECTOR_RADIUS,0,2*Math.PI),this.ctx.closePath(),this.ctx.strokeStyle=Z4Constants.getStyle(i===this.biSelectedIndex&&s===this.selectedIndex?"red":"black"),this.ctx.setLineDash(a),this.ctx.stroke(),a.push(2.5,2.5),this.ctx.beginPath(),this.ctx.arc(t*this.width,e*this.height,Z4BiGradientColorPanel.SELECTOR_RADIUS,0,2*Math.PI),this.ctx.closePath(),this.ctx.strokeStyle=Z4Constants.getStyle("white"),this.ctx.setLineDash(a),this.ctx.stroke()}setSpaceTimeLabelsVisible(e){this.space.getStyle().visibility=e?"visible":"hidden",this.time.getStyle().visibility=e?"visible":"hidden"}setSize(e,t){let i=e/t;this.width=parseInt(i>1?Z4BiGradientColorPanel.SIZE:Z4BiGradientColorPanel.SIZE*i),this.height=parseInt(i>1?Z4BiGradientColorPanel.SIZE/i:Z4BiGradientColorPanel.SIZE),this.preview.setProperty("width",""+this.width),this.preview.setProperty("height",""+this.height),this.drawPreview(!1)}getSelectedBiGradientColor(){return this.biGradientColor}}class Z4GradientColorPanel extends JSPanel{preview=new JSComponent(document.createElement("canvas"));ctx=this.preview.invoke("getContext('2d')");rippleSpinner=new JSSpinner;rippleSlider=new JSSlider;colorPreview=new Z4ColorPreview;delete=new JSButton;gradientColor=new Z4GradientColor;selectedIndex=0;pressed=!1;listeners=[];valueIsAdjusting=!1;static SELECTOR_RADIUS=7;static WIDTH=200;static HEIGHT=50;static TOLERANCE=.1;constructor(){super(),this.cssAddClass("z4gradientcolorpanel"),this.setLayout(new GridBagLayout),this.preview.setProperty("width",""+Z4GradientColorPanel.WIDTH),this.preview.setProperty("height",""+Z4GradientColorPanel.HEIGHT),this.preview.addEventListener("mouseenter",e=>this.onMouse(e,"enter")),this.preview.addEventListener("mouseleave",e=>this.onMouse(e,"leave")),this.preview.addEventListener("mousedown",e=>this.onMouse(e,"down")),this.preview.addEventListener("mousemove",e=>this.onMouse(e,"move")),this.preview.addEventListener("mouseup",e=>this.onMouse(e,"up")),this.add(this.preview,new GBC(0,0).w(3).i(0,0,5,0)),this.colorPreview.setColor(this.gradientColor.getColorAtIndex(this.selectedIndex)),this.add(this.colorPreview,new GBC(0,1).wx(1).f(GBC.HORIZONTAL));let e=new JSButton;e.setText(Z4Translations.EDIT),e.addActionListener(e=>this.selectColor()),this.add(e,new GBC(1,1).a(GBC.WEST).i(0,5,0,0)),this.delete.setText(Z4Translations.DELETE),this.delete.setEnabled(!1),this.delete.addActionListener(e=>JSOptionPane.showConfirmDialog(Z4Translations.DELETE_COLOR_MESSAGE,Z4Translations.DELETE,JSOptionPane.YES_NO_OPTION,JSOptionPane.QUESTION_MESSAGE,e=>{e===JSOptionPane.YES_OPTION&&(this.gradientColor.removeColor(this.gradientColor.getColorPositionAtIndex(this.selectedIndex)),this.selectedIndex=0,this.afterOperation(),this.fireOnChange())})),this.add(this.delete,new GBC(2,1).a(GBC.WEST).i(0,5,0,0)),Z4UI.addLabel(this,Z4Translations.RIPPLE,new GBC(0,3).a(GBC.WEST)),this.rippleSpinner.cssAddClass("jsspinner_w_4rem"),this.rippleSpinner.setModel(new SpinnerNumberModel(0,0,100,1)),this.rippleSpinner.addChangeListener(e=>this.onChange(!0,this.rippleSpinner.getValueIsAdjusting())),this.add(this.rippleSpinner,new GBC(1,3).w(2).a(GBC.EAST).i(5,0,0,0)),this.rippleSlider.setValue(0),this.rippleSlider.getStyle().minWidth="20rem",this.rippleSlider.addChangeListener(e=>this.onChange(!1,this.rippleSlider.getValueIsAdjusting())),this.add(this.rippleSlider,new GBC(0,4).w(3).a(GBC.NORTH).f(GBC.HORIZONTAL));let t=new JSPanel;this.add(t,new GBC(0,5).w(3).a(GBC.NORTH).f(GBC.HORIZONTAL)),(e=new JSButton).setText(Z4Translations.MIRRORED),e.addActionListener(e=>{this.gradientColor.mirror(),this.afterOperation(),this.fireOnChange()}),t.add(e,null),(e=new JSButton).setText(Z4Translations.INVERTED),e.addActionListener(e=>{this.gradientColor.reverse(),this.drawPreview(!1),this.fireOnChange()}),t.add(e,null),this.drawPreview(!1)}onMouse(e,t){switch(t){case"enter":break;case"down":for(let i=0;i<this.gradientColor.getColorCount();i++){let s=this.gradientColor.getColorPositionAtIndex(i);Z4Math.distance(s*Z4GradientColorPanel.WIDTH,Z4GradientColorPanel.HEIGHT/2,e.offsetX,e.offsetY)<=Z4GradientColorPanel.SELECTOR_RADIUS&&(this.pressed=!0,this.selectedIndex=i,this.afterOperation())}if(!this.pressed&&!this.gradientColor.isPositionOccupied(e.offsetX/Z4GradientColorPanel.WIDTH,Z4GradientColorPanel.TOLERANCE)&&Math.abs(Z4GradientColorPanel.HEIGHT/2-e.offsetY)<=Z4GradientColorPanel.SELECTOR_RADIUS){this.gradientColor.addColor(this.gradientColor.getColorAt(e.offsetX/Z4GradientColorPanel.WIDTH,!1),e.offsetX/Z4GradientColorPanel.WIDTH),this.pressed=!0;for(let a=0;a<this.gradientColor.getColorCount();a++){let n=this.gradientColor.getColorPositionAtIndex(a);Z4Math.distance(n*Z4GradientColorPanel.WIDTH,Z4GradientColorPanel.HEIGHT/2,e.offsetX,e.offsetY)<=Z4GradientColorPanel.SELECTOR_RADIUS&&(this.selectedIndex=a,this.afterOperation(),this.fireOnChange())}this.preview.getStyle().cursor="pointer"}break;case"move":if(this.pressed){let r=this.gradientColor.getColorPositionAtIndex(this.selectedIndex),o=this.gradientColor.getColorPositionAtIndex(this.selectedIndex-1),l=this.gradientColor.getColorPositionAtIndex(this.selectedIndex+1),h=e.offsetX/Z4GradientColorPanel.WIDTH;if(0!==this.selectedIndex&&this.selectedIndex!==this.gradientColor.getColorCount()-1&&o<h-Z4GradientColorPanel.TOLERANCE&&l>h+Z4GradientColorPanel.TOLERANCE){let d=this.gradientColor.getColorAtIndex(this.selectedIndex);this.gradientColor.removeColor(r),this.gradientColor.addColor(d,h),this.drawPreview(!0),this.valueIsAdjusting=!0,this.fireOnChange()}}else{this.preview.getStyle().cursor="default";for(let c=0;c<this.gradientColor.getColorCount();c++){let g=this.gradientColor.getColorPositionAtIndex(c);Z4Math.distance(g*Z4GradientColorPanel.WIDTH,Z4GradientColorPanel.HEIGHT/2,e.offsetX,e.offsetY)<=Z4GradientColorPanel.SELECTOR_RADIUS&&(this.preview.getStyle().cursor="pointer")}"default"===this.preview.getStyle().cursor&&!this.gradientColor.isPositionOccupied(e.offsetX/Z4GradientColorPanel.WIDTH,Z4GradientColorPanel.TOLERANCE)&&Math.abs(Z4GradientColorPanel.HEIGHT/2-e.offsetY)<=Z4GradientColorPanel.SELECTOR_RADIUS&&(this.preview.getStyle().cursor="copy")}break;case"up":case"leave":this.pressed=!1,this.drawPreview(!1),this.valueIsAdjusting=!1,this.fireOnChange()}}onChange(e,t){e?this.rippleSlider.setValue(this.rippleSpinner.getValue()):this.rippleSpinner.setValue(this.rippleSlider.getValue()),this.gradientColor.setRipple(this.rippleSlider.getValue()/100),this.drawPreview(t),this.valueIsAdjusting=t,this.fireOnChange()}selectColor(){JSColorChooser.showDialog(Z4Translations.COLOR,this.gradientColor.getColorAtIndex(this.selectedIndex),!0,null,e=>{this.gradientColor.addColor(e,this.gradientColor.getColorPositionAtIndex(this.selectedIndex)),this.colorPreview.setColor(e),this.drawPreview(!1),this.fireOnChange()})}afterOperation(){this.colorPreview.setColor(this.gradientColor.getColorAtIndex(this.selectedIndex)),this.delete.setEnabled(0!==this.selectedIndex&&this.selectedIndex!==this.gradientColor.getColorCount()-1),this.drawPreview(!1)}drawPreview(e){let t=this.ctx.createImageData(Z4GradientColorPanel.WIDTH,Z4GradientColorPanel.HEIGHT),i=t.data;for(let s=0;s<Z4GradientColorPanel.WIDTH;s++){let a=this.gradientColor.getColorAt(s/Z4GradientColorPanel.WIDTH,!0);for(let n=0;n<Z4GradientColorPanel.HEIGHT;n++){let r=(n*Z4GradientColorPanel.WIDTH+s)*4;i[r]=a.red,i[r+1]=a.green,i[r+2]=a.blue,i[r+3]=a.alpha}}this.ctx.putImageData(t,0,0);for(let o=0;o<this.gradientColor.getColorCount();o++)this.drawCircle(this.gradientColor.getColorPositionAtIndex(o),o)}drawCircle(e,t){let i=[];this.ctx.beginPath(),this.ctx.arc(e*Z4GradientColorPanel.WIDTH,Z4GradientColorPanel.HEIGHT/2,Z4GradientColorPanel.SELECTOR_RADIUS,0,2*Math.PI),this.ctx.closePath(),this.ctx.strokeStyle=Z4Constants.getStyle(t===this.selectedIndex?"red":"black"),this.ctx.setLineDash(i),this.ctx.stroke(),i.push(2.5,2.5),this.ctx.beginPath(),this.ctx.arc(e*Z4GradientColorPanel.WIDTH,Z4GradientColorPanel.HEIGHT/2,Z4GradientColorPanel.SELECTOR_RADIUS,0,2*Math.PI),this.ctx.closePath(),this.ctx.strokeStyle=Z4Constants.getStyle("white"),this.ctx.setLineDash(i),this.ctx.stroke()}getGradientColor(){return this.gradientColor}addChangeListener(e){this.listeners.push(e)}fireOnChange(){let e=new ChangeEvent;this.listeners.forEach(t=>{"function"==typeof t?t(e):t.stateChanged(e)})}getValueIsAdjusting(){return this.valueIsAdjusting}}class Z4GradientColorProgressionPanelOrientation{static HORIZONTALLY_COMPACT="HORIZONTALLY_COMPACT";static VERTICALLY_COMPACT="VERTICALLY_COMPACT"}class Z4LightingPanelOrientation{static HORIZONTAL="HORIZONTAL";static VERTICAL="VERTICAL"}class Z4AbstractFillerPanel extends JSPanel{preview=new JSComponent(document.createElement("canvas"));ctx=this.preview.invoke("getContext('2d')");offscreenCanvas=new OffscreenCanvas(Z4AbstractFillerPanel.SIZE/Z4AbstractFillerPanel.RESCALE,Z4AbstractFillerPanel.SIZE/Z4AbstractFillerPanel.RESCALE);offscreenCtx=this.offscreenCanvas.getContext("2d");xSlider=new JSSlider;xSpinner=new JSSpinner;ySlider=new JSSlider;ySpinner=new JSSpinner;gradientColor=new Z4GradientColor;radios=[];points=[];width=Z4Constants.DEFAULT_IMAGE_SIZE;height=Z4Constants.DEFAULT_IMAGE_SIZE;selectedIndex=0;selectedOption=null;pressed=!1;static SIZE=180;static SELECTOR_RADIUS=7;static RESCALE=3;constructor(e,t){super(),this.cssAddClass("z4abstractfillerpanel"),this.setLayout(new GridBagLayout);let i=new JSPanel;this.add(i,new GBC(0,0).w(4).a(GBC.WEST).f(GBC.HORIZONTAL)),this.preview.setProperty("width",""+Z4AbstractFillerPanel.SIZE),this.preview.setProperty("height",""+Z4AbstractFillerPanel.SIZE),this.preview.addEventListener("mouseenter",e=>this.onMouse(e,"enter")),this.preview.addEventListener("mouseleave",e=>this.onMouse(e,"leave")),this.preview.addEventListener("mousedown",e=>this.onMouse(e,"down")),this.preview.addEventListener("mousemove",e=>this.onMouse(e,"move")),this.preview.addEventListener("mouseup",e=>this.onMouse(e,"up")),this.add(this.preview,new GBC(0,1).wh(2,2).wxy(1,1)),Z4UI.addLabel(this,"y",new GBC(2,2).a(GBC.SOUTH)).cssAddClass("jslabel-vertical"),this.ySpinner.cssAddClass("jsspinner-vertical"),this.ySpinner.cssAddClass("jsspinner_h_4rem"),this.ySpinner.setModel(new SpinnerNumberModel(0,0,this.height,1)),this.ySpinner.setChildPropertyByQuery("*:nth-child(2)","textContent","▶"),this.ySpinner.setChildPropertyByQuery("*:nth-child(3)","textContent","◀"),this.ySpinner.addChangeListener(e=>this.onChange(!0,this.ySpinner.getValueIsAdjusting(),this.ySpinner,this.ySlider,!1)),this.add(this.ySpinner,new GBC(2,1).wy(1).a(GBC.NORTHEAST)),this.ySlider.setMaximum(this.height),this.ySlider.setOrientation(JSSlider.VERTICAL),this.ySlider.setInverted(!0),this.ySlider.getStyle().minHeight="20rem",this.ySlider.getStyle().minWidth="1.5rem",this.ySlider.addChangeListener(e=>this.onChange(!1,this.ySlider.getValueIsAdjusting(),this.ySpinner,this.ySlider,!1)),this.add(this.ySlider,new GBC(3,1).h(2).a(GBC.EAST)),Z4UI.addHLine(this,new GBC(0,3).w(4).a(GBC.WEST).f(GBC.HORIZONTAL).i(2,1,2,1)),Z4UI.addLabel(this,"x",new GBC(0,4).a(GBC.WEST)),this.xSpinner.setModel(new SpinnerNumberModel(0,0,this.width,1)),this.xSpinner.cssAddClass("jsspinner_w_4rem"),this.xSpinner.addChangeListener(e=>this.onChange(!0,this.xSpinner.getValueIsAdjusting(),this.xSpinner,this.xSlider,!0)),this.add(this.xSpinner,new GBC(1,4).w(3).a(GBC.EAST)),this.xSlider.setMaximum(this.width),this.xSlider.getStyle().minWidth="20rem",this.xSlider.addChangeListener(e=>this.onChange(!1,this.xSlider.getValueIsAdjusting(),this.xSpinner,this.xSlider,!0)),this.add(this.xSlider,new GBC(0,5).w(4).a(GBC.NORTH).f(GBC.HORIZONTAL));let s=new JSPanel;if(this.add(s,new GBC(0,6).w(4).a(GBC.WEST).f(GBC.HORIZONTAL)),t){let a=new ButtonGroup;t.forEach((e,t,s)=>{let n=new JSRadioButton;n.setContentAreaFilled(!1),n.setToggle(),n.setSelected(0===t),0===t&&(this.selectedOption=e),n.setIcon(new Z4EmptyImageProducer(e)),n.addActionListener(t=>{this.selectedOption=e,this.drawPreview(!1)}),a.add(n),i.add(n,null)})}let n=new ButtonGroup;for(let r=0;r<e;r++){let o=r,l=new JSRadioButton;l.setText(""+(r+1)),l.setSelected(0===r),l.addActionListener(e=>this.onRadio(o)),this.radios.push(l),n.add(l),s.add(l,null)}this.pushPointPositions(this.points,this.width,this.height),this.setXY()}onRadio(e){this.selectedIndex=e,this.setXY(),this.drawPreview(!1)}onChange(e,t,i,s,a){e?s.setValue(i.getValue()):i.setValue(s.getValue()),this.setPointPosition(this.points,this.selectedIndex,a?s.getValue():this.points[this.selectedIndex].x,a?this.points[this.selectedIndex].y:s.getValue(),this.width,this.height),this.drawPreview(t)}onMouse(e,t){let i=parseInt(this.preview.getProperty("width")),s=parseInt(this.preview.getProperty("height"));switch(t){case"enter":break;case"down":this.points.map(e=>new Point(i*e.x/this.width,s*e.y/this.height)).forEach((t,i,s)=>{this.isPointEnabled(i)&&Z4Math.distance(t.x,t.y,e.offsetX,e.offsetY)<=Z4AbstractFillerPanel.SELECTOR_RADIUS&&(this.pressed=!0,this.selectedIndex=i,this.radios[this.selectedIndex].setSelected(!0),this.setXY(),this.drawPreview(!1))});break;case"move":this.pressed?(this.setPointPosition(this.points,this.selectedIndex,parseInt(this.width*e.offsetX/i),parseInt(this.height*e.offsetY/s),this.width,this.height),this.setXY(),this.drawPreview(!0)):(this.preview.getStyle().cursor="default",this.points.map(e=>new Point(i*e.x/this.width,s*e.y/this.height)).forEach((t,i,s)=>{this.isPointEnabled(i)&&Z4Math.distance(t.x,t.y,e.offsetX,e.offsetY)<=Z4AbstractFillerPanel.SELECTOR_RADIUS&&(this.preview.getStyle().cursor="pointer")}));break;case"up":case"leave":this.pressed=!1,this.drawPreview(!1)}}setPointPosition(e,t,i,s,a,n){}requestSetPointPosition(){this.setPointPosition(this.points,this.selectedIndex,this.points[this.selectedIndex].x,this.points[this.selectedIndex].y,this.width,this.height)}setSize(e,t){this.width=e,this.height=t,this.ySpinner.setModel(new SpinnerNumberModel(0,0,this.height,1)),this.ySlider.setMaximum(this.height),this.xSpinner.setModel(new SpinnerNumberModel(0,0,this.width,1)),this.xSlider.setMaximum(this.width),this.points.length=0,this.pushPointPositions(this.points,this.width,this.height),this.setXY();let i=e/t;this.preview.setProperty("width",""+parseInt(i>1?Z4AbstractFillerPanel.SIZE:Z4AbstractFillerPanel.SIZE*i)),this.preview.setProperty("height",""+parseInt(i>1?Z4AbstractFillerPanel.SIZE/i:Z4AbstractFillerPanel.SIZE)),this.offscreenCanvas=new OffscreenCanvas(parseInt(this.preview.getProperty("width"))/Z4AbstractFillerPanel.RESCALE,parseInt(this.preview.getProperty("height"))/Z4AbstractFillerPanel.RESCALE),this.offscreenCtx=this.offscreenCanvas.getContext("2d"),this.drawPreview(!1)}setGradientColor(e){this.gradientColor=e,this.drawPreview(!1)}pushPointPositions(e,t,i){}setXY(){this.xSlider.setValue(this.points[this.selectedIndex].x),this.xSpinner.setValue(this.points[this.selectedIndex].x),this.ySlider.setValue(this.points[this.selectedIndex].y),this.ySpinner.setValue(this.points[this.selectedIndex].y)}setPointsEnabled(){this.radios.forEach((e,t,i)=>{let s=this.isPointEnabled(t);e.setEnabled(s),!s&&e.isSelected()&&(this.radios[0].setSelected(!0),this.selectedIndex=0,this.setXY(),this.drawPreview(!1))})}getSelectedFiller(){return this.getFiller(this.gradientColor,this.points,this.selectedOption)}drawPreview(e){let t=parseInt(this.preview.getProperty("width")),i=parseInt(this.preview.getProperty("height"));if(t>0&&i>0){this.ctx.clearRect(0,0,t,i);let s=this.points.map(e=>new Point(t*e.x/this.width,i*e.y/this.height));if(e&&this.needsRescale(this.selectedOption)){let a=this.offscreenCtx.createImageData(t/Z4AbstractFillerPanel.RESCALE,i/Z4AbstractFillerPanel.RESCALE);this.getFiller(this.gradientColor,s.map(e=>new Point(e.x/Z4AbstractFillerPanel.RESCALE,e.y/Z4AbstractFillerPanel.RESCALE)),this.selectedOption).fill(a),this.offscreenCtx.putImageData(a,0,0),this.ctx.drawImage(this.offscreenCanvas,0,0,t,i)}else{let n=this.ctx.createImageData(t,i);this.getFiller(this.gradientColor,s,this.selectedOption).fill(n),this.ctx.putImageData(n,0,0)}this.ctx.save(),s.forEach((e,t,i)=>this.drawCircle(e,t)),this.ctx.restore(),this.ctx.save(),this.drawObjects(this.ctx,s),this.ctx.restore()}}needsRescale(e){}getFiller(e,t,i){}drawCircle(e,t){if(this.isPointEnabled(t)){let i=[];this.ctx.beginPath(),this.ctx.arc(e.x,e.y,Z4AbstractFillerPanel.SELECTOR_RADIUS,0,2*Math.PI),this.ctx.closePath(),this.ctx.strokeStyle=Z4Constants.getStyle(t===this.selectedIndex?"red":"black"),this.ctx.setLineDash(i),this.ctx.stroke(),i.push(2.5,2.5),this.ctx.beginPath(),this.ctx.arc(e.x,e.y,Z4AbstractFillerPanel.SELECTOR_RADIUS,0,2*Math.PI),this.ctx.closePath(),this.ctx.strokeStyle=Z4Constants.getStyle("white"),this.ctx.setLineDash(i),this.ctx.stroke()}}isPointEnabled(e){}drawObjects(e,t){}}class Z4BezierFillerPanel extends Z4AbstractFillerPanel{constructor(){super(5,[Z4BoundaryBehavior.STOP_AT_BOUNDARY,Z4BoundaryBehavior.FILL_AT_BOUNDARY,Z4BoundaryBehavior.SYMMETRIC_AT_BOUNDARY,Z4BoundaryBehavior.REPEAT_AT_BOUNDARY]),this.cssAddClass("z4bezierfillerpanel"),this.drawPreview(!1)}setPointPosition(e,t,i,s,a,n){e[t]=new Point(i,s)}pushPointPositions(e,t,i){e.push(new Point(0,3*i/4)),e.push(new Point(t/4,i/8)),e.push(new Point(3*t/4,i/8)),e.push(new Point(t,3*i/4)),e.push(new Point(t/4,7*i/8))}needsRescale(e){return!0}getFiller(e,t,i){return new Z4BezierFiller(e,t[0].x,t[0].y,t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y,parseInt(Z4Math.distance(t[0].x,t[0].y,t[4].x,t[4].y)),i)}isPointEnabled(e){return!0}drawObjects(e,t){let i=[];e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.lineTo(t[2].x,t[2].y),e.lineTo(t[3].x,t[3].y),e.moveTo(t[0].x,t[0].y),e.lineTo(t[4].x,t[4].y),e.strokeStyle=Z4Constants.getStyle("black"),e.setLineDash(i),e.stroke(),i.push(2.5,2.5),e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.lineTo(t[2].x,t[2].y),e.lineTo(t[3].x,t[3].y),e.moveTo(t[0].x,t[0].y),e.lineTo(t[4].x,t[4].y),e.strokeStyle=Z4Constants.getStyle("white"),e.setLineDash(i),e.stroke()}}class Z4ConicFillerPanel extends Z4AbstractFillerPanel{constructor(){super(2,[!1,!0]),this.cssAddClass("z4conicfillerpanel"),this.drawPreview(!1)}setPointPosition(e,t,i,s,a,n){e[t]=new Point(i,s)}pushPointPositions(e,t,i){e.push(new Point(t/2,i/2)),e.push(new Point(t,i/2))}needsRescale(e){return!1}getFiller(e,t,i){return new Z4ConicFiller(e,t[0].x,t[0].y,Z4Math.atan(t[0].x,t[0].y,t[1].x,t[1].y),i)}isPointEnabled(e){return!0}drawObjects(e,t){let i=[];e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.strokeStyle=Z4Constants.getStyle("black"),e.setLineDash(i),e.stroke(),i.push(2.5,2.5),e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.strokeStyle=Z4Constants.getStyle("white"),e.setLineDash(i),e.stroke()}}class Z4LinearFillerPanel extends Z4AbstractFillerPanel{constructor(){super(2,[Z4BoundaryBehavior.STOP_AT_BOUNDARY,Z4BoundaryBehavior.FILL_AT_BOUNDARY,Z4BoundaryBehavior.SYMMETRIC_AT_BOUNDARY,Z4BoundaryBehavior.REPEAT_AT_BOUNDARY]),this.cssAddClass("z4linearfillerpanel"),this.drawPreview(!1)}setPointPosition(e,t,i,s,a,n){e[t]=new Point(i,s)}pushPointPositions(e,t,i){e.push(new Point(0,i/2)),e.push(new Point(t,i/2))}needsRescale(e){return!1}getFiller(e,t,i){return new Z4LinearFiller(e,t[0].x,t[0].y,t[1].x,t[1].y,i)}isPointEnabled(e){return!0}drawObjects(e,t){let i=[];e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.strokeStyle=Z4Constants.getStyle("black"),e.setLineDash(i),e.stroke(),i.push(2.5,2.5),e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.strokeStyle=Z4Constants.getStyle("white"),e.setLineDash(i),e.stroke()}}class Z4SinusoidalFillerPanel extends Z4AbstractFillerPanel{constructor(){super(4,[Z4BoundaryBehavior.STOP_AT_BOUNDARY,Z4BoundaryBehavior.FILL_AT_BOUNDARY,Z4BoundaryBehavior.SYMMETRIC_AT_BOUNDARY,Z4BoundaryBehavior.REPEAT_AT_BOUNDARY]),this.cssAddClass("z4sinusoidalfillerpanel"),this.drawPreview(!1)}setPointPosition(e,t,i,s,a,n){let r=0,o=0,l=null,h=0,d=0,c=null,g=0,u=0,E=null;switch(t){case 0:let T=e[0].x-i,p=e[0].y-s;o=Z4Math.distance(e[0].x,e[0].y,e[1].x,e[1].y),r=Z4Math.atan(e[0].x,e[0].y,e[1].x,e[1].y),d=Z4Math.distance(e[0].x,e[0].y,e[2].x,e[2].y),h=Z4Math.atan(e[0].x,e[0].y,e[2].x,e[2].y),u=Z4Math.distance(e[0].x,e[0].y,e[3].x,e[3].y),g=Z4Math.atan(e[0].x,e[0].y,e[3].x,e[3].y),e[0]=new Point(i,s),l=this.getPoint(e[0].x,e[0].y,e[1].x-T,e[1].y-p,o,r,a,n),e[1]=new Point(Math.round(l.x),Math.round(l.y)),c=this.getPoint(e[0].x,e[0].y,e[2].x-T,e[2].y-p,d,h,a,n),e[2]=new Point(Math.round(c.x),Math.round(c.y)),E=this.getPoint(e[0].x,e[0].y,e[3].x-T,e[3].y-p,u,g,a,n),e[3]=new Point(Math.round(E.x),Math.round(E.y));break;case 1:d=Z4Math.distance(e[0].x,e[0].y,e[2].x,e[2].y),h=Z4Math.atan(e[0].x,e[0].y,i,s)+Z4Math.HALF_PI,u=Z4Math.distance(e[0].x,e[0].y,e[3].x,e[3].y),g=Z4Math.atan(e[0].x,e[0].y,i,s)+Math.PI,c=this.getPoint(e[0].x,e[0].y,e[0].x+d*Math.cos(h),e[0].y+d*Math.sin(h),d,h,a,n),E=this.getPoint(e[0].x,e[0].y,e[0].x+u*Math.cos(g),e[0].y+u*Math.sin(g),u,g,a,n),e[1]=new Point(i,s),e[2]=new Point(Math.round(c.x),Math.round(c.y)),e[3]=new Point(Math.round(E.x),Math.round(E.y));break;case 2:o=Z4Math.distance(e[0].x,e[0].y,e[1].x,e[1].y),r=Z4Math.atan(e[0].x,e[0].y,i,s)-Z4Math.HALF_PI,u=Z4Math.distance(e[0].x,e[0].y,e[3].x,e[3].y),g=Z4Math.atan(e[0].x,e[0].y,i,s)+Z4Math.HALF_PI,l=this.getPoint(e[0].x,e[0].y,e[0].x+o*Math.cos(r),e[0].y+o*Math.sin(r),o,r,a,n),E=this.getPoint(e[0].x,e[0].y,e[0].x+u*Math.cos(g),e[0].y+u*Math.sin(g),u,g,a,n),e[1]=new Point(Math.round(l.x),Math.round(l.y)),e[2]=new Point(i,s),e[3]=new Point(Math.round(E.x),Math.round(E.y));break;case 3:o=Z4Math.distance(e[0].x,e[0].y,e[1].x,e[1].y),r=Z4Math.atan(e[0].x,e[0].y,i,s)+Math.PI,d=Z4Math.distance(e[0].x,e[0].y,e[2].x,e[2].y),h=Z4Math.atan(e[0].x,e[0].y,i,s)-Z4Math.HALF_PI,l=this.getPoint(e[0].x,e[0].y,e[0].x+o*Math.cos(r),e[0].y+o*Math.sin(r),o,r,a,n),c=this.getPoint(e[0].x,e[0].y,e[0].x+d*Math.cos(h),e[0].y+d*Math.sin(h),d,h,a,n),e[1]=new Point(Math.round(l.x),Math.round(l.y)),e[2]=new Point(Math.round(c.x),Math.round(c.y)),e[3]=new Point(i,s)}}getPoint(e,t,i,s,a,n,r,o){for(;(i<0||i>r||s<0||s>o)&&a>0;)i=e+(a=Math.max(0,a-.05))*Math.cos(n),s=t+a*Math.sin(n);return new Z4Point(i,s)}pushPointPositions(e,t,i){e.push(new Point(t/2,i/2)),e.push(new Point(t/2,i/8)),e.push(new Point(t,i/2)),e.push(new Point(t/2,i))}needsRescale(e){return!1}getFiller(e,t,i){return new Z4SinusoidalFiller(e,t[0].x,t[0].y,Z4Math.distance(t[0].x,t[0].y,t[1].x,t[1].y),Z4Math.distance(t[0].x,t[0].y,t[2].x,t[2].y),Z4Math.distance(t[0].x,t[0].y,t[3].x,t[3].y),Z4Math.atan(t[0].x,t[0].y,t[2].x,t[2].y),i)}isPointEnabled(e){return!0}drawObjects(e,t){let i=[];e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.moveTo(t[0].x,t[0].y),e.lineTo(t[2].x,t[2].y),e.moveTo(t[0].x,t[0].y),e.lineTo(t[3].x,t[3].y),e.strokeStyle=Z4Constants.getStyle("black"),e.setLineDash(i),e.stroke(),i.push(2.5,2.5),e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.moveTo(t[0].x,t[0].y),e.lineTo(t[2].x,t[2].y),e.moveTo(t[0].x,t[0].y),e.lineTo(t[3].x,t[3].y),e.strokeStyle=Z4Constants.getStyle("white"),e.setLineDash(i),e.stroke()}}class Z4SpiralFillerPanel extends Z4AbstractFillerPanel{constructor(){super(2,[!1,!0]),this.cssAddClass("z4spiralfillerpanel"),this.drawPreview(!1)}setPointPosition(e,t,i,s,a,n){e[t]=new Point(i,s)}pushPointPositions(e,t,i){e.push(new Point(t/2,i/2)),e.push(new Point(t,i/2))}needsRescale(e){return!1}getFiller(e,t,i){return new Z4SpiralFiller(e,t[0].x,t[0].y,Z4Math.distance(t[0].x,t[0].y,t[1].x,t[1].y),Z4Math.atan(t[0].x,t[0].y,t[1].x,t[1].y),i)}isPointEnabled(e){return!0}drawObjects(e,t){let i=[];e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.strokeStyle=Z4Constants.getStyle("black"),e.setLineDash(i),e.stroke(),i.push(2.5,2.5),e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.strokeStyle=Z4Constants.getStyle("white"),e.setLineDash(i),e.stroke()}}class Z4TextureFillerPanel extends Z4AbstractFillerPanel{colorPreview=new Z4ColorPreview;free=new JSRadioButton;lockRatio=new JSRadioButton;lock=new JSRadioButton;group=new ButtonGroup;imageData=new ImageData(Z4TextureFillerPanel.DEFAULT_SIZE,Z4TextureFillerPanel.DEFAULT_SIZE);backgroundColor=new Color(0,0,0,0);newImage=!0;static DEFAULT_SIZE=50;constructor(){super(2,[!1,!0]),Z4UI.addLabel(this,Z4Translations.DIMENSION,new GBC(0,7).w(4).a(GBC.WEST));let e=new JSPanel;this.add(e,new GBC(0,8).w(4).a(GBC.WEST).f(GBC.HORIZONTAL)),this.free.setText(Z4Translations.FREE),this.free.setSelected(!0),this.group.add(this.free),e.add(this.free,null),this.lockRatio.setText(Z4Translations.LOCK_RATIO),this.group.add(this.lockRatio),e.add(this.lockRatio,null),this.lock.setText(Z4Translations.LOCK),this.group.add(this.lock),e.add(this.lock,null),Z4UI.addLabel(this,Z4Translations.BACKGROUND_COLOR,new GBC(0,9).w(4).a(GBC.EAST)),(e=new JSPanel).setLayout(new BorderLayout(5,0)),this.add(e,new GBC(0,10).w(4).a(GBC.WEST).f(GBC.HORIZONTAL)),this.colorPreview.getStyle().alignSelf="center",this.colorPreview.setColor(this.backgroundColor),e.add(this.colorPreview,BorderLayout.CENTER);let t=new JSButton;t.setText(Z4Translations.PATTERN),t.getStyle().marginRight="4rem",t.addActionListener(e=>this.selectPattern()),e.add(t,BorderLayout.WEST),(t=new JSButton).setText(Z4Translations.EDIT),t.addActionListener(e=>this.selectColor()),e.add(t,BorderLayout.EAST);let i=this.imageData.data;for(let s=0;s<Z4TextureFillerPanel.DEFAULT_SIZE;s++)for(let a=0;a<Z4TextureFillerPanel.DEFAULT_SIZE;a++){let n=(s*Z4TextureFillerPanel.DEFAULT_SIZE+a)*4;Z4Math.distance(a,s,Z4TextureFillerPanel.DEFAULT_SIZE/2,Z4TextureFillerPanel.DEFAULT_SIZE/2)>Z4TextureFillerPanel.DEFAULT_SIZE/2||(s<Z4TextureFillerPanel.DEFAULT_SIZE/2?(i[n]=255,i[n+1]=255,i[n+2]=255,i[n+3]=255):(i[n]=0,i[n+1]=0,i[n+2]=0,i[n+3]=255))}this.cssAddClass("z4texturefillerpanel"),this.drawPreview(!1)}selectPattern(){if("function"==typeof window.showOpenFilePicker){let e=new FilePickerOptions;e.excludeAcceptAllOption=!0,e.id=Z4Constants.TEXTURE_FILE_ID,e.multiple=!1,e.types=Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_TYPE,JSFilePicker.showOpenFilePicker(e,0,e=>e.forEach(e=>e.getFile().then(e=>{this.openTexture(e)})))}else JSFileChooser.showOpenDialog(""+Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_FORMAT.join(","),JSFileChooser.SINGLE_SELECTION,0,e=>e.forEach(e=>this.openTexture(e)))}openTexture(e){let t=new FileReader;t.onload=e=>{let i=document.createElement("img");return i.onload=e=>{let t=new OffscreenCanvas(i.width,i.height).getContext("2d");return t.drawImage(i,0,0),this.imageData=t.getImageData(0,0,i.width,i.height),this.newImage=!0,this.requestSetPointPosition(),this.drawPreview(!1),null},i.src=t.result,null},t.readAsDataURL(e)}selectColor(){JSColorChooser.showDialog(Z4Translations.BACKGROUND_COLOR,this.backgroundColor,!0,null,e=>{this.backgroundColor=e,this.colorPreview.setColor(e),this.drawPreview(!1)})}setPointPosition(e,t,i,s,a,n){if(this.newImage)e[0]=new Point(0,0),e[1]=new Point(Math.min(a,this.imageData.width),Math.min(n,this.imageData.height));else if(this.free.isSelected())e[t]=new Point(i,s);else if(this.lockRatio.isSelected()){let r=Z4Math.distance(e[1-t].x,e[1-t].y,i,s),o=Z4Math.atan(e[1-t].x,e[1-t].y,e[t].x,e[t].y);e[t]=new Point(Math.round(e[1-t].x+r*Math.cos(o)),Math.round(e[1-t].y+r*Math.sin(o)))}else if(this.lock.isSelected()){let l=e[t].x-i,h=e[t].y-s,d=e[1-t].x-l,c=e[1-t].y-h;0<=d&&d<a&&0<=c&&c<n&&(e[t]=new Point(i,s),e[1-t]=new Point(d,c))}this.newImage=!1}pushPointPositions(e,t,i){e.push(new Point(0,0)),e.push(new Point(Math.min(t,Z4TextureFillerPanel.DEFAULT_SIZE),Math.min(i,Z4TextureFillerPanel.DEFAULT_SIZE)))}needsRescale(e){return!1}getFiller(e,t,i){return new Z4TextureFiller(this.imageData,t[0].x,t[0].y,t[1].x,t[1].y,this.backgroundColor,i)}isPointEnabled(e){return!0}drawObjects(e,t){let i=[];e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.strokeStyle=Z4Constants.getStyle("black"),e.setLineDash(i),e.stroke(),i.push(2.5,2.5),e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.strokeStyle=Z4Constants.getStyle("white"),e.setLineDash(i),e.stroke()}}class Z4VertexBasedFillerPanel extends Z4AbstractFillerPanel{star=new JSCheckBox;vertexCounter=new JSSlider;regular=new JSCheckBox;constructor(){super(3,[Z4BoundaryBehavior.STOP_AT_BOUNDARY,Z4BoundaryBehavior.FILL_AT_BOUNDARY,Z4BoundaryBehavior.SYMMETRIC_AT_BOUNDARY,Z4BoundaryBehavior.REPEAT_AT_BOUNDARY]),Z4UI.addLabel(this,Z4Translations.VERTICES,new GBC(0,7).a(GBC.WEST)),this.star.setText(Z4Translations.STAR),this.star.setEnabled(!1),this.star.addActionListener(e=>{this.setIcons(),this.drawPreview(!1)}),this.add(this.star,new GBC(1,7).w(3).a(GBC.EAST));let e=new DefaultSliderModelAndRenderer;for(let t=3;t<10;t++)e.addElement(""+t);e.addElement("∞"),this.vertexCounter.setModelAndRenderer(e),this.vertexCounter.setValue(7),this.vertexCounter.addChangeListener(e=>{this.star.setEnabled(7!==this.vertexCounter.getValue()),this.setIcons(),this.drawPreview(!1)}),this.add(this.vertexCounter,new GBC(0,8).w(4).a(GBC.WEST).f(GBC.HORIZONTAL)),this.getChilStyleByQuery("*:nth-child(13) datalist option:nth-child(8)").fontSize="larger",this.regular.setText(Z4Translations.REGULAR),this.regular.addActionListener(e=>{this.setPointsEnabled(),this.drawPreview(!1)}),this.appendChildInTree("*:nth-child(10)",this.regular),this.cssAddClass("z4ellipticfillerpanel"),this.drawPreview(!1)}setIcons(){this.cssRemoveClass("z4ellipticfillerpanel"),this.cssRemoveClass("z4starfillerpanel"),this.cssRemoveClass("z4polygonfillerpanel"),7===this.vertexCounter.getValue()?this.cssAddClass("z4ellipticfillerpanel"):this.star.isSelected()?this.cssAddClass("z4starfillerpanel"):this.cssAddClass("z4polygonfillerpanel")}setPointPosition(e,t,i,s,a,n){let r=0,o=0,l=null,h=0,d=0,c=null;switch(t){case 0:let g=e[0].x-i,u=e[0].y-s;o=Z4Math.distance(e[0].x,e[0].y,e[1].x,e[1].y),r=Z4Math.atan(e[0].x,e[0].y,e[1].x,e[1].y),d=Z4Math.distance(e[0].x,e[0].y,e[2].x,e[2].y),h=Z4Math.atan(e[0].x,e[0].y,e[2].x,e[2].y),e[0]=new Point(i,s),l=this.getPoint(e[0].x,e[0].y,e[1].x-g,e[1].y-u,o,r,a,n),e[1]=new Point(Math.round(l.x),Math.round(l.y)),c=this.getPoint(e[0].x,e[0].y,e[2].x-g,e[2].y-u,d,h,a,n),e[2]=new Point(Math.round(c.x),Math.round(c.y));break;case 1:d=Z4Math.distance(e[0].x,e[0].y,e[2].x,e[2].y),h=Z4Math.atan(e[0].x,e[0].y,i,s)-Z4Math.HALF_PI,c=this.getPoint(e[0].x,e[0].y,e[0].x+d*Math.cos(h),e[0].y+d*Math.sin(h),d,h,a,n),e[1]=new Point(i,s),e[2]=new Point(Math.round(c.x),Math.round(c.y));break;case 2:o=Z4Math.distance(e[0].x,e[0].y,e[1].x,e[1].y),r=Z4Math.atan(e[0].x,e[0].y,i,s)+Z4Math.HALF_PI,l=this.getPoint(e[0].x,e[0].y,e[0].x+o*Math.cos(r),e[0].y+o*Math.sin(r),o,r,a,n),e[1]=new Point(Math.round(l.x),Math.round(l.y)),e[2]=new Point(i,s)}}getPoint(e,t,i,s,a,n,r,o){for(;(i<0||i>r||s<0||s>o)&&a>0;)i=e+(a=Math.max(0,a-.05))*Math.cos(n),s=t+a*Math.sin(n);return new Z4Point(i,s)}pushPointPositions(e,t,i){e.push(new Point(t/2,i/2)),e.push(new Point(t,i/2)),e.push(new Point(t/2,0))}needsRescale(e){return e!==Z4BoundaryBehavior.STOP_AT_BOUNDARY&&e!==Z4BoundaryBehavior.FILL_AT_BOUNDARY&&(e!==Z4BoundaryBehavior.SYMMETRIC_AT_BOUNDARY&&e!==Z4BoundaryBehavior.REPEAT_AT_BOUNDARY||7!==this.vertexCounter.getValue())}getFiller(e,t,i){let s=Z4Math.distance(t[0].x,t[0].y,t[1].x,t[1].y),a=Z4Math.distance(t[0].x,t[0].y,t[2].x,t[2].y),n=Z4Math.atan(t[0].x,t[0].y,t[1].x,t[1].y),r=this.vertexCounter.getValue();return 7===r?new Z4EllipticFiller(e,t[0].x,t[0].y,s,this.regular.isSelected()?s:a,n,i):this.star.isSelected()?new Z4StarFiller(e,t[0].x,t[0].y,s,this.regular.isSelected()?s:a,n,r+3,i):new Z4PolygonFiller(e,t[0].x,t[0].y,s,this.regular.isSelected()?s:a,n,r+3,i)}isPointEnabled(e){return 2!==e||!this.regular.isSelected()}drawObjects(e,t){let i=[];e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),this.regular.isSelected()||(e.moveTo(t[0].x,t[0].y),e.lineTo(t[2].x,t[2].y)),e.strokeStyle=Z4Constants.getStyle("black"),e.setLineDash(i),e.stroke(),i.push(2.5,2.5),e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),this.regular.isSelected()||(e.moveTo(t[0].x,t[0].y),e.lineTo(t[2].x,t[2].y)),e.strokeStyle=Z4Constants.getStyle("white"),e.setLineDash(i),e.stroke()}}class Z4FancifulValuePanelOrientation{static HORIZONTAL="HORIZONTAL";static VERTICAL="VERTICAL";static HORIZONTALLY_VERTICAL="HORIZONTALLY_VERTICAL"}class Z4RandomValuePanelOrientation{static HORIZONTAL="HORIZONTAL";static VERTICAL="VERTICAL";static HORIZONTALLY_VERTICAL="HORIZONTALLY_VERTICAL"}class Z4RotationPanelOrientation{static HORIZONTAL="HORIZONTAL";static VERTICAL="VERTICAL"}class Z4SignedValuePanelOrientation{static HORIZONTAL="HORIZONTAL";static VERTICAL="VERTICAL"}class Z4SignPanelOrientation{static HORIZONTAL="HORIZONTAL";static VERTICAL="VERTICAL";static SQUARED="SQUARED"}class Z4AbstractRibbonPanel extends JSPanel{constructor(){super()}addButton(e,t,i,s,a,n,r){let o=new JSButton;o.setText(e),o.setEnabled(t),o.setContentAreaFilled(!1),o.addActionListener(r);let l=new GBC(i,s).a(GBC.NORTH);switch(a){case"left":l.i(n,5,0,0),o.getStyle().borderTopRightRadius="0px",o.getStyle().borderBottomRightRadius="0px",o.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"both":o.getStyle().borderRadius="0px",o.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",o.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"right":l.i(n,0,0,5),o.getStyle().borderTopLeftRadius="0px",o.getStyle().borderBottomLeftRadius="0px",o.getStyle().borderLeft="1px solid var(--main-action-bgcolor)";break;default:l.i(n,5,0,5)}return this.add(o,l),o}}class Z4RibbonFilePanel extends Z4AbstractRibbonPanel{canvas=null;statusPanel=null;saveProjectButton=null;constructor(){super(),this.setLayout(new GridBagLayout),this.cssAddClass("z4ribbonfilepanel"),Z4UI.addLabel(this,Z4Translations.NEW_PROJECT,new GBC(0,0).w(3).a(GBC.WEST).i(5,5,2,0)),this.addButton(Z4Translations.CREATE,!0,0,1,"left",0,e=>this.checkSaved(Z4Translations.CREATE,()=>this.createFromColor())),this.addButton(Z4Translations.FROM_CLIPBOARD,"function"==typeof navigator.clipboard.read,1,1,"both",0,e=>this.checkSaved(Z4Translations.FROM_CLIPBOARD,()=>this.createFromClipboard())),this.addButton(Z4Translations.FROM_FILE,!0,2,1,"right",0,e=>this.checkSaved(Z4Translations.FROM_FILE,()=>this.createFromFile())),Z4UI.addVLine(this,new GBC(3,0).h(2).wy(1).f(GBC.VERTICAL).i(1,2,1,2)),Z4UI.addLabel(this,Z4Translations.OPEN,new GBC(4,0).a(GBC.WEST).i(5,5,2,0)),this.addButton(Z4Translations.OPEN_PROJECT,!0,4,1,"",0,e=>this.checkSaved(Z4Translations.OPEN_PROJECT,()=>this.openProject())),Z4UI.addVLine(this,new GBC(5,0).h(2).wy(1).f(GBC.VERTICAL).i(1,2,1,2)),Z4UI.addLabel(this,Z4Translations.SAVE,new GBC(6,0).w(2).a(GBC.WEST).i(5,5,2,0)),this.saveProjectButton=this.addButton(Z4Translations.SAVE_PROJECT,!1,6,1,"left",0,e=>this.saveProject(null,!1)),this.addButton(Z4Translations.SAVE_PROJECT_AS,!0,7,1,"both",0,e=>this.saveProject(null,!0)),this.addButton(Z4Translations.EXPORT,!0,8,1,"right",0,e=>this.exportToFile()),Z4UI.addVLine(this,new GBC(9,0).h(2).wxy(1,1).f(GBC.VERTICAL).i(1,2,1,2))}setCanvas(e){this.canvas=e,this.canvas.addEventListener("dragenter",e=>this.onDrop(e,!1)),this.canvas.addEventListener("dragover",e=>this.onDrop(e,!1)),this.canvas.addEventListener("dragleave",e=>this.onDrop(e,!1)),this.canvas.addEventListener("drop",e=>this.onDrop(e,!0))}setStatusPanel(e){this.statusPanel=e}checkSaved(e,t){this.canvas.isSaved()?t():JSOptionPane.showConfirmDialog(Z4Translations.PROJECT_NOT_SAVED_MESSAGE,e,JSOptionPane.YES_NO_CANCEL_OPTION,JSOptionPane.QUESTION_MESSAGE,e=>{switch(e){case JSOptionPane.YES_OPTION:this.saveProject(t,!1);break;case JSOptionPane.NO_OPTION:t()}})}createFromColor(){let e=new Z4NewImagePanel;JSOptionPane.showInputDialog(e,Z4Translations.CREATE,t=>e.addChangeListener(t),()=>{let t=e.getSelectedSize();return t.width>0&&t.height>0},t=>{if(t===JSOptionPane.OK_OPTION){let i=e.getSelectedSize();this.canvas.create(i.width,i.height,e.getSelectedFilling())}})}createFromFile(){if("function"==typeof window.showOpenFilePicker){let e=new FilePickerOptions;e.excludeAcceptAllOption=!0,e.id=Z4Constants.IMAGE_FILE_ID,e.multiple=!1,e.types=Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_TYPE,JSFilePicker.showOpenFilePicker(e,0,e=>e.forEach(e=>this.canvas.createFromHandle(e)))}else JSFileChooser.showOpenDialog(""+Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_FORMAT.join(","),JSFileChooser.SINGLE_SELECTION,0,e=>e.forEach(e=>this.canvas.createFromFile(e)))}createFromClipboard(){this.canvas.createFromClipboard()}openProject(){if("function"==typeof window.showOpenFilePicker){let e=new FilePickerOptions;e.excludeAcceptAllOption=!0,e.id=Z4Constants.IMAGE_FILE_ID,e.multiple=!1,e.types=Z4Constants.PIZZAPAZZA_PROJECT_IMAGE_FILE_TYPE,JSFilePicker.showOpenFilePicker(e,0,e=>e.forEach(e=>this.canvas.openProjectFromHandle(e)))}else JSFileChooser.showOpenDialog(".z4i",JSFileChooser.SINGLE_SELECTION,0,e=>e.forEach(e=>this.canvas.openProjectFromFile(e)))}saveProject(e,t){"function"==typeof window.showSaveFilePicker?this.saveProjectToHandle(e,t):this.saveProjectToFile(e,t)}saveProjectToFile(e,t){if(t||!this.canvas.getProjectName()){let i=new JSPanel;i.setLayout(new BorderLayout(0,0));let s=new JSLabel;s.setText(Z4Translations.PROJECT_NAME),i.add(s,BorderLayout.NORTH);let a=new JSTextField;a.setText(this.canvas.getProjectName()),i.add(a,BorderLayout.CENTER),JSOptionPane.showInputDialog(i,Z4Translations.SAVE,e=>a.addActionListener(t=>e(new ChangeEvent)),()=>!!a.getText(),t=>{t===JSOptionPane.OK_OPTION&&this.canvas.saveProjectToFile(a.getText(),e)})}else this.canvas.saveProjectToFile(this.canvas.getProjectName(),e)}saveProjectToHandle(e,t){if(t||!this.canvas.getHandle()){let i=new FilePickerOptions;i.excludeAcceptAllOption=!0,i.id=Z4Constants.IMAGE_FILE_ID,i.multiple=!1,i.suggestedName=this.canvas.getProjectName(),i.types=Z4Constants.PIZZAPAZZA_PROJECT_IMAGE_FILE_TYPE,JSFilePicker.showSaveFilePicker(i,t=>this.canvas.saveProjectToHandle(t,e))}else this.canvas.saveProjectToHandle(this.canvas.getHandle(),e)}exportToFile(){if("function"==typeof window.showSaveFilePicker){let e=new FilePickerOptions;e.excludeAcceptAllOption=!0,e.id=Z4Constants.IMAGE_FILE_ID,e.multiple=!1,e.suggestedName=this.canvas.getProjectName(),e.types=Z4Constants.ACCEPTED_SAVE_IMAGE_FILE_TYPE,JSFilePicker.showSaveFilePicker(e,e=>this.export(e))}else this.export(null)}export(e){if(e)e.name.toLowerCase().endsWith(".png")?this.canvas.exportToHandle(e,0):e.getFile().then(t=>{let i=new Z4ExportToFilePanel;i.setFilename(t.name),i.setFilenameEditable(!1),i.setFileExtension(".jpg"),i.setFileExtensionEnabled(!1),JSOptionPane.showInputDialog(i,Z4Translations.EXPORT,e=>i.addChangeListener(e),()=>i.isValid(),t=>{t===JSOptionPane.OK_OPTION&&this.canvas.exportToHandle(e,i.getQuality())})});else{let t=new Z4ExportToFilePanel;t.setFilename(this.canvas.getProjectName()),JSOptionPane.showInputDialog(t,Z4Translations.EXPORT,e=>t.addChangeListener(e),()=>t.isValid(),e=>{e===JSOptionPane.OK_OPTION&&this.canvas.exportToFile(t.getFilename(),t.getFileExtension(),t.getQuality())})}}onDrop(e,t){e.preventDefault(),e.dataTransfer.dropEffect="none";let i=[];if(e.dataTransfer.items){for(let s=0;s<e.dataTransfer.items.length;s++)if("file"===e.dataTransfer.items[s].kind){let a=e.dataTransfer.items[s].getAsFile();i.push(a||e.dataTransfer.items[s])}}else e.dataTransfer.files.forEach(e=>i.push(e));i[0]&&(e.dataTransfer.dropEffect="copy",t&&(i[0].name.toLowerCase().endsWith(".z4i")?this.checkSaved(Z4Translations.OPEN_PROJECT,()=>this.canvas.openProjectFromFile(i[0])):Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_FORMAT.some((e,t,s)=>i[0].name.toLowerCase().endsWith(e))&&this.checkSaved(Z4Translations.FROM_FILE,()=>this.canvas.createFromFile(i[0]))))}setSaveEnabled(e){this.saveProjectButton.setEnabled(e)}}class Z4RibbonHelpPanel extends Z4AbstractRibbonPanel{constructor(){super(),this.setLayout(new FlowLayout(FlowLayout.LEFT,5,5)),this.cssAddClass("z4ribbonhelppanel");let e=new JSButton;e.setText(Z4Translations.ABOUT),e.setContentAreaFilled(!1),e.addActionListener(e=>this.showAbout()),this.add(e,null),(e=new JSButton).cssAddClass("z4check-install"),e.setProperty("innerHTML",Z4Translations.INSTALL),e.setContentAreaFilled(!1),this.add(e,null),(e=new JSButton).cssAddClass("z4check-update"),e.setText(Z4Translations.CHECK_UPDATE),e.setContentAreaFilled(!1),this.add(e,null)}showAbout(){let e=RegExp("pizzApazzA-bundle-.*js");document.querySelectorAll("script").forEach(t=>{let i=t.getAttribute("src");if(e.test(i)){let s=22,a=i.indexOf("pizzApazzA-bundle-min-");-1===a&&(s=18,a=i.indexOf("pizzApazzA-bundle-"));let n=i.indexOf(".js"),r=i.substring(a+s,n),o=new JSPanel;o.cssAddClass("z4ribbonhelppanel-about"),o.setLayout(new BoxLayout(o,BoxLayout.Y_AXIS));let l=new JSComponent(document.createElement("img"));l.cssAddClass("z4ribbonhelppanel-splash"),o.add(l,null);let h=new JSLabel;h.setProperty("innerHTML",Z4Translations.BASED_ON.replace("$version$",r)),h.getStyle().marginTop="5px",h.getStyle().maxWidth="500px",o.add(h,null),JSOptionPane.showMessageDialog(o,Z4Translations.ABOUT,JSOptionPane.INFORMATION_MESSAGE,null)}})}}class Z4RibbonHistoryPanel extends Z4AbstractRibbonPanel{undo=null;redo=null;save=null;consolidate=null;historyPreview=new JSPanel;canvas=null;statusPanel=null;dbName=null;database=null;currentKey=0;z4historyManagement=null;z4savingDelay=0;z4savingInterval=0;timerID=-1;standardID=-1;standardRand=0;constructor(){super(),this.setLayout(new GridBagLayout),this.cssAddClass("z4ribbonhistorypanel"),this.undo=this.addButton(Z4Translations.UNDO,!1,0,0,"left",5,e=>this.database.transaction("history","readonly").objectStore("history").openCursor(IDBKeyRange.upperBound(this.currentKey,!0),"prev").onsuccess=e=>this.undoRedo(e)),this.redo=this.addButton(Z4Translations.REDO,!1,1,0,"right",5,e=>this.database.transaction("history","readonly").objectStore("history").openCursor(IDBKeyRange.lowerBound(this.currentKey,!0)).onsuccess=e=>this.undoRedo(e)),this.save=this.addButton(Z4Translations.SAVE,!1,2,0,"",5,e=>this.saveHistory("manual")),this.consolidate=this.addButton(Z4Translations.CONSOLIDATE,!1,3,0,"",5,e=>JSOptionPane.showConfirmDialog(Z4Translations.CONSOLIDATE_MESSAGE,Z4Translations.CONSOLIDATE,JSOptionPane.YES_NO_OPTION,JSOptionPane.WARNING_MESSAGE,e=>{e===JSOptionPane.YES_OPTION&&(this.canvas.setChanged(!1),this.resetHistory(()=>this.canvas.toHistory(e=>this.addHistory(e,e=>this.setCurrentKey(e),!1))))})),Z4UI.addVLine(this,new GBC(4,0).h(2).wy(1).f(GBC.VERTICAL).i(1,2,1,2)),this.historyPreview.setLayout(new BoxLayout(this.historyPreview,BoxLayout.X_AXIS)),this.historyPreview.getStyle().overflowX="scroll",this.add(this.historyPreview,new GBC(5,0).h(2).wx(1).f(GBC.BOTH)),window.onunload=e=>(window.indexedDB.deleteDatabase(this.dbName),null)}undoRedo(e){let t=e.target.result;return this.setCurrentKey(t.key),this.canvas.openFromHistory(t.value),document.querySelector(".z4historypreview.z4historypreview-"+this.currentKey).scrollIntoView(),null}resetHistory(e){this.clearIntervals(),this.undo.setEnabled(!1),this.redo.setEnabled(!1),this.consolidate.setEnabled(!1),this.historyPreview.setProperty("innerHTML",""),this.dbName&&window.indexedDB.deleteDatabase(this.dbName),this.dbName="pizzapazza_"+new Date().getTime(),window.indexedDB.open(this.dbName,1).onupgradeneeded=t=>{this.database=t.target.result;let i={};return i.autoIncrement=!0,this.database.createObjectStore("history",i).transaction.oncomplete=t=>(this.setIntervals(),e(),null),null}}saveHistory(e){this.canvas.isChanged()&&-1!==e.indexOf(this.z4historyManagement)&&(this.database.transaction("history","readwrite").objectStore("history").openCursor(IDBKeyRange.lowerBound(this.currentKey,!0)).onsuccess=e=>{let t=e.target.result;return t?(document.querySelector(".z4historypreview.z4historypreview-"+t.key).remove(),t.delete().onsuccess=e=>(t.continue(),null)):this.canvas.toHistory(e=>{this.database.transaction("history","readwrite").objectStore("history").add(e).onsuccess=t=>{this.undo.setEnabled(!0),this.redo.setEnabled(!1),this.consolidate.setEnabled(!0),this.canvas.setChanged(!1),this.currentKey=t.target.result;let i=new Z4HistoryPreview;return i.setHistory(this.currentKey,e,this.canvas),i.setRibbonHistoryPanel(this),this.historyPreview.add(i,null),document.querySelectorAll(".z4historypreview .z4historypreview-selector").forEach(e=>e.textContent=Z4HistoryPreview.UNSELECTED_HISTORY_CONTENT),document.querySelector(".z4historypreview.z4historypreview-"+this.currentKey+" .z4historypreview-selector").textContent=Z4HistoryPreview.SELECTED_HISTORY_CONTENT,document.querySelector(".z4historypreview.z4historypreview-"+this.currentKey).scrollIntoView(),null}}),null})}addHistory(e,t,i){this.database.transaction("history","readwrite").objectStore("history").add(e).onsuccess=s=>{this.consolidate.setEnabled(i);let a=s.target.result,n=new Z4HistoryPreview;return n.setHistory(a,e,this.canvas),n.setRibbonHistoryPanel(this),this.historyPreview.add(n,null),t(a),null}}iterateHistoryBuffer(e){this.database.transaction("history","readonly").objectStore("history").openCursor().onsuccess=t=>{let i=t.target.result;return i?e(i.key,i.value,()=>i.continue()):e(-1,null,null),null}}setCurrentKey(e){this.currentKey=e,document.querySelectorAll(".z4historypreview .z4historypreview-selector").forEach(e=>e.textContent=Z4HistoryPreview.UNSELECTED_HISTORY_CONTENT),document.querySelector(".z4historypreview.z4historypreview-"+this.currentKey+" .z4historypreview-selector").textContent=Z4HistoryPreview.SELECTED_HISTORY_CONTENT,this.database.transaction("history","readonly").objectStore("history").openCursor(IDBKeyRange.upperBound(this.currentKey,!0)).onsuccess=e=>(this.undo.setEnabled(!!e.target.result),null),this.database.transaction("history","readonly").objectStore("history").openCursor(IDBKeyRange.lowerBound(this.currentKey,!0)).onsuccess=e=>(this.redo.setEnabled(!!e.target.result),null)}getCurrentKey(){return this.currentKey}setCanvas(e){this.canvas=e}setStatusPanel(e){this.statusPanel=e}startStandard(){if("standard"===this.z4historyManagement){this.clearIntervals(),this.standardRand=Math.random();let e=this.standardRand;this.standardID=setTimeout(()=>{this.standardRand===e&&this.saveHistory("standard")},this.z4savingDelay)}}stopStandard(){"standard"===this.z4historyManagement&&(this.clearIntervals(),this.standardRand=Math.random())}setHistoryManagementSettings(e,t,i){this.z4historyManagement=e,this.z4savingDelay=t,this.z4savingInterval=i,this.save.setEnabled("manual"===e),this.clearIntervals(),this.setIntervals()}clearIntervals(){-1!==this.timerID&&(clearInterval(this.timerID),this.timerID=-1),-1!==this.standardID&&(clearTimeout(this.standardID),this.standardID=-1)}setIntervals(){switch(this.z4historyManagement){case"standard":case"manual":break;case"timer":this.timerID=setInterval(()=>this.saveHistory("timer"),this.z4savingInterval)}}}class Z4RibbonLayerPanel extends Z4AbstractRibbonPanel{layersPreview=new JSPanel;statusPanel=null;canvas=null;layerDnD=null;previewDnD=null;constructor(){super(),this.setLayout(new GridBagLayout),this.cssAddClass("z4ribbonlayerpanel"),Z4UI.addLabel(this,Z4Translations.NEW_LAYER,new GBC(0,0).w(3).a(GBC.WEST).i(5,5,2,0)),this.addButton(Z4Translations.CREATE,!0,0,1,"left",0,e=>this.addFromColor()),this.addButton(Z4Translations.FROM_CLIPBOARD,"function"==typeof navigator.clipboard.read,1,1,"both",0,e=>this.addFromClipboard()),this.addButton(Z4Translations.FROM_FILE,!0,2,1,"right",0,e=>this.addFromFile()),Z4UI.addVLine(this,new GBC(3,0).h(2).wy(1).f(GBC.VERTICAL).i(1,2,1,2)),this.addButton(Z4Translations.MERGE,!0,4,1,"",0,e=>this.merge()),Z4UI.addVLine(this,new GBC(5,0).h(2).wy(1).f(GBC.VERTICAL).i(1,2,1,2)),this.layersPreview.setLayout(new BoxLayout(this.layersPreview,BoxLayout.X_AXIS)),this.layersPreview.getStyle().overflowX="scroll",this.layersPreview.addEventListener("dragenter",e=>e.preventDefault()),this.layersPreview.addEventListener("dragover",e=>e.preventDefault()),this.layersPreview.addEventListener("dragleave",e=>e.preventDefault()),this.layersPreview.addEventListener("drop",e=>{e.preventDefault();let t=e,i=this.previewDnD.invoke("getBoundingClientRect()"),s=this.layersPreview.invoke("getBoundingClientRect()"),a=parseInt((t.clientX-s.left)/i.width);this.moveLayer(this.previewDnD,this.layerDnD,a)}),this.add(this.layersPreview,new GBC(6,0).h(2).wx(1).f(GBC.BOTH))}setCanvas(e){this.canvas=e}setStatusPanel(e){this.statusPanel=e}moveLayer(e,t,i){this.canvas.moveLayer(t,i)&&(i<this.canvas.getLayersCount()?(i=Math.min(this.canvas.getLayersCount(),i+1),this.layersPreview.insertBefore(e,"details:nth-child("+i+")")):this.layersPreview.add(e,null))}addFromColor(){let e=this.canvas.getSize(),t=new Z4NewImagePanel;t.setSelectedSize(e.width,e.height),JSOptionPane.showInputDialog(t,Z4Translations.CREATE,e=>t.addChangeListener(e),()=>{let e=t.getSelectedSize();return e.width>0&&e.height>0},e=>{if(e===JSOptionPane.OK_OPTION){let i=t.getSelectedSize();this.canvas.addLayer(i.width,i.height,t.getSelectedFilling())}})}addFromFile(){if("function"==typeof window.showOpenFilePicker){let e=new FilePickerOptions;e.excludeAcceptAllOption=!0,e.id=Z4Constants.IMAGE_FILE_ID,e.multiple=!1,e.types=Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_TYPE,JSFilePicker.showOpenFilePicker(e,0,e=>e.forEach(e=>this.canvas.addLayerFromHandle(e)))}else JSFileChooser.showOpenDialog(""+Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_FORMAT.join(","),JSFileChooser.SINGLE_SELECTION,0,e=>e.forEach(e=>this.canvas.addLayerFromFile(e)))}addFromClipboard(){this.canvas.addLayerFromClipboard()}merge(){let e=new Z4MergeLayerPanel;e.setCanvas(this.canvas),JSOptionPane.showInputDialog(e,Z4Translations.MERGE,t=>e.addChangeListener(t),()=>e.getSelectedLayers().length>1,t=>{if(t===JSOptionPane.OK_OPTION){let i=e.getSelectedLayers();i.forEach(e=>{let t=this.canvas.deleteLayer(e);document.querySelector(".z4layerpreview:nth-child("+(t+1)+")").remove()}),this.canvas.mergeLayers(i)}})}reset(){this.layersPreview.setProperty("innerHTML","")}addLayerPreview(e){let t=new Z4LayerPreview;t.setRibbonLayerPanel(this),t.setLayer(this.canvas,e),t.setChildAttributeByQuery("summary","draggable","true"),t.addEventListener("dragstart",i=>{i.dataTransfer.effectAllowed="move",this.layerDnD=e,this.previewDnD=t}),document.querySelectorAll(".z4layerpreview .z4layerpreview-selector").forEach(e=>e.textContent=Z4LayerPreview.UNSELECTED_LAYER_CONTENT),this.layersPreview.add(t,null),t.invoke("scrollIntoView()")}}class Z4RibbonSettingsPanel extends Z4AbstractRibbonPanel{language=new JSComboBox;theme=new JSComboBox;color=new JSColorChooser;historyManagement=new JSComboBox;historyManagementDescription=new JSLabel;savingInterval=new JSComboBox;savingDelay=new JSComboBox;historyPanel=null;constructor(){super(),this.setLayout(new GridBagLayout),this.cssAddClass("z4ribbonsettingspanel"),Z4UI.addLabel(this,Z4Translations.LANGUAGE,new GBC(0,0).a(GBC.WEST).i(5,5,2,0));let e=new DefaultKeyValueComboBoxModelAndRenderer;e.addElement(new KeyValue("en",Z4Translations.LANGUAGE_ENGLISH_NATIVE)),e.addElement(new KeyValue("it",Z4Translations.LANGUAGE_ITALIAN_NATIVE)),this.language.setModelAndRenderer(e),this.language.setSelectedItem(Z4Translations.CURRENT_LANGUAGE),this.language.addActionListener(e=>this.onchangeLanguage()),this.add(this.language,new GBC(0,1).f(GBC.HORIZONTAL).i(0,5,0,5)),Z4UI.addLabel(this,Z4Translations.THEME,new GBC(1,0).a(GBC.WEST).i(5,5,2,0));let t=null,i=localStorage.getItem("z4theme");switch(i){case"light":case"dark":case"auto":t=new KeyValue(i,Z4Translations["THEME_"+i.toUpperCase()]);break;default:t=new KeyValue("auto",Z4Translations.THEME_AUTO)}let s=new DefaultKeyValueComboBoxModelAndRenderer;s.addElement(new KeyValue("auto",Z4Translations.THEME_AUTO)),s.addElement(new KeyValue("light",Z4Translations.THEME_LIGHT)),s.addElement(new KeyValue("dark",Z4Translations.THEME_DARK)),this.theme.setModelAndRenderer(s),this.theme.setSelectedItem(t),this.theme.addActionListener(e=>this.onchangeTheme()),this.add(this.theme,new GBC(1,1).f(GBC.HORIZONTAL).i(0,5,0,5)),Z4UI.addLabel(this,Z4Translations.THEME_COLOR,new GBC(2,0).a(GBC.WEST).i(5,5,2,0));let a=localStorage.getItem("z4color");this.color.setSelectedColor(Color.fromRGB_HEX(a||"#0d6efd")),this.color.setOpacityVisible(!1),this.color.addChangeListener(e=>this.onchangeColor()),this.add(this.color,new GBC(2,1).f(GBC.HORIZONTAL).i(0,5,0,5)),Z4UI.addVLine(this,new GBC(3,0).h(3).wy(1).a(GBC.EAST).f(GBC.VERTICAL).i(1,2,1,2)),Z4UI.addLabel(this,Z4Translations.HISTORY_MANAGEMENT,new GBC(4,0).a(GBC.WEST).i(5,5,2,0));let n=null,r=localStorage.getItem("z4historymanagement");switch(r){case"standard":case"timer":case"manual":case"tool":n=new KeyValue(r,Z4Translations[r.toUpperCase()+"_POLICY"]);break;default:n=new KeyValue("standard",Z4Translations.STANDARD_POLICY)}let o=new DefaultKeyValueComboBoxModelAndRenderer;o.addElement(new KeyValue("standard",Z4Translations.STANDARD_POLICY)),o.addElement(new KeyValue("timer",Z4Translations.TIMER_POLICY)),o.addElement(new KeyValue("manual",Z4Translations.MANUAL_POLICY)),o.addElement(new KeyValue("tool",Z4Translations.TOOL_POLICY)),this.historyManagement.getStyle().minWidth="18rem",this.historyManagement.setModelAndRenderer(o),this.historyManagement.setSelectedItem(n),this.historyManagement.addActionListener(e=>this.onchangeHistoryManagementSettings()),this.add(this.historyManagement,new GBC(4,1).a(GBC.WEST).i(0,5,0,5)),this.historyManagementDescription.setText(Z4Translations[n.key.toUpperCase()+"_POLICY_DESCRIPTION"]),this.add(this.historyManagementDescription,new GBC(4,2).w(3).wx(1).a(GBC.NORTHWEST).i(5,0,0,0)),Z4UI.addLabel(this,Z4Translations.SAVING_DELAY,new GBC(5,0).a(GBC.WEST).i(5,5,2,0));let l=parseInt(localStorage.getItem("z4savingdelay")),h=(l=l||1e3)<1e3?l+"ms":l/1e3+"s",d=new KeyValue(l,h),c=new DefaultKeyValueComboBoxModelAndRenderer;c.addElement(new KeyValue(100,"100ms")),c.addElement(new KeyValue(200,"200ms")),c.addElement(new KeyValue(500,"500ms")),c.addElement(new KeyValue(1e3,"1s")),c.addElement(new KeyValue(2e3,"2s")),c.addElement(new KeyValue(5e3,"5s")),this.savingDelay.getStyle().minWidth="6rem",this.savingDelay.setEnabled("standard"===n.key),this.savingDelay.setModelAndRenderer(c),this.savingDelay.setSelectedItem(d),this.savingDelay.addActionListener(e=>this.onchangeHistoryManagementSettings()),this.add(this.savingDelay,new GBC(5,1).a(GBC.WEST).i(0,5,0,0)),Z4UI.addLabel(this,Z4Translations.SAVING_INTERVAL,new GBC(6,0).a(GBC.WEST).i(5,5,2,0));let g=parseInt(localStorage.getItem("z4savinginterval")),u=(g=g||6e4)<6e4?g/1e3+"s":g/6e4+"min",E=new KeyValue(g,u),T=new DefaultKeyValueComboBoxModelAndRenderer;T.addElement(new KeyValue(1e4,"10s")),T.addElement(new KeyValue(3e4,"30s")),T.addElement(new KeyValue(6e4,"1m")),T.addElement(new KeyValue(12e4,"2m")),T.addElement(new KeyValue(18e4,"3m")),T.addElement(new KeyValue(3e5,"5m")),this.savingInterval.getStyle().minWidth="6rem",this.savingInterval.setEnabled("timer"===n.key),this.savingInterval.setModelAndRenderer(T),this.savingInterval.setSelectedItem(E),this.savingInterval.addActionListener(e=>this.onchangeHistoryManagementSettings()),this.add(this.savingInterval,new GBC(6,1).a(GBC.WEST).i(0,5,0,0)),Z4UI.addVLine(this,new GBC(7,0).h(3).wy(1).a(GBC.EAST).f(GBC.VERTICAL).i(1,2,1,2));let p=new JSButton;p.setText(Z4Translations.RESET),p.setContentAreaFilled(!1),p.addActionListener(e=>this.onreset()),this.add(p,new GBC(8,1).a(GBC.BOTH).i(0,5,0,5))}onchangeLanguage(){localStorage.setItem("z4language",this.language.getSelectedItem().key),JSOptionPane.showMessageDialog(Z4Translations.REFRESH_PAGE_MESSAGE,Z4Translations.LANGUAGE,JSOptionPane.INFORMATION_MESSAGE,null)}onchangeTheme(){localStorage.setItem("z4theme",this.theme.getSelectedItem().key),JSOptionPane.showMessageDialog(Z4Translations.REFRESH_PAGE_MESSAGE,Z4Translations.THEME,JSOptionPane.INFORMATION_MESSAGE,null)}onchangeColor(){this.color.getValueIsAdjusting()||(localStorage.setItem("z4color",this.color.getSelectedColor().getRGB_HEX()),JSOptionPane.showMessageDialog(Z4Translations.REFRESH_PAGE_MESSAGE,Z4Translations.THEME_COLOR,JSOptionPane.INFORMATION_MESSAGE,null))}onchangeHistoryManagementSettings(){let e=this.historyManagement.getSelectedItem();localStorage.setItem("z4historymanagement",e.key),this.historyManagementDescription.setText(Z4Translations[e.key.toUpperCase()+"_POLICY_DESCRIPTION"]);let t=this.savingDelay.getSelectedItem();localStorage.setItem("z4savingdelay",""+t.key);let i=this.savingInterval.getSelectedItem();localStorage.setItem("z4savinginterval",""+i.key),this.savingDelay.setEnabled("standard"===e.key),this.savingInterval.setEnabled("timer"===e.key),this.historyPanel.setHistoryManagementSettings(e.key,t.key,i.key)}onreset(){localStorage.removeItem("z4language"),localStorage.removeItem("z4theme"),localStorage.removeItem("z4color"),localStorage.removeItem("z4historymanagement"),localStorage.removeItem("z4savingdelay"),localStorage.removeItem("z4savinginterval"),this.historyManagement.setSelectedItem(new KeyValue("standard",Z4Translations.STANDARD_POLICY)),this.historyManagementDescription.setText(Z4Translations.STANDARD_POLICY_DESCRIPTION),this.savingDelay.setSelectedItem(new KeyValue(1e3,"1s")),this.savingDelay.setEnabled(!0),this.savingInterval.setSelectedItem(new KeyValue(6e4,"1min")),this.savingInterval.setEnabled(!1),this.historyPanel.setHistoryManagementSettings("standard",1e3,6e4),JSOptionPane.showMessageDialog(Z4Translations.REFRESH_PAGE_MESSAGE,Z4Translations.RESET,JSOptionPane.INFORMATION_MESSAGE,null)}setHistoryPanel(e){this.historyPanel=e;let t=this.historyManagement.getSelectedItem(),i=this.savingDelay.getSelectedItem(),s=this.savingInterval.getSelectedItem();this.historyPanel.setHistoryManagementSettings(t.key,i.key,s.key)}}class Z4AbstractValuePanel extends JSPanel{value=null;listeners=[];constructor(){super(),this.cssAddClass("z4abstractvaluepanel")}setValue(e){}getValue(){return this.value}addChangeListener(e){this.listeners.push(e)}onchange(){let e=new ChangeEvent;this.listeners.forEach(t=>{"function"==typeof t?t(e):t.stateChanged(e)})}}class Z4GradientColorProgressionPanel extends Z4AbstractValuePanel{lightingPanel=new Z4LightingPanel(Z4LightingPanelOrientation.HORIZONTAL);radios=[];temporalStepSlider=new JSSlider;temporalStepSpinner=new JSSpinner;valueIsAdjusting=!1;constructor(e){super(),this.cssAddClass("z4gradientcolorprogressionpanel"),this.setLayout(new GridBagLayout);let t=new JSPanel,i=new ButtonGroup;e===Z4GradientColorProgressionPanelOrientation.HORIZONTALLY_COMPACT?(Z4UI.addLabel(this,Z4Translations.FILLING,new GBC(0,0).a(GBC.WEST)),t.setLayout(new BoxLayout(t,BoxLayout.X_AXIS)),this.add(t,new GBC(1,0).w(3)),this.addRadio(Z4GradientColorProgressionBehavior.SPATIAL,i,t,"left"),this.addRadio(Z4GradientColorProgressionBehavior.TEMPORAL,i,t,"centerh"),this.addRadio(Z4GradientColorProgressionBehavior.RELATIVE_TO_PATH,i,t,"centerh"),this.addRadio(Z4GradientColorProgressionBehavior.RANDOM,i,t,"right"),Z4UI.addLabel(this,Z4Translations.STEP,new GBC(0,1).a(GBC.WEST).wx(1)),this.add(this.temporalStepSpinner,new GBC(1,1).w(3).a(GBC.EAST).i(1,0,0,0)),this.add(this.temporalStepSlider,new GBC(0,2).w(4)),Z4UI.addLabel(this,Z4Translations.LIGHTING,new GBC(0,3).a(GBC.EAST).w(2).wx(1).i(0,0,0,1)),this.add(this.lightingPanel,new GBC(2,3).w(2).a(GBC.EAST))):e===Z4GradientColorProgressionPanelOrientation.VERTICALLY_COMPACT&&(Z4UI.addLabel(this,Z4Translations.FILLING,new GBC(0,0).w(4).a(GBC.WEST)),t.setLayout(new BoxLayout(t,BoxLayout.Y_AXIS)),this.add(t,new GBC(0,1).h(3).i(0,0,0,1)),this.addRadio(Z4GradientColorProgressionBehavior.SPATIAL,i,t,"top"),this.addRadio(Z4GradientColorProgressionBehavior.TEMPORAL,i,t,"centerv"),this.addRadio(Z4GradientColorProgressionBehavior.RELATIVE_TO_PATH,i,t,"centerv"),this.addRadio(Z4GradientColorProgressionBehavior.RANDOM,i,t,"bottom"),Z4UI.addLabel(this,Z4Translations.STEP,new GBC(1,1).a(GBC.WEST).wx(1)),this.add(this.temporalStepSpinner,new GBC(2,1).w(2).a(GBC.EAST)),this.add(this.temporalStepSlider,new GBC(1,2).w(3)),Z4UI.addLabel(this,Z4Translations.LIGHTING,new GBC(2,3).a(GBC.EAST).i(0,0,0,1)),this.add(this.lightingPanel,new GBC(3,3))),this.temporalStepSpinner.setModel(new SpinnerNumberModel(1,1,100,1)),this.temporalStepSpinner.cssAddClass("jsspinner_w_4rem"),this.temporalStepSpinner.addChangeListener(e=>this.onTemporalStepChange(!0,this.temporalStepSpinner.getValueIsAdjusting(),this.temporalStepSpinner,this.temporalStepSlider)),this.temporalStepSlider.setMinimum(1),this.temporalStepSlider.setMaximum(100),this.temporalStepSlider.setValue(1),this.temporalStepSlider.getStyle().minWidth="20rem",this.temporalStepSlider.addChangeListener(e=>this.onTemporalStepChange(!1,this.temporalStepSlider.getValueIsAdjusting(),this.temporalStepSpinner,this.temporalStepSlider)),this.lightingPanel.addChangeListener(e=>this.onProgressionChange(!1)),this.setValue(new Z4GradientColorProgression(Z4GradientColorProgressionBehavior.SPATIAL,.1,Z4Lighting.NONE))}addRadio(e,t,i,s){let a=new JSRadioButton;switch(a.cssAddClass("z4gradientcolorprogressionpanel-radio"),a.getStyle().padding="1px",a.setTooltip(Z4Translations[""+e]),a.setToggle(),a.setIcon(new Z4EmptyImageProducer(e)),a.addActionListener(t=>{Object.keys(this.radios).forEach(e=>this.radios[e].setContentAreaFilled(!1)),a.setContentAreaFilled(!0),this.lightingPanel.setEnabled(e!==Z4GradientColorProgressionBehavior.SPATIAL),this.temporalStepSpinner.setEnabled(e===Z4GradientColorProgressionBehavior.TEMPORAL),this.temporalStepSlider.setEnabled(e===Z4GradientColorProgressionBehavior.TEMPORAL),this.onProgressionChange(!1)}),s){case"left":a.getStyle().borderTopRightRadius="0px",a.getStyle().borderBottomRightRadius="0px",a.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"centerh":a.getStyle().borderRadius="0px",a.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",a.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"right":a.getStyle().borderTopLeftRadius="0px",a.getStyle().borderBottomLeftRadius="0px",a.getStyle().borderLeft="1px solid var(--main-action-bgcolor)";break;case"top":a.getStyle().borderBottomLeftRadius="0px",a.getStyle().borderBottomRightRadius="0px",a.getStyle().borderBottom="1px solid var(--main-action-bgcolor)";break;case"centerv":a.getStyle().borderRadius="0px",a.getStyle().borderTop="1px solid var(--main-action-bgcolor)",a.getStyle().borderBottom="1px solid var(--main-action-bgcolor)";break;case"bottom":a.getStyle().borderTopLeftRadius="0px",a.getStyle().borderTopRightRadius="0px",a.getStyle().borderTop="1px solid var(--main-action-bgcolor)"}t.add(a),this.radios[""+e]=a,i.add(a,null)}onProgressionChange(e){this.valueIsAdjusting=e,Object.keys(this.radios).forEach(e=>{if(this.radios[e].isSelected())switch(""+e){case"SPATIAL":this.value=new Z4GradientColorProgression(Z4GradientColorProgressionBehavior.SPATIAL,this.temporalStepSlider.getValue()/100,this.lightingPanel.getValue());break;case"TEMPORAL":this.value=new Z4GradientColorProgression(Z4GradientColorProgressionBehavior.TEMPORAL,this.temporalStepSlider.getValue()/100,this.lightingPanel.getValue());break;case"RELATIVE_TO_PATH":this.value=new Z4GradientColorProgression(Z4GradientColorProgressionBehavior.RELATIVE_TO_PATH,this.temporalStepSlider.getValue()/100,this.lightingPanel.getValue());break;case"RANDOM":this.value=new Z4GradientColorProgression(Z4GradientColorProgressionBehavior.RANDOM,this.temporalStepSlider.getValue()/100,this.lightingPanel.getValue())}}),this.onchange()}onTemporalStepChange(e,t,i,s){e?s.setValue(i.getValue()):i.setValue(s.getValue()),this.onProgressionChange(t)}getValueIsAdjusting(){return this.valueIsAdjusting}setValue(e){this.value=e,this.lightingPanel.setValue(e.getLighting()),this.lightingPanel.setEnabled(e.getGradientColorProgressionBehavior()!==Z4GradientColorProgressionBehavior.SPATIAL),Object.keys(this.radios).forEach(e=>this.radios[e].setContentAreaFilled(!1)),this.radios[""+e.getGradientColorProgressionBehavior()].setSelected(!0),this.radios[""+e.getGradientColorProgressionBehavior()].setContentAreaFilled(!0),this.temporalStepSpinner.setEnabled(e.getGradientColorProgressionBehavior()===Z4GradientColorProgressionBehavior.TEMPORAL),this.temporalStepSpinner.setValue(100*e.getTemporalStepProgression()),this.temporalStepSlider.setEnabled(e.getGradientColorProgressionBehavior()===Z4GradientColorProgressionBehavior.TEMPORAL),this.temporalStepSlider.setValue(parseInt(100*e.getTemporalStepProgression()))}setEnabled(e){this.lightingPanel.setEnabled(e),Object.keys(this.radios).forEach(t=>{let i=this.radios[t];i.setEnabled(e),i.isSelected()&&(this.lightingPanel.setEnabled(e&&""+t!=""+Z4GradientColorProgressionBehavior.SPATIAL),this.temporalStepSpinner.setEnabled(e&&""+t!=""+Z4GradientColorProgressionBehavior.TEMPORAL),this.temporalStepSlider.setEnabled(e&&""+t!=""+Z4GradientColorProgressionBehavior.TEMPORAL))})}}class Z4LightingPanel extends Z4AbstractValuePanel{radios=[];constructor(e){super(),this.cssAddClass("z4lightingpanel"),this.setLayout(new GridBagLayout);let t=new ButtonGroup;e===Z4LightingPanelOrientation.HORIZONTAL?(this.addRadio(Z4Lighting.NONE,t,0,0,"left"),this.addRadio(Z4Lighting.LIGHTED,t,1,0,"centerh"),this.addRadio(Z4Lighting.DARKENED,t,3,0,"right")):e===Z4LightingPanelOrientation.VERTICAL&&(this.addRadio(Z4Lighting.NONE,t,0,0,"top"),this.addRadio(Z4Lighting.LIGHTED,t,0,2,"centerv"),this.addRadio(Z4Lighting.DARKENED,t,0,3,"bottom")),this.setValue(Z4Lighting.NONE)}addRadio(e,t,i,s,a){let n=new JSRadioButton;switch(n.cssAddClass("z4lightingpanel-radio"),n.getStyle().padding="1px",n.setTooltip(Z4Translations[e===Z4Lighting.NONE?"NONE_HER":""+e]),n.setToggle(),n.setIcon(new Z4EmptyImageProducer(e)),n.addActionListener(t=>{Object.keys(this.radios).forEach(e=>this.radios[e].setContentAreaFilled(!1)),n.setContentAreaFilled(!0),this.value=e,this.onchange()}),a){case"left":n.getStyle().borderTopRightRadius="0px",n.getStyle().borderBottomRightRadius="0px",n.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"centerh":n.getStyle().borderRadius="0px",n.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",n.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"right":n.getStyle().borderTopLeftRadius="0px",n.getStyle().borderBottomLeftRadius="0px",n.getStyle().borderLeft="1px solid var(--main-action-bgcolor)";break;case"top":n.getStyle().borderBottomLeftRadius="0px",n.getStyle().borderBottomRightRadius="0px",n.getStyle().borderBottom="1px solid var(--main-action-bgcolor)";break;case"centerv":n.getStyle().borderRadius="0px",n.getStyle().borderTop="1px solid var(--main-action-bgcolor)",n.getStyle().borderBottom="1px solid var(--main-action-bgcolor)";break;case"bottom":n.getStyle().borderTopLeftRadius="0px",n.getStyle().borderTopRightRadius="0px",n.getStyle().borderTop="1px solid var(--main-action-bgcolor)"}t.add(n),this.radios[""+e]=n,this.add(n,new GBC(i,s))}setValue(e){this.value=e,Object.keys(this.radios).forEach(e=>this.radios[e].setContentAreaFilled(!1)),this.radios[""+e].setSelected(!0),this.radios[""+e].setContentAreaFilled(!0)}setEnabled(e){Object.keys(this.radios).forEach(t=>this.radios[t].setEnabled(e))}}class Z4AbstractRandomValuePanel extends Z4AbstractValuePanel{valuePanel=null;radios=[];lengthPanel=null;valueIsAdjusting=!1;constructor(e,t){super(),this.cssAddClass("z4abstractrandomvaluepanel"),this.setLayout(new GridBagLayout);let i=new ButtonGroup;t===Z4RandomValuePanelOrientation.HORIZONTAL?(this.valuePanel=new Z4SignedValuePanel(Z4SignedValuePanelOrientation.HORIZONTAL),this.add(this.valuePanel,new GBC(0,0).h(2).a(GBC.SOUTH).i(0,0,0,1)),this.addRadio(Z4RandomValueBehavior.CLASSIC,i,1,0,"topleft"),this.addRadio(Z4RandomValueBehavior.BEZIER,i,2,0,"topright"),this.addRadio(Z4RandomValueBehavior.POLYLINE,i,1,1,"bottomleft"),this.addRadio(Z4RandomValueBehavior.STEPPED,i,2,1,"bottomright"),this.lengthPanel=new Z4SignedValuePanel(Z4SignedValuePanelOrientation.HORIZONTAL),this.add(this.lengthPanel,new GBC(3,0).h(2).a(GBC.SOUTH))):t===Z4RandomValuePanelOrientation.VERTICAL?(this.valuePanel=new Z4SignedValuePanel(Z4SignedValuePanelOrientation.VERTICAL),this.add(this.valuePanel,new GBC(0,0).w(4).f(GBC.HORIZONTAL).i(0,0,1,0)),this.addRadio(Z4RandomValueBehavior.CLASSIC,i,0,1,"left"),this.addRadio(Z4RandomValueBehavior.BEZIER,i,1,1,"center"),this.addRadio(Z4RandomValueBehavior.POLYLINE,i,2,1,"center"),this.addRadio(Z4RandomValueBehavior.STEPPED,i,3,1,"right"),this.lengthPanel=new Z4SignedValuePanel(Z4SignedValuePanelOrientation.VERTICAL),this.add(this.lengthPanel,new GBC(0,2).w(4).f(GBC.HORIZONTAL))):t===Z4RandomValuePanelOrientation.HORIZONTALLY_VERTICAL?(this.valuePanel=new Z4SignedValuePanel(Z4SignedValuePanelOrientation.HORIZONTAL),this.add(this.valuePanel,new GBC(0,0).w(3).a(GBC.EAST)),this.addRadio(Z4RandomValueBehavior.CLASSIC,i,0,1,"topleft"),this.addRadio(Z4RandomValueBehavior.BEZIER,i,1,1,"topright"),this.addRadio(Z4RandomValueBehavior.POLYLINE,i,0,2,"bottomleft"),this.addRadio(Z4RandomValueBehavior.STEPPED,i,1,2,"bottomright"),this.lengthPanel=new Z4SignedValuePanel(Z4SignedValuePanelOrientation.VERTICAL),this.add(this.lengthPanel,new GBC(2,1).h(2).i(0,1,0,0))):(this.valuePanel=null,this.lengthPanel=null),this.valuePanel.setSignVisible(e),this.valuePanel.addChangeListener(e=>{this.valueIsAdjusting=this.valuePanel.getValueIsAdjusting(),this.onRandomValueChange(),this.onchange()}),this.lengthPanel.setLabel(Z4Translations.LENGTH),this.lengthPanel.setSignVisible(!1),this.lengthPanel.addChangeListener(e=>{this.valueIsAdjusting=this.lengthPanel.getValueIsAdjusting(),this.onRandomValueChange(),this.onchange()})}addRadio(e,t,i,s,a){let n=new JSRadioButton;n.cssAddClass("z4abstractrandomvaluepanel-radio"),n.getStyle().padding="1px",n.setTooltip(Z4Translations[""+e]),n.setToggle(),n.setIcon(new Z4EmptyImageProducer(e)),n.addActionListener(t=>{Object.keys(this.radios).forEach(e=>this.radios[e].setContentAreaFilled(!1)),n.setContentAreaFilled(!0),this.lengthPanel.setEnabled(e!==Z4RandomValueBehavior.CLASSIC),this.onRandomValueChange(),this.onchange()});let r=new GBC(i,s);switch(a){case"left":n.getStyle().borderTopRightRadius="0px",n.getStyle().borderBottomRightRadius="0px",n.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"center":n.getStyle().borderRadius="0px",n.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",n.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"right":n.getStyle().borderTopLeftRadius="0px",n.getStyle().borderBottomLeftRadius="0px",n.getStyle().borderLeft="1px solid var(--main-action-bgcolor)";break;case"topleft":r.a(GBC.SOUTH).wy(1),n.getStyle().borderTopRightRadius="0px",n.getStyle().borderBottomRightRadius="0px",n.getStyle().borderBottomLeftRadius="0px",n.getStyle().borderRight="1px solid var(--main-action-bgcolor)",n.getStyle().borderBottom="1px solid var(--main-action-bgcolor)";break;case"topright":r.a(GBC.SOUTH).wy(1),n.getStyle().borderTopLeftRadius="0px",n.getStyle().borderBottomLeftRadius="0px",n.getStyle().borderBottomRightRadius="0px",n.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",n.getStyle().borderBottom="1px solid var(--main-action-bgcolor)";break;case"bottomleft":n.getStyle().borderTopRightRadius="0px",n.getStyle().borderBottomRightRadius="0px",n.getStyle().borderTopLeftRadius="0px",n.getStyle().borderRight="1px solid var(--main-action-bgcolor)",n.getStyle().borderTop="1px solid var(--main-action-bgcolor)";break;case"bottomright":n.getStyle().borderTopLeftRadius="0px",n.getStyle().borderBottomLeftRadius="0px",n.getStyle().borderTopRightRadius="0px",n.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",n.getStyle().borderTop="1px solid var(--main-action-bgcolor)"}t.add(n),this.radios[""+e]=n,this.add(n,r)}onRandomValueChange(){}getValueIsAdjusting(){return this.valueIsAdjusting}setLabel(e){this.valuePanel.setLabel(e)}setRange(e,t){this.valuePanel.setRange(e,t)}setLengthRange(e,t){this.lengthPanel.setRange(e,t)}setEnabled(e){this.valuePanel.setEnabled(e),Object.keys(this.radios).forEach(t=>{let i=this.radios[t];i.setEnabled(e),i.isSelected()&&this.lengthPanel.setEnabled(e&&""+t!=""+Z4RandomValueBehavior.CLASSIC)})}}class Z4RandomValuePanel extends Z4AbstractRandomValuePanel{constructor(e){super(!1,e),this.cssAddClass("z4randomvaluepanel"),this.setValue(new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0))}onRandomValueChange(){Object.keys(this.radios).forEach(e=>{if(this.radios[e].isSelected())switch(""+e){case"CLASSIC":this.value=new Z4RandomValue(this.valuePanel.getValue().getValue(),Z4RandomValueBehavior.CLASSIC,this.lengthPanel.getValue().getValue());break;case"BEZIER":this.value=new Z4RandomValue(this.valuePanel.getValue().getValue(),Z4RandomValueBehavior.BEZIER,this.lengthPanel.getValue().getValue());break;case"POLYLINE":this.value=new Z4RandomValue(this.valuePanel.getValue().getValue(),Z4RandomValueBehavior.POLYLINE,this.lengthPanel.getValue().getValue());break;case"STEPPED":this.value=new Z4RandomValue(this.valuePanel.getValue().getValue(),Z4RandomValueBehavior.STEPPED,this.lengthPanel.getValue().getValue())}})}setValue(e){this.value=e,this.valuePanel.setValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),e.getValue())),Object.keys(this.radios).forEach(e=>this.radios[e].setContentAreaFilled(!1)),this.radios[""+e.getRandomValueBehavior()].setSelected(!0),this.radios[""+e.getRandomValueBehavior()].setContentAreaFilled(!0),this.lengthPanel.setEnabled(e.getRandomValueBehavior()!==Z4RandomValueBehavior.CLASSIC),this.lengthPanel.setValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),e.getLength()))}}class Z4SignedRandomValuePanel extends Z4AbstractRandomValuePanel{constructor(e){super(!0,e),this.cssAddClass("z4signedrandomvaluepanel"),this.setValue(new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.RANDOM),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)))}onRandomValueChange(){Object.keys(this.radios).forEach(e=>{if(this.radios[e].isSelected())switch(""+e){case"CLASSIC":this.value=new Z4SignedRandomValue(this.valuePanel.getValue().getSign(),new Z4RandomValue(this.valuePanel.getValue().getValue(),Z4RandomValueBehavior.CLASSIC,this.lengthPanel.getValue().getValue()));break;case"BEZIER":this.value=new Z4SignedRandomValue(this.valuePanel.getValue().getSign(),new Z4RandomValue(this.valuePanel.getValue().getValue(),Z4RandomValueBehavior.BEZIER,this.lengthPanel.getValue().getValue()));break;case"POLYLINE":this.value=new Z4SignedRandomValue(this.valuePanel.getValue().getSign(),new Z4RandomValue(this.valuePanel.getValue().getValue(),Z4RandomValueBehavior.POLYLINE,this.lengthPanel.getValue().getValue()));break;case"STEPPED":this.value=new Z4SignedRandomValue(this.valuePanel.getValue().getSign(),new Z4RandomValue(this.valuePanel.getValue().getValue(),Z4RandomValueBehavior.STEPPED,this.lengthPanel.getValue().getValue()))}})}setValue(e){this.value=e,this.valuePanel.setValue(new Z4SignedValue(e.getSign(),e.getValue().getValue())),Object.keys(this.radios).forEach(e=>this.radios[e].setContentAreaFilled(!1)),this.radios[""+e.getValue().getRandomValueBehavior()].setSelected(!0),this.radios[""+e.getValue().getRandomValueBehavior()].setContentAreaFilled(!0),this.lengthPanel.setEnabled(e.getValue().getRandomValueBehavior()!==Z4RandomValueBehavior.CLASSIC),this.lengthPanel.setValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),e.getValue().getLength()))}}class Z4FancifulValuePanel extends Z4AbstractValuePanel{label=new JSLabel;uniformSign=new JSToggleButton;sign=null;constant=null;random=null;signedRandom=null;signsVisible=!0;valueIsAdjusting=!1;orientation=null;constructor(e){super(),this.cssAddClass("z4fancifulvaluepanel"),this.setLayout(new GridBagLayout),this.orientation=e,e===Z4FancifulValuePanelOrientation.HORIZONTAL?(this.add(this.label,new GBC(0,0).w(2).a(GBC.WEST)),this.add(this.uniformSign,new GBC(2,0).w(2).a(GBC.EAST)),this.sign=new Z4SignPanel(Z4SignPanelOrientation.SQUARED),this.add(this.sign,new GBC(0,1).i(0,0,0,2).a(GBC.SOUTH)),this.constant=new Z4SignedValuePanel(Z4SignedValuePanelOrientation.HORIZONTAL),this.add(this.constant,new GBC(1,1).i(0,0,0,2)),this.random=new Z4RandomValuePanel(Z4RandomValuePanelOrientation.HORIZONTAL),this.add(this.random,new GBC(2,1)),this.signedRandom=new Z4SignedRandomValuePanel(Z4RandomValuePanelOrientation.HORIZONTAL),this.add(this.signedRandom,new GBC(3,1))):e===Z4FancifulValuePanelOrientation.VERTICAL?(this.add(this.label,new GBC(0,0).a(GBC.WEST)),this.add(this.uniformSign,new GBC(1,0).a(GBC.EAST)),this.sign=new Z4SignPanel(Z4SignPanelOrientation.HORIZONTAL),this.add(this.sign,new GBC(0,1).w(2).i(1,0,0,0)),this.constant=new Z4SignedValuePanel(Z4SignedValuePanelOrientation.VERTICAL),this.add(this.constant,new GBC(0,2).w(2).i(0,0,2,0)),this.random=new Z4RandomValuePanel(Z4RandomValuePanelOrientation.VERTICAL),this.add(this.random,new GBC(0,3).w(2)),this.signedRandom=new Z4SignedRandomValuePanel(Z4RandomValuePanelOrientation.VERTICAL),this.add(this.signedRandom,new GBC(0,4).w(2))):e===Z4FancifulValuePanelOrientation.HORIZONTALLY_VERTICAL?(this.add(this.label,new GBC(0,0).w(2).wx(1).a(GBC.WEST)),this.add(this.uniformSign,new GBC(2,0).a(GBC.EAST)),this.sign=new Z4SignPanel(Z4SignPanelOrientation.SQUARED),this.add(this.sign,new GBC(0,1).a(GBC.SOUTH)),this.constant=new Z4SignedValuePanel(Z4SignedValuePanelOrientation.HORIZONTAL),this.add(this.constant,new GBC(1,1).w(2)),this.random=new Z4RandomValuePanel(Z4RandomValuePanelOrientation.HORIZONTALLY_VERTICAL),this.add(this.random,new GBC(0,2).w(3).a(GBC.EAST)),this.signedRandom=new Z4SignedRandomValuePanel(Z4RandomValuePanelOrientation.HORIZONTALLY_VERTICAL),this.add(this.signedRandom,new GBC(0,3).w(3).a(GBC.EAST))):(this.sign=null,this.constant=null,this.random=null,this.signedRandom=null),this.uniformSign.cssAddClass("z4fancifulvaluepanel-uniform-sign"),this.uniformSign.getStyle().padding="1px",this.uniformSign.setTooltip(Z4Translations.UNIFORM_SIGN),this.uniformSign.setIcon(new Z4EmptyImageProducer("")),this.uniformSign.addActionListener(e=>this.onFancifulValueChange(!1)),this.sign.getStyle().display="none",this.sign.addChangeListener(e=>this.onFancifulValueChange(!1)),this.constant.setLabel(Z4Translations.CONSTANT),this.constant.addChangeListener(e=>this.onFancifulValueChange(this.constant.getValueIsAdjusting())),this.random.setLabel(Z4Translations.RANDOM),this.random.getStyle().display="none",this.random.addChangeListener(e=>this.onFancifulValueChange(this.random.getValueIsAdjusting())),this.signedRandom.setLabel(Z4Translations.RANDOM),this.signedRandom.addChangeListener(e=>this.onFancifulValueChange(this.signedRandom.getValueIsAdjusting())),this.setValue(new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.RANDOM),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.RANDOM),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1))}onFancifulValueChange(e){this.valueIsAdjusting=e,this.uniformSign.setContentAreaFilled(this.uniformSign.isSelected()),this.signsVisible?this.uniformSign.isSelected()?(this.constant.setValue(new Z4SignedValue(this.sign.getValue(),this.constant.getValue().getValue())),this.signedRandom.setValue(new Z4SignedRandomValue(this.sign.getValue(),this.random.getValue()))):(this.sign.setValue(this.constant.getValue().getSign()),this.random.setValue(this.signedRandom.getValue().getValue())):this.signedRandom.setValue(new Z4SignedRandomValue(this.signedRandom.getValue().getSign(),this.random.getValue())),this.value=new Z4FancifulValue(this.constant.getValue(),this.signedRandom.getValue(),this.uniformSign.isSelected()),this.setSignsVisible(this.signsVisible),this.onchange()}setLabel(e){this.label.setText(e)}setConstantRange(e,t){this.constant.setRange(e,t)}setRandomRange(e,t){this.random.setRange(e,t),this.signedRandom.setRange(e,t)}setRandomLengthRange(e,t){this.random.setLengthRange(e,t),this.signedRandom.setLengthRange(e,t)}setSignsVisible(e){if(this.signsVisible=e,this.uniformSign.getStyle().display=e?"flex":"none",this.sign.getStyle().display=e&&this.uniformSign.isSelected()?"grid":"none",this.constant.setSignVisible(e&&!this.uniformSign.isSelected()),this.random.getStyle().display=e&&!this.uniformSign.isSelected()?"none":"grid",this.signedRandom.getStyle().display=e&&!this.uniformSign.isSelected()?"grid":"none",this.orientation===Z4FancifulValuePanelOrientation.VERTICAL){let t=this.random.invoke("getBoundingClientRect()"),i=this.signedRandom.invoke("getBoundingClientRect()");this.constant.getStyle().minWidth=Math.max(t.width,i.width)+"px"}}getValueIsAdjusting(){return this.valueIsAdjusting}setValue(e){this.value=e,this.sign.setValue(e.getConstant().getSign()),this.constant.setValue(e.getConstant()),this.random.setValue(e.getRandom().getValue()),this.signedRandom.setValue(e.getRandom()),this.uniformSign.setSelected(e.isUniformSign()),this.uniformSign.setContentAreaFilled(e.isUniformSign()),this.setSignsVisible(this.signsVisible)}setEnabled(e){this.uniformSign.setEnabled(e),this.sign.setEnabled(e),this.constant.setEnabled(e),this.random.setEnabled(e),this.signedRandom.setEnabled(e)}}class Z4RotationPanel extends Z4AbstractValuePanel{label=new JSLabel;startAngle=null;angle=null;radios=[];delayed=new JSToggleButton;valueIsAdjusting=!1;constructor(e){super(),this.cssAddClass("z4rotationpanel"),this.setLayout(new GridBagLayout);let t=new ButtonGroup;e===Z4RotationPanelOrientation.HORIZONTAL?(this.cssAddClass("z4rotationpanel-horizontal"),this.add(this.label,new GBC(0,0)),this.startAngle=new Z4SignedValuePanel(Z4SignedValuePanelOrientation.HORIZONTAL),this.add(this.startAngle,new GBC(1,0).h(2).a(GBC.SOUTHEAST).wx(1).i(0,0,0,1)),this.angle=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.HORIZONTAL),this.add(this.angle,new GBC(0,2).w(4).i(1,0,0,0)),this.addRadio(Z4RotationBehavior.FIXED,t,2,0,"topleft"),this.addRadio(Z4RotationBehavior.CUMULATIVE,t,3,0,"topright"),this.addRadio(Z4RotationBehavior.RELATIVE_TO_PATH,t,2,1,"bottomleft"),this.delayed.getStyle().borderTopLeftRadius="0px",this.delayed.getStyle().borderBottomLeftRadius="0px",this.delayed.getStyle().borderTopRightRadius="0px",this.delayed.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",this.delayed.getStyle().borderTop="1px solid var(--main-action-bgcolor)",this.add(this.delayed,new GBC(3,1))):e===Z4RotationPanelOrientation.VERTICAL?(this.cssAddClass("z4rotationpanel-vertical"),this.add(this.label,new GBC(0,0).w(4).a(GBC.WEST)),this.startAngle=new Z4SignedValuePanel(Z4SignedValuePanelOrientation.VERTICAL),this.add(this.startAngle,new GBC(0,1).w(4).f(GBC.HORIZONTAL).i(0,0,1,0)),this.addRadio(Z4RotationBehavior.FIXED,t,0,2,"left"),this.addRadio(Z4RotationBehavior.CUMULATIVE,t,1,2,"center"),this.addRadio(Z4RotationBehavior.RELATIVE_TO_PATH,t,2,2,"center"),this.delayed.getStyle().borderTopLeftRadius="0px",this.delayed.getStyle().borderBottomLeftRadius="0px",this.delayed.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",this.add(this.delayed,new GBC(3,2)),this.angle=new Z4FancifulValuePanel(Z4FancifulValuePanelOrientation.VERTICAL),this.add(this.angle,new GBC(0,3).w(4).i(1,0,0,0))):(this.startAngle=null,this.angle=null),this.startAngle.setRange(0,360),this.startAngle.setSignVisible(!1),this.startAngle.setLabel(Z4Translations.FIXED),this.startAngle.addChangeListener(e=>this.onRotationChange(this.startAngle.getValueIsAdjusting())),this.angle.setLabel(Z4Translations.VARIABLE),this.angle.setConstantRange(0,180),this.angle.setRandomRange(0,180),this.angle.addChangeListener(e=>this.onRotationChange(this.angle.getValueIsAdjusting())),this.delayed.cssAddClass("z4rotationpanel-delayed"),this.delayed.getStyle().padding="1px",this.delayed.setTooltip(Z4Translations.DELAYED),this.delayed.setIcon(new Z4EmptyImageProducer("")),this.delayed.addActionListener(e=>this.onRotationChange(!1)),this.setValue(new Z4Rotation(0,new Z4FancifulValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.RANDOM),0),new Z4SignedRandomValue(new Z4Sign(Z4SignBehavior.RANDOM),new Z4RandomValue(0,Z4RandomValueBehavior.CLASSIC,0)),!1),Z4RotationBehavior.FIXED,!1))}addRadio(e,t,i,s,a){let n=new JSRadioButton;n.cssAddClass("z4rotationpanel-radio"),n.getStyle().padding="1px",n.setTooltip(Z4Translations[""+e]),n.setToggle(),n.setIcon(new Z4EmptyImageProducer(e)),n.addActionListener(e=>{Object.keys(this.radios).forEach(e=>this.radios[e].setContentAreaFilled(!1)),n.setContentAreaFilled(!0),this.onRotationChange(!1)});let r=new GBC(i,s);switch(a){case"left":n.getStyle().borderTopRightRadius="0px",n.getStyle().borderBottomRightRadius="0px",n.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"center":n.getStyle().borderRadius="0px",n.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",n.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"topleft":r.a(GBC.SOUTH).wy(1),n.getStyle().borderTopRightRadius="0px",n.getStyle().borderBottomRightRadius="0px",n.getStyle().borderBottomLeftRadius="0px",n.getStyle().borderRight="1px solid var(--main-action-bgcolor)",n.getStyle().borderBottom="1px solid var(--main-action-bgcolor)";break;case"topright":r.a(GBC.SOUTH).wy(1),n.getStyle().borderTopLeftRadius="0px",n.getStyle().borderBottomLeftRadius="0px",n.getStyle().borderBottomRightRadius="0px",n.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",n.getStyle().borderBottom="1px solid var(--main-action-bgcolor)";break;case"bottomleft":n.getStyle().borderTopRightRadius="0px",n.getStyle().borderBottomRightRadius="0px",n.getStyle().borderTopLeftRadius="0px",n.getStyle().borderRight="1px solid var(--main-action-bgcolor)",n.getStyle().borderTop="1px solid var(--main-action-bgcolor)"}t.add(n),this.radios[""+e]=n,this.add(n,r)}onRotationChange(e){this.valueIsAdjusting=e,this.delayed.setContentAreaFilled(this.delayed.isSelected()),Object.keys(this.radios).forEach(e=>{if(this.radios[e].isSelected())switch(""+e){case"FIXED":this.value=new Z4Rotation(this.startAngle.getValue().getValue(),this.angle.getValue(),Z4RotationBehavior.FIXED,this.delayed.isSelected());break;case"CUMULATIVE":this.value=new Z4Rotation(this.startAngle.getValue().getValue(),this.angle.getValue(),Z4RotationBehavior.CUMULATIVE,this.delayed.isSelected());break;case"RELATIVE_TO_PATH":this.value=new Z4Rotation(this.startAngle.getValue().getValue(),this.angle.getValue(),Z4RotationBehavior.RELATIVE_TO_PATH,this.delayed.isSelected())}}),this.onchange()}setLabel(e){this.label.setText(e)}setRandomLengthRange(e,t){this.angle.setRandomLengthRange(e,t)}getValueIsAdjusting(){return this.valueIsAdjusting}setValue(e){this.value=e,this.startAngle.setValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.POSITIVE),e.getStartAngle())),this.angle.setValue(e.getAngle()),this.delayed.setSelected(e.isDelayed()),this.delayed.setContentAreaFilled(e.isDelayed()),Object.keys(this.radios).forEach(e=>this.radios[e].setContentAreaFilled(!1)),this.radios[""+e.getRotationBehavior()].setSelected(!0),this.radios[""+e.getRotationBehavior()].setContentAreaFilled(!0)}setEnabled(e){this.startAngle.setEnabled(e),this.angle.setEnabled(e),Object.keys(this.radios).forEach(t=>this.radios[t].setEnabled(e)),this.delayed.setEnabled(e)}}class Z4SignedValuePanel extends Z4AbstractValuePanel{label=new JSLabel;signPanel=null;valueSpinner=new JSSpinner;constructor(e){super(),this.cssAddClass("z4signedvaluepanel"),this.setLayout(new GridBagLayout),e===Z4SignedValuePanelOrientation.HORIZONTAL?(this.add(this.label,new GBC(1,0).a(GBC.WEST)),this.signPanel=new Z4SignPanel(Z4SignPanelOrientation.SQUARED),this.add(this.signPanel,new GBC(0,0).h(2).a(GBC.SOUTH)),this.add(this.valueSpinner,new GBC(1,1).a(GBC.SOUTH).i(0,1,0,0))):e===Z4SignedValuePanelOrientation.VERTICAL?(this.add(this.label,new GBC(0,0).a(GBC.WEST)),this.signPanel=new Z4SignPanel(Z4SignPanelOrientation.HORIZONTAL),this.add(this.signPanel,new GBC(0,1)),this.add(this.valueSpinner,new GBC(0,2).wx(1).f(GBC.HORIZONTAL).i(1,0,0,0))):this.signPanel=null,this.signPanel.addChangeListener(e=>this.onSignedValueChange()),this.valueSpinner.cssAddClass("jsspinner_w_4rem"),this.valueSpinner.setModel(new SpinnerNumberModel(0,0,50,1)),this.valueSpinner.addChangeListener(e=>this.onSignedValueChange()),this.setValue(new Z4SignedValue(new Z4Sign(Z4SignBehavior.RANDOM),0))}onSignedValueChange(){this.value=new Z4SignedValue(this.signPanel.getValue(),this.valueSpinner.getValue()),this.onchange()}setLabel(e){this.label.setText(e)}setRange(e,t){this.valueSpinner.setModel(new SpinnerNumberModel(e,e,t,1))}getValueIsAdjusting(){return this.valueSpinner.getValueIsAdjusting()}setValue(e){this.value=e,this.signPanel.setValue(e.getSign()),this.valueSpinner.setValue(e.getValue())}setEnabled(e){this.signPanel.setEnabled(e),this.valueSpinner.setEnabled(e)}setSignVisible(e){this.signPanel.getStyle().display=e?"grid":"none"}}class Z4SignPanel extends Z4AbstractValuePanel{radios=[];constructor(e){super(),this.cssAddClass("z4signpanel"),this.setLayout(new GridBagLayout);let t=new ButtonGroup;e===Z4SignPanelOrientation.HORIZONTAL?(this.addRadio(Z4SignBehavior.POSITIVE,t,0,0,"left"),this.addRadio(Z4SignBehavior.NEGATIVE,t,1,0,"centerh"),this.addRadio(Z4SignBehavior.RANDOM,t,2,0,"centerh"),this.addRadio(Z4SignBehavior.ALTERNATE,t,3,0,"right")):e===Z4SignPanelOrientation.VERTICAL?(this.addRadio(Z4SignBehavior.POSITIVE,t,0,0,"top"),this.addRadio(Z4SignBehavior.NEGATIVE,t,0,1,"centerv"),this.addRadio(Z4SignBehavior.RANDOM,t,0,2,"centerv"),this.addRadio(Z4SignBehavior.ALTERNATE,t,0,3,"bottom")):e===Z4SignPanelOrientation.SQUARED&&(this.addRadio(Z4SignBehavior.POSITIVE,t,0,0,"topleft"),this.addRadio(Z4SignBehavior.NEGATIVE,t,1,0,"topright"),this.addRadio(Z4SignBehavior.RANDOM,t,0,1,"bottomleft"),this.addRadio(Z4SignBehavior.ALTERNATE,t,1,1,"bottomright")),this.setValue(new Z4Sign(Z4SignBehavior.RANDOM))}addRadio(e,t,i,s,a){let n=new JSRadioButton;switch(n.cssAddClass("z4signpanel-radio"),n.getStyle().padding="1px",n.setTooltip(Z4Translations[""+e]),n.setToggle(),n.setIcon(new Z4EmptyImageProducer(e)),n.addActionListener(t=>{Object.keys(this.radios).forEach(e=>this.radios[e].setContentAreaFilled(!1)),n.setContentAreaFilled(!0),this.value=new Z4Sign(e),this.onchange()}),a){case"left":n.getStyle().borderTopRightRadius="0px",n.getStyle().borderBottomRightRadius="0px",n.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"centerh":n.getStyle().borderRadius="0px",n.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",n.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"right":n.getStyle().borderTopLeftRadius="0px",n.getStyle().borderBottomLeftRadius="0px",n.getStyle().borderLeft="1px solid var(--main-action-bgcolor)";break;case"top":n.getStyle().borderBottomLeftRadius="0px",n.getStyle().borderBottomRightRadius="0px",n.getStyle().borderBottom="1px solid var(--main-action-bgcolor)";break;case"centerv":n.getStyle().borderRadius="0px",n.getStyle().borderTop="1px solid var(--main-action-bgcolor)",n.getStyle().borderBottom="1px solid var(--main-action-bgcolor)";break;case"bottom":n.getStyle().borderTopLeftRadius="0px",n.getStyle().borderTopRightRadius="0px",n.getStyle().borderTop="1px solid var(--main-action-bgcolor)";break;case"topleft":n.getStyle().borderTopRightRadius="0px",n.getStyle().borderBottomRightRadius="0px",n.getStyle().borderBottomLeftRadius="0px",n.getStyle().borderRight="1px solid var(--main-action-bgcolor)",n.getStyle().borderBottom="1px solid var(--main-action-bgcolor)";break;case"topright":n.getStyle().borderTopLeftRadius="0px",n.getStyle().borderBottomLeftRadius="0px",n.getStyle().borderBottomRightRadius="0px",n.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",n.getStyle().borderBottom="1px solid var(--main-action-bgcolor)";break;case"bottomleft":n.getStyle().borderTopRightRadius="0px",n.getStyle().borderBottomRightRadius="0px",n.getStyle().borderTopLeftRadius="0px",n.getStyle().borderRight="1px solid var(--main-action-bgcolor)",n.getStyle().borderTop="1px solid var(--main-action-bgcolor)";break;case"bottomright":n.getStyle().borderTopLeftRadius="0px",n.getStyle().borderBottomLeftRadius="0px",n.getStyle().borderTopRightRadius="0px",n.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",n.getStyle().borderTop="1px solid var(--main-action-bgcolor)"}t.add(n),this.radios[""+e]=n,this.add(n,new GBC(i,s))}setValue(e){this.value=e,Object.keys(this.radios).forEach(e=>this.radios[e].setContentAreaFilled(!1)),this.radios[""+e.getSignBehavior()].setSelected(!0),this.radios[""+e.getSignBehavior()].setContentAreaFilled(!0)}setEnabled(e){Object.keys(this.radios).forEach(t=>this.radios[t].setEnabled(e))}}class Z4ExportToFilePanel extends JSPanel{filename=new JSTextField;png=new JSRadioButton;jpg=new JSRadioButton;qualitySlider=new JSSlider;qualitySpinner=new JSSpinner;listeners=[];constructor(){super(),this.cssAddClass("z4exporttofilepanel"),this.setLayout(new GridBagLayout),Z4UI.addLabel(this,Z4Translations.FILENAME,new GBC(0,0).a(GBC.WEST)),this.filename.addActionListener(e=>this.onchange()),this.add(this.filename,new GBC(0,1).w(2).f(GBC.HORIZONTAL).wx(1));let e=new ButtonGroup;e.add(this.png),e.add(this.jpg),this.addRadio(this.png,!0,"PNG",0),this.addRadio(this.jpg,!1,"JPG",1),Z4UI.addLabel(this,Z4Translations.QUALITY,new GBC(0,3).a(GBC.WEST)),this.qualitySlider.setEnabled(!1),this.qualitySlider.setValue(100),this.qualitySlider.addChangeListener(e=>this.qualitySpinner.setValue(this.qualitySlider.getValue())),this.add(this.qualitySlider,new GBC(0,4).w(2).f(GBC.HORIZONTAL).wx(1)),this.qualitySpinner.cssAddClass("jsspinner_w_3rem"),this.qualitySpinner.setEnabled(!1),this.qualitySpinner.setModel(new SpinnerNumberModel(100,0,100,1)),this.qualitySpinner.addChangeListener(e=>this.qualitySlider.setValue(this.qualitySpinner.getValue())),this.add(this.qualitySpinner,new GBC(1,3).a(GBC.EAST))}onchange(){let e=new ChangeEvent;this.listeners.forEach(t=>{"function"==typeof t?t(e):t.stateChanged(e)})}addRadio(e,t,i,s){e.setSelected(t),e.setText(i),e.addActionListener(e=>{this.qualitySlider.setEnabled(!t),this.qualitySpinner.setEnabled(!t)}),this.add(e,new GBC(s,2).a(GBC.WEST))}addChangeListener(e){this.listeners.push(e)}isValid(){return!!this.filename.getText()}setFilename(e){this.filename.setText(e)}getFilename(){return this.filename.getText()}setFilenameEditable(e){this.filename.setEditable(e)}getFileExtension(){return this.png.isSelected()?".png":".jpg"}setFileExtension(e){switch(e){case".png":this.png.setSelected(!0);break;case".jpg":this.jpg.setSelected(!0)}this.qualitySlider.setEnabled(".jpg"===e),this.qualitySpinner.setEnabled(".jpg"===e)}setFileExtensionEnabled(e){this.png.setEnabled(e),this.jpg.setEnabled(e)}getQuality(){return this.qualitySpinner.getValue()/100}}class Z4FillingPanel extends JSPanel{cardFillerSelectors=["FLAT","LINEAR","VERTEX","CONIC","SPIRAL","BEZIER","SINUSOIDAL","TEXTURE","BIGRADIENT"];cardFillerPanels=[new JSPanel,null,null,null,null,null,null,null,new JSPanel];cardFillerEvalPanels=["","new Z4LinearFillerPanel()","new Z4VertexBasedFillerPanel()","new Z4ConicFillerPanel()","new Z4SpiralFillerPanel()","new Z4BezierFillerPanel()","new Z4SinusoidalFillerPanel()","new Z4TextureFillerPanel()",""];cardColorSelectors=["FLAT","GRADIENT","NONE","BIGRADIENT"];cardColorPanels=[new JSPanel,new Z4GradientColorPanel,new JSPanel,new Z4BiGradientColorPanel];colorPreview=new Z4ColorPreview;width=Z4Constants.DEFAULT_IMAGE_SIZE;height=Z4Constants.DEFAULT_IMAGE_SIZE;selectedFillerSelector="FLAT";selectedFillerPanel=this.cardFillerPanels[0];selectedColor=new Color(255,255,255,255);constructor(){super(),this.setLayout(new GridBagLayout),this.cssAddClass("z4fillingpanel");let panelRadio=new JSPanel;panelRadio.setLayout(new BoxLayout(panelRadio,BoxLayout.Y_AXIS)),this.add(panelRadio,new GBC(0,0).wy(1)),Z4UI.addVLine(this,new GBC(1,0).wy(1).a(GBC.NORTH).f(GBC.VERTICAL).i(1,5,1,5));let panelColor=new JSPanel,cardColor=new CardLayout(0,0);panelColor.setLayout(cardColor),this.add(panelColor,new GBC(2,0).wxy(1,1).a(GBC.NORTH).i(5,0,0,0)),Z4UI.addVLine(this,new GBC(3,0).wy(1).a(GBC.NORTH).f(GBC.VERTICAL).i(1,5,1,5));let panelFiller=new JSPanel,cardFiller=new CardLayout(0,0);panelFiller.setLayout(cardFiller),panelFiller.getStyle().display="none",this.add(panelFiller,new GBC(4,0).wxy(1,1).a(GBC.NORTH));let flatPanel=this.cardColorPanels[0];flatPanel.setLayout(new BorderLayout(5,0));let label=new JSLabel;label.setText(Z4Translations.FILLING_COLOR),flatPanel.add(label,BorderLayout.NORTH),this.colorPreview.setColor(this.selectedColor),this.colorPreview.getStyle().alignSelf="center",this.colorPreview.getStyle().minWidth="15rem",flatPanel.add(this.colorPreview,BorderLayout.CENTER);let button=new JSButton;button.setText(Z4Translations.EDIT),button.addActionListener(e=>{JSColorChooser.showDialog(Z4Translations.FILLING_COLOR,this.selectedColor,!0,null,e=>{this.selectedColor=e,this.colorPreview.setColor(e)})}),flatPanel.add(button,BorderLayout.EAST);let gradientColorPanel=this.cardColorPanels[1];gradientColorPanel.addChangeListener(e=>{switch(this.selectedFillerSelector){case"FLAT":case"TEXTURE":break;case"LINEAR":case"VERTEX":case"CONIC":case"SPIRAL":case"BEZIER":case"SINUSOIDAL":this.selectedFillerPanel.drawPreview(gradientColorPanel.getValueIsAdjusting())}}),this.cardColorPanels[3].setSpaceTimeLabelsVisible(!1);let buttonGroup=new ButtonGroup;this.cardFillerSelectors.forEach((card,index,array)=>{let radio=new JSRadioButton;switch(radio.setContentAreaFilled(!1),radio.setToggle(),radio.setSelected(0===index),radio.setIcon(new Z4EmptyImageProducer(index)),radio.addActionListener(event=>{this.selectedFillerSelector=card,this.cardFillerPanels[index]?(this.selectedFillerPanel=this.cardFillerPanels[index],this.afterSelection(panelFiller,cardFiller,card,panelColor,cardColor)):"BEZIER"===card?Z4UI.pleaseWait(this,!1,!1,!1,!1,"",()=>{this.selectedFillerPanel=eval(this.cardFillerEvalPanels[index]),this.afterEval(panelFiller,card,index,gradientColorPanel),this.afterSelection(panelFiller,cardFiller,card,panelColor,cardColor)}):(this.selectedFillerPanel=eval(this.cardFillerEvalPanels[index]),this.afterEval(panelFiller,card,index,gradientColorPanel),this.afterSelection(panelFiller,cardFiller,card,panelColor,cardColor))}),buttonGroup.add(radio),panelRadio.add(radio,null),card){case"FLAT":case"BIGRADIENT":panelFiller.add(this.cardFillerPanels[index],card)}}),this.cardColorSelectors.forEach((e,t,i)=>panelColor.add(this.cardColorPanels[t],e))}afterEval(e,t,i,s){this.selectedFillerPanel.setSize(this.width,this.height),this.selectedFillerPanel.setGradientColor(s.getGradientColor()),this.cardFillerPanels[i]=this.selectedFillerPanel,e.add(this.selectedFillerPanel,t)}afterSelection(e,t,i,s,a){switch(t.show(e,i),i){case"FLAT":a.show(s,"FLAT"),e.getStyle().display="none",s.getStyle().display="block";break;case"LINEAR":case"VERTEX":case"CONIC":case"SPIRAL":case"BEZIER":case"SINUSOIDAL":a.show(s,"GRADIENT"),e.getStyle().display="block",s.getStyle().display="block",this.selectedFillerPanel.drawPreview(!1);break;case"TEXTURE":a.show(s,"NONE"),e.getStyle().display="block",s.getStyle().display="none";break;case"BIGRADIENT":a.show(s,"BIGRADIENT"),e.getStyle().display="none",s.getStyle().display="block"}}getSelectedFilling(){switch(this.selectedFillerSelector){case"FLAT":return this.selectedColor;case"LINEAR":case"VERTEX":case"CONIC":case"SPIRAL":case"BEZIER":case"SINUSOIDAL":case"TEXTURE":return this.selectedFillerPanel.getSelectedFiller();case"BIGRADIENT":return this.cardColorPanels[3].getSelectedBiGradientColor();default:return null}}setSize(e,t){e>0&&t>0&&(this.width=e,this.height=t,this.cardFillerSelectors.forEach((i,s,a)=>{switch(i){case"FLAT":break;case"LINEAR":case"VERTEX":case"CONIC":case"SPIRAL":case"BEZIER":case"SINUSOIDAL":case"TEXTURE":this.cardFillerPanels[s]&&this.cardFillerPanels[s].setSize(e,t)}}),this.cardColorSelectors.forEach((i,s,a)=>{switch(i){case"FLAT":case"GRADIENT":case"NONE":break;case"BIGRADIENT":this.cardColorPanels[s].setSize(e,t)}}))}}class Z4MergeLayerPanel extends JSPanel{checkboxes=[];layers=[];listeners=[];constructor(){super(),this.cssAddClass("z4mergelayerpanel"),this.setLayout(new GridBagLayout);let e=new JSButton;e.setText(Z4Translations.MERGE_VISIBLE_LAYERS),e.addActionListener(e=>{this.layers.forEach((e,t,i)=>this.checkboxes[t].setSelected(!e.isHidden())),this.onchange()}),this.add(e,new GBC(0,0).i(0,0,0,2)),(e=new JSButton).setText(Z4Translations.MERGE_ALL_LAYERS),e.addActionListener(e=>{this.checkboxes.forEach((e,t,i)=>e.setSelected(!0)),this.onchange()}),this.add(e,new GBC(1,0).i(0,2,0,0))}getSelectedLayers(){let e=[];return this.checkboxes.forEach((t,i,s)=>{t.isSelected()&&e.push(this.layers[i])}),e}setCanvas(e){for(let t=0;t<e.getLayersCount();t++){let i=e.getLayerAt(t),s=new JSLabel;s.setText(Z4LayerPreview.VISIBLE_LAYER_CONTENT),i.isHidden()||(s.getStyle().color="var(--main-action-bgcolor)"),this.add(s,new GBC(0,t+1).a(GBC.EAST));let a=new JSCheckBox;a.setText(i.getName()),a.addActionListener(e=>this.onchange()),this.add(a,new GBC(1,t+1).a(GBC.WEST)),this.checkboxes.push(a),this.layers.push(i)}}onchange(){let e=new ChangeEvent;this.listeners.forEach(t=>{"function"==typeof t?t(e):t.stateChanged(e)})}addChangeListener(e){this.listeners.push(e)}}class Z4NewImagePanel extends JSTabbedPane{width=new JSSpinner;height=new JSSpinner;resolution=new JSSpinner;dimensionMM=new JSLabel;dimensionIN=new JSLabel;fillingPanel=new Z4FillingPanel;listeners=[];constructor(){super(),this.cssAddClass("z4newimagepanel"),this.getStyle().minWidth="60rem",this.getStyle().minHeight="44rem";let e=new JSPanel;e.setLayout(new GridBagLayout),this.addTab(Z4Translations.DIMENSION,e),Z4UI.addLabel(e,Z4Translations.WIDTH+" (px)",new GBC(0,0).a(GBC.WEST).i(5,5,0,5)),this.addSpinner(e,this.width,Z4Constants.DEFAULT_IMAGE_SIZE,Z4Constants.MAX_IMAGE_SIZE,0,1),Z4UI.addLabel(e,Z4Translations.HEIGHT+" (px)",new GBC(1,0).a(GBC.WEST).i(5,5,0,5)),this.addSpinner(e,this.height,Z4Constants.DEFAULT_IMAGE_SIZE,Z4Constants.MAX_IMAGE_SIZE,1,1),Z4UI.addLabel(e,Z4Translations.RESOLUTION+" (dpi)",new GBC(2,0).a(GBC.WEST).i(5,5,0,5)),this.addSpinner(e,this.resolution,Z4Constants.DEFAULT_DPI,Z4Constants.MAX_DPI,2,1),e.add(this.dimensionMM,new GBC(0,2).w(3).f(GBC.HORIZONTAL).i(2,5,0,0)),e.add(this.dimensionIN,new GBC(0,3).w(3).f(GBC.HORIZONTAL).i(2,5,0,0)),e.add(new JSLabel,new GBC(0,4).wy(1)),this.addTab(Z4Translations.FILLING,this.fillingPanel),this.setDimensions()}addSpinner(e,t,i,s,a,n){t.setModel(new SpinnerNumberModel(i,1,s,1)),t.getStyle().minWidth="6.6rem",t.getChilStyleByQuery("input[type=number]").minWidth="5.5rem",t.getChilStyleByQuery("input[type=number]").width="5.5rem",t.addChangeListener(e=>this.setDimensions()),e.add(t,new GBC(a,n).a(GBC.WEST).i(0,5,0,5))}setDimensions(){let e=this.width.getValue(),t=this.height.getValue(),i=this.resolution.getValue(),s=e/i,a=t/i;this.dimensionMM.setText(new Number(25.4*s).toFixed(2)+" ✖ "+new Number(25.4*a).toFixed(2)+" mm"),this.dimensionIN.setText(new Number(s).toFixed(2)+" ✖ "+new Number(a).toFixed(2)+" inch"),this.fillingPanel.setSize(e,t),this.onchange()}setSelectedSize(e,t){this.width.setValue(e),this.height.setValue(t),this.fillingPanel.setSize(e,t)}getSelectedSize(){return new Dimension(this.width.getValue(),this.height.getValue())}getSelectedFilling(){return this.fillingPanel.getSelectedFilling()}addChangeListener(e){this.listeners.push(e)}onchange(){let e=new ChangeEvent;this.listeners.forEach(t=>{"function"==typeof t?t(e):t.stateChanged(e)})}}class Z4StatusPanel extends JSPanel{canvas=null;projectName=new JSLabel;projectSize=new JSLabel;mousePosition=new JSLabel;zoom=new JSComboBox;constructor(){super(),this.cssAddClass("z4statuspanel"),this.setLayout(new GridBagLayout),this.projectName.setText(Z4Translations.PROJECT_NAME+": "),this.add(this.projectName,new GBC(0,0).i(0,5,0,5)),this.addPipe(1);let e=new DefaultKeyValueComboBoxModelAndRenderer;Z4Constants.ZOOM_LEVEL.forEach(t=>e.addElement(new KeyValue(""+t,parseInt(100*t)+"%"))),e.addElement(new KeyValue("FIT",Z4Translations.FIT)),this.zoom.setModelAndRenderer(e),this.zoom.getStyle().minWidth="5rem",this.zoom.getChilStyleByQuery("ul").minWidth="5rem",this.zoom.setSelectedItem(new KeyValue("1","")),this.zoom.addActionListener(e=>this.onZoom()),this.add(this.zoom,new GBC(2,0).i(0,5,0,5)),this.addPipe(3),this.projectSize.setText(Z4Translations.DIMENSION+": "+Z4Constants.DEFAULT_IMAGE_SIZE+" ✖ "+Z4Constants.DEFAULT_IMAGE_SIZE),this.add(this.projectSize,new GBC(4,0).i(0,5,0,5)),this.addPipe(5),this.mousePosition.getStyle().fontFamily="monospace",this.setMousePosition(0,0),this.add(this.mousePosition,new GBC(6,0).i(0,5,0,5)),this.add(new JSLabel,new GBC(7,0).wx(1))}addPipe(e){let t=new JSLabel;t.setText("|"),t.getStyle().minWidth="0.5rem",t.getStyle().textAlign="center",this.add(t,new GBC(e,0).i(0,5,0,5))}setCanvas(e){this.canvas=e}setProjectName(e){this.projectName.setText(Z4Translations.PROJECT_NAME+": "+e)}setProjectSize(e,t){this.projectSize.setText(Z4Translations.DIMENSION+": "+e+" ✖ "+t)}setMousePosition(e,t){this.mousePosition.setText(new Number(e).toFixed(0).padStart(4,"\xa0")+" ✖ "+new Number(t).toFixed(0).padEnd(4,"\xa0"))}setZoom(e){this.zoom.setSelectedItem(new KeyValue(""+e,""))}onZoom(){let e=this.zoom.getSelectedItem().key;"FIT"===e?this.canvas.fitZoom():this.canvas.setZoom(parseFloat(e))}}class Z4Ribbon extends JSTabbedPane{filePanel=new Z4RibbonFilePanel;layerPanel=new Z4RibbonLayerPanel;historyPanel=new Z4RibbonHistoryPanel;settingsPanel=new Z4RibbonSettingsPanel;helpPanel=new Z4RibbonHelpPanel;constructor(){super(),this.cssAddClass("z4ribbon"),this.addTab(Z4Translations.FILE,this.filePanel),this.addTab(Z4Translations.LAYER,this.layerPanel),this.addTab(Z4Translations.HISTORY,this.historyPanel),this.addTab(Z4Translations.SETTINGS,this.settingsPanel),this.addTab(Z4Translations.HELP,this.helpPanel),this.settingsPanel.setHistoryPanel(this.historyPanel)}setCanvas(e){e.setRibbonPanels(this.filePanel,this.layerPanel,this.historyPanel)}setStatusPanel(e){this.filePanel.setStatusPanel(e),this.layerPanel.setStatusPanel(e),this.historyPanel.setStatusPanel(e)}}class Z4Constants{static IMAGE_FILE_ID="IMAGE_FILE_FOLDER_ID";static TEXTURE_FILE_ID="TEXTURE_FILE_FOLDER_ID";static ACCEPTED_OPEN_IMAGE_FILE_FORMAT=[".gif",".png",".apng",".jpeg",".jpg",".jfif",".pjpeg",".pjp",".bmp",".svg",".webp",".avif"];static ACCEPTED_OPEN_IMAGE_FILE_TYPE=[];static ACCEPTED_SAVE_IMAGE_FILE_TYPE=[];static PIZZAPAZZA_PROJECT_IMAGE_FILE_TYPE=[];static ZOOM_LEVEL=[.25,.33,.5,.66,1,1.5,2,3,4];static COMPOSITE_OPERATION=[["source-over","source-in","source-out","source-atop"],["destination-over","destination-in","destination-out","destination-atop"],["lighter"],["copy"],["xor"],["multiply","screen","overlay"],["darken","lighten"],["color-dodge","color-burn"],["hard-light","soft-light"],["difference","exclusion"],["hue","saturation","color","luminosity"]];static DEFAULT_IMAGE_SIZE=500;static MAX_IMAGE_SIZE=3e3;static DEFAULT_DPI=150;static MAX_DPI=1500;constructor(){}static configureAcceptedImageFileTypeArrays(){let e=new FilePickerOptionsType;e.description=Z4Translations.IMAGE_FILE,e.pushAccept("image/z4i",Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_FORMAT),Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_TYPE.push(e),Z4Constants.pushACCEPTED_IMAGE_FILE_TYPE(Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_TYPE,"image/gif",[".gif"]),Z4Constants.pushACCEPTED_IMAGE_FILE_TYPE(Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_TYPE,"image/png",[".png",".apng"]),Z4Constants.pushACCEPTED_IMAGE_FILE_TYPE(Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_TYPE,"image/jpg",[".jpeg",".jpg",".jfif",".pjpeg",".pjp"]),Z4Constants.pushACCEPTED_IMAGE_FILE_TYPE(Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_TYPE,"image/bmp",[".bmp"]),Z4Constants.pushACCEPTED_IMAGE_FILE_TYPE(Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_TYPE,"image/svg+xml",[".svg"]),Z4Constants.pushACCEPTED_IMAGE_FILE_TYPE(Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_TYPE,"image/webp",[".webp"]),Z4Constants.pushACCEPTED_IMAGE_FILE_TYPE(Z4Constants.ACCEPTED_OPEN_IMAGE_FILE_TYPE,"image/avif",[".avif"]),Z4Constants.pushACCEPTED_IMAGE_FILE_TYPE(Z4Constants.ACCEPTED_SAVE_IMAGE_FILE_TYPE,"image/png",[".png"]),Z4Constants.pushACCEPTED_IMAGE_FILE_TYPE(Z4Constants.ACCEPTED_SAVE_IMAGE_FILE_TYPE,"image/jpg",[".jpeg",".jpg"]);let t=new FilePickerOptionsType;t.description=Z4Translations.PIZZAPAZZA_PROJECT,t.pushAccept("application/z4i",[".z4i"]),Z4Constants.PIZZAPAZZA_PROJECT_IMAGE_FILE_TYPE.push(t)}static pushACCEPTED_IMAGE_FILE_TYPE(e,t,i){let s=new FilePickerOptionsType,a=t.indexOf("/")+1,n=t.indexOf("+");s.description=-1!==n?t.substring(a,n).toUpperCase():t.substring(a).toUpperCase(),s.pushAccept(t,i),e.push(s)}static getStyle(e){return e}}class Z4EmptyImageProducer extends AbstractHTMLImageProducer{constructor(e){super(e)}produce(){return document.createElement("img")}}class Z4JSONable{toJSON(){}}class Z4AbstractGradientColor extends Z4JSONable{colors=[];colorPositions=[];ripple=0;addColor(e,t){let i=this.colorPositions.findIndex(e=>e===t);-1!==i?this.colors[i]=e:-1!==(i=this.colorPositions.findIndex(e=>e>t))?(this.colors.splice(i,0,e),this.colorPositions.splice(i,0,t)):(this.colors.push(e),this.colorPositions.push(t))}removeColor(e){let t=this.colorPositions.findIndex(t=>t===e);-1!==t&&(this.colors.splice(t,1),this.colorPositions.splice(t,1))}isPositionOccupied(e,t){return!!this.colorPositions.filter(i=>Math.abs(i-e)<=t).length}getPosition(e,t){let i=this.colorPositions.filter(i=>Math.abs(i-e)<=t);return i.length?i[0]:-1}getColorPositionAtIndex(e){return this.colorPositions[e]}getColorAtIndex(e){return this.colors[e]}getColorCount(){return this.colors.length}mirror(){this.colors.slice().splice(0,this.colors.length-1).reverse().forEach(e=>this.colors.push(this.cloneColor(e)));for(let e=0;e<this.colorPositions.length;e++)this.colorPositions[e]=this.colorPositions[e]/2;this.colorPositions.slice().splice(0,this.colorPositions.length-1).reverse().forEach(e=>this.colorPositions.push(1-e))}cloneColor(e){}reverse(){this.colors.reverse(),this.colorPositions.reverse().forEach((e,t,i)=>this.colorPositions[t]=1-e)}setRipple(e){this.ripple=e}getRipple(){return this.ripple}getColorAt(e,t){}toJSON(){let e={};return e.ripple=this.ripple,e.colorsAndPositions=this.colors.map((e,t,i)=>this.mapColor(e,t)),e}mapColor(e,t){}}class Z4BiGradientColor extends Z4AbstractGradientColor{constructor(){super(),this.addColor(new Z4GradientColor,0),this.addColor(new Z4GradientColor,1)}cloneColor(e){return Z4GradientColor.fromJSON(e.toJSON())}gradientMirror(){this.colors.forEach(e=>e.mirror())}gradientReverse(){this.colors.forEach(e=>e.reverse())}setGradientRipple(e){this.colors.forEach(t=>t.setRipple(e))}getGradientRipple(){return this.colors[0].getRipple()}getColorAt(e,t){t&&this.getRipple()&&(e=Z4Math.ripple(e,0,1,this.getRipple()));let i=e,s=this.colorPositions.findIndex(e=>e>=i,null);if(this.colorPositions[s]===e)return this.colors[s];if(this.colorPositions[s-1]===e)return this.colors[s-1];{let a=(e-this.colorPositions[s-1])/(this.colorPositions[s]-this.colorPositions[s-1]),n=this.colors[s-1],r=this.colors[s],o=new Z4GradientColor;return o.setRipple(this.getGradientRipple()),n.colors.forEach((e,t,i)=>{let s=n.colorPositions[t],l=r.getColorAt(s,!1);this.addInGradientColor(o,e,l,a,s)}),r.colors.forEach((e,t,i)=>{let s=r.colorPositions[t];if(-1===o.colorPositions.findIndex(e=>e===s)){let l=n.getColorAt(s,!1);this.addInGradientColor(o,l,e,a,s)}}),o}}addInGradientColor(e,t,i,s,a){e.addColor(new Color(parseInt((i.red-t.red)*s+t.red),parseInt((i.green-t.green)*s+t.green),parseInt((i.blue-t.blue)*s+t.blue),parseInt((i.alpha-t.alpha)*s+t.alpha)),a)}mapColor(e,t){let i={};return i.gradientColor=e.toJSON(),i.position=this.colorPositions[t],i}static fromJSON(e){let t=new Z4BiGradientColor;return t.setRipple(e.ripple),e.colorsAndPositions.forEach(e=>t.addColor(Z4GradientColor.fromJSON(e.gradientColor),e.position)),t}}class Z4GradientColor extends Z4AbstractGradientColor{constructor(){super(),this.addColor(new Color(255,255,255,255),0),this.addColor(new Color(0,0,0,255),1)}cloneColor(e){return new Color(e.red,e.green,e.blue,e.alpha)}getColorAt(e,t){t&&this.getRipple()&&(e=Z4Math.ripple(e,0,1,this.getRipple()));let i=e,s=this.colorPositions.findIndex(e=>e>=i,null);if(this.colorPositions[s]===e)return this.colors[s];if(this.colorPositions[s-1]===e)return this.colors[s-1];{let a=(e-this.colorPositions[s-1])/(this.colorPositions[s]-this.colorPositions[s-1]);return new Color(parseInt((this.colors[s].red-this.colors[s-1].red)*a+this.colors[s-1].red),parseInt((this.colors[s].green-this.colors[s-1].green)*a+this.colors[s-1].green),parseInt((this.colors[s].blue-this.colors[s-1].blue)*a+this.colors[s-1].blue),parseInt((this.colors[s].alpha-this.colors[s-1].alpha)*a+this.colors[s-1].alpha))}}mapColor(e,t){let i={};return i.red=e.red,i.green=e.green,i.blue=e.blue,i.alpha=e.alpha,i.position=this.colorPositions[t],i}mergeOverlapping(e){for(let t=this.colorPositions.length-1;t>0;t--){let i=this.colorPositions[t-1],s=this.colorPositions[t];if(Math.abs(s-i)<=e){let a=(i+s)/2,n=this.getColorAt(a,!1);this.removeColor(i),this.removeColor(s),this.addColor(n,a)}}}static fromJSON(e){let t=new Z4GradientColor;return t.setRipple(e.ripple),e.colorsAndPositions.forEach(e=>t.addColor(new Color(e.red,e.green,e.blue,e.alpha),e.position)),t}}class Z4AbstractGradientColorProgression extends Z4JSONable{lighting=null;constructor(e){super(),this.lighting=e}getLighting(){return this.lighting}toJSON(){let e={};return e.lighting=this.lighting,e}}class Z4GradientColorProgression extends Z4AbstractGradientColorProgression{behavior=null;temporalStepProgression=0;constructor(e,t,i){super(i),this.behavior=e,this.temporalStepProgression=t}getGradientColorProgressionBehavior(){return this.behavior}getTemporalStepProgression(){return this.temporalStepProgression}toJSON(){let e=super.toJSON();return e.behavior=this.behavior,e.temporalStepProgression=this.temporalStepProgression,e}static fromJSON(e){let t=null;switch(""+e.lighting){case"NONE":t=Z4Lighting.NONE;break;case"LIGHTED":t=Z4Lighting.LIGHTED;break;case"DARKENED":t=Z4Lighting.DARKENED;break;default:t=null}switch(""+e.behavior){case"SPATIAL":return new Z4GradientColorProgression(Z4GradientColorProgressionBehavior.SPATIAL,e.temporalStepProgression,t);case"TEMPORAL":return new Z4GradientColorProgression(Z4GradientColorProgressionBehavior.TEMPORAL,e.temporalStepProgression,t);case"RELATIVE_TO_PATH":return new Z4GradientColorProgression(Z4GradientColorProgressionBehavior.RELATIVE_TO_PATH,e.temporalStepProgression,t);case"RANDOM":return new Z4GradientColorProgression(Z4GradientColorProgressionBehavior.RANDOM,e.temporalStepProgression,t);default:return null}}}class Z4SpatioTemporalColor extends Z4JSONable{color=null;gradientColor=null;biGradientColor=null;flatGradientColor=null;constructor(e,t,i){this.color=e,this.gradientColor=t,this.biGradientColor=i,e&&(this.flatGradientColor=new Z4GradientColor,this.flatGradientColor.addColor(this.color,0),this.flatGradientColor.addColor(this.color,1))}static fromColor(e){return new Z4SpatioTemporalColor(e,null,null)}static fromGradientColor(e){return new Z4SpatioTemporalColor(null,e,null)}static fromBiGradientColor(e){return new Z4SpatioTemporalColor(null,null,e)}getColorAt(e,t){return this.color?this.color:this.gradientColor?this.gradientColor.getColorAt(t,!0):this.biGradientColor?this.biGradientColor.getColorAt(e,!0).getColorAt(t,!0):null}getGradientColorAt(e){return this.color?this.flatGradientColor:this.gradientColor?this.gradientColor:this.biGradientColor?this.biGradientColor.getColorAt(e,!0):null}toJSON(){let e={};if(this.color){let t={};t.red=color.red,t.green=color.green,t.blue=color.blue,t.alpha=color.alpha,e.color=t}else this.gradientColor?e.gradientColor=this.gradientColor.toJSON():this.biGradientColor&&(e.biGradientColor=this.biGradientColor.toJSON());return e}static fromJSON(e){if(e.color){let t=e.color;return Z4SpatioTemporalColor.fromColor(new Color(t.red,t.green,t.blue,t.alpha))}return e.gradientColor?Z4SpatioTemporalColor.fromGradientColor(Z4GradientColor.fromJSON(e.gradientColor)):e.biGradientColor?Z4SpatioTemporalColor.fromBiGradientColor(Z4BiGradientColor.fromJSON(e.biGradientColor)):null}}class Z4Nextable extends Z4JSONable{next(){}}class Z4PointIterator extends Z4Nextable{z4DrawingPoint=null;hasNext=!1;drawAction(e,t,i){}next(){}isInfinitePointGenerator(){}getInfinitePointGeneratorSleep(){}}class Z4FancifulValue extends Z4Nextable{constant=null;random=null;uniformSign=!1;constructor(e,t,i){super(),this.constant=e,this.random=t,this.uniformSign=i}getConstant(){return this.constant}getRandom(){return this.random}isUniformSign(){return this.uniformSign}next(){return this.uniformSign?this.constant.getSign().next()*(this.constant.getValue()+this.random.getValue().next()):this.constant.next()+this.random.next()}toJSON(){let e={};return e.constant=this.constant.toJSON(),e.random=this.random.toJSON(),e.uniform=this.uniformSign,e}static fromJSON(e){return new Z4FancifulValue(Z4SignedValue.fromJSON(e.constant),Z4SignedRandomValue.fromJSON(e.random),e.uniform)}}class Z4RandomValue extends Z4Nextable{value=0;behavior=null;length=0;step=0;prevRandom=0;controlRandom=0;nextRandom=0;bezierCurve=null;constructor(e,t,i){super(),this.value=e,this.behavior=t,this.length=i,this.step=1,this.prevRandom=Math.random(),this.controlRandom=1,this.nextRandom=Math.random(),this.behavior===Z4RandomValueBehavior.BEZIER&&this.createBezierCurve()}createBezierCurve(){this.bezierCurve=new Bezier(0,this.prevRandom,this.length/2,this.controlRandom,1,this.nextRandom)}getValue(){return this.value}getRandomValueBehavior(){return this.behavior}getLength(){return this.length}next(){return this.behavior===Z4RandomValueBehavior.CLASSIC?this.value*Math.random():this.behavior===Z4RandomValueBehavior.BEZIER?(this.step>=this.length?(this.step=1,this.prevRandom=this.nextRandom,this.controlRandom=1===this.controlRandom?0:1,this.nextRandom=Math.random(),this.createBezierCurve()):this.step++,this.value*this.bezierCurve.get(this.step/this.length).y):this.behavior===Z4RandomValueBehavior.POLYLINE?(this.step>=this.length?(this.step=1,this.prevRandom=this.nextRandom,this.nextRandom=Math.random()):this.step++,this.value*((this.nextRandom-this.prevRandom)*this.step/this.length+this.prevRandom)):this.behavior===Z4RandomValueBehavior.STEPPED?(this.step>=this.length?(this.step=1,this.prevRandom=Math.random()):this.step++,this.value*this.prevRandom):0}toJSON(){let e={};return e.value=this.value,e.behavior=this.behavior,e.length=this.length,e}static fromJSON(e){switch(""+e.behavior){case"CLASSIC":return new Z4RandomValue(e.value,Z4RandomValueBehavior.CLASSIC,e.length);case"BEZIER":return new Z4RandomValue(e.value,Z4RandomValueBehavior.BEZIER,e.length);case"POLYLINE":return new Z4RandomValue(e.value,Z4RandomValueBehavior.POLYLINE,e.length);case"STEPPED":return new Z4RandomValue(e.value,Z4RandomValueBehavior.STEPPED,e.length);default:return null}}}class Z4Sign extends Z4Nextable{behavior=null;sign=0;constructor(e){super(),this.behavior=e,e===Z4SignBehavior.POSITIVE?this.sign=1:e===Z4SignBehavior.NEGATIVE?this.sign=-1:e===Z4SignBehavior.RANDOM?this.sign=0:e===Z4SignBehavior.ALTERNATE&&(this.sign=-2)}getSignBehavior(){return this.behavior}next(){switch(this.sign){case 1:case -1:return this.sign;case 0:default:return Math.random()>.5?1:-1;case 2:case -2:return this.sign*=-1,this.sign/2}}toJSON(){let e={};return e.behavior=this.behavior,e}static fromJSON(e){switch(""+e.behavior){case"POSITIVE":return new Z4Sign(Z4SignBehavior.POSITIVE);case"NEGATIVE":return new Z4Sign(Z4SignBehavior.NEGATIVE);case"RANDOM":return new Z4Sign(Z4SignBehavior.RANDOM);case"ALTERNATE":return new Z4Sign(Z4SignBehavior.ALTERNATE);default:return null}}}class Z4SignedRandomValue extends Z4Nextable{sign=null;value=null;constructor(e,t){super(),this.sign=e,this.value=t}getSign(){return this.sign}getValue(){return this.value}next(){return this.sign.next()*this.value.next()}toJSON(){let e={};return e.sign=this.sign.toJSON(),e.value=this.value.toJSON(),e}static fromJSON(e){return new Z4SignedRandomValue(Z4Sign.fromJSON(e.sign),Z4RandomValue.fromJSON(e.value))}}class Z4SignedValue extends Z4Nextable{sign=null;value=0;constructor(e,t){super(),this.sign=e,this.value=t}getSign(){return this.sign}getValue(){return this.value}next(){return this.sign.next()*this.value}toJSON(){let e={};return e.sign=this.sign.toJSON(),e.value=this.value,e}static fromJSON(e){return new Z4SignedValue(Z4Sign.fromJSON(e.sign),e.value)}}class Z4DrawingTool extends Z4Nextable{pointIterator=null;painter=null;spatioTemporalColor=null;drawAction(e,t,i){return this.pointIterator.drawAction(e,t,i)}next(){return this.pointIterator.next()}draw(e,t){this.painter.draw(e,t,this.spatioTemporalColor)}isInfinitePointGenerator(){return this.pointIterator.isInfinitePointGenerator()}getInfinitePointGeneratorSleep(){return this.pointIterator.getInfinitePointGeneratorSleep()}toJSON(){let e={};return e.pointIterator=this.pointIterator,e.painter=this.painter,e.spatioTemporalColor=this.spatioTemporalColor,e}}class Z4NextableWithParam extends Z4JSONable{next(e){}}class Z4Rotation extends Z4NextableWithParam{startAngle=0;angle=null;behavior=null;delayed=!1;rotationNext=0;constructor(e,t,i,s){super(),this.startAngle=e,this.delayed=s,this.behavior=i,this.angle=t}getStartAngle(){return this.startAngle}getAngle(){return this.angle}getRotationBehavior(){return this.behavior}isDelayed(){return this.delayed}next(e){let t=Z4Math.deg2rad(this.startAngle+this.angle.next());return this.behavior===Z4RotationBehavior.FIXED?t+(this.delayed?Math.PI:0):this.behavior===Z4RotationBehavior.CUMULATIVE?(this.rotationNext+=t,this.rotationNext+(this.delayed?Math.PI:0)):this.behavior===Z4RotationBehavior.RELATIVE_TO_PATH?t+e+(this.delayed?Math.PI:0):0}toJSON(){let e={};return e.startAngle=this.startAngle,e.angle=this.angle.toJSON(),e.behavior=this.behavior,e.delayed=this.delayed,e}static fromJSON(e){switch(""+e.behavior){case"FIXED":return new Z4Rotation(e.startAngle,Z4FancifulValue.fromJSON(e.angle),Z4RotationBehavior.FIXED,e.delayed);case"CUMULATIVE":return new Z4Rotation(e.startAngle,Z4FancifulValue.fromJSON(e.angle),Z4RotationBehavior.CUMULATIVE,e.delayed);case"RELATIVE_TO_PATH":return new Z4Rotation(e.startAngle,Z4FancifulValue.fromJSON(e.angle),Z4RotationBehavior.RELATIVE_TO_PATH,e.delayed);default:return null}}}class Z4Painter extends Z4JSONable{draw(e,t,i){}}class Z4ArrowPainter extends Z4Painter{module=15;bool=!1;draw(e,t,i){this.bool=!this.bool;let s=t.intensity*(t.useVectorModuleAsSize?t.z4Vector.module:this.module);e.save(),e.lineWidth=3,e.strokeStyle=Z4Constants.getStyle("black"),e.beginPath(),e.arc(0,0,2,0,Z4Math.TWO_PI),e.stroke(),e.beginPath(),e.moveTo(0,0),e.lineTo(s,0),e.lineTo(s-5,-2.5),e.lineTo(s-5,2.5),e.lineTo(s,0),e.stroke(),e.restore()}toJSON(){return{}}}class Z4Layer{offscreen=null;offscreenCtx=null;blob=null;name=null;offsetX=0;offsetY=0;opacity=1;compositeOperation="source-over";width=0;height=0;hidden=!1;constructor(e,t,i,s,a,n){if(this.name=e,this.offscreen=new OffscreenCanvas(t,i),this.offscreenCtx=this.offscreen.getContext("2d"),s instanceof Color)this.offscreenCtx.fillStyle=Z4Constants.getStyle(s.getRGBA_HEX()),this.offscreenCtx.fillRect(0,0,t,i);else if(s instanceof Z4AbstractFiller){let r=this.offscreenCtx.createImageData(t,i);s.fill(r),this.offscreenCtx.putImageData(r,0,0)}else if(s instanceof Z4BiGradientColor){let o=this.offscreenCtx.createImageData(t,i),l=o.data;for(let h=0;h<i;h++){let d=s.getColorAt(h/i,!0);for(let c=0;c<t;c++){let g=d.getColorAt(c/t,!0),u=(h*t+c)*4;l[u]=g.red,l[u+1]=g.green,l[u+2]=g.blue,l[u+3]=g.alpha}}this.offscreenCtx.putImageData(o,0,0)}this.offsetX=(a-t)/2,this.offsetY=(n-i)/2,this.width=t,this.height=i}static fromImage(e,t,i,s){let a=new Z4Layer(e,t.width,t.height,new Color(0,0,0,0),i,s);return a.offscreenCtx.drawImage(t,0,0),a}convertToBlob(e){if(this.blob)e(this.blob);else{let t={};t.type="image/png",this.offscreen.convertToBlob(t).then(t=>{this.blob=t,e(this.blob)})}}shift(e,t){this.offsetX+=e,this.offsetY+=t}setOpacity(e){this.opacity=e}getOpacity(){return this.opacity}setCompositeOperation(e){this.compositeOperation=e}getCompositeOperation(){return this.compositeOperation}setHidden(e){this.hidden=e}isHidden(){return this.hidden}move(e,t){this.offsetX=e,this.offsetY=t}setName(e){this.name=e}getName(){return this.name}getOffset(){return new Point(this.offsetX,this.offsetY)}getSize(){return new Dimension(this.width,this.height)}draw(e,t,i){(i||!this.hidden)&&(e.save(),e.globalAlpha=this.opacity,e.globalCompositeOperation=this.compositeOperation,e.drawImage(this.offscreen,t?0:this.offsetX,t?0:this.offsetY),e.restore())}drawTool(e,t){this.offscreenCtx.save(),this.offscreenCtx.translate(t.z4Vector.x0-this.offsetX,t.z4Vector.y0-this.offsetY),this.offscreenCtx.rotate(t.z4Vector.phase),e.draw(this.offscreenCtx,t),this.offscreenCtx.restore()}flipHorizonal(){let e=this.offscreenCtx.getImageData(0,0,this.width,this.height),t=e.data;for(let i=0;i<this.height;i++)for(let s=0;s<this.width/2;s++){let a=(i*this.width+s)*4,n=(i*this.width+this.width-1-s)*4;this.flipValue(t,a,n)}this.offscreenCtx.putImageData(e,0,0),this.blob=null}flipVertical(){let e=this.offscreenCtx.getImageData(0,0,this.width,this.height),t=e.data;for(let i=0;i<this.height/2;i++)for(let s=0;s<this.width;s++){let a=(i*this.width+s)*4,n=((this.height-1-i)*this.width+s)*4;this.flipValue(t,a,n)}this.offscreenCtx.putImageData(e,0,0),this.blob=null}flipValue(e,t,i){let s=e[t],a=e[t+1],n=e[t+2],r=e[t+3];e[t]=e[i],e[t+1]=e[i+1],e[t+2]=e[i+2],e[t+3]=e[i+3],e[i]=s,e[i+1]=a,e[i+2]=n,e[i+3]=r}rotatePlus90(){let e=new OffscreenCanvas(this.height,this.width),t=e.getContext("2d"),i=this.offscreenCtx.getImageData(0,0,this.width,this.height).data,s=t.createImageData(this.height,this.width),a=s.data;for(let n=0;n<this.height;n++)for(let r=0;r<this.width;r++){let o=(n*this.width+r)*4,l=(r*this.height+this.height-1-n)*4;a[l]=i[o],a[l+1]=i[o+1],a[l+2]=i[o+2],a[l+3]=i[o+3]}t.putImageData(s,0,0),this.offscreen=e,this.offscreenCtx=t,this.offsetX=0,this.offsetY=0;let h=this.width;this.width=this.height,this.height=h,this.blob=null}}class Z4Paper{layers=[];getLayersCount(){return this.layers.length}getLayerAt(e){return this.layers[e]}addLayer(e,t,i,s,a,n){this.layers.push(new Z4Layer(e,t,i,s,a,n))}addLayerFromImage(e,t,i,s){this.layers.push(Z4Layer.fromImage(e,t,i,s))}deleteLayer(e){let t=this.layers.indexOf(e);return this.layers.splice(t,1),t}moveLayer(e,t){let i=Math.min(this.layers.length,t),s=this.layers.indexOf(e);return i<s?(this.layers.splice(i,0,this.layers.splice(s,1)[0]),!0):i>s&&(this.layers.splice(i,0,this.layers[s]),this.layers.splice(s,1),!0)}reset(){this.layers.length=0}draw(e,t,i){this.layers.forEach(s=>s.draw(e,t,i))}}class Z4Translations{static CURRENT_LANGUAGE=null;static DEPENDENCIES="<a href='https://repository.jsweet.org/artifactory/libs-release-local/org/jsweet/jsweet-core' target='_blank'>jsweet-core</a>, <a href='https://github.com/gianpierodiblasi/swing.js' target='_blank'>swing.js</a>, <a href='https://pomax.github.io/bezierjs' target='_blank'>Bezier.js</a>, <a href='https://stuk.github.io/jszip' target='_blank'>JSZip</a>, <a href='https://github.com/eligrey/FileSaver.js' target='_blank'>FileSaver.js</a>.";static FILE="";static NEW_PROJECT="";static CREATE="";static FROM_CLIPBOARD="";static FROM_FILE="";static OPEN="";static OPEN_PROJECT="";static SAVE="";static SAVE_PROJECT="";static SAVE_PROJECT_AS="";static EXPORT="";static PROJECT_NOT_SAVED_MESSAGE="";static IMAGE_FILE="";static PIZZAPAZZA_PROJECT="";static LAYER="";static LAYER_NAME="";static NEW_LAYER="";static BACKGROUND_LAYER="";static DELETE_LAYER_MESSAGE="";static MERGE_VISIBLE_LAYERS="";static MERGE_ALL_LAYERS="";static HISTORY="";static UNDO="";static REDO="";static CONSOLIDATE="";static CONSOLIDATE_MESSAGE="";static SETTINGS="";static LANGUAGE="";static LANGUAGE_ENGLISH_NATIVE="";static LANGUAGE_ITALIAN_NATIVE="";static THEME="";static THEME_AUTO="";static THEME_LIGHT="";static THEME_DARK="";static THEME_COLOR="";static HISTORY_MANAGEMENT="";static STANDARD_POLICY="";static STANDARD_POLICY_DESCRIPTION="";static TIMER_POLICY="";static TIMER_POLICY_DESCRIPTION="";static MANUAL_POLICY="";static MANUAL_POLICY_DESCRIPTION="";static TOOL_POLICY="";static TOOL_POLICY_DESCRIPTION="";static SAVING_INTERVAL="";static SAVING_DELAY="";static REFRESH_PAGE_MESSAGE="";static HELP="";static ABOUT="";static BASED_ON="";static INSTALL="";static CHECK_UPDATE="";static PROJECT_NAME="";static FILENAME="";static QUALITY="";static RESET="";static WIDTH="";static HEIGHT="";static RESOLUTION="";static PATTERN="";static EDIT="";static FIT="";static OFFSET_X="";static OFFSET_Y="";static BASIC="";static ADVANCED="";static STAR="";static VERTICES="";static REGULAR="";static DIMENSION="";static FREE="";static LOCK_RATIO="";static LOCK="";static RIPPLE="";static DELETE="";static DUPLICATE="";static TRANSFORM="";static FLIP_HORIZONTAL="";static FLIP_VERTICAL="";static ROTATE_PLUS_90="";static ROTATE_MINUS_90="";static ROTATE_180="";static SPACE="";static TIME="";static FILLING="";static MERGE="";static NONE_HIM="";static NONE_HER="";static COLOR="";static FILLING_COLOR="";static BACKGROUND_COLOR="";static MIRRORED="";static INVERTED="";static DELETE_COLOR_MESSAGE="";static LIGHTED="";static DARKENED="";static SPATIAL="";static TEMPORAL="";static LIGHTING="";static POSITIVE="";static NEGATIVE="";static ALTERNATE="";static CONSTANT="";static RANDOM="";static CLASSIC="";static STEPPED="";static POLYLINE="";static BEZIER="";static LENGTH="";static UNIFORM_SIGN="";static FIXED="";static VARIABLE="";static CUMULATIVE="";static RELATIVE_TO_PATH="";static DELAYED="";static STEP="";static COMPOSITE_OPERATION="";static COMPOSITE_OPERATION_SOURCE_OVER="";static COMPOSITE_OPERATION_SOURCE_IN="";static COMPOSITE_OPERATION_SOURCE_OUT="";static COMPOSITE_OPERATION_SOURCE_ATOP="";static COMPOSITE_OPERATION_DESTINATION_OVER="";static COMPOSITE_OPERATION_DESTINATION_IN="";static COMPOSITE_OPERATION_DESTINATION_OUT="";static COMPOSITE_OPERATION_DESTINATION_ATOP="";static COMPOSITE_OPERATION_LIGHTER="";static COMPOSITE_OPERATION_COPY="";static COMPOSITE_OPERATION_XOR="";static COMPOSITE_OPERATION_MULTIPLY="";static COMPOSITE_OPERATION_SCREEN="";static COMPOSITE_OPERATION_OVERLAY="";static COMPOSITE_OPERATION_DARKEN="";static COMPOSITE_OPERATION_LIGHTEN="";static COMPOSITE_OPERATION_COLOR_DODGE="";static COMPOSITE_OPERATION_COLOR_BURN="";static COMPOSITE_OPERATION_HARD_LIGHT="";static COMPOSITE_OPERATION_SOFT_LIGHT="";static COMPOSITE_OPERATION_DIFFERENCE="";static COMPOSITE_OPERATION_EXCLUSION="";static COMPOSITE_OPERATION_HUE="";static COMPOSITE_OPERATION_SATURATION="";static COMPOSITE_OPERATION_COLOR="";static COMPOSITE_OPERATION_LUMINOSITY="";static{switch(navigator.language.substring(0,2)){case"en":default:Z4Translations.setEnglish();break;case"it":Z4Translations.setItalian()}}constructor(){}static setEnglish(){Z4Translations.FILE="File",Z4Translations.NEW_PROJECT="New Project",Z4Translations.CREATE="Create",Z4Translations.FROM_CLIPBOARD="From Clipboard",Z4Translations.FROM_FILE="From File",Z4Translations.OPEN="Open",Z4Translations.OPEN_PROJECT="Open Project",Z4Translations.SAVE="Save",Z4Translations.SAVE_PROJECT="Save Project",Z4Translations.SAVE_PROJECT="Save Project As",Z4Translations.EXPORT="Export",Z4Translations.PROJECT_NOT_SAVED_MESSAGE="Project not saved, do you want to save your changes?",Z4Translations.IMAGE_FILE="Image File",Z4Translations.PIZZAPAZZA_PROJECT="pizzApazzA Project",Z4Translations.LAYER="Layer",Z4Translations.LAYER_NAME="Layer Name",Z4Translations.NEW_LAYER="New Layer",Z4Translations.BACKGROUND_LAYER="Bkgrd",Z4Translations.DELETE_LAYER_MESSAGE="Do you really want to delete the layer?",Z4Translations.MERGE_VISIBLE_LAYERS="Merge Visible Layers",Z4Translations.MERGE_ALL_LAYERS="Merge All Layers",Z4Translations.HISTORY="History",Z4Translations.UNDO="Undo",Z4Translations.REDO="Redo",Z4Translations.CONSOLIDATE="Consolidate",Z4Translations.CONSOLIDATE_MESSAGE="Consolidation will remove all history, do you want to proceed?",Z4Translations.SETTINGS="Settings",Z4Translations.LANGUAGE="Language",Z4Translations.LANGUAGE_ENGLISH_NATIVE="English",Z4Translations.LANGUAGE_ITALIAN_NATIVE="Italiano",Z4Translations.THEME="Theme",Z4Translations.THEME_AUTO="Auto",Z4Translations.THEME_LIGHT="Light",Z4Translations.THEME_DARK="Dark",Z4Translations.THEME_COLOR="Color",Z4Translations.HISTORY_MANAGEMENT="History Management",Z4Translations.STANDARD_POLICY="Standard",Z4Translations.STANDARD_POLICY_DESCRIPTION='The history is updated at each conclusion of a drawing operation and at each "global" operation on the drawing',Z4Translations.TIMER_POLICY="Time Based",Z4Translations.TIMER_POLICY_DESCRIPTION="The history is updated at regular intervals (only if the drawing has been modified)",Z4Translations.MANUAL_POLICY="Manual",Z4Translations.MANUAL_POLICY_DESCRIPTION="The history is manually updated (only if the drawing has been modified)",Z4Translations.TOOL_POLICY="On Drawing Tool Change",Z4Translations.TOOL_POLICY_DESCRIPTION='The history is updated when the drawing tool is changed (only if the drawing has been modified) and at each "global" operation on the drawing',Z4Translations.SAVING_INTERVAL="Saving Interval",Z4Translations.SAVING_DELAY="Saving Delay",Z4Translations.REFRESH_PAGE_MESSAGE="Refresh the page to make the changes",Z4Translations.HELP="Help",Z4Translations.ABOUT="About",Z4Translations.BASED_ON="<p>pizzApazzA<sup>&#8734;</sup> Version $version$ is based on pizzApazzA VB6 by Ettore Luzio and is licensed under <a href='https://unlicense.org/'>Unlicense license</a>.</p><p>Developed in Java by Gianpiero Di Blasi, transpilled in JavaScript by means of <a href='https://github.com/gianpierodiblasi/josetta' target='_blank'>Josetta</a> (<a href='https://github.com/gianpierodiblasi/pizzApazzAinfinity' target='_blank'>github repository</a>).</p><p>Ettore Luzio and Gianpiero Di Blasi are the founders of <a href='https://sites.google.com/view/gruppoz4/home'>GruppoZ4</a>.</p><p>Dependencies: "+Z4Translations.DEPENDENCIES+"</p>",Z4Translations.INSTALL="<span>Install pizzApazzA<sup>&#8734;</sup></span>",Z4Translations.CHECK_UPDATE="Check for Updates",Z4Translations.PROJECT_NAME="Project Name",Z4Translations.FILENAME="File Name",Z4Translations.QUALITY="Quality",Z4Translations.RESET="Reset",Z4Translations.WIDTH="Width",Z4Translations.HEIGHT="Height",Z4Translations.RESOLUTION="Resolution",Z4Translations.PATTERN="Pattern",Z4Translations.EDIT="Edit",Z4Translations.FIT="Fit",Z4Translations.OFFSET_X="Offset X",Z4Translations.OFFSET_Y="Offset Y",Z4Translations.BASIC="Basic",Z4Translations.ADVANCED="Advanced",Z4Translations.STAR="Star",Z4Translations.VERTICES="Vertices",Z4Translations.REGULAR="Regular",Z4Translations.DIMENSION="Dimension",Z4Translations.FREE="Free",Z4Translations.LOCK_RATIO="Lock Ratio",Z4Translations.LOCK="Lock",Z4Translations.RIPPLE="Ripple",Z4Translations.DELETE="Delete",Z4Translations.DUPLICATE="Duplicate",Z4Translations.TRANSFORM="Transform",Z4Translations.FLIP_HORIZONTAL="Flip Horizontal",Z4Translations.FLIP_VERTICAL="Flip Vertical",Z4Translations.ROTATE_PLUS_90="Rotate +90\xb0",Z4Translations.ROTATE_MINUS_90="Rotate -90\xb0",Z4Translations.ROTATE_180="Rotate 180\xb0",Z4Translations.SPACE="Space →",Z4Translations.TIME="← Time",Z4Translations.FILLING="Filling",Z4Translations.MERGE="Merge",Z4Translations.NONE_HIM="None",Z4Translations.NONE_HER="None",Z4Translations.COLOR="Color",Z4Translations.FILLING_COLOR="Filling Color",Z4Translations.BACKGROUND_COLOR="Background Color",Z4Translations.MIRRORED="Mirrored",Z4Translations.INVERTED="Inverted",Z4Translations.DELETE_COLOR_MESSAGE="Do you really want to delete the color?",Z4Translations.LIGHTED="Lighted",Z4Translations.DARKENED="Darkened",Z4Translations.SPATIAL="Spatial",Z4Translations.TEMPORAL="Temporal",Z4Translations.LIGHTING="Lighting",Z4Translations.POSITIVE="Positive",Z4Translations.NEGATIVE="Negative",Z4Translations.ALTERNATE="Alternate",Z4Translations.CONSTANT="Constant",Z4Translations.RANDOM="Random",Z4Translations.CLASSIC="Classic",Z4Translations.STEPPED="Stepped",Z4Translations.POLYLINE="Polyline",Z4Translations.BEZIER="Bezier",Z4Translations.LENGTH="Length",Z4Translations.UNIFORM_SIGN="Uniform Sign",Z4Translations.FIXED="Fixed",Z4Translations.VARIABLE="Variable",Z4Translations.CUMULATIVE="Cumulative",Z4Translations.RELATIVE_TO_PATH="Relative to Path",Z4Translations.DELAYED="Delayed",Z4Translations.STEP="Step",Z4Translations.COMPOSITE_OPERATION="Composite Operation",Z4Translations.COMPOSITE_OPERATION_SOURCE_OVER="This is the default setting and draws the layer on top of the existing content",Z4Translations.COMPOSITE_OPERATION_SOURCE_IN="The layer is drawn only where both the layer and the destination content overlap; everything else is made transparent",Z4Translations.COMPOSITE_OPERATION_SOURCE_OUT="The layer is drawn where it doesn't overlap the existing content",Z4Translations.COMPOSITE_OPERATION_SOURCE_ATOP="The layer is only drawn where it overlaps the existing content",Z4Translations.COMPOSITE_OPERATION_DESTINATION_OVER="The layer is drawn behind the existing content",Z4Translations.COMPOSITE_OPERATION_DESTINATION_IN="The existing content is kept where both the layer and existing content overlap; everything else is made transparent",Z4Translations.COMPOSITE_OPERATION_DESTINATION_OUT="The existing content is kept where it doesn't overlap the layer",Z4Translations.COMPOSITE_OPERATION_DESTINATION_ATOP="The existing content is only kept where it overlaps the layer; the layer is drawn behind the content",Z4Translations.COMPOSITE_OPERATION_LIGHTER="Where both layer and existing content overlap the color is determined by adding color values",Z4Translations.COMPOSITE_OPERATION_COPY="Only the layer is shown",Z4Translations.COMPOSITE_OPERATION_XOR="Layer and existing content are made transparent where both overlap and drawn normal everywhere else",Z4Translations.COMPOSITE_OPERATION_MULTIPLY="The pixels of the layer are multiplied with the corresponding pixel of the existing content; a darker picture is the result",Z4Translations.COMPOSITE_OPERATION_SCREEN="The pixels are inverted, multiplied, and inverted again; a lighter picture is the result (opposite of 'multiply')",Z4Translations.COMPOSITE_OPERATION_OVERLAY="A combination of 'multiply' and 'screen'; dark parts on the existing content become darker, and light parts become lighter",Z4Translations.COMPOSITE_OPERATION_DARKEN="Retains the darkest pixels of both layer and existing content",Z4Translations.COMPOSITE_OPERATION_LIGHTEN="Retains the lightest pixels of both layer and existing content",Z4Translations.COMPOSITE_OPERATION_COLOR_DODGE="Divides the existing content by the inverted layer",Z4Translations.COMPOSITE_OPERATION_COLOR_BURN="Divides the inverted existing content by the layer, and then inverts the result",Z4Translations.COMPOSITE_OPERATION_HARD_LIGHT="A combination of 'multiply' and 'screen' like 'overlay', but with layer and existing content swapped",Z4Translations.COMPOSITE_OPERATION_SOFT_LIGHT="A softer version of 'hard-light'; pure black or white does not result in pure black or white",Z4Translations.COMPOSITE_OPERATION_DIFFERENCE="Subtracts the existing content from the layer or the other way round to always get a positive value",Z4Translations.COMPOSITE_OPERATION_EXCLUSION="Like 'difference', but with lower contrast",Z4Translations.COMPOSITE_OPERATION_HUE="Preserves the luma and chroma of the existing content, while adopting the hue of the layer",Z4Translations.COMPOSITE_OPERATION_SATURATION="Preserves the luma and hue of the existing content, while adopting the chroma of the layer",Z4Translations.COMPOSITE_OPERATION_COLOR="Preserves the luma of the existing content, while adopting the hue and chroma of the layer",Z4Translations.COMPOSITE_OPERATION_LUMINOSITY="Preserves the hue and chroma of the existing content, while adopting the luma of the layer",Z4Translations.CURRENT_LANGUAGE=new KeyValue("en",Z4Translations.LANGUAGE_ENGLISH_NATIVE)}static setItalian(){Z4Translations.FILE="File",Z4Translations.NEW_PROJECT="Nuovo Progetto",Z4Translations.CREATE="Crea",Z4Translations.FROM_CLIPBOARD="Dagli Appunti",Z4Translations.FROM_FILE="Da File",Z4Translations.OPEN="Apri",Z4Translations.OPEN_PROJECT="Apri Progetto",Z4Translations.SAVE="Salva",Z4Translations.SAVE_PROJECT="Salva Progetto",Z4Translations.SAVE_PROJECT_AS="Salva Progetto con Nome",Z4Translations.EXPORT="Esporta",Z4Translations.PROJECT_NOT_SAVED_MESSAGE="Progetto non salvato, vuoi salvare le modifiche?",Z4Translations.IMAGE_FILE="File Immagine",Z4Translations.PIZZAPAZZA_PROJECT="Progetto pizzApazzA",Z4Translations.LAYER="Livello",Z4Translations.LAYER_NAME="Nome Livello",Z4Translations.NEW_LAYER="Nuovo Livello",Z4Translations.BACKGROUND_LAYER="Sfondo",Z4Translations.DELETE_LAYER_MESSAGE="Vuoi davvero eliminare il livello?",Z4Translations.MERGE_VISIBLE_LAYERS="Fondi Livelli Visibili",Z4Translations.MERGE_ALL_LAYERS="Fondi Tutti i Livelli",Z4Translations.HISTORY="Cronologia",Z4Translations.UNDO="Annulla",Z4Translations.REDO="Ripeti",Z4Translations.CONSOLIDATE="Consolida",Z4Translations.CONSOLIDATE_MESSAGE="La consolidazione rimuover\xe0 tutta la cronologia, vuoi proseguire?",Z4Translations.SETTINGS="Impostazioni",Z4Translations.LANGUAGE="Lingua",Z4Translations.LANGUAGE_ENGLISH_NATIVE="English",Z4Translations.LANGUAGE_ITALIAN_NATIVE="Italiano",Z4Translations.THEME="Tema",Z4Translations.THEME_AUTO="Auto",Z4Translations.THEME_LIGHT="Chiaro",Z4Translations.THEME_DARK="Scuro",Z4Translations.THEME_COLOR="Colore",Z4Translations.HISTORY_MANAGEMENT="Gestione Cronologia",Z4Translations.STANDARD_POLICY="Standard",Z4Translations.STANDARD_POLICY_DESCRIPTION='La cronologia viene aggiornata ad ogni conclusione di un\'operazione di disegno ed ad ogni operazione "globale" sul disegno',Z4Translations.TIMER_POLICY="A Tempo",Z4Translations.TIMER_POLICY_DESCRIPTION="La cronologia viene aggiornata ad intervalli regolari (solo se il disegno \xe8 stato modificato)",Z4Translations.MANUAL_POLICY="Manuale",Z4Translations.MANUAL_POLICY_DESCRIPTION="La cronologia viene aggiornata manualmente (solo se il disegno \xe8 stato modificato)",Z4Translations.TOOL_POLICY="Su Cambio Strumento di Disegno",Z4Translations.TOOL_POLICY_DESCRIPTION='La cronologia viene aggiornata quando viene cambiato lo strumento di disegno (solo se il disegno \xe8 stato modificato) ed ad ogni operazione "globale" sul disegno',Z4Translations.SAVING_INTERVAL="Intervallo di Salvataggio",Z4Translations.SAVING_DELAY="Ritardo di Salvataggio",Z4Translations.REFRESH_PAGE_MESSAGE="Aggiorna la pagina per eseguire le modifiche",Z4Translations.HELP="Aiuto",Z4Translations.ABOUT="Informazioni su",Z4Translations.BASED_ON="<p>pizzApazzA<sup>&#8734;</sup> Versione $version$ \xe8 basato su pizzApazzA VB6 di Ettore Luzio ed \xe8 distribuito con <a href='https://unlicense.org/' target='_blank'>licenza Unlicense</a>.</p><p>Sviluppato in Java da Gianpiero Di Blasi, tradotto in JavaScript tramite <a href='https://github.com/gianpierodiblasi/josetta' target='_blank'>Josetta</a> (<a href='https://github.com/gianpierodiblasi/pizzApazzAinfinity' target='_blank'>repository github</a>).</p><p>Ettore Luzio e Gianpiero Di Blasi sono i fondatori del <a href='https://sites.google.com/view/gruppoz4/home'>GruppoZ4</a>.</p><p>Dipendenze: "+Z4Translations.DEPENDENCIES+"</p>",Z4Translations.INSTALL="<span>Installa pizzApazzA<sup>&#8734;</sup></span>",Z4Translations.CHECK_UPDATE="Controlla gli Aggiornamenti",Z4Translations.PROJECT_NAME="Nome Progetto",Z4Translations.FILENAME="Nome File",Z4Translations.QUALITY="Qualit\xe0",Z4Translations.RESET="Ripristina",Z4Translations.WIDTH="Larghezza",Z4Translations.HEIGHT="Altezza",Z4Translations.RESOLUTION="Risoluzione",Z4Translations.PATTERN="Trama",Z4Translations.EDIT="Modifica",Z4Translations.FIT="Adatta",Z4Translations.OFFSET_X="Offset X",Z4Translations.OFFSET_Y="Offset Y",Z4Translations.BASIC="Base",Z4Translations.ADVANCED="Avanzato",Z4Translations.STAR="Stella",Z4Translations.VERTICES="Vertici",Z4Translations.REGULAR="Regolare",Z4Translations.DIMENSION="Dimensione",Z4Translations.FREE="Libero",Z4Translations.LOCK_RATIO="Blocca Rapporto",Z4Translations.LOCK="Blocca",Z4Translations.RIPPLE="Caoticit\xe0",Z4Translations.DELETE="Elimina",Z4Translations.DUPLICATE="Duplica",Z4Translations.TRANSFORM="Trasforma",Z4Translations.FLIP_HORIZONTAL="Rifletti Orizzontale",Z4Translations.FLIP_VERTICAL="Rifletti Verticale",Z4Translations.ROTATE_PLUS_90="Ruota +90\xb0",Z4Translations.ROTATE_MINUS_90="Ruota -90\xb0",Z4Translations.ROTATE_180="Ruota 180\xb0",Z4Translations.SPACE="Spazio →",Z4Translations.TIME="← Tempo",Z4Translations.FILLING="Riempimento",Z4Translations.MERGE="Fondi",Z4Translations.NONE_HIM="Nessuno",Z4Translations.NONE_HER="Nessuna",Z4Translations.COLOR="Colore",Z4Translations.FILLING_COLOR="Colore di Riempimento",Z4Translations.BACKGROUND_COLOR="Colore di Sfondo",Z4Translations.MIRRORED="Riflesso",Z4Translations.INVERTED="Invertito",Z4Translations.DELETE_COLOR_MESSAGE="Vuoi davvero eliminare il colore?",Z4Translations.LIGHTED="Illuminato",Z4Translations.DARKENED="Incupito",Z4Translations.SPATIAL="Spaziale",Z4Translations.TEMPORAL="Temporale",Z4Translations.LIGHTING="Illuminazione",Z4Translations.POSITIVE="Positivo",Z4Translations.NEGATIVE="Negativo",Z4Translations.ALTERNATE="Alternato",Z4Translations.CONSTANT="Costante",Z4Translations.RANDOM="Random",Z4Translations.CLASSIC="Classico",Z4Translations.STEPPED="A Gradino",Z4Translations.POLYLINE="Polilinea",Z4Translations.BEZIER="Bezier",Z4Translations.LENGTH="Lunghezza",Z4Translations.UNIFORM_SIGN="Segno Uniforme",Z4Translations.FIXED="Fisso",Z4Translations.VARIABLE="Variabile",Z4Translations.CUMULATIVE="Cumulativo",Z4Translations.RELATIVE_TO_PATH="Relativo al Percorso",Z4Translations.DELAYED="Ritardato",Z4Translations.STEP="Passo",Z4Translations.COMPOSITE_OPERATION="Operazione Composita",Z4Translations.COMPOSITE_OPERATION_SOURCE_OVER="Questa \xe8 l'impostazione predefinita e disegna il livello sopra il contenuto esistente",Z4Translations.COMPOSITE_OPERATION_SOURCE_IN="Il livello viene disegnato solo dove si sovrappongono sia il livello che il contenuto di destinazione; tutto il resto \xe8 reso trasparente",Z4Translations.COMPOSITE_OPERATION_SOURCE_OUT="Il livello viene disegnato dove non si sovrappone al contenuto esistente",Z4Translations.COMPOSITE_OPERATION_SOURCE_ATOP="Il livello viene disegnato solo dove si sovrappone al contenuto esistente",Z4Translations.COMPOSITE_OPERATION_DESTINATION_OVER="Il livello viene disegnato dietro il contenuto esistente",Z4Translations.COMPOSITE_OPERATION_DESTINATION_IN="Il contenuto esistente viene mantenuto dove sia il livello che il contenuto esistente si sovrappongono; tutto il resto \xe8 reso trasparente",Z4Translations.COMPOSITE_OPERATION_DESTINATION_OUT="Il contenuto esistente viene mantenuto dove non si sovrappone al livello",Z4Translations.COMPOSITE_OPERATION_DESTINATION_ATOP="Il contenuto esistente viene mantenuto solo dove si sovrappone al livello; il livello viene disegnato dietro il contenuto",Z4Translations.COMPOSITE_OPERATION_LIGHTER="Laddove sia il livello che il contenuto esistente si sovrappongono, il colore viene determinato sommando i colori",Z4Translations.COMPOSITE_OPERATION_COPY="Viene mostrato solo il livello",Z4Translations.COMPOSITE_OPERATION_XOR="Il livello e il contenuto esistente vengono resi trasparenti laddove entrambi si sovrappongono e vengono disegnati normali altrove",Z4Translations.COMPOSITE_OPERATION_MULTIPLY="I pixel del layer vengono moltiplicati per il pixel corrispondente del contenuto esistente; il risultato \xe8 un'immagine pi\xf9 scura",Z4Translations.COMPOSITE_OPERATION_SCREEN="I pixel vengono invertiti, moltiplicati e nuovamente invertiti; il risultato \xe8 un'immagine pi\xf9 chiara (opposto di 'multiply')",Z4Translations.COMPOSITE_OPERATION_OVERLAY="Una combinazione di 'multiply' e 'screen'; le parti scure del contenuto esistente diventano pi\xf9 scure e le parti chiare diventano pi\xf9 chiare",Z4Translations.COMPOSITE_OPERATION_DARKEN="Mantiene i pixel pi\xf9 scuri sia del livello che del contenuto esistente",Z4Translations.COMPOSITE_OPERATION_LIGHTEN="Mantiene i pixel pi\xf9 chiari sia del livello che del contenuto esistente",Z4Translations.COMPOSITE_OPERATION_COLOR_DODGE="Divide il contenuto esistente per il livello invertito",Z4Translations.COMPOSITE_OPERATION_COLOR_BURN="Divide il contenuto esistente invertito per il livello, quindi inverte il risultato",Z4Translations.COMPOSITE_OPERATION_HARD_LIGHT="Una combinazione di 'multiply' e 'screen' come 'overlay', ma con il livello e il contenuto esistente scambiati",Z4Translations.COMPOSITE_OPERATION_SOFT_LIGHT="Una versione pi\xf9 morbida della 'hard-light'; il nero o il bianco puro non risultano in bianco o nero puro",Z4Translations.COMPOSITE_OPERATION_DIFFERENCE="Sottrae il contenuto esistente dal livello o viceversa per ottenere sempre un valore positivo",Z4Translations.COMPOSITE_OPERATION_EXCLUSION="Come 'difference', ma con contrasto inferiore",Z4Translations.COMPOSITE_OPERATION_HUE="Preserva la luminanza e la crominanza del contenuto esistente, adottando la tonalit\xe0 del livello",Z4Translations.COMPOSITE_OPERATION_SATURATION="Preserva la luminanza e la tonalit\xe0 del contenuto esistente, adottando la crominanza del livello",Z4Translations.COMPOSITE_OPERATION_COLOR="Preserva la luminanza del contenuto esistente, adottando la tonalit\xe0 e la saturazione del livello",Z4Translations.COMPOSITE_OPERATION_LUMINOSITY="Preserva la tonalit\xe0 e il croma del contenuto esistente, adottando la luminanza del livello",Z4Translations.CURRENT_LANGUAGE=new KeyValue("it",Z4Translations.LANGUAGE_ITALIAN_NATIVE)}}class Z4UI{static PLEASE_WAIT=new JSPanel;static PROGRESS_BAR=new JSProgressBar;static{Z4UI.PLEASE_WAIT.cssAddClass("please-wait"),Z4UI.PLEASE_WAIT.setLayout(new GridBagLayout),Z4UI.PLEASE_WAIT.add(Z4UI.PROGRESS_BAR,new GBC(0,0).wx(1).f(GBC.HORIZONTAL).i(0,25,0,25)),Z4UI.PROGRESS_BAR.getStyle().display="none"}static pleaseWait(e,t,i,s,a,n,r){Z4UI.PROGRESS_BAR.getStyle().display=i?"grid":"none",i?(Z4UI.PROGRESS_BAR.setIndeterminate(s),Z4UI.PROGRESS_BAR.setStringPainted(a),Z4UI.PROGRESS_BAR.setValue(0),Z4UI.PROGRESS_BAR.setString(n)):(Z4UI.PROGRESS_BAR.setIndeterminate(!1),Z4UI.PROGRESS_BAR.setStringPainted(!1),Z4UI.PROGRESS_BAR.setValue(0),Z4UI.PROGRESS_BAR.setString(""));let o=Color.fromRGB_HEX(window.getComputedStyle(document.body).getPropertyValue("--main-action-bgcolor"));Z4UI.PLEASE_WAIT.getStyle().background=new Color(o.red,o.green,o.blue,64).getRGBA_HEX(),Z4UI.PLEASE_WAIT.appendInBody(),Z4UI.PLEASE_WAIT.cssAddClass("please-wait-visible"),e.cssAddClass("please-wait-request");let l=document.querySelector(".jsdialog:has(.please-wait-request)");l||(l=document.querySelector(".jsframe:has(.please-wait-request)")),l.appendChild(document.querySelector(".please-wait")),e.cssRemoveClass("please-wait-request"),setTimeout(()=>{r(),t||Z4UI.pleaseWaitCompleted()},0)}static pleaseWaitAdvanced(e){setTimeout(()=>e(),0)}static pleaseWaitCompleted(){Z4UI.PLEASE_WAIT.cssRemoveClass("please-wait-visible")}static setPleaseWaitProgressBarValue(e){Z4UI.PROGRESS_BAR.setValue(e)}static setPleaseWaitProgressBarString(e){Z4UI.PROGRESS_BAR.setString(e)}static addLabel(e,t,i){let s=new JSLabel;return s.setText(t),e.add(s,i),s}static addVLine(e,t){let i=new JSComponent(document.createElement("div"));return i.getStyle().width="1px",i.getStyle().background="var(--main-action-bgcolor)",e.add(i,t),i}static addHLine(e,t){let i=new JSComponent(document.createElement("div"));return i.getStyle().height="1px",i.getStyle().background="var(--main-action-bgcolor)",e.add(i,t),i}constructor(){}}