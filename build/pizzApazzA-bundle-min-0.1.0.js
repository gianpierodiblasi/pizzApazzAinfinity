window.onload=t=>{switch(window.addEventListener("wheel",t=>{t.ctrlKey&&t.preventDefault()},{passive:!1}),window.addEventListener("keydown",t=>{t.ctrlKey&&("+"===t.key||"-"===t.key)&&(t.preventDefault(),document.querySelector(".z4canvas").dispatchEvent(new t.constructor(t.type,t)))}),localStorage.getItem("z4language")){case"en":Translations.setEnglish(),Z4Translations.setEnglish();break;case"it":Translations.setItalian(),Z4Translations.setItalian()}switch(localStorage.getItem("z4theme")){case"light":break;case"dark":SwingJS.instance().darkMode(!0).build();break;default:SwingJS.instance().darkMode(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches).build()}let e=localStorage.getItem("z4color");e&&SwingJS.instance().mainActionBGColor(e).build(),new Z4Frame};class Z4GradientColor{colors=[];colorPositions=[];ripple=0;constructor(){this.addColor(new Color(255,255,255,255),0),this.addColor(new Color(0,0,0,255),1)}addColor(t,e){let i=this.colorPositions.indexOf(e);-1!==i?this.colors[i]=t:-1!==(i=this.colorPositions.findIndex(t=>t>e))?(this.colors.splice(i,0,t),this.colorPositions.splice(i,0,e)):(this.colors.push(t),this.colorPositions.push(e))}removeColor(t){let e=this.colorPositions.indexOf(t);-1!==e&&(this.colors.splice(e,1),this.colorPositions.splice(e,1))}isPositionOccupied(t,e){return!!this.colorPositions.filter(i=>Math.abs(i-t)<=e).length}getPosition(t,e){let i=this.colorPositions.filter(i=>Math.abs(i-t)<=e);return i.length?i[0]:-1}mirror(){this.colors.slice().splice(this.colors.length-1,1).reverse().forEach(t=>this.colors.push(t));for(let t=0;t<this.colorPositions.length;t++)this.colorPositions[t]=this.colorPositions[t]/2;this.colorPositions.slice().splice(this.colorPositions.length-1,1).reverse().map(t=>1-t).forEach(t=>this.colorPositions.push(t))}reverse(){this.colors.reverse();for(let t=1;t<this.colorPositions.length-1;t++)this.colorPositions[t]=1-this.colorPositions[t]}setRipple(t){this.ripple=t}getRipple(){return this.ripple}getColorAt(t,e){e&&this.ripple&&(t=Z4Math.ripple(t,0,1,this.ripple));let i=t,s=this.colorPositions.findIndex(t=>t>=i,null);if(this.colorPositions[s]===t)return this.colors[s];if(this.colorPositions[s-1]===t)return this.colors[s-1];{let a=(t-this.colorPositions[s-1])/(this.colorPositions[s]-this.colorPositions[s-1]);return new Color(parseInt((this.colors[s].red-this.colors[s-1].red)*a+this.colors[s-1].red),parseInt((this.colors[s].green-this.colors[s-1].green)*a+this.colors[s-1].green),parseInt((this.colors[s].blue-this.colors[s-1].blue)*a+this.colors[s-1].blue),parseInt((this.colors[s].alpha-this.colors[s-1].alpha)*a+this.colors[s-1].alpha))}}toJSON(){let t={};return t.ripple=this.ripple,t.colorsAndPositions=this.colors.map((t,e,i)=>{let s={};return s.red=t.red,s.green=t.green,s.blue=t.blue,s.alpha=t.alpha,s.position=this.colorPositions[e],s}),t}static fromJSON(t){let e=new Z4GradientColor;return e.setRipple(t.ripple),t.colorsAndPositions.forEach(t=>e.addColor(new Color(t.red,t.green,t.blue,t.alpha),t.position)),e}}class Z4AbstractFiller{fill(t){}}class Z4AbstractGradientColorFiller extends Z4AbstractFiller{gradientColor=null;constructor(t){super(),this.gradientColor=t}fill(t){let e=t.data;for(let i=0;i<t.height;i++)for(let s=0;s<t.width;s++){let a=this.getColorPositionAt(s,i);if(-1!==a){let n=this.gradientColor.getColorAt(a,!0),r=(i*t.width+s)*4;e[r]=n.red,e[r+1]=n.green,e[r+2]=n.blue,e[r+3]=n.alpha}}}getColorPositionAt(t,e){}}class Z4AbstractBoundaryBehaviorFiller extends Z4AbstractGradientColorFiller{static STOP_AT_BOUNDARY=0;static FILL_AT_BOUNDARY=1;static SYMMETRIC_AT_BOUNDARY=2;static REPEAT_AT_BOUNDARY=3;boundaryBehavior=0;constructor(t,e){super(t),this.boundaryBehavior=e}getColorPositionAt(t,e){return this.getColorPositionAtWithBoundaryBehavior(t,e,this.boundaryBehavior)}getColorPositionAtWithBoundaryBehavior(t,e,i){}}class Z4AbstractDistanceBasedBoundaryBehaviorFiller extends Z4AbstractBoundaryBehaviorFiller{constructor(t,e){super(t,e)}getDistance(t,e){}getColorPositionAtWithBoundaryBehavior(t,e,i){let s=this.getDistance(t,e);if(s<=1)return s;if(i===Z4AbstractDistanceBasedBoundaryBehaviorFiller.STOP_AT_BOUNDARY)return -1;if(i===Z4AbstractDistanceBasedBoundaryBehaviorFiller.FILL_AT_BOUNDARY)return 1;if(i===Z4AbstractDistanceBasedBoundaryBehaviorFiller.SYMMETRIC_AT_BOUNDARY){let a=Math.floor(s);return s-=a,a%2&&(s=1-s),s}if(i===Z4AbstractDistanceBasedBoundaryBehaviorFiller.REPEAT_AT_BOUNDARY)return s-Math.floor(s);else return -1}}class Z4BezierFiller extends Z4AbstractDistanceBasedBoundaryBehaviorFiller{x1=0;y1=0;ctrlx1=0;ctrly1=0;ctrlx2=0;ctrly2=0;x2=0;y2=0;radius=0;bezier=null;constructor(t,e,i,s,a,n,r,o,l,h,d){super(t,d),this.x1=e,this.y1=i,this.ctrlx1=s,this.ctrly1=a,this.ctrlx2=n,this.ctrly2=r,this.x2=o,this.y2=l,this.radius=h,this.bezier=new Bezier(this.x1,this.y1,this.ctrlx1,this.ctrly1,this.ctrlx2,this.ctrly2,this.x2,this.y2)}getDistance(t,e){let i=this.bezier.project(new Z4Point(t,e));return Z4Math.distance(i.x,i.y,t,e)/this.radius}}class Z4EllipticFiller extends Z4AbstractDistanceBasedBoundaryBehaviorFiller{cx=0;cy=0;rx=0;ry=0;angle=0;constructor(t,e,i,s,a,n,r){super(t,r),this.cx=e,this.cy=i,this.rx=s,this.ry=a,this.angle=n}getDistance(t,e){let i=Z4Math.rotate(t-this.cx,e-this.cy,this.angle);return Math.hypot(i.x/this.rx,i.y/this.ry)}}class Z4SinusoidalFiller extends Z4AbstractDistanceBasedBoundaryBehaviorFiller{x=0;y=0;waveLength=0;period=0;amplitude=0;angle=0;two_PI_over_period=0;constructor(t,e,i,s,a,n,r,o){super(t,o),this.x=e,this.y=i,this.waveLength=s,this.period=a,this.amplitude=n,this.angle=r,this.two_PI_over_period=Z4Math.TWO_PI/this.period}getDistance(t,e){let i=Z4Math.rotate(t-this.x,e-this.y,this.angle);return Math.abs(i.y-this.amplitude*Math.sin(i.x*this.two_PI_over_period))/this.waveLength}}class Z4AbstractEllipseInscribedFiller extends Z4AbstractBoundaryBehaviorFiller{cx=0;cy=0;rx=0;ry=0;angle=0;vertexCount=0;edges=null;d00=0;ctx=new OffscreenCanvas(1,1).getContext("2d");constructor(t,e,i,s,a,n,r,o){super(t,o),this.cx=e,this.cy=i,this.rx=s,this.ry=a,this.angle=n,this.vertexCount=r,this.edges=this.createEdges(this.vertexCount),this.ctx.beginPath(),this.edges.forEach((t,e,i)=>{0===e?this.ctx.moveTo(t.x1,t.y1):this.ctx.lineTo(t.x1,t.y1)}),this.ctx.closePath(),this.d00=this.edges.map(t=>Z4Math.ptSegDist(t.x1,t.y1,t.x2,t.y2,0,0)).reduce((t,e,i,s)=>Math.min(t,e))}createEdges(t){}getColorPositionAtWithBoundaryBehavior(t,e,i){let s=Z4Math.rotate(t-this.cx,e-this.cy,this.angle),a=s.x/this.rx,n=s.y/this.ry;switch(i){case Z4StarFiller.STOP_AT_BOUNDARY:case Z4StarFiller.FILL_AT_BOUNDARY:return this.ctx.isPointInPath(a,n)?1-this.getDistance(a,n,1):i===Z4StarFiller.STOP_AT_BOUNDARY?-1:1;case Z4StarFiller.SYMMETRIC_AT_BOUNDARY:case Z4StarFiller.REPEAT_AT_BOUNDARY:let r=1,o=a/r,l=n/r,h=this.getDistance(o,l,r);for(;h>1||!this.ctx.isPointInPath(o,l);)o=a/++r,l=n/r,h=this.getDistance(o,l,r);return i===Z4StarFiller.REPEAT_AT_BOUNDARY?1-h:r%2?1-h:h;default:return -1}}getDistance(t,e,i){return this.edges.map(i=>Z4Math.ptSegDist(i.x1,i.y1,i.x2,i.y2,t,e)).reduce((t,e,i,s)=>Math.min(t,e))/(this.d00/i)}}class Z4PolygonFiller extends Z4AbstractEllipseInscribedFiller{constructor(t,e,i,s,a,n,r,o){super(t,e,i,s,a,n,r,o)}createEdges(t){let e=[];for(let i=0;i<t-1;i++)e.push(new Z4Line(Math.cos(i*Z4Math.TWO_PI/t),Math.sin(i*Z4Math.TWO_PI/t),Math.cos((i+1)*Z4Math.TWO_PI/t),Math.sin((i+1)*Z4Math.TWO_PI/t)));return e.push(new Z4Line(Math.cos((t-1)*Z4Math.TWO_PI/t),Math.sin((t-1)*Z4Math.TWO_PI/t),1,0)),e}}class Z4StarFiller extends Z4AbstractEllipseInscribedFiller{constructor(t,e,i,s,a,n,r,o){super(t,e,i,s,a,n,r,o)}createEdges(t){let e=[];for(let i=0;i<t;i++){let s=i*Z4Math.TWO_PI/t;e.push(new Z4Point(Math.cos(s),Math.sin(s))),s=(i*Z4Math.TWO_PI+Math.PI)/t,e.push(new Z4Point(Math.cos(s)/Z4Math.SQUARE_GOLD_SECTION,Math.sin(s)/Z4Math.SQUARE_GOLD_SECTION))}e.push(new Z4Point(1,0));let a=[];for(let n=0;n<e.length-1;n++)a.push(new Z4Line(e[n].x,e[n].y,e[n+1].x,e[n+1].y));return a}}class Z4LinearFiller extends Z4AbstractBoundaryBehaviorFiller{p1x=0;p1y=0;p2x=0;p2y=0;angle=0;distance=0;line1x=0;line1y=0;line2x=0;line2y=0;constructor(t,e,i,s,a,n){super(t,n),this.p1x=e,this.p1y=i,this.p2x=s,this.p2y=a,this.angle=Z4Math.atan(this.p1x,this.p1y,this.p2x,this.p2y)+Z4Math.HALF_PI,this.distance=Z4Math.distance(this.p1x,this.p1y,this.p2x,this.p2y),this.line1x=this.p1x+Math.cos(this.angle),this.line1y=this.p1y+Math.sin(this.angle),this.line2x=this.p2x+Math.cos(this.angle),this.line2y=this.p2y+Math.sin(this.angle)}getColorPositionAtWithBoundaryBehavior(t,e,i){let s=Z4Math.ptLineDist(this.p1x,this.p1y,this.line1x,this.line1y,t,e)/this.distance,a=Z4Math.ptLineDist(this.p2x,this.p2y,this.line2x,this.line2y,t,e)/this.distance;if(s<=1&&a<=1)return s;if(i===Z4LinearFiller.STOP_AT_BOUNDARY)return -1;if(i===Z4LinearFiller.FILL_AT_BOUNDARY)return s<a?0:1;if(i===Z4LinearFiller.SYMMETRIC_AT_BOUNDARY){let n=s<a?s:a,r=Math.floor(n);return n-=r,(s<a&&r%2||s>a&&!(r%2))&&(n=1-n),n}{if(i!==Z4LinearFiller.REPEAT_AT_BOUNDARY)return -1;let o=s<a?s:a;return o-=Math.floor(o),s<a&&(o=1-o),o}}}class Z4ConicFiller extends Z4AbstractGradientColorFiller{cx=0;cy=0;angle=0;symmetric=!1;constructor(t,e,i,s,a){super(t),this.cx=e,this.cy=i,this.angle=s,this.symmetric=a}getColorPositionAt(t,e){let i=Z4Math.rotate(t-this.cx,e-this.cy,this.angle),s=Math.atan2(i.y,i.x)/Z4Math.TWO_PI;return(s<0&&(s+=1),this.symmetric)?2*(s<.5?s:1-s):s}}class Z4SpiralFiller extends Z4AbstractGradientColorFiller{cx=0;cy=0;radius=0;angle=0;logarithmic=!1;constructor(t,e,i,s,a,n){super(t),this.cx=e,this.cy=i,this.radius=s,this.angle=a,this.logarithmic=n}getColorPositionAt(t,e){let i=Z4Math.rotate(t-this.cx,e-this.cy,this.angle),s=Math.hypot(i.x,i.y),a=Z4Math.TWO_PI*(this.logarithmic?Math.log(s/this.radius):s/this.radius),n=s*Math.cos(a),r=s*Math.sin(a);return isNaN(s=Z4Math.distance(i.x,i.y,n,r)/(2*s))?0:s}}class Z4TextureFiller extends Z4AbstractFiller{texture=null;x1=0;y1=0;x2=0;y2=0;color=null;symmetric=!1;textureData=null;left=0;top=0;width=0;height=0;scaleW=0;scaleH=0;constructor(t,e,i,s,a,n,r){if(super(),this.texture=t,this.x1=e,this.y1=i,this.x2=s,this.y2=a,this.color=n,this.symmetric=r,this.symmetric){this.textureData=new Uint8Array(16*this.texture.width*this.texture.height);for(let o=0;o<this.texture.height;o++)for(let l=0;l<this.texture.width;l++){let h=(o*this.texture.width+l)*4,d=(o*this.texture.width*2+l)*4;this.textureData[d]=this.texture.data[h],this.textureData[d+1]=this.texture.data[h+1],this.textureData[d+2]=this.texture.data[h+2],this.textureData[d+3]=this.texture.data[h+3],d=(o*this.texture.width*2+(2*this.texture.width-1-l))*4,this.textureData[d]=this.texture.data[h],this.textureData[d+1]=this.texture.data[h+1],this.textureData[d+2]=this.texture.data[h+2],this.textureData[d+3]=this.texture.data[h+3],d=((2*this.texture.height-1-o)*this.texture.width*2+l)*4,this.textureData[d]=this.texture.data[h],this.textureData[d+1]=this.texture.data[h+1],this.textureData[d+2]=this.texture.data[h+2],this.textureData[d+3]=this.texture.data[h+3],d=((2*this.texture.height-o-1)*this.texture.width*2+(2*this.texture.width-1-l))*4,this.textureData[d]=this.texture.data[h],this.textureData[d+1]=this.texture.data[h+1],this.textureData[d+2]=this.texture.data[h+2],this.textureData[d+3]=this.texture.data[h+3]}}else this.textureData=this.texture.data;this.left=Math.min(e,s),this.top=Math.min(i,a),this.width=Math.abs(s-e),this.height=Math.abs(a-i),this.scaleW=(this.symmetric?2:1)*this.texture.width/this.width,this.scaleH=(this.symmetric?2:1)*this.texture.height/this.height}fill(t){if(!this.width||!this.height)return;let e=t.data;for(let i=0;i<t.height;i++)for(let s=0;s<t.width;s++){let a=(i*t.width+s)*4,n=this.computeRect(s,i),r=parseInt(this.scaleW*(s-n.x)),o=(parseInt(this.scaleH*(i-n.y))*(this.symmetric?2:1)*this.texture.width+r)*4;this.textureData[o+3]?(e[a]=this.textureData[o],e[a+1]=this.textureData[o+1],e[a+2]=this.textureData[o+2],e[a+3]=this.textureData[o+3]):(e[a]=this.color.red,e[a+1]=this.color.green,e[a+2]=this.color.blue,e[a+3]=this.color.alpha)}}computeRect(t,e){let i=this.left,s=this.top,a=i+this.width,n=s+this.height;for(;t<i;)i-=this.width,a=i+this.width;for(;t>=a;)i+=this.width,a=i+this.width;for(;e<s;)s-=this.height,n=s+this.height;for(;e>=n;)s+=this.height,n=s+this.height;return new Point(i,s)}}class Z4Line{x1=0;y1=0;x2=0;y2=0;constructor(t,e,i,s){this.x1=t,this.y1=e,this.x2=i,this.y2=s}}class Z4Math{static TWO_PI=2*Math.PI;static HALF_PI=Math.PI/2;static GOLD_SECTION=(1+Math.sqrt(5))/2;static SQUARE_GOLD_SECTION=Z4Math.GOLD_SECTION*Z4Math.GOLD_SECTION;static RAD2DEG=180/Math.PI;static DEG2RAD=Math.PI/180;static rad2deg(t){return t*Z4Math.RAD2DEG}static deg2rad(t){return t*Z4Math.DEG2RAD}static distance(t,e,i,s){let a=t-i,n=e-s;return Math.sqrt(a*a+n*n)}static ptLineDist(t,e,i,s,a,n){return Math.sqrt(Z4Math.ptLineDistSq(t,e,i,s,a,n))}static ptLineDistSq(t,e,i,s,a,n){i-=t,s-=e;let r=(a-=t)*i+(n-=e)*s,o=a*a+n*n-r*r/(i*i+s*s);return o<0?0:o}static ptSegDist(t,e,i,s,a,n){return Math.sqrt(Z4Math.ptSegDistSq(t,e,i,s,a,n))}static ptSegDistSq(t,e,i,s,a,n){i-=t,s-=e;let r=(a-=t)*i+(n-=e)*s,o=0;o=r<=0?0:(r=(a=i-a)*i+(n=s-n)*s)<=0?0:r*r/(i*i+s*s);let l=a*a+n*n-o;return l<0?0:l}static atan(t,e,i,s){let a=Math.atan2(s-e,i-t);return a<0?a+Z4Math.TWO_PI:a}static rotate(t,e,i){let s=Math.cos(i),a=Math.sin(i);return new Z4Point(t*s+e*a,t*a-e*s)}static ripple(t,e,i,s){let a=(i-e)*s*Math.random();return(t+=Math.random()>.5?a:-a)<e?e:t>i?i:t}constructor(){}}class Z4Point{x=0;y=0;constructor(t,e){this.x=t,this.y=e}}class Z4Canvas extends JSComponent{canvas=document.createElement("canvas");ctx=this.canvas.getContext("2d");ribbonLayerPanel=null;statusPanel=null;projectName=null;width=0;height=0;zoom=1;zooming=!1;saved=!0;paper=new Z4Paper;constructor(){super(document.createElement("div")),this.cssAddClass("z4canvas"),this.appendNodeChild(this.canvas),this.addEventListener("wheel",t=>{let e=t;e.ctrlKey&&(e.deltaY<0?this.zoomIn():e.ctrlKey&&e.deltaY>0&&this.zoomOut())}),this.addEventListener("keydown",t=>{let e=t;e.ctrlKey&&("+"===e.key?(e.stopPropagation(),this.zoomIn()):"-"===e.key&&(e.stopPropagation(),this.zoomOut()))})}setRibbonLayerPanel(t){this.ribbonLayerPanel=t}setStatusPanel(t){this.statusPanel=t}create(t,e,i){this.paper.reset(),this.paper.addLayer(Z4Translations.BACKGROUND_LAYER,t,e,i,t,e),this.width=t,this.height=e,this.ribbonLayerPanel.reset(),this.ribbonLayerPanel.addLayerPreview(this.paper.getLayerAt(this.paper.getLayersCount()-1)),this.afterCreate("",t,e)}createFromFile(t){let e=new FileReader;e.onload=i=>this.createFromURL(t.name.substring(0,t.name.lastIndexOf(".")),e.result),e.readAsDataURL(t)}createFromClipboard(){navigator.clipboard.read().then(t=>{t.forEach(t=>{let e=t.types.find((t,e,i)=>t.startsWith("image/"));t.getType(e).then(t=>{this.createFromURL("",URL.createObjectURL(t))})})})}createFromURL(t,e){let i=document.createElement("img");return i.onload=e=>(this.paper.reset(),this.paper.addLayerFromImage(Z4Translations.BACKGROUND_LAYER,i,i.width,i.height),this.width=i.width,this.height=i.height,this.ribbonLayerPanel.reset(),this.ribbonLayerPanel.addLayerPreview(this.paper.getLayerAt(this.paper.getLayersCount()-1)),this.afterCreate(t,i.width,i.height),null),i.src=e,null}afterCreate(t,e,i){this.projectName=t,this.statusPanel.setProjectName(t),this.statusPanel.setZoom(1),this.zoom=1,this.saved=!0,this.canvas.width=e,this.canvas.height=i,this.drawCanvas()}openProject(t){new JSZip().loadAsync(t).then(t=>{t.file("manifest.json").async("string",null).then(e=>{this.paper.reset(),this.ribbonLayerPanel.reset();let i=JSON.parse(""+e);this.width=i.width,this.height=i.height,this.openLayer(t,i,i.layers,0)})})}openLayer(t,e,i,s){t.file("layers/layer"+s+".png").async("blob",t=>this.statusPanel.setProgressBarValue(t.percent)).then(a=>{let n=document.createElement("img");this.statusPanel.setProgressBarValue(0),n.onload=a=>{this.paper.addLayerFromImage(i[s].name,n,n.width,n.height);let r=this.paper.getLayerAt(s);return r.setOpacity(i[s].opacity),r.setCompositeOperation(i[s].compositeOperation),r.move(i[s].offsetX,i[s].offsetY),this.ribbonLayerPanel.addLayerPreview(r),s+1===i.length?this.afterCreate(e.projectName,e.width,e.height):this.openLayer(t,e,i,s+1),null},n.src=URL.createObjectURL(a)})}saveProject(t,e){this.projectName=t,this.statusPanel.setProjectName(t),this.saveLayer(new JSZip,[],0,e)}saveLayer(t,e,i,s){let a=this.paper.getLayerAt(i);a.convertToBlob(n=>{t.file("layers/layer"+i+".png",n,null);let r=a.getOffset();if(e[i]='{"name": "'+a.getName()+'","opacity": '+a.getOpacity()+',"compositeOperation": "'+a.getCompositeOperation()+'","offsetX": '+r.x+',"offsetY": '+r.y+"}",i+1===this.paper.getLayersCount()){let o='{"projectName": "'+this.projectName+'",\n"width": '+this.width+',\n"height": '+this.height+',\n"layers": ['+e.join(",")+"]}";t.file("manifest.json",o,null);let l={};l.type="blob",l.compression="DEFLATE",l.streamFiles=!0;let h={};h.level=9,l.compressionOptions=h,t.generateAsync(l,t=>this.statusPanel.setProgressBarValue(t.percent)).then(t=>{saveAs(t,this.projectName+".z4i"),this.statusPanel.setProgressBarValue(0),this.saved=!0,s&&s()})}else this.saveLayer(t,e,i+1,s)})}exportToFile(t,e,i){let s=new OffscreenCanvas(this.width,this.height),a=s.getContext("2d");this.paper.draw(a,!1);let n={};n.type=".png"===e?"image/png":"image/jpeg",n.quality=i,s.convertToBlob(n).then(i=>{let s=document.createElement("a");s.setAttribute("href",URL.createObjectURL(i)),s.setAttribute("download",t+e),document.body.appendChild(s);let a=document.createEvent("MouseEvents");a.initEvent("click",!1,!1),s.dispatchEvent(a),document.body.removeChild(s)})}addLayer(t,e,i){this.paper.addLayer(this.findLayerName(),t,e,i,this.width,this.height),this.afterAddLayer(),this.drawCanvas()}addLayerFromFile(t){let e=t.name.substring(0,t.name.lastIndexOf(".")),i=new FileReader;i.onload=t=>this.addLayerFromURL(e,i.result),i.readAsDataURL(t)}addLayerFromClipboard(){navigator.clipboard.read().then(t=>{t.forEach(t=>{let e=t.types.find((t,e,i)=>t.startsWith("image/"));t.getType(e).then(t=>{this.addLayerFromURL(this.findLayerName(),URL.createObjectURL(t))})})})}findLayerName(){let t=0,e="";for(;!e;){e=Z4Translations.LAYER+"_"+t;for(let i=0;i<this.paper.getLayersCount();i++)e===this.paper.getLayerAt(i).getName()&&(e="");t++}return e}addLayerFromURL(t,e){let i=document.createElement("img");return i.onload=e=>(this.paper.addLayerFromImage(t,i,this.width,this.height),this.afterAddLayer(),this.drawCanvas(),null),i.src=e,null}afterAddLayer(){this.ribbonLayerPanel.addLayerPreview(this.paper.getLayerAt(this.paper.getLayersCount()-1)),this.saved=!1}moveLayer(t,e){return!!this.paper.moveLayer(t,e)&&(this.saved=!1,this.drawCanvas(),!0)}getLayersCount(){return this.paper.getLayersCount()}getProjectName(){return this.projectName}getSize(){return new Dimension(this.width,this.height)}isSaved(){return this.saved}setSaved(t){this.saved=t}setZoom(t){this.zoom=t,this.canvas.width=this.width*t,this.canvas.height=this.height*t,this.drawCanvas()}fitZoom(){this.setZoom(Math.min((this.canvas.parentElement.clientWidth-20)/this.width,(this.canvas.parentElement.clientHeight-20)/this.height))}zoomIn(){if(this.zooming);else{this.zooming=!0;let t=Z4Constants.ZOOM_LEVEL.find(t=>t>this.zoom,null);t&&(this.zoom=t,this.canvas.width=this.width*t,this.canvas.height=this.height*t,this.statusPanel.setZoom(this.zoom),this.drawCanvas()),this.zooming=!1}}zoomOut(){if(this.zooming);else{this.zooming=!0;let t=Z4Constants.ZOOM_LEVEL.filter(t=>t<this.zoom).pop();t&&(this.zoom=t,this.canvas.width=this.width*t,this.canvas.height=this.height*t,this.statusPanel.setZoom(this.zoom),this.drawCanvas()),this.zooming=!1}}drawCanvas(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.ctx.scale(this.zoom,this.zoom),this.paper.draw(this.ctx,!1),this.ctx.restore()}}class Z4ColorPreview extends JSComponent{component=new JSComponent(document.createElement("div"));componentOpacity=new JSComponent(document.createElement("div"));constructor(){super(document.createElement("div")),this.cssAddClass("z4colorpreview"),this.component.cssAddClass("z4colorpreview-opaque"),this.appendChild(this.component),this.componentOpacity.cssAddClass("z4colorpreview-transparent"),this.appendChild(this.componentOpacity),this.setColor(new Color(0,0,0,255))}setColor(t){this.component.getStyle().backgroundColor=t.getRGB_String(),this.componentOpacity.getStyle().backgroundColor=t.getRGBA_String();let e=[],i=[];e[0]=t.red,e[1]=t.green,e[2]=t.blue,Color.RGBtoHSL(e,i),this.getStyle().border="1px solid "+(i[2]>.5?t.darkened(.1).getRGB_HEX():t.lighted(.1).getRGB_HEX())}}class Z4LayerPreview extends JSComponent{summary=new JSPanel;name=new JSLabel;preview=new JSComponent(document.createElement("canvas"));ctx=this.preview.invoke("getContext('2d')");editor=new JSTabbedPane;editName=new JSTextField;offsetXSlider=new JSSlider;offsetXSpinner=new JSSpinner;offsetYSlider=new JSSlider;offsetYSpinner=new JSSpinner;opacitySlider=new JSSlider;opacitySpinner=new JSSpinner;compositeOperations=[];compositeOperationsGroup=new ButtonGroup;canvas=null;layer=null;zoom=1;static PREVIEW_SIZE=50;constructor(){super(document.createElement("details")),this.cssAddClass("z4layerpreview"),this.addEventListener("toggle",t=>{if(""+this.getProperty("open")=="true"){this.getChilStyleByQuery(".z4layerpreview-editor").visibility="visible";let e=this.invokeInTree(".z4layerpreview-editor","getBoundingClientRect()"),i=this.invokeInTree("summary","getBoundingClientRect()");i.left+e.width<document.body.scrollWidth?this.getChilStyleByQuery(".z4layerpreview-editor").left=i.left+"px":i.right-e.width>0?this.getChilStyleByQuery(".z4layerpreview-editor").left=i.right-e.width+"px":(this.getChilStyleByQuery(".z4layerpreview-editor").left="auto",this.getChilStyleByQuery(".z4layerpreview-editor").right="5px"),i.bottom+e.height<document.body.scrollHeight?this.getChilStyleByQuery(".z4layerpreview-editor").top=i.bottom+"px":i.top-e.height>0?this.getChilStyleByQuery(".z4layerpreview-editor").top="calc("+(i.top-e.height)+"px - 1rem)":(this.getChilStyleByQuery(".z4layerpreview-editor").top="auto",this.getChilStyleByQuery(".z4layerpreview-editor").bottom="5px")}else this.getChilStyleByQuery(".z4layerpreview-editor").removeProperty("visibility"),this.getChilStyleByQuery(".z4layerpreview-editor").removeProperty("top"),this.getChilStyleByQuery(".z4layerpreview-editor").removeProperty("bottom"),this.getChilStyleByQuery(".z4layerpreview-editor").removeProperty("left"),this.getChilStyleByQuery(".z4layerpreview-editor").removeProperty("right")}),this.name.getStyle().width=Z4LayerPreview.PREVIEW_SIZE+"px",this.preview.setAttribute("width",""+Z4LayerPreview.PREVIEW_SIZE),this.preview.setAttribute("height",""+Z4LayerPreview.PREVIEW_SIZE),this.summary.setLayout(new BorderLayout(0,0)),this.summary.add(this.name,BorderLayout.NORTH),this.summary.add(this.preview,BorderLayout.CENTER),this.appendNodeChild(document.createElement("summary")),this.appendChildInTree("summary",this.summary),this.editor.cssAddClass("z4layerpreview-editor");let t=new JSPanel;t.setLayout(new GridBagLayout),this.editName.addActionListener(t=>{let e=this.editName.getText();e&&(this.canvas.setSaved(!1),this.name.setText(e),this.layer.setName(e))}),this.addLabel(t,Z4Translations.LAYER_NAME,0,0,1,1,GridBagConstraints.WEST,GridBagConstraints.NONE),this.addComponent(t,this.editName,0,1,5,1,0,0,GridBagConstraints.WEST,GridBagConstraints.HORIZONTAL,new Insets(0,0,5,0)),this.addLabel(t,Z4Translations.OFFSET_X,0,2,1,1,GridBagConstraints.WEST,GridBagConstraints.NONE),this.offsetXSpinner.getStyle().minWidth="4rem",this.offsetXSpinner.getChilStyleByQuery("input[type=number]").minWidth="3.5rem",this.offsetXSpinner.getChilStyleByQuery("input[type=number]").width="3.5rem",this.offsetXSpinner.addChangeListener(t=>this.onChange(!0,this.offsetXSpinner.getValueIsAdjusting(),this.offsetXSpinner,this.offsetXSlider)),this.addComponent(t,this.offsetXSpinner,1,2,1,1,0,0,GridBagConstraints.EAST,GridBagConstraints.NONE,null),this.offsetXSlider.getStyle().minWidth="20rem",this.offsetXSlider.addChangeListener(t=>this.onChange(!1,this.offsetXSlider.getValueIsAdjusting(),this.offsetXSpinner,this.offsetXSlider)),this.addComponent(t,this.offsetXSlider,0,3,2,1,0,0,GridBagConstraints.NORTH,GridBagConstraints.HORIZONTAL,null),this.addLabel(t,Translations.JSColorChooser_OPACITY,0,4,1,1,GridBagConstraints.WEST,GridBagConstraints.NONE),this.opacitySpinner.getStyle().minWidth="4rem",this.opacitySpinner.getChilStyleByQuery("input[type=number]").minWidth="3.5rem",this.opacitySpinner.getChilStyleByQuery("input[type=number]").width="3.5rem",this.opacitySpinner.addChangeListener(t=>this.onChange(!0,this.opacitySpinner.getValueIsAdjusting(),this.opacitySpinner,this.opacitySlider)),this.addComponent(t,this.opacitySpinner,1,4,1,1,0,0,GridBagConstraints.EAST,GridBagConstraints.NONE,null),this.opacitySlider.addChangeListener(t=>this.onChange(!1,this.opacitySlider.getValueIsAdjusting(),this.opacitySpinner,this.opacitySlider)),this.opacitySlider.getStyle().minWidth="20rem",this.addComponent(t,this.opacitySlider,0,5,2,1,0,0,GridBagConstraints.NORTH,GridBagConstraints.HORIZONTAL,null),this.addVLine(t,2,2,1,5,GridBagConstraints.CENTER,GridBagConstraints.VERTICAL),this.addLabel(t,Z4Translations.OFFSET_Y,3,5,1,1,GridBagConstraints.SOUTH,GridBagConstraints.NONE),t.getChilStyleByQuery("*:nth-child(10)").writingMode="vertical-lr",t.getChilStyleByQuery("*:nth-child(10)").transform="rotate(180deg)",this.offsetYSpinner.cssAddClass("offsetyspinner"),this.offsetYSpinner.setChildPropertyByQuery("*:nth-child(2)","textContent","▶"),this.offsetYSpinner.setChildPropertyByQuery("*:nth-child(3)","textContent","◀"),this.offsetYSpinner.addChangeListener(t=>this.onChange(!0,this.offsetYSpinner.getValueIsAdjusting(),this.offsetYSpinner,this.offsetYSlider)),this.addComponent(t,this.offsetYSpinner,3,2,1,3,0,0,GridBagConstraints.NORTH,GridBagConstraints.NONE,null),this.offsetYSlider.setOrientation(JSSlider.VERTICAL),this.offsetYSlider.setInverted(!0),this.offsetYSlider.getStyle().minHeight="20rem",this.offsetYSlider.addChangeListener(t=>this.onChange(!1,this.offsetYSlider.getValueIsAdjusting(),this.offsetYSpinner,this.offsetYSlider)),this.addComponent(t,this.offsetYSlider,4,2,1,4,0,1,GridBagConstraints.NORTH,GridBagConstraints.NONE,null),this.editor.addTab(Z4Translations.BASIC,t);let e=new JSPanel;e.setLayout(new GridBagLayout),this.addLabel(e,Z4Translations.COMPOSITE_OPERATION,0,0,1,1,GridBagConstraints.WEST,GridBagConstraints.NONE),Z4Constants.COMPOSITE_OPERATION.forEach((t,i,s)=>{t.forEach((t,s,a)=>{let n=new JSRadioButton;n.setContentAreaFilled(!1),n.setToggle(),n.setText(t),n.setTooltip(Z4Translations["COMPOSITE_OPERATION_"+t.toUpperCase().replace("-","_")]),n.addActionListener(e=>this.onAction(t)),this.compositeOperations.push(n),this.compositeOperationsGroup.add(n),this.addComponent(e,n,s,i+1,1,1,0,0,GridBagConstraints.WEST,GridBagConstraints.HORIZONTAL,new Insets(1,1,1,1))})}),this.editor.addTab(Z4Translations.ADVANCED,e),this.appendChild(this.editor)}addLabel(t,e,i,s,a,n,r,o){let l=new JSLabel;l.setText(e),this.addComponent(t,l,i,s,a,n,0,0,r,o,null)}addVLine(t,e,i,s,a,n,r){let o=new JSComponent(document.createElement("div"));o.getStyle().width="1px",o.getStyle().background="var(--main-action-bgcolor",this.addComponent(t,o,e,i,s,a,0,0,n,r,new Insets(1,2,1,2))}addComponent(t,e,i,s,a,n,r,o,l,h,d){let c=new GridBagConstraints;c.gridx=i,c.gridy=s,c.gridwidth=a,c.gridheight=n,c.weightx=r,c.weighty=o,c.anchor=l,c.fill=h,d&&(c.insets=d),t.add(e,c)}onChange(t,e,i,s){this.canvas.setSaved(!1),t?s.setValue(i.getValue()):i.setValue(s.getValue()),e?this.editor.setAttribute("offset","true"):this.editor.removeAttribute("offset"),this.layer.setOpacity(this.opacitySpinner.getValue()/100),this.layer.move(this.offsetXSlider.getValue(),this.offsetYSlider.getValue()),this.canvas.drawCanvas()}onAction(t){this.canvas.setSaved(!1),this.layer.setCompositeOperation(t),this.canvas.drawCanvas()}setLayer(t,e){this.canvas=t,this.layer=e,this.name.setText(this.layer.getName()),this.editName.setText(this.layer.getName()),this.setChildAttributeByQuery("summary","title",this.layer.getName());let i=e.getSize(),s=i.width/i.height,a=0,n=0;s>1?(a=Z4LayerPreview.PREVIEW_SIZE,n=Z4LayerPreview.PREVIEW_SIZE/s):(a=Z4LayerPreview.PREVIEW_SIZE*s,n=Z4LayerPreview.PREVIEW_SIZE),this.zoom=Math.min(a/i.width,n/i.height),this.preview.setAttribute("width",""+a),this.preview.setAttribute("height",""+n),this.preview.getStyle().marginTop=(Z4LayerPreview.PREVIEW_SIZE-n-1)/2+"px",this.preview.getStyle().marginBottom=(Z4LayerPreview.PREVIEW_SIZE-n-1)/2+"px",this.preview.getStyle().marginLeft=(Z4LayerPreview.PREVIEW_SIZE-a-1)/2+"px",this.preview.getStyle().marginRight=(Z4LayerPreview.PREVIEW_SIZE-a-1)/2+"px";let r=e.getOffset(),o=this.canvas.getSize();this.offsetXSlider.setMinimum(-i.width),this.offsetXSlider.setMaximum(o.width),this.offsetXSlider.setValue(r.x),this.offsetXSpinner.setModel(new SpinnerNumberModel(r.x,-i.width,o.width,1)),this.offsetYSlider.setMinimum(-i.height),this.offsetYSlider.setMaximum(o.height),this.offsetYSlider.setValue(r.y),this.offsetYSpinner.setModel(new SpinnerNumberModel(r.y,-i.height,o.height,1)),this.opacitySlider.setValue(parseInt(100*e.getOpacity())),this.opacitySpinner.setModel(new SpinnerNumberModel(parseInt(100*e.getOpacity()),0,100,1)),this.compositeOperations.forEach(t=>t.setSelected(t.getText()===e.getCompositeOperation())),this.drawLayer()}drawLayer(){this.layer&&(this.ctx.save(),this.ctx.scale(this.zoom,this.zoom),this.layer.draw(this.ctx,!0),this.ctx.restore())}}class Z4Frame extends JSFrame{ribbon=new Z4Ribbon;canvas=new Z4Canvas;statusPanel=new Z4StatusPanel;constructor(){super(),this.cssAddClass("z4frame"),this.getContentPane().setLayout(new BorderLayout(5,5)),this.ribbon.setCanvas(this.canvas),this.ribbon.setStatusPanel(this.statusPanel),this.canvas.setStatusPanel(this.statusPanel),this.statusPanel.setCanvas(this.canvas),this.getContentPane().add(this.ribbon,BorderLayout.NORTH),this.getContentPane().add(this.canvas,BorderLayout.CENTER),this.getContentPane().add(this.statusPanel,BorderLayout.SOUTH),this.canvas.create(Z4Constants.DEFAULT_IMAGE_SIZE,Z4Constants.DEFAULT_IMAGE_SIZE,new Color(0,0,0,0))}}class Z4AbstractFillerPanel extends JSPanel{preview=new JSComponent(document.createElement("canvas"));ctx=this.preview.invoke("getContext('2d')");offscreenCanvas=new OffscreenCanvas(Z4AbstractFillerPanel.SIZE/Z4AbstractFillerPanel.RESCALE,Z4AbstractFillerPanel.SIZE/Z4AbstractFillerPanel.RESCALE);offscreenCtx=this.offscreenCanvas.getContext("2d");panelOptions=new JSPanel;xSlider=new JSSlider;xSpinner=new JSSpinner;ySlider=new JSSlider;ySpinner=new JSSpinner;panelRadios=new JSPanel;buttonGroupOptions=new ButtonGroup;buttonGroupRadios=new ButtonGroup;gradientColor=new Z4GradientColor;radios=[];points=[];width=Z4Constants.DEFAULT_IMAGE_SIZE;height=Z4Constants.DEFAULT_IMAGE_SIZE;selectedIndex=0;selectedOption=null;pressed=!1;static SIZE=180;static SELECTOR_RADIUS=7;static RESCALE=3;constructor(t,e){super(),this.cssAddClass("z4abstractfillerpanel"),this.setLayout(new GridBagLayout),this.addComponent(this.panelOptions,0,0,4,1,0,0,GridBagConstraints.WEST,GridBagConstraints.HORIZONTAL,null),this.preview.setProperty("width",""+Z4AbstractFillerPanel.SIZE),this.preview.setProperty("height",""+Z4AbstractFillerPanel.SIZE),this.preview.addEventListener("mousedown",t=>this.onMouse(t,"down")),this.preview.addEventListener("mousemove",t=>this.onMouse(t,"move")),this.preview.addEventListener("mouseup",t=>this.onMouse(t,"up")),this.addComponent(this.preview,0,1,2,2,1,1,GridBagConstraints.CENTER,GridBagConstraints.NONE,null),this.addLabel("y",2,2,1,1,GridBagConstraints.SOUTH,GridBagConstraints.NONE),this.getChilStyleByQuery("label").writingMode="vertical-lr",this.getChilStyleByQuery("label").transform="rotate(180deg)",this.ySpinner.cssAddClass("yspinner"),this.ySpinner.setModel(new SpinnerNumberModel(0,0,this.height,1)),this.ySpinner.setChildPropertyByQuery("*:nth-child(2)","textContent","▶"),this.ySpinner.setChildPropertyByQuery("*:nth-child(3)","textContent","◀"),this.ySpinner.addChangeListener(t=>this.onChange(!0,this.ySpinner.getValueIsAdjusting(),this.ySpinner,this.ySlider,!1)),this.addComponent(this.ySpinner,2,1,1,1,0,0,GridBagConstraints.NORTHEAST,GridBagConstraints.NONE,null),this.ySlider.setMaximum(this.height),this.ySlider.setOrientation(JSSlider.VERTICAL),this.ySlider.setInverted(!0),this.ySlider.getStyle().minHeight="20rem",this.ySlider.addChangeListener(t=>this.onChange(!1,this.ySlider.getValueIsAdjusting(),this.ySpinner,this.ySlider,!1)),this.addComponent(this.ySlider,3,1,1,2,0,0,GridBagConstraints.EAST,GridBagConstraints.NONE,null),this.addHLine(0,3,4,1,GridBagConstraints.WEST,GridBagConstraints.HORIZONTAL),this.addLabel("x",0,4,1,1,GridBagConstraints.WEST,GridBagConstraints.NONE),this.xSpinner.setModel(new SpinnerNumberModel(0,0,this.width,1)),this.xSpinner.getStyle().minWidth="4rem",this.xSpinner.getChilStyleByQuery("input[type=number]").minWidth="3.5rem",this.xSpinner.getChilStyleByQuery("input[type=number]").width="3.5rem",this.xSpinner.addChangeListener(t=>this.onChange(!0,this.xSpinner.getValueIsAdjusting(),this.xSpinner,this.xSlider,!0)),this.addComponent(this.xSpinner,1,4,3,1,0,0,GridBagConstraints.EAST,GridBagConstraints.NONE,null),this.xSlider.setMaximum(this.width),this.xSlider.getStyle().minWidth="20rem",this.xSlider.addChangeListener(t=>this.onChange(!1,this.xSlider.getValueIsAdjusting(),this.xSpinner,this.xSlider,!0)),this.addComponent(this.xSlider,0,5,4,1,0,0,GridBagConstraints.NORTH,GridBagConstraints.HORIZONTAL,null),this.addComponent(this.panelRadios,0,6,4,1,0,0,GridBagConstraints.WEST,GridBagConstraints.HORIZONTAL,null),e&&e.forEach((t,e,i)=>{let s=new JSRadioButton;s.setContentAreaFilled(!1),s.setToggle(),s.setSelected(0===e),0===e&&(this.selectedOption=t),s.setIcon(new Z4EmptyImageProducer(t)),s.addActionListener(e=>{this.selectedOption=t,this.drawPreview(!1)}),this.buttonGroupOptions.add(s),this.panelOptions.add(s,null)});for(let i=0;i<t;i++){let s=i,a=new JSRadioButton;a.setText(""+(i+1)),a.setSelected(0===i),a.addActionListener(t=>this.onRadio(s)),this.radios.push(a),this.buttonGroupRadios.add(a),this.panelRadios.add(a,null)}this.pushPointPositions(this.points,this.width,this.height),this.setXY()}addLabel(t,e,i,s,a,n,r){let o=new JSLabel;o.setText(t),this.addComponent(o,e,i,s,a,0,0,n,r,null)}addComponent(t,e,i,s,a,n,r,o,l,h){let d=new GridBagConstraints;d.gridx=e,d.gridy=i,d.gridwidth=s,d.gridheight=a,d.weightx=n,d.weighty=r,d.anchor=o,d.fill=l,h&&(d.insets=h),this.add(t,d)}addHLine(t,e,i,s,a,n){let r=new JSComponent(document.createElement("div"));r.getStyle().height="1px",r.getStyle().background="var(--main-action-bgcolor",this.addComponent(r,t,e,i,s,0,0,a,n,new Insets(2,1,2,1))}onRadio(t){this.selectedIndex=t,this.setXY(),this.drawPreview(!1)}onChange(t,e,i,s,a){t?s.setValue(i.getValue()):i.setValue(s.getValue()),this.setPointPosition(this.points,this.selectedIndex,a?s.getValue():this.points[this.selectedIndex].x,a?this.points[this.selectedIndex].y:s.getValue(),this.width,this.height),this.drawPreview(e)}onMouse(t,e){let i=parseInt(this.preview.getProperty("width")),s=parseInt(this.preview.getProperty("height"));switch(e){case"down":this.points.map(t=>new Point(i*t.x/this.width,s*t.y/this.height)).forEach((e,i,s)=>{this.isPointEnabled(i)&&Z4Math.distance(e.x,e.y,t.offsetX,t.offsetY)<=Z4AbstractFillerPanel.SELECTOR_RADIUS&&(this.pressed=!0,this.selectedIndex=i,this.radios[this.selectedIndex].setSelected(!0),this.setXY(),this.drawPreview(!1))});break;case"move":this.pressed?(this.setPointPosition(this.points,this.selectedIndex,parseInt(this.width*t.offsetX/i),parseInt(this.height*t.offsetY/s),this.width,this.height),this.setXY(),this.drawPreview(!0)):(this.preview.getStyle().cursor="default",this.points.map(t=>new Point(i*t.x/this.width,s*t.y/this.height)).forEach((e,i,s)=>{this.isPointEnabled(i)&&Z4Math.distance(e.x,e.y,t.offsetX,t.offsetY)<=Z4AbstractFillerPanel.SELECTOR_RADIUS&&(this.preview.getStyle().cursor="pointer")}));break;case"up":this.pressed=!1,this.drawPreview(!1)}}setPointPosition(t,e,i,s,a,n){}requestSetPointPosition(){this.setPointPosition(this.points,this.selectedIndex,this.points[this.selectedIndex].x,this.points[this.selectedIndex].y,this.width,this.height)}setSize(t,e){this.width=t,this.height=e,this.ySpinner.setModel(new SpinnerNumberModel(0,0,this.height,1)),this.ySlider.setMaximum(this.height),this.xSpinner.setModel(new SpinnerNumberModel(0,0,this.width,1)),this.xSlider.setMaximum(this.width),this.points.length=0,this.pushPointPositions(this.points,this.width,this.height),this.setXY();let i=t/e;this.preview.setProperty("width",""+parseInt(i>1?Z4AbstractFillerPanel.SIZE:Z4AbstractFillerPanel.SIZE*i)),this.preview.setProperty("height",""+parseInt(i>1?Z4AbstractFillerPanel.SIZE/i:Z4AbstractFillerPanel.SIZE)),this.offscreenCanvas=new OffscreenCanvas(parseInt(this.preview.getProperty("width"))/Z4AbstractFillerPanel.RESCALE,parseInt(this.preview.getProperty("height"))/Z4AbstractFillerPanel.RESCALE),this.offscreenCtx=this.offscreenCanvas.getContext("2d"),this.drawPreview(!1)}pushPointPositions(t,e,i){}setXY(){this.xSlider.setValue(this.points[this.selectedIndex].x),this.xSpinner.setValue(this.points[this.selectedIndex].x),this.ySlider.setValue(this.points[this.selectedIndex].y),this.ySpinner.setValue(this.points[this.selectedIndex].y)}setPointsEnabled(){this.radios.forEach((t,e,i)=>{let s=this.isPointEnabled(e);t.setEnabled(s),!s&&t.isSelected()&&(this.radios[0].setSelected(!0),this.selectedIndex=0,this.setXY(),this.drawPreview(!1))})}drawPreview(t){let e=parseInt(this.preview.getProperty("width")),i=parseInt(this.preview.getProperty("height"));this.ctx.clearRect(0,0,e,i);let s=this.points.map(t=>new Point(e*t.x/this.width,i*t.y/this.height));if(t&&this.needsRescale(this.selectedOption)){let a=this.offscreenCtx.createImageData(e/Z4AbstractFillerPanel.RESCALE,i/Z4AbstractFillerPanel.RESCALE);this.getFiller(this.gradientColor,s.map(t=>new Point(t.x/Z4AbstractFillerPanel.RESCALE,t.y/Z4AbstractFillerPanel.RESCALE)),this.selectedOption).fill(a),this.offscreenCtx.putImageData(a,0,0),this.ctx.drawImage(this.offscreenCanvas,0,0,e,i)}else{let n=this.ctx.createImageData(e,i);this.getFiller(this.gradientColor,s,this.selectedOption).fill(n),this.ctx.putImageData(n,0,0)}this.ctx.save(),s.forEach((t,e,i)=>this.drawCircle(t,e)),this.ctx.restore(),this.ctx.save(),this.drawObjects(this.ctx,s),this.ctx.restore()}needsRescale(t){}getFiller(t,e,i){}drawCircle(t,e){if(this.isPointEnabled(e)){let i=[];this.ctx.beginPath(),this.ctx.arc(t.x,t.y,Z4AbstractFillerPanel.SELECTOR_RADIUS,0,2*Math.PI),this.ctx.closePath(),this.ctx.strokeStyle=this.getStrokeStyle(e===this.selectedIndex?"red":"black"),this.ctx.setLineDash(i),this.ctx.stroke(),i.push(2.5,2.5),this.ctx.beginPath(),this.ctx.arc(t.x,t.y,Z4AbstractFillerPanel.SELECTOR_RADIUS,0,2*Math.PI),this.ctx.closePath(),this.ctx.strokeStyle=this.getStrokeStyle("white"),this.ctx.setLineDash(i),this.ctx.stroke()}}isPointEnabled(t){}drawObjects(t,e){}getStrokeStyle(t){return t}}class Z4BezierFillerPanel extends Z4AbstractFillerPanel{constructor(){super(5,[Z4AbstractBoundaryBehaviorFiller.STOP_AT_BOUNDARY,Z4AbstractBoundaryBehaviorFiller.FILL_AT_BOUNDARY,Z4AbstractBoundaryBehaviorFiller.SYMMETRIC_AT_BOUNDARY,Z4AbstractBoundaryBehaviorFiller.REPEAT_AT_BOUNDARY]),this.cssAddClass("z4bezierfillerpanel"),this.drawPreview(!1)}setPointPosition(t,e,i,s,a,n){t[e]=new Point(i,s)}pushPointPositions(t,e,i){t.push(new Point(0,3*i/4)),t.push(new Point(e/4,i/8)),t.push(new Point(3*e/4,i/8)),t.push(new Point(e,3*i/4)),t.push(new Point(e/4,7*i/8))}needsRescale(t){return!0}getFiller(t,e,i){return new Z4BezierFiller(t,e[0].x,e[0].y,e[1].x,e[1].y,e[2].x,e[2].y,e[3].x,e[3].y,parseInt(Z4Math.distance(e[0].x,e[0].y,e[4].x,e[4].y)),i)}isPointEnabled(t){return!0}drawObjects(t,e){let i=[];t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.lineTo(e[2].x,e[2].y),t.lineTo(e[3].x,e[3].y),t.moveTo(e[0].x,e[0].y),t.lineTo(e[4].x,e[4].y),t.strokeStyle=this.getStrokeStyle("black"),t.setLineDash(i),t.stroke(),i.push(2.5,2.5),t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.lineTo(e[2].x,e[2].y),t.lineTo(e[3].x,e[3].y),t.moveTo(e[0].x,e[0].y),t.lineTo(e[4].x,e[4].y),t.strokeStyle=this.getStrokeStyle("white"),t.setLineDash(i),t.stroke()}getStrokeStyle(t){return t}}class Z4ConicFillerPanel extends Z4AbstractFillerPanel{constructor(){super(2,[!1,!0]),this.cssAddClass("z4conicfillerpanel"),this.drawPreview(!1)}setPointPosition(t,e,i,s,a,n){t[e]=new Point(i,s)}pushPointPositions(t,e,i){t.push(new Point(e/2,i/2)),t.push(new Point(e,i/2))}needsRescale(t){return!1}getFiller(t,e,i){return new Z4ConicFiller(t,e[0].x,e[0].y,Z4Math.atan(e[0].x,e[0].y,e[1].x,e[1].y),i)}isPointEnabled(t){return!0}drawObjects(t,e){let i=[];t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.strokeStyle=this.getStrokeStyle("black"),t.setLineDash(i),t.stroke(),i.push(2.5,2.5),t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.strokeStyle=this.getStrokeStyle("white"),t.setLineDash(i),t.stroke()}getStrokeStyle(t){return t}}class Z4LinearFillerPanel extends Z4AbstractFillerPanel{constructor(){super(2,[Z4AbstractBoundaryBehaviorFiller.STOP_AT_BOUNDARY,Z4AbstractBoundaryBehaviorFiller.FILL_AT_BOUNDARY,Z4AbstractBoundaryBehaviorFiller.SYMMETRIC_AT_BOUNDARY,Z4AbstractBoundaryBehaviorFiller.REPEAT_AT_BOUNDARY]),this.cssAddClass("z4linearfillerpanel"),this.drawPreview(!1)}setPointPosition(t,e,i,s,a,n){t[e]=new Point(i,s)}pushPointPositions(t,e,i){t.push(new Point(0,i/2)),t.push(new Point(e,i/2))}needsRescale(t){return!1}getFiller(t,e,i){return new Z4LinearFiller(t,e[0].x,e[0].y,e[1].x,e[1].y,i)}isPointEnabled(t){return!0}drawObjects(t,e){let i=[];t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.strokeStyle=this.getStrokeStyle("black"),t.setLineDash(i),t.stroke(),i.push(2.5,2.5),t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.strokeStyle=this.getStrokeStyle("white"),t.setLineDash(i),t.stroke()}getStrokeStyle(t){return t}}class Z4SinusoidalFillerPanel extends Z4AbstractFillerPanel{constructor(){super(4,[Z4AbstractBoundaryBehaviorFiller.STOP_AT_BOUNDARY,Z4AbstractBoundaryBehaviorFiller.FILL_AT_BOUNDARY,Z4AbstractBoundaryBehaviorFiller.SYMMETRIC_AT_BOUNDARY,Z4AbstractBoundaryBehaviorFiller.REPEAT_AT_BOUNDARY]),this.cssAddClass("z4sinusoidalfillerpanel"),this.drawPreview(!1)}setPointPosition(t,e,i,s,a,n){let r=0,o=0,l=null,h=0,d=0,c=null,T=0,u=0,p=null;switch(e){case 0:let E=t[0].x-i,g=t[0].y-s;o=Z4Math.distance(t[0].x,t[0].y,t[1].x,t[1].y),r=Z4Math.atan(t[0].x,t[0].y,t[1].x,t[1].y),d=Z4Math.distance(t[0].x,t[0].y,t[2].x,t[2].y),h=Z4Math.atan(t[0].x,t[0].y,t[2].x,t[2].y),u=Z4Math.distance(t[0].x,t[0].y,t[3].x,t[3].y),T=Z4Math.atan(t[0].x,t[0].y,t[3].x,t[3].y),t[0]=new Point(i,s),l=this.getPoint(t[0].x,t[0].y,t[1].x-E,t[1].y-g,o,r,a,n),t[1]=new Point(Math.round(l.x),Math.round(l.y)),c=this.getPoint(t[0].x,t[0].y,t[2].x-E,t[2].y-g,d,h,a,n),t[2]=new Point(Math.round(c.x),Math.round(c.y)),p=this.getPoint(t[0].x,t[0].y,t[3].x-E,t[3].y-g,u,T,a,n),t[3]=new Point(Math.round(p.x),Math.round(p.y));break;case 1:d=Z4Math.distance(t[0].x,t[0].y,t[2].x,t[2].y),h=Z4Math.atan(t[0].x,t[0].y,i,s)+Z4Math.HALF_PI,u=Z4Math.distance(t[0].x,t[0].y,t[3].x,t[3].y),T=Z4Math.atan(t[0].x,t[0].y,i,s)+Math.PI,c=this.getPoint(t[0].x,t[0].y,t[0].x+d*Math.cos(h),t[0].y+d*Math.sin(h),d,h,a,n),p=this.getPoint(t[0].x,t[0].y,t[0].x+u*Math.cos(T),t[0].y+u*Math.sin(T),u,T,a,n),t[1]=new Point(i,s),t[2]=new Point(Math.round(c.x),Math.round(c.y)),t[3]=new Point(Math.round(p.x),Math.round(p.y));break;case 2:o=Z4Math.distance(t[0].x,t[0].y,t[1].x,t[1].y),r=Z4Math.atan(t[0].x,t[0].y,i,s)-Z4Math.HALF_PI,u=Z4Math.distance(t[0].x,t[0].y,t[3].x,t[3].y),T=Z4Math.atan(t[0].x,t[0].y,i,s)+Z4Math.HALF_PI,l=this.getPoint(t[0].x,t[0].y,t[0].x+o*Math.cos(r),t[0].y+o*Math.sin(r),o,r,a,n),p=this.getPoint(t[0].x,t[0].y,t[0].x+u*Math.cos(T),t[0].y+u*Math.sin(T),u,T,a,n),t[1]=new Point(Math.round(l.x),Math.round(l.y)),t[2]=new Point(i,s),t[3]=new Point(Math.round(p.x),Math.round(p.y));break;case 3:o=Z4Math.distance(t[0].x,t[0].y,t[1].x,t[1].y),r=Z4Math.atan(t[0].x,t[0].y,i,s)+Math.PI,d=Z4Math.distance(t[0].x,t[0].y,t[2].x,t[2].y),h=Z4Math.atan(t[0].x,t[0].y,i,s)-Z4Math.HALF_PI,l=this.getPoint(t[0].x,t[0].y,t[0].x+o*Math.cos(r),t[0].y+o*Math.sin(r),o,r,a,n),c=this.getPoint(t[0].x,t[0].y,t[0].x+d*Math.cos(h),t[0].y+d*Math.sin(h),d,h,a,n),t[1]=new Point(Math.round(l.x),Math.round(l.y)),t[2]=new Point(Math.round(c.x),Math.round(c.y)),t[3]=new Point(i,s)}}getPoint(t,e,i,s,a,n,r,o){for(;(i<0||i>r||s<0||s>o)&&a>0;)i=t+(a=Math.max(0,a-.05))*Math.cos(n),s=e+a*Math.sin(n);return new Z4Point(i,s)}pushPointPositions(t,e,i){t.push(new Point(e/2,i/2)),t.push(new Point(e/2,i/8)),t.push(new Point(e,i/2)),t.push(new Point(e/2,i))}needsRescale(t){return!1}getFiller(t,e,i){return new Z4SinusoidalFiller(t,e[0].x,e[0].y,Z4Math.distance(e[0].x,e[0].y,e[1].x,e[1].y),Z4Math.distance(e[0].x,e[0].y,e[2].x,e[2].y),Z4Math.distance(e[0].x,e[0].y,e[3].x,e[3].y),Z4Math.atan(e[0].x,e[0].y,e[2].x,e[2].y),i)}isPointEnabled(t){return!0}drawObjects(t,e){let i=[];t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.moveTo(e[0].x,e[0].y),t.lineTo(e[2].x,e[2].y),t.moveTo(e[0].x,e[0].y),t.lineTo(e[3].x,e[3].y),t.strokeStyle=this.getStrokeStyle("black"),t.setLineDash(i),t.stroke(),i.push(2.5,2.5),t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.moveTo(e[0].x,e[0].y),t.lineTo(e[2].x,e[2].y),t.moveTo(e[0].x,e[0].y),t.lineTo(e[3].x,e[3].y),t.strokeStyle=this.getStrokeStyle("white"),t.setLineDash(i),t.stroke()}getStrokeStyle(t){return t}}class Z4SpiralFillerPanel extends Z4AbstractFillerPanel{constructor(){super(2,[!1,!0]),this.cssAddClass("z4spiralfillerpanel"),this.drawPreview(!1)}setPointPosition(t,e,i,s,a,n){t[e]=new Point(i,s)}pushPointPositions(t,e,i){t.push(new Point(e/2,i/2)),t.push(new Point(e,i/2))}needsRescale(t){return!1}getFiller(t,e,i){return new Z4SpiralFiller(t,e[0].x,e[0].y,Z4Math.distance(e[0].x,e[0].y,e[1].x,e[1].y),Z4Math.atan(e[0].x,e[0].y,e[1].x,e[1].y),i)}isPointEnabled(t){return!0}drawObjects(t,e){let i=[];t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.strokeStyle=this.getStrokeStyle("black"),t.setLineDash(i),t.stroke(),i.push(2.5,2.5),t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.strokeStyle=this.getStrokeStyle("white"),t.setLineDash(i),t.stroke()}getStrokeStyle(t){return t}}class Z4TextureFillerPanel extends Z4AbstractFillerPanel{colorPreview=new Z4ColorPreview;free=new JSRadioButton;lockRatio=new JSRadioButton;lock=new JSRadioButton;group=new ButtonGroup;imageData=new ImageData(Z4TextureFillerPanel.DEFAULT_SIZE,Z4TextureFillerPanel.DEFAULT_SIZE);backgroundColor=new Color(0,0,0,0);newImage=!0;static DEFAULT_SIZE=50;constructor(){super(2,[!1,!0]),this.addLabel(Z4Translations.DIMENSION,0,7,4,1,GridBagConstraints.WEST,GridBagConstraints.NONE);let t=new JSPanel;this.addComponent(t,0,8,4,1,0,0,GridBagConstraints.WEST,GridBagConstraints.HORIZONTAL,null),this.free.setText(Z4Translations.FREE),this.free.setSelected(!0),this.group.add(this.free),t.add(this.free,null),this.lockRatio.setText(Z4Translations.LOCK_RATIO),this.group.add(this.lockRatio),t.add(this.lockRatio,null),this.lock.setText(Z4Translations.LOCK),this.group.add(this.lock),t.add(this.lock,null),this.addLabel(Z4Translations.BACKGROUND_COLOR,0,9,4,1,GridBagConstraints.EAST,GridBagConstraints.NONE),(t=new JSPanel).setLayout(new BorderLayout(5,0)),this.addComponent(t,0,10,4,1,0,0,GridBagConstraints.WEST,GridBagConstraints.HORIZONTAL,null),this.colorPreview.getStyle().alignSelf="center",this.colorPreview.setColor(this.backgroundColor),t.add(this.colorPreview,BorderLayout.CENTER);let e=new JSButton;e.setText(Z4Translations.PATTERN),e.getStyle().marginRight="4rem",e.addActionListener(t=>this.selectPattern()),t.add(e,BorderLayout.WEST),(e=new JSButton).setText(Z4Translations.EDIT),e.addActionListener(t=>this.selectColor()),t.add(e,BorderLayout.EAST);let i=this.imageData.data;for(let s=0;s<Z4TextureFillerPanel.DEFAULT_SIZE;s++)for(let a=0;a<Z4TextureFillerPanel.DEFAULT_SIZE;a++){let n=(s*Z4TextureFillerPanel.DEFAULT_SIZE+a)*4;Z4Math.distance(a,s,Z4TextureFillerPanel.DEFAULT_SIZE/2,Z4TextureFillerPanel.DEFAULT_SIZE/2)>Z4TextureFillerPanel.DEFAULT_SIZE/2||(s<Z4TextureFillerPanel.DEFAULT_SIZE/2?(i[n]=255,i[n+1]=255,i[n+2]=255,i[n+3]=255):(i[n]=0,i[n+1]=0,i[n+2]=0,i[n+3]=255))}this.cssAddClass("z4texturefillerpanel"),this.drawPreview(!1)}selectPattern(){JSFileChooser.showOpenDialog(""+Z4Constants.ACCEPTED_IMAGE_FILE_FORMAT.join(","),JSFileChooser.SINGLE_SELECTION,0,t=>t.forEach(t=>{let e=new FileReader;e.onload=t=>{let i=document.createElement("img");return i.onload=t=>{let e=new OffscreenCanvas(i.width,i.height).getContext("2d");return e.drawImage(i,0,0),this.imageData=e.getImageData(0,0,i.width,i.height),this.newImage=!0,this.requestSetPointPosition(),this.drawPreview(!1),null},i.src=e.result,null},e.readAsDataURL(t)}))}selectColor(){JSColorChooser.showDialog(Z4Translations.FILLING_COLOR,this.backgroundColor,!0,null,t=>{this.backgroundColor=t,this.colorPreview.setColor(t),this.drawPreview(!1)})}setPointPosition(t,e,i,s,a,n){if(this.newImage)t[0]=new Point(0,0),t[1]=new Point(Math.min(a,this.imageData.width),Math.min(n,this.imageData.height));else if(this.free.isSelected())t[e]=new Point(i,s);else if(this.lockRatio.isSelected()){let r=Z4Math.distance(t[1-e].x,t[1-e].y,i,s),o=Z4Math.atan(t[1-e].x,t[1-e].y,t[e].x,t[e].y);t[e]=new Point(Math.round(t[1-e].x+r*Math.cos(o)),Math.round(t[1-e].y+r*Math.sin(o)))}else if(this.lock.isSelected()){let l=t[e].x-i,h=t[e].y-s,d=t[1-e].x-l,c=t[1-e].y-h;0<=d&&d<a&&0<=c&&c<n&&(t[e]=new Point(i,s),t[1-e]=new Point(d,c))}this.newImage=!1}pushPointPositions(t,e,i){t.push(new Point(0,0)),t.push(new Point(Math.min(e,Z4TextureFillerPanel.DEFAULT_SIZE),Math.min(i,Z4TextureFillerPanel.DEFAULT_SIZE)))}needsRescale(t){return!1}getFiller(t,e,i){return new Z4TextureFiller(this.imageData,e[0].x,e[0].y,e[1].x,e[1].y,this.backgroundColor,i)}isPointEnabled(t){return!0}drawObjects(t,e){let i=[];t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.strokeStyle=this.getStrokeStyle("black"),t.setLineDash(i),t.stroke(),i.push(2.5,2.5),t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.strokeStyle=this.getStrokeStyle("white"),t.setLineDash(i),t.stroke()}getStrokeStyle(t){return t}}class Z4VertexBasedFillerPanel extends Z4AbstractFillerPanel{star=new JSCheckBox;vertexCounter=new JSSlider;regular=new JSCheckBox;constructor(){super(3,[Z4AbstractBoundaryBehaviorFiller.STOP_AT_BOUNDARY,Z4AbstractBoundaryBehaviorFiller.FILL_AT_BOUNDARY,Z4AbstractBoundaryBehaviorFiller.SYMMETRIC_AT_BOUNDARY,Z4AbstractBoundaryBehaviorFiller.REPEAT_AT_BOUNDARY]),this.addLabel(Z4Translations.VERTICES,0,7,1,1,GridBagConstraints.WEST,GridBagConstraints.NONE),this.star.setText(Z4Translations.STAR),this.star.setEnabled(!1),this.star.addActionListener(t=>{this.setIcons(),this.drawPreview(!1)}),this.addComponent(this.star,1,7,3,1,0,0,GridBagConstraints.EAST,GridBagConstraints.NONE,null);let t=new DefaultSliderModelAndRenderer;for(let e=3;e<10;e++)t.addElement(""+e);t.addElement("∞"),this.vertexCounter.setModelAndRenderer(t),this.vertexCounter.setValue(7),this.vertexCounter.addChangeListener(t=>{this.star.setEnabled(7!==this.vertexCounter.getValue()),this.setIcons(),this.drawPreview(!1)}),this.addComponent(this.vertexCounter,0,8,4,1,0,0,GridBagConstraints.WEST,GridBagConstraints.HORIZONTAL,null),this.getChilStyleByQuery("*:nth-child(13) datalist option:nth-child(8)").fontSize="larger",this.regular.setText(Z4Translations.REGULAR),this.regular.addActionListener(t=>{this.setPointsEnabled(),this.drawPreview(!1)}),this.appendChildInTree("*:nth-child(10)",this.regular),this.cssAddClass("z4ellipticfillerpanel"),this.drawPreview(!1)}setIcons(){this.cssRemoveClass("z4ellipticfillerpanel"),this.cssRemoveClass("z4starfillerpanel"),this.cssRemoveClass("z4polygonfillerpanel"),7===this.vertexCounter.getValue()?this.cssAddClass("z4ellipticfillerpanel"):this.star.isSelected()?this.cssAddClass("z4starfillerpanel"):this.cssAddClass("z4polygonfillerpanel")}setPointPosition(t,e,i,s,a,n){let r=0,o=0,l=null,h=0,d=0,c=null;switch(e){case 0:let T=t[0].x-i,u=t[0].y-s;o=Z4Math.distance(t[0].x,t[0].y,t[1].x,t[1].y),r=Z4Math.atan(t[0].x,t[0].y,t[1].x,t[1].y),d=Z4Math.distance(t[0].x,t[0].y,t[2].x,t[2].y),h=Z4Math.atan(t[0].x,t[0].y,t[2].x,t[2].y),t[0]=new Point(i,s),l=this.getPoint(t[0].x,t[0].y,t[1].x-T,t[1].y-u,o,r,a,n),t[1]=new Point(Math.round(l.x),Math.round(l.y)),c=this.getPoint(t[0].x,t[0].y,t[2].x-T,t[2].y-u,d,h,a,n),t[2]=new Point(Math.round(c.x),Math.round(c.y));break;case 1:d=Z4Math.distance(t[0].x,t[0].y,t[2].x,t[2].y),h=Z4Math.atan(t[0].x,t[0].y,i,s)-Z4Math.HALF_PI,c=this.getPoint(t[0].x,t[0].y,t[0].x+d*Math.cos(h),t[0].y+d*Math.sin(h),d,h,a,n),t[1]=new Point(i,s),t[2]=new Point(Math.round(c.x),Math.round(c.y));break;case 2:o=Z4Math.distance(t[0].x,t[0].y,t[1].x,t[1].y),r=Z4Math.atan(t[0].x,t[0].y,i,s)+Z4Math.HALF_PI,l=this.getPoint(t[0].x,t[0].y,t[0].x+o*Math.cos(r),t[0].y+o*Math.sin(r),o,r,a,n),t[1]=new Point(Math.round(l.x),Math.round(l.y)),t[2]=new Point(i,s)}}getPoint(t,e,i,s,a,n,r,o){for(;(i<0||i>r||s<0||s>o)&&a>0;)i=t+(a=Math.max(0,a-.05))*Math.cos(n),s=e+a*Math.sin(n);return new Z4Point(i,s)}pushPointPositions(t,e,i){t.push(new Point(e/2,i/2)),t.push(new Point(e,i/2)),t.push(new Point(e/2,0))}needsRescale(t){switch(t){case Z4AbstractBoundaryBehaviorFiller.STOP_AT_BOUNDARY:case Z4AbstractBoundaryBehaviorFiller.FILL_AT_BOUNDARY:return!1;case Z4AbstractBoundaryBehaviorFiller.SYMMETRIC_AT_BOUNDARY:case Z4AbstractBoundaryBehaviorFiller.REPEAT_AT_BOUNDARY:return 7!==this.vertexCounter.getValue();default:return!0}}getFiller(t,e,i){let s=Z4Math.distance(e[0].x,e[0].y,e[1].x,e[1].y),a=Z4Math.distance(e[0].x,e[0].y,e[2].x,e[2].y),n=Z4Math.atan(e[0].x,e[0].y,e[1].x,e[1].y),r=this.vertexCounter.getValue();return 7===r?new Z4EllipticFiller(t,e[0].x,e[0].y,s,this.regular.isSelected()?s:a,n,i):this.star.isSelected()?new Z4StarFiller(t,e[0].x,e[0].y,s,this.regular.isSelected()?s:a,n,r+3,i):new Z4PolygonFiller(t,e[0].x,e[0].y,s,this.regular.isSelected()?s:a,n,r+3,i)}isPointEnabled(t){return 2!==t||!this.regular.isSelected()}drawObjects(t,e){let i=[];t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),this.regular.isSelected()||(t.moveTo(e[0].x,e[0].y),t.lineTo(e[2].x,e[2].y)),t.strokeStyle=this.getStrokeStyle("black"),t.setLineDash(i),t.stroke(),i.push(2.5,2.5),t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),this.regular.isSelected()||(t.moveTo(e[0].x,e[0].y),t.lineTo(e[2].x,e[2].y)),t.strokeStyle=this.getStrokeStyle("white"),t.setLineDash(i),t.stroke()}getStrokeStyle(t){return t}}class Z4RibbonFilePanel extends JSPanel{canvas=null;statusPanel=null;constructor(){super(),this.setLayout(new GridBagLayout),this.cssAddClass("z4ribbonfilepanel"),this.addLabel(Z4Translations.NEW_PROJECT,0,3),this.addButton(Z4Translations.CREATE,!0,0,1,"left",t=>this.checkSaved(Z4Translations.CREATE,()=>this.createFromColor())),this.addButton(Z4Translations.FROM_CLIPBOARD,"function"==typeof navigator.clipboard.read,1,1,"both",t=>this.checkSaved(Z4Translations.FROM_CLIPBOARD,()=>this.createFromClipboard())),this.addButton(Z4Translations.FROM_FILE,!0,2,1,"right",t=>this.checkSaved(Z4Translations.FROM_FILE,()=>this.createFromFile())),this.addVLine(3,0),this.addLabel(Z4Translations.OPEN,4,1),this.addButton(Z4Translations.OPEN_PROJECT,!0,4,1,"",t=>this.checkSaved(Z4Translations.OPEN_PROJECT,()=>this.openProject())),this.addVLine(5,0),this.addLabel(Z4Translations.SAVE,6,2),this.addButton(Z4Translations.SAVE_PROJECT,!0,6,1,"left",t=>this.saveProject(null)),this.addButton(Z4Translations.EXPORT,!0,7,1,"right",t=>this.exportToFile()),this.addVLine(8,1)}setCanvas(t){this.canvas=t}setStatusPanel(t){this.statusPanel=t}addLabel(t,e,i){let s=new JSLabel;s.setText(t);let a=new GridBagConstraints;a.gridx=e,a.gridy=0,a.gridwidth=i,a.anchor=GridBagConstraints.WEST,a.insets=new Insets(5,5,2,0),this.add(s,a)}addButton(t,e,i,s,a,n){let r=new JSButton;r.setText(t),r.setEnabled(e),r.setContentAreaFilled(!1),r.addActionListener(n);let o=new GridBagConstraints;switch(o.gridx=i,o.gridy=s,o.anchor=GridBagConstraints.NORTH,a){case"left":o.insets=new Insets(0,5,0,0),r.getStyle().borderTopRightRadius="0px",r.getStyle().borderBottomRightRadius="0px",r.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"both":r.getStyle().borderRadius="0px",r.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",r.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"right":o.insets=new Insets(0,0,0,5),r.getStyle().borderTopLeftRadius="0px",r.getStyle().borderBottomLeftRadius="0px",r.getStyle().borderLeft="1px solid var(--main-action-bgcolor)"}this.add(r,o)}addVLine(t,e){let i=new JSComponent(document.createElement("div"));i.getStyle().width="1px",i.getStyle().background="var(--main-action-bgcolor";let s=new GridBagConstraints;s.gridx=t,s.gridy=0,s.gridheight=2,s.fill=GridBagConstraints.VERTICAL,s.weightx=e,s.weighty=1,s.insets=new Insets(1,2,1,2),this.add(i,s)}checkSaved(t,e){this.canvas.isSaved()?e():JSOptionPane.showConfirmDialog(Z4Translations.PROJECT_NOT_SAVED_MESSAGE,t,JSOptionPane.YES_NO_CANCEL_OPTION,JSOptionPane.QUESTION_MESSAGE,t=>{switch(t){case JSOptionPane.YES_OPTION:this.saveProject(e);break;case JSOptionPane.NO_OPTION:e()}})}createFromColor(){let t=new Z4NewImagePanel;JSOptionPane.showInputDialog(t,Z4Translations.CREATE,t=>{},()=>!0,e=>{if(e===JSOptionPane.OK_OPTION){let i=t.getSelectedSize();this.canvas.create(i.width,i.height,t.getSelectedColor())}})}createFromFile(){JSFileChooser.showOpenDialog(""+Z4Constants.ACCEPTED_IMAGE_FILE_FORMAT.join(","),JSFileChooser.SINGLE_SELECTION,0,t=>t.forEach(t=>this.canvas.createFromFile(t)))}createFromClipboard(){this.canvas.createFromClipboard()}openProject(){JSFileChooser.showOpenDialog(".z4i",JSFileChooser.SINGLE_SELECTION,0,t=>t.forEach(t=>this.canvas.openProject(t)))}saveProject(t){let e=new JSPanel;e.setLayout(new BorderLayout(0,0));let i=new JSLabel;i.setText(Z4Translations.PROJECT_NAME),e.add(i,BorderLayout.NORTH);let s=new JSTextField;s.setText(this.canvas.getProjectName()),e.add(s,BorderLayout.CENTER),JSOptionPane.showInputDialog(e,Z4Translations.SAVE,t=>s.addActionListener(e=>t(new ChangeEvent)),()=>!!s.getText(),e=>{e===JSOptionPane.OK_OPTION&&this.canvas.saveProject(s.getText(),t)})}exportToFile(){let t=new Z4ExportToFilePanel;t.setFilename(this.canvas.getProjectName()),JSOptionPane.showInputDialog(t,Z4Translations.EXPORT,e=>t.addChangeListener(e),()=>t.isValid(),e=>{e===JSOptionPane.OK_OPTION&&this.canvas.exportToFile(t.getFilename(),t.getFileExtension(),t.getQuality())})}}class Z4RibbonHelpPanel extends JSPanel{constructor(){super(),this.setLayout(new FlowLayout(FlowLayout.LEFT,5,5)),this.cssAddClass("z4ribbonhelppanel");let t=new JSButton;t.setText(Z4Translations.ABOUT),t.setContentAreaFilled(!1),t.addActionListener(t=>this.showAbout()),this.add(t,null)}showAbout(){let t=RegExp("pizzApazzA-bundle-.*js");document.querySelectorAll("script").forEach(e=>{let i=e.getAttribute("src");if(t.test(i)){let s=i.indexOf("pizzApazzA-bundle-"),a=i.indexOf(".js"),n=i.substring(s+18,a),r=new JSPanel;r.cssAddClass("z4ribbonhelppanel-about"),r.setLayout(new BoxLayout(r,BoxLayout.Y_AXIS));let o=new JSComponent(document.createElement("img"));o.cssAddClass("z4ribbonhelppanel-splash"),r.add(o,null);let l=new JSLabel;l.setProperty("innerHTML",Z4Translations.BASED_ON.replace("$version$",n)),l.getStyle().marginTop="5px",l.getStyle().maxWidth="500px",r.add(l,null),JSOptionPane.showMessageDialog(r,Z4Translations.ABOUT,JSOptionPane.INFORMATION_MESSAGE,null)}})}}class Z4RibbonLayerPanel extends JSPanel{layersPreview=new JSPanel;canvas=null;layerDnD=null;previewDnD=null;constructor(){super(),this.setLayout(new GridBagLayout),this.cssAddClass("z4ribbonlayerpanel"),this.addLabel(Z4Translations.NEW_LAYER,0),this.addButton(Z4Translations.CREATE,!0,0,1,"left",t=>this.addFromColor()),this.addButton(Z4Translations.FROM_CLIPBOARD,"function"==typeof navigator.clipboard.read,1,1,"both",t=>this.addFromClipboard()),this.addButton(Z4Translations.FROM_FILE,!0,2,1,"right",t=>this.addFromFile()),this.addVLine(3),this.layersPreview.setLayout(new BoxLayout(this.layersPreview,BoxLayout.X_AXIS)),this.layersPreview.getStyle().overflowX="scroll",this.layersPreview.addEventListener("dragenter",t=>t.preventDefault()),this.layersPreview.addEventListener("dragover",t=>t.preventDefault()),this.layersPreview.addEventListener("dragleave",t=>t.preventDefault()),this.layersPreview.addEventListener("drop",t=>{t.preventDefault();let e=t,i=this.previewDnD.invoke("getBoundingClientRect()"),s=this.layersPreview.invoke("getBoundingClientRect()"),a=parseInt((e.clientX-s.left)/i.width);this.canvas.moveLayer(this.layerDnD,a)&&(a<this.canvas.getLayersCount()?(a=Math.min(this.canvas.getLayersCount(),a+1),this.layersPreview.insertBefore(this.previewDnD,"details:nth-child("+a+")")):this.layersPreview.add(this.previewDnD,null))});let t=new GridBagConstraints;t.gridx=4,t.gridy=0,t.gridheight=2,t.weightx=1,t.fill=GridBagConstraints.BOTH,this.add(this.layersPreview,t)}setCanvas(t){this.canvas=t}addLabel(t,e){let i=new JSLabel;i.setText(t);let s=new GridBagConstraints;s.gridx=e,s.gridy=0,s.gridwidth=3,s.anchor=GridBagConstraints.WEST,s.insets=new Insets(5,5,2,0),this.add(i,s)}addButton(t,e,i,s,a,n){let r=new JSButton;r.setText(t),r.setEnabled(e),r.setContentAreaFilled(!1),r.addActionListener(n);let o=new GridBagConstraints;switch(o.gridx=i,o.gridy=s,o.anchor=GridBagConstraints.NORTH,a){case"left":o.insets=new Insets(0,5,0,0),r.getStyle().borderTopRightRadius="0px",r.getStyle().borderBottomRightRadius="0px",r.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"both":r.getStyle().borderRadius="0px",r.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",r.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"right":o.insets=new Insets(0,0,0,5),r.getStyle().borderTopLeftRadius="0px",r.getStyle().borderBottomLeftRadius="0px",r.getStyle().borderLeft="1px solid var(--main-action-bgcolor)"}this.add(r,o)}addVLine(t){let e=new JSComponent(document.createElement("div"));e.getStyle().width="1px",e.getStyle().background="var(--main-action-bgcolor";let i=new GridBagConstraints;i.gridx=t,i.gridy=0,i.gridheight=2,i.fill=GridBagConstraints.VERTICAL,i.weighty=1,i.insets=new Insets(1,2,1,2),this.add(e,i)}addFromColor(){let t=new Z4NewImagePanel;JSOptionPane.showInputDialog(t,Z4Translations.CREATE,t=>{},()=>!0,e=>{if(e===JSOptionPane.OK_OPTION){let i=t.getSelectedSize();this.canvas.addLayer(i.width,i.height,t.getSelectedColor())}})}addFromFile(){JSFileChooser.showOpenDialog(""+Z4Constants.ACCEPTED_IMAGE_FILE_FORMAT.join(","),JSFileChooser.SINGLE_SELECTION,0,t=>t.forEach(t=>this.canvas.addLayerFromFile(t)))}addFromClipboard(){this.canvas.addLayerFromClipboard()}reset(){this.layersPreview.setProperty("innerHTML","")}addLayerPreview(t){let e=new Z4LayerPreview;e.setLayer(this.canvas,t),e.setChildAttributeByQuery("summary","draggable","true"),e.addEventListener("dragstart",i=>{i.dataTransfer.effectAllowed="move",this.layerDnD=t,this.previewDnD=e}),this.layersPreview.add(e,null)}}class Z4RibbonSettingsPanel extends JSPanel{language=new JSComboBox;theme=new JSComboBox;color=new JSColorChooser;constructor(){super(),this.setLayout(new GridBagLayout),this.cssAddClass("z4ribbonsettingspanel");let t=new JSLabel;t.setText(Z4Translations.LANGUAGE);let e=new GridBagConstraints;e.gridx=0,e.gridy=0,e.anchor=GridBagConstraints.WEST,e.insets=new Insets(5,5,2,0),this.add(t,e);let i=new DefaultKeyValueComboBoxModelAndRenderer;i.addElement(new KeyValue("en",Z4Translations.LANGUAGE_ENGLISH_NATIVE)),i.addElement(new KeyValue("it",Z4Translations.LANGUAGE_ITALIAN_NATIVE)),this.language.setModelAndRenderer(i),this.language.setSelectedItem(Z4Translations.CURRENT_LANGUAGE),this.language.addActionListener(t=>this.onchangeLanguage()),(e=new GridBagConstraints).gridx=0,e.gridy=1,e.fill=GridBagConstraints.HORIZONTAL,e.anchor=GridBagConstraints.NORTH,e.weighty=1,e.insets=new Insets(0,5,0,5),this.add(this.language,e),(t=new JSLabel).setText(Z4Translations.THEME),(e=new GridBagConstraints).gridx=1,e.gridy=0,e.anchor=GridBagConstraints.WEST,e.insets=new Insets(5,5,2,0),this.add(t,e);let s=null;switch(localStorage.getItem("z4theme")){case"light":s=new KeyValue("light",Z4Translations.THEME_LIGHT);break;case"dark":s=new KeyValue("dark",Z4Translations.THEME_DARK);break;default:s=new KeyValue("auto",Z4Translations.THEME_AUTO)}let a=new DefaultKeyValueComboBoxModelAndRenderer;a.addElement(new KeyValue("auto",Z4Translations.THEME_AUTO)),a.addElement(new KeyValue("light",Z4Translations.THEME_LIGHT)),a.addElement(new KeyValue("dark",Z4Translations.THEME_DARK)),this.theme.setModelAndRenderer(a),this.theme.setSelectedItem(s),this.theme.addActionListener(t=>this.onchangeTheme()),(e=new GridBagConstraints).gridx=1,e.gridy=1,e.fill=GridBagConstraints.HORIZONTAL,e.anchor=GridBagConstraints.NORTH,e.weighty=1,e.insets=new Insets(0,5,0,5),this.add(this.theme,e),(t=new JSLabel).setText(Z4Translations.THEME_COLOR),(e=new GridBagConstraints).gridx=2,e.gridy=0,e.anchor=GridBagConstraints.WEST,e.insets=new Insets(5,5,2,0),this.add(t,e);let n=localStorage.getItem("z4color");this.color.setSelectedColor(Color.fromRGB_HEX(n||"#0d6efd")),this.color.setOpacityVisible(!1),this.color.addChangeListener(t=>this.onchangeColor()),(e=new GridBagConstraints).gridx=2,e.gridy=1,e.fill=GridBagConstraints.HORIZONTAL,e.anchor=GridBagConstraints.NORTH,e.weighty=1,e.insets=new Insets(0,5,0,5),this.add(this.color,e);let r=new JSButton;r.setText(Z4Translations.RESET),r.setContentAreaFilled(!1),r.addActionListener(t=>this.onreset()),(e=new GridBagConstraints).gridx=3,e.gridy=1,e.fill=GridBagConstraints.HORIZONTAL,e.anchor=GridBagConstraints.NORTH,e.weighty=1,e.insets=new Insets(0,5,0,5),this.add(r,e),t=new JSLabel,(e=new GridBagConstraints).gridx=4,e.gridy=0,e.fill=GridBagConstraints.BOTH,e.weightx=1,this.add(t,e)}onchangeLanguage(){localStorage.setItem("z4language",this.language.getSelectedItem().key),JSOptionPane.showMessageDialog(Z4Translations.REFRESH_PAGE_MESSAGE,Z4Translations.LANGUAGE,JSOptionPane.INFORMATION_MESSAGE,null)}onchangeTheme(){localStorage.setItem("z4theme",this.theme.getSelectedItem().key),JSOptionPane.showMessageDialog(Z4Translations.REFRESH_PAGE_MESSAGE,Z4Translations.THEME,JSOptionPane.INFORMATION_MESSAGE,null)}onchangeColor(){this.color.getValueIsAdjusting()||(localStorage.setItem("z4color",this.color.getSelectedColor().getRGB_HEX()),JSOptionPane.showMessageDialog(Z4Translations.REFRESH_PAGE_MESSAGE,Z4Translations.THEME_COLOR,JSOptionPane.INFORMATION_MESSAGE,null))}onreset(){localStorage.removeItem("z4language"),localStorage.removeItem("z4theme"),localStorage.removeItem("z4color"),JSOptionPane.showMessageDialog(Z4Translations.REFRESH_PAGE_MESSAGE,Z4Translations.RESET,JSOptionPane.INFORMATION_MESSAGE,null)}}class Z4ExportToFilePanel extends JSPanel{filename=new JSTextField;png=new JSRadioButton;jpg=new JSRadioButton;qualitySlider=new JSSlider;qualitySpinner=new JSSpinner;listeners=[];constructor(){super(),this.cssAddClass("z4exporttofilepanel"),this.setLayout(new GridBagLayout),this.addLabel(Z4Translations.FILENAME,0,0),this.filename.addActionListener(t=>this.onchange());let t=new GridBagConstraints;t.gridx=0,t.gridy=1,t.gridwidth=2,t.fill=GridBagConstraints.HORIZONTAL,t.weightx=1,this.add(this.filename,t);let e=new ButtonGroup;e.add(this.png),e.add(this.jpg),this.addRadio(this.png,!0,"PNG",0),this.addRadio(this.jpg,!1,"JPG",1),this.addLabel(Z4Translations.QUALITY,0,3),this.qualitySlider.setEnabled(!1),this.qualitySlider.setValue(100),this.qualitySlider.addChangeListener(t=>this.qualitySpinner.setValue(this.qualitySlider.getValue())),(t=new GridBagConstraints).gridx=0,t.gridy=4,t.gridwidth=2,t.fill=GridBagConstraints.HORIZONTAL,t.weightx=1,this.add(this.qualitySlider,t),this.qualitySpinner.setEnabled(!1),this.qualitySpinner.setModel(new SpinnerNumberModel(100,0,100,1)),this.qualitySpinner.addChangeListener(t=>this.qualitySlider.setValue(this.qualitySpinner.getValue())),this.qualitySpinner.getStyle().minWidth="3rem",this.qualitySpinner.getChilStyleByQuery("input[type=number]").minWidth="2.5rem",this.qualitySpinner.getChilStyleByQuery("input[type=number]").width="2.5rem",(t=new GridBagConstraints).gridx=1,t.gridy=3,t.anchor=GridBagConstraints.EAST,this.add(this.qualitySpinner,t)}addLabel(t,e,i){let s=new JSLabel;s.setText(t);let a=new GridBagConstraints;a.gridx=e,a.gridy=i,a.anchor=GridBagConstraints.WEST,this.add(s,a)}onchange(){let t=new ChangeEvent;this.listeners.forEach(e=>{"function"==typeof e?e(t):e.stateChanged(t)})}addRadio(t,e,i,s){t.setSelected(e),t.setText(i),t.addActionListener(t=>{this.qualitySlider.setEnabled(!e),this.qualitySpinner.setEnabled(!e)});let a=new GridBagConstraints;a.gridx=s,a.gridy=2,a.anchor=GridBagConstraints.WEST,this.add(t,a)}addChangeListener(t){this.listeners.push(t)}isValid(){return!!this.filename.getText()}setFilename(t){this.filename.setText(t)}getFilename(){return this.filename.getText()}getFileExtension(){return this.png.isSelected()?".png":".jpg"}getQuality(){return this.qualitySpinner.getValue()/100}}class Z4NewImagePanel extends JSPanel{width=new JSSpinner;height=new JSSpinner;resolution=new JSSpinner;dimensionMM=new JSLabel;dimensionIN=new JSLabel;colorPreview=new Z4ColorPreview;selectedColor=new Color(255,255,255,255);constructor(){super(),this.cssAddClass("z4newimagepanel"),this.setLayout(new GridBagLayout),this.addLabel(Z4Translations.WIDTH+" (px)",0,0,1,0),this.addSpinner(this.width,Z4Constants.DEFAULT_IMAGE_SIZE,Z4Constants.MAX_IMAGE_SIZE,0,1),this.addLabel(Z4Translations.HEIGHT+" (px)",1,0,1,0),this.addSpinner(this.height,Z4Constants.DEFAULT_IMAGE_SIZE,Z4Constants.MAX_IMAGE_SIZE,1,1),this.addLabel(Z4Translations.RESOLUTION+" (dpi)",2,0,1,0),this.addSpinner(this.resolution,Z4Constants.DEFAULT_DPI,Z4Constants.MAX_DPI,2,1),this.addDimension(this.dimensionMM,3),this.addDimension(this.dimensionIN,4),this.addLabel(Z4Translations.FILLING_COLOR,0,5,3,10),this.colorPreview.setColor(this.selectedColor);let t=new GridBagConstraints;t.gridx=0,t.gridy=6,t.gridwidth=2,t.fill=GridBagConstraints.HORIZONTAL,t.insets=new Insets(0,5,0,5),this.add(this.colorPreview,t);let e=new JSButton;e.setText(Z4Translations.EDIT),e.addActionListener(t=>{JSColorChooser.showDialog(Z4Translations.FILLING_COLOR,this.selectedColor,!0,null,t=>{this.selectedColor=t,this.colorPreview.setColor(t)})}),(t=new GridBagConstraints).gridx=2,t.gridy=6,t.gridwidth=1,t.anchor=GridBagConstraints.WEST,this.add(e,t),this.setDimensions()}addLabel(t,e,i,s,a){let n=new JSLabel;n.setText(t);let r=new GridBagConstraints;r.gridx=e,r.gridy=i,r.gridwidth=s,r.anchor=GridBagConstraints.WEST,r.insets=new Insets(a,5,0,5),this.add(n,r)}addSpinner(t,e,i,s,a){t.setModel(new SpinnerNumberModel(e,1,i,1)),t.getStyle().minWidth="6.6rem",t.getChilStyleByQuery("input[type=number]").minWidth="5.5rem",t.getChilStyleByQuery("input[type=number]").width="5.5rem",t.addChangeListener(t=>this.setDimensions());let n=new GridBagConstraints;n.gridx=s,n.gridy=a,n.anchor=GridBagConstraints.WEST,n.insets=new Insets(0,5,0,5),this.add(t,n)}addDimension(t,e){let i=new GridBagConstraints;i.gridy=e,i.gridwidth=3,i.fill=GridBagConstraints.HORIZONTAL,i.insets=new Insets(2,5,0,0),this.add(t,i)}setDimensions(){let t=this.width.getValue(),e=this.height.getValue(),i=this.resolution.getValue(),s=t/i,a=e/i;this.dimensionMM.setText(new Number(25.4*s).toFixed(2)+" ✖ "+new Number(25.4*a).toFixed(2)+" mm"),this.dimensionIN.setText(new Number(s).toFixed(2)+" ✖ "+new Number(a).toFixed(2)+" inch")}getSelectedSize(){return new Dimension(this.width.getValue(),this.height.getValue())}getSelectedColor(){return this.selectedColor}}class Z4StatusPanel extends JSPanel{canvas=null;projectName=new JSLabel;zoom=new JSComboBox;progressBar=new JSProgressBar;constructor(){super(),this.cssAddClass("z4statuspanel"),this.setLayout(new GridBagLayout),this.projectName.setText(Z4Translations.PROJECT_NAME+": "),this.setLabel(this.projectName,0),this.addPipe(1);let t=new DefaultKeyValueComboBoxModelAndRenderer;Z4Constants.ZOOM_LEVEL.forEach(e=>t.addElement(new KeyValue(""+e,parseInt(100*e)+"%"))),t.addElement(new KeyValue("FIT",Z4Translations.FIT)),this.zoom.setModelAndRenderer(t),this.zoom.getStyle().minWidth="5rem",this.zoom.getChilStyleByQuery("ul").minWidth="5rem",this.zoom.setSelectedItem(new KeyValue("1","")),this.zoom.addActionListener(t=>this.onZoom());let e=new GridBagConstraints;e.gridx=2,e.gridy=0,this.add(this.zoom,e),this.addPipe(3),this.progressBar.setStringPainted(!0),(e=new GridBagConstraints).gridx=4,e.gridy=0,e.weightx=1,e.fill=GridBagConstraints.BOTH,this.add(this.progressBar,e)}addPipe(t){let e=new JSLabel;e.setText("|"),e.getStyle().minWidth="2rem",e.getStyle().textAlign="center",this.setLabel(e,t)}setLabel(t,e){let i=new GridBagConstraints;i.gridx=e,i.gridy=0,this.add(t,i)}setCanvas(t){this.canvas=t}setProjectName(t){this.projectName.setText(Z4Translations.PROJECT_NAME+": "+t)}setProgressBarValue(t){this.progressBar.setValue(t)}setZoom(t){this.zoom.setSelectedItem(new KeyValue(""+t,""))}onZoom(){let t=this.zoom.getSelectedItem().key;"FIT"===t?this.canvas.fitZoom():this.canvas.setZoom(parseFloat(t))}}class Z4Ribbon extends JSTabbedPane{filePanel=new Z4RibbonFilePanel;layerPanel=new Z4RibbonLayerPanel;settingsPanel=new Z4RibbonSettingsPanel;helpPanel=new Z4RibbonHelpPanel;constructor(){super(),this.cssAddClass("z4ribbon"),this.addTab(Z4Translations.FILE,this.filePanel),this.addTab(Z4Translations.LAYER,this.layerPanel),this.addTab(Z4Translations.SETTINGS,this.settingsPanel),this.addTab(Z4Translations.HELP,this.helpPanel)}setCanvas(t){this.filePanel.setCanvas(t),this.layerPanel.setCanvas(t),t.setRibbonLayerPanel(this.layerPanel)}setStatusPanel(t){this.filePanel.setStatusPanel(t)}}class Z4Constants{static ACCEPTED_IMAGE_FILE_FORMAT=[".gif",".png",".apng",".jpeg",".jpg",".jfif",".pjpeg",".pjp",".bmp",".svg",".webp",".avif"];static ZOOM_LEVEL=[.25,.33,.5,.66,1,1.5,2,3,4];static COMPOSITE_OPERATION=[["source-over","source-in","source-out","source-atop"],["destination-over","destination-in","destination-out","destination-atop"],["lighter"],["copy"],["xor"],["multiply","screen","overlay"],["darken","lighten"],["color-dodge","color-burn"],["hard-light","soft-light"],["difference","exclusion"],["hue","saturation","color","luminosity"]];static DEFAULT_IMAGE_SIZE=500;static MAX_IMAGE_SIZE=3e3;static DEFAULT_DPI=150;static MAX_DPI=1500;constructor(){}}class Z4EmptyImageProducer extends AbstractHTMLImageProducer{constructor(t){super(t)}produce(){return document.createElement("img")}}class Z4Translations{static CURRENT_LANGUAGE=null;static FILE="";static NEW_PROJECT="";static CREATE="";static FROM_CLIPBOARD="";static FROM_FILE="";static OPEN="";static OPEN_PROJECT="";static SAVE="";static SAVE_PROJECT="";static EXPORT="";static PROJECT_NOT_SAVED_MESSAGE="";static LAYER="";static LAYER_NAME="";static NEW_LAYER="";static BACKGROUND_LAYER="";static SETTINGS="";static LANGUAGE="";static LANGUAGE_ENGLISH_NATIVE="";static LANGUAGE_ITALIAN_NATIVE="";static THEME="";static THEME_AUTO="";static THEME_LIGHT="";static THEME_DARK="";static THEME_COLOR="";static REFRESH_PAGE_MESSAGE="";static HELP="";static ABOUT="";static BASED_ON="";static PROJECT_NAME="";static FILENAME="";static QUALITY="";static RESET="";static WIDTH="";static HEIGHT="";static RESOLUTION="";static FILLING_COLOR="";static BACKGROUND_COLOR="";static PATTERN="";static EDIT="";static FIT="";static OFFSET_X="";static OFFSET_Y="";static BASIC="";static ADVANCED="";static STAR="";static VERTICES="";static REGULAR="";static DIMENSION="";static FREE="";static LOCK_RATIO="";static LOCK="";static COMPOSITE_OPERATION="";static COMPOSITE_OPERATION_SOURCE_OVER="";static COMPOSITE_OPERATION_SOURCE_IN="";static COMPOSITE_OPERATION_SOURCE_OUT="";static COMPOSITE_OPERATION_SOURCE_ATOP="";static COMPOSITE_OPERATION_DESTINATION_OVER="";static COMPOSITE_OPERATION_DESTINATION_IN="";static COMPOSITE_OPERATION_DESTINATION_OUT="";static COMPOSITE_OPERATION_DESTINATION_ATOP="";static COMPOSITE_OPERATION_LIGHTER="";static COMPOSITE_OPERATION_COPY="";static COMPOSITE_OPERATION_XOR="";static COMPOSITE_OPERATION_MULTIPLY="";static COMPOSITE_OPERATION_SCREEN="";static COMPOSITE_OPERATION_OVERLAY="";static COMPOSITE_OPERATION_DARKEN="";static COMPOSITE_OPERATION_LIGHTEN="";static COMPOSITE_OPERATION_COLOR_DODGE="";static COMPOSITE_OPERATION_COLOR_BURN="";static COMPOSITE_OPERATION_HARD_LIGHT="";static COMPOSITE_OPERATION_SOFT_LIGHT="";static COMPOSITE_OPERATION_DIFFERENCE="";static COMPOSITE_OPERATION_EXCLUSION="";static COMPOSITE_OPERATION_HUE="";static COMPOSITE_OPERATION_SATURATION="";static COMPOSITE_OPERATION_COLOR="";static COMPOSITE_OPERATION_LUMINOSITY="";static{switch(navigator.language.substring(0,2)){case"en":default:Z4Translations.setEnglish();break;case"it":Z4Translations.setItalian()}}constructor(){}static setEnglish(){Z4Translations.FILE="File",Z4Translations.NEW_PROJECT="New Project",Z4Translations.CREATE="Create",Z4Translations.FROM_CLIPBOARD="From Clipboard",Z4Translations.FROM_FILE="From File",Z4Translations.OPEN="Open",Z4Translations.OPEN_PROJECT="Open Project",Z4Translations.SAVE="Save",Z4Translations.SAVE_PROJECT="Save Project",Z4Translations.EXPORT="Export",Z4Translations.PROJECT_NOT_SAVED_MESSAGE="Project not saved, do you want to save your changes?",Z4Translations.LAYER="Layer",Z4Translations.LAYER_NAME="Layer Name",Z4Translations.NEW_LAYER="New Layer",Z4Translations.BACKGROUND_LAYER="Bkgrd",Z4Translations.SETTINGS="Settings",Z4Translations.LANGUAGE="Language",Z4Translations.LANGUAGE_ENGLISH_NATIVE="English",Z4Translations.LANGUAGE_ITALIAN_NATIVE="Italiano",Z4Translations.THEME="Theme",Z4Translations.THEME_AUTO="Auto",Z4Translations.THEME_LIGHT="Light",Z4Translations.THEME_DARK="Dark",Z4Translations.THEME_COLOR="Color",Z4Translations.REFRESH_PAGE_MESSAGE="Refresh the page to make the changes",Z4Translations.HELP="Help",Z4Translations.ABOUT="About",Z4Translations.BASED_ON="<p>pizzApazzA<sup>&#8734;</sup> Version $version$ is based on pizzApazzA VB6 by Ettore Luzio and is licensed under <a href='https://unlicense.org/'>Unlicense license</a>.</p><p>Developed in Java by Gianpiero Di Blasi, transpilled in JavaScript by means of <a href='https://github.com/gianpierodiblasi/josetta' target='_blank'>Josetta</a> (<a href='https://github.com/gianpierodiblasi/pizzApazzAinfinity' target='_blank'>github repository</a>).</p><p>Dependencies:</p><ul><li><a href='https://repository.jsweet.org/artifactory/libs-release-local/org/jsweet/jsweet-core/' target='_blank'>jsweet-core</a></li><li><a href='https://github.com/gianpierodiblasi/swing.js' target='_blank'>swing.js</a></li><li><a href='https://pomax.github.io/bezierjs/' target='_blank'>Bezier.js</a></li></ul>",Z4Translations.PROJECT_NAME="Project Name",Z4Translations.FILENAME="File Name",Z4Translations.QUALITY="Quality",Z4Translations.RESET="Reset",Z4Translations.WIDTH="Width",Z4Translations.HEIGHT="Height",Z4Translations.RESOLUTION="Resolution",Z4Translations.FILLING_COLOR="Filling Color",Z4Translations.BACKGROUND_COLOR="Background Color",Z4Translations.PATTERN="Pattern",Z4Translations.EDIT="Edit",Z4Translations.FIT="Fit",Z4Translations.OFFSET_X="Offset X",Z4Translations.OFFSET_Y="Offset Y",Z4Translations.BASIC="Basic",Z4Translations.ADVANCED="Advanced",Z4Translations.STAR="Star",Z4Translations.VERTICES="Vertices",Z4Translations.REGULAR="Regular",Z4Translations.DIMENSION="Dimension",Z4Translations.FREE="Free",Z4Translations.LOCK_RATIO="Lock Ratio",Z4Translations.LOCK="Lock",Z4Translations.COMPOSITE_OPERATION="Composite Operation",Z4Translations.COMPOSITE_OPERATION_SOURCE_OVER="This is the default setting and draws the layer on top of the existing content",Z4Translations.COMPOSITE_OPERATION_SOURCE_IN="The layer is drawn only where both the layer and the destination content overlap; everything else is made transparent",Z4Translations.COMPOSITE_OPERATION_SOURCE_OUT="The layer is drawn where it doesn't overlap the existing content",Z4Translations.COMPOSITE_OPERATION_SOURCE_ATOP="The layer is only drawn where it overlaps the existing content",Z4Translations.COMPOSITE_OPERATION_DESTINATION_OVER="The layer is drawn behind the existing content",Z4Translations.COMPOSITE_OPERATION_DESTINATION_IN="The existing content is kept where both the layer and existing content overlap; everything else is made transparent",Z4Translations.COMPOSITE_OPERATION_DESTINATION_OUT="The existing content is kept where it doesn't overlap the layer",Z4Translations.COMPOSITE_OPERATION_DESTINATION_ATOP="The existing content is only kept where it overlaps the layer; the layer is drawn behind the content",Z4Translations.COMPOSITE_OPERATION_LIGHTER="Where both layer and existing content overlap the color is determined by adding color values",Z4Translations.COMPOSITE_OPERATION_COPY="Only the layer is shown",Z4Translations.COMPOSITE_OPERATION_XOR="Layer and existing content are made transparent where both overlap and drawn normal everywhere else",Z4Translations.COMPOSITE_OPERATION_MULTIPLY="The pixels of the layer are multiplied with the corresponding pixel of the existing content; a darker picture is the result",Z4Translations.COMPOSITE_OPERATION_SCREEN="The pixels are inverted, multiplied, and inverted again; a lighter picture is the result (opposite of 'multiply')",Z4Translations.COMPOSITE_OPERATION_OVERLAY="A combination of 'multiply' and 'screen'; dark parts on the existing content become darker, and light parts become lighter",Z4Translations.COMPOSITE_OPERATION_DARKEN="Retains the darkest pixels of both layer and existing content",Z4Translations.COMPOSITE_OPERATION_LIGHTEN="Retains the lightest pixels of both layer and existing content",Z4Translations.COMPOSITE_OPERATION_COLOR_DODGE="Divides the existing content by the inverted layer",Z4Translations.COMPOSITE_OPERATION_COLOR_BURN="Divides the inverted existing content by the layer, and then inverts the result",Z4Translations.COMPOSITE_OPERATION_HARD_LIGHT="A combination of 'multiply' and 'screen' like 'overlay', but with layer and existing content swapped",Z4Translations.COMPOSITE_OPERATION_SOFT_LIGHT="A softer version of 'hard-light'; pure black or white does not result in pure black or white",Z4Translations.COMPOSITE_OPERATION_DIFFERENCE="Subtracts the existing content from the layer or the other way round to always get a positive value",Z4Translations.COMPOSITE_OPERATION_EXCLUSION="Like 'difference', but with lower contrast",Z4Translations.COMPOSITE_OPERATION_HUE="Preserves the luma and chroma of the existing content, while adopting the hue of the layer",Z4Translations.COMPOSITE_OPERATION_SATURATION="Preserves the luma and hue of the existing content, while adopting the chroma of the layer",Z4Translations.COMPOSITE_OPERATION_COLOR="Preserves the luma of the existing content, while adopting the hue and chroma of the layer",Z4Translations.COMPOSITE_OPERATION_LUMINOSITY="Preserves the hue and chroma of the existing content, while adopting the luma of the layer",Z4Translations.CURRENT_LANGUAGE=new KeyValue("en",Z4Translations.LANGUAGE_ENGLISH_NATIVE)}static setItalian(){Z4Translations.FILE="File",Z4Translations.NEW_PROJECT="Nuovo Progetto",Z4Translations.CREATE="Crea",Z4Translations.FROM_CLIPBOARD="Dagli Appunti",Z4Translations.FROM_FILE="Da File",Z4Translations.OPEN="Apri",Z4Translations.OPEN_PROJECT="Apri Progetto",Z4Translations.SAVE="Salva",Z4Translations.SAVE_PROJECT="Salva Progetto",Z4Translations.EXPORT="Esporta",Z4Translations.PROJECT_NOT_SAVED_MESSAGE="Progetto non salvato, vuoi salvare le modifiche?",Z4Translations.LAYER="Livello",Z4Translations.LAYER_NAME="Nome Livello",Z4Translations.NEW_LAYER="Nuovo Livello",Z4Translations.BACKGROUND_LAYER="Sfondo",Z4Translations.SETTINGS="Impostazioni",Z4Translations.LANGUAGE="Lingua",Z4Translations.LANGUAGE_ENGLISH_NATIVE="English",Z4Translations.LANGUAGE_ITALIAN_NATIVE="Italiano",Z4Translations.THEME="Tema",Z4Translations.THEME_AUTO="Auto",Z4Translations.THEME_LIGHT="Chiaro",Z4Translations.THEME_DARK="Scuro",Z4Translations.THEME_COLOR="Colore",Z4Translations.REFRESH_PAGE_MESSAGE="Aggiorna la pagina per eseguire le modifiche",Z4Translations.HELP="Aiuto",Z4Translations.ABOUT="Informazioni su",Z4Translations.BASED_ON="<p>pizzApazzA<sup>&#8734;</sup> Versione $version$ \xe8 basato su pizzApazzA VB6 di Ettore Luzio ed \xe8 distribuito con <a href='https://unlicense.org/' target='_blank'>licenza Unlicense</a>.</p><p>Sviluppato in Java da Gianpiero Di Blasi, tradotto in JavaScript tramite <a href='https://github.com/gianpierodiblasi/josetta' target='_blank'>Josetta</a> (<a href='https://github.com/gianpierodiblasi/pizzApazzAinfinity' target='_blank'>repository github</a>).</p><p>Dipendenze:</p><ul><li><a href='https://repository.jsweet.org/artifactory/libs-release-local/org/jsweet/jsweet-core/' target='_blank'>jsweet-core</a></li><li><a href='https://github.com/gianpierodiblasi/swing.js' target='_blank'>swing.js</a></li><li><a href='https://pomax.github.io/bezierjs/' target='_blank'>Bezier.js</a></li></ul>",Z4Translations.PROJECT_NAME="Nome Progetto",Z4Translations.FILENAME="Nome File",Z4Translations.QUALITY="Qualit\xe0",Z4Translations.RESET="Ripristina",Z4Translations.WIDTH="Larghezza",Z4Translations.HEIGHT="Altezza",Z4Translations.RESOLUTION="Risoluzione",Z4Translations.FILLING_COLOR="Colore di Riempimento",Z4Translations.BACKGROUND_COLOR="Colore di Sfondo",Z4Translations.PATTERN="Trama",Z4Translations.EDIT="Modifica",Z4Translations.FIT="Adatta",Z4Translations.OFFSET_X="Offset X",Z4Translations.OFFSET_Y="Offset Y",Z4Translations.BASIC="Base",Z4Translations.ADVANCED="Avanzato",Z4Translations.STAR="Stella",Z4Translations.VERTICES="Vertici",Z4Translations.REGULAR="Regolare",Z4Translations.DIMENSION="Dimensione",Z4Translations.FREE="Libero",Z4Translations.LOCK_RATIO="Blocca Rapporto",Z4Translations.LOCK="Blocca",Z4Translations.COMPOSITE_OPERATION="Operazione Composita",Z4Translations.COMPOSITE_OPERATION_SOURCE_OVER="Questa \xe8 l'impostazione predefinita e disegna il livello sopra il contenuto esistente",Z4Translations.COMPOSITE_OPERATION_SOURCE_IN="Il livello viene disegnato solo dove si sovrappongono sia il livello che il contenuto di destinazione; tutto il resto \xe8 reso trasparente",Z4Translations.COMPOSITE_OPERATION_SOURCE_OUT="Il livello viene disegnato dove non si sovrappone al contenuto esistente",Z4Translations.COMPOSITE_OPERATION_SOURCE_ATOP="Il livello viene disegnato solo dove si sovrappone al contenuto esistente",Z4Translations.COMPOSITE_OPERATION_DESTINATION_OVER="Il livello viene disegnato dietro il contenuto esistente",Z4Translations.COMPOSITE_OPERATION_DESTINATION_IN="Il contenuto esistente viene mantenuto dove sia il livello che il contenuto esistente si sovrappongono; tutto il resto \xe8 reso trasparente",Z4Translations.COMPOSITE_OPERATION_DESTINATION_OUT="Il contenuto esistente viene mantenuto dove non si sovrappone al livello",Z4Translations.COMPOSITE_OPERATION_DESTINATION_ATOP="Il contenuto esistente viene mantenuto solo dove si sovrappone al livello; il livello viene disegnato dietro il contenuto",Z4Translations.COMPOSITE_OPERATION_LIGHTER="Laddove sia il livello che il contenuto esistente si sovrappongono, il colore viene determinato sommando i colori",Z4Translations.COMPOSITE_OPERATION_COPY="Viene mostrato solo il livello",Z4Translations.COMPOSITE_OPERATION_XOR="Il livello e il contenuto esistente vengono resi trasparenti laddove entrambi si sovrappongono e vengono disegnati normali altrove",Z4Translations.COMPOSITE_OPERATION_MULTIPLY="I pixel del layer vengono moltiplicati per il pixel corrispondente del contenuto esistente; il risultato \xe8 un'immagine pi\xf9 scura",Z4Translations.COMPOSITE_OPERATION_SCREEN="I pixel vengono invertiti, moltiplicati e nuovamente invertiti; il risultato \xe8 un'immagine pi\xf9 chiara (opposto di 'multiply')",Z4Translations.COMPOSITE_OPERATION_OVERLAY="Una combinazione di 'multiply' e 'screen'; le parti scure del contenuto esistente diventano pi\xf9 scure e le parti chiare diventano pi\xf9 chiare",Z4Translations.COMPOSITE_OPERATION_DARKEN="Mantiene i pixel pi\xf9 scuri sia del livello che del contenuto esistente",Z4Translations.COMPOSITE_OPERATION_LIGHTEN="Mantiene i pixel pi\xf9 chiari sia del livello che del contenuto esistente",Z4Translations.COMPOSITE_OPERATION_COLOR_DODGE="Divide il contenuto esistente per il livello invertito",Z4Translations.COMPOSITE_OPERATION_COLOR_BURN="Divide il contenuto esistente invertito per il livello, quindi inverte il risultato",Z4Translations.COMPOSITE_OPERATION_HARD_LIGHT="Una combinazione di 'multiply' e 'screen' come 'overlay', ma con il livello e il contenuto esistente scambiati",Z4Translations.COMPOSITE_OPERATION_SOFT_LIGHT="Una versione pi\xf9 morbida della 'hard-light'; il nero o il bianco puro non risultano in bianco o nero puro",Z4Translations.COMPOSITE_OPERATION_DIFFERENCE="Sottrae il contenuto esistente dal livello o viceversa per ottenere sempre un valore positivo",Z4Translations.COMPOSITE_OPERATION_EXCLUSION="Come 'difference', ma con contrasto inferiore",Z4Translations.COMPOSITE_OPERATION_HUE="Preserva la luminanza e la crominanza del contenuto esistente, adottando la tonalit\xe0 del livello",Z4Translations.COMPOSITE_OPERATION_SATURATION="Preserva la luminanza e la tonalit\xe0 del contenuto esistente, adottando la crominanza del livello",Z4Translations.COMPOSITE_OPERATION_COLOR="Preserva la luminanza del contenuto esistente, adottando la tonalit\xe0 e la saturazione del livello",Z4Translations.COMPOSITE_OPERATION_LUMINOSITY="Preserva la tonalit\xe0 e il croma del contenuto esistente, adottando la luminanza del livello",Z4Translations.CURRENT_LANGUAGE=new KeyValue("it",Z4Translations.LANGUAGE_ITALIAN_NATIVE)}}class Z4Layer{offscreen=null;offscreenCtx=null;name=null;offsetX=0;offsetY=0;opacity=1;compositeOperation="source-over";width=0;height=0;constructor(t,e,i,s,a,n){this.name=t,this.offscreen=new OffscreenCanvas(e,i),this.offscreenCtx=this.offscreen.getContext("2d"),this.offscreenCtx.fillStyle=this.getFillStyle(s.getRGBA_HEX()),this.offscreenCtx.fillRect(0,0,e,i),this.offsetX=(a-e)/2,this.offsetY=(n-i)/2,this.width=e,this.height=i}getFillStyle(t){return t}static fromImage(t,e,i,s){let a=new Z4Layer(t,e.width,e.height,new Color(0,0,0,0),i,s);return a.offscreenCtx.drawImage(e,0,0),a}convertToBlob(t){let e={};e.type="image/png",this.offscreen.convertToBlob(e).then(e=>{t(e)})}shift(t,e){this.offsetX+=t,this.offsetY+=e}setOpacity(t){this.opacity=t}getOpacity(){return this.opacity}setCompositeOperation(t){this.compositeOperation=t}getCompositeOperation(){return this.compositeOperation}move(t,e){this.offsetX=t,this.offsetY=e}setName(t){this.name=t}getName(){return this.name}getOffset(){return new Point(this.offsetX,this.offsetY)}getSize(){return new Dimension(this.width,this.height)}draw(t,e){t.save(),t.globalAlpha=this.opacity,t.globalCompositeOperation=this.compositeOperation,t.drawImage(this.offscreen,e?0:this.offsetX,e?0:this.offsetY),t.restore()}}class Z4Paper{layers=[];getLayersCount(){return this.layers.length}getLayerAt(t){return this.layers[t]}addLayer(t,e,i,s,a,n){this.layers.push(new Z4Layer(t,e,i,s,a,n))}addLayerFromImage(t,e,i,s){this.layers.push(Z4Layer.fromImage(t,e,i,s))}moveLayer(t,e){let i=Math.min(this.layers.length,e),s=this.layers.indexOf(t);return i<s?(this.layers.splice(i,0,this.layers.splice(s,1)[0]),!0):i>s&&(this.layers.splice(i,0,this.layers[s]),this.layers.splice(s,1),!0)}reset(){this.layers.length=0}draw(t,e){this.layers.forEach(i=>i.draw(t,e))}}