window.onload=e=>{switch(window.addEventListener("wheel",e=>{e.ctrlKey&&e.preventDefault()},{passive:!1}),window.addEventListener("keydown",e=>{e.ctrlKey&&("+"===e.key||"-"===e.key)&&(e.preventDefault(),document.querySelector(".z4canvas").dispatchEvent(new e.constructor(e.type,e)))}),localStorage.getItem("z4language")){case"en":Translations.setEnglish(),Z4Translations.setEnglish();break;case"it":Translations.setItalian(),Z4Translations.setItalian()}switch(localStorage.getItem("z4theme")){case"light":break;case"dark":SwingJS.instance().darkMode(!0).build();break;default:SwingJS.instance().darkMode(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches).build()}let t=localStorage.getItem("z4color");t&&SwingJS.instance().mainActionBGColor(t).build(),new Z4Frame};class Z4Canvas extends JSComponent{canvas=document.createElement("canvas");ctx=this.canvas.getContext("2d");ribbonLayerPanel=null;statusPanel=null;projectName=null;width=0;height=0;zoom=1;zooming=!1;saved=!0;paper=new Z4Paper;constructor(){super(document.createElement("div")),this.cssAddClass("z4canvas"),this.appendNodeChild(this.canvas),this.addEventListener("wheel",e=>{let t=e;t.ctrlKey&&(t.deltaY<0?this.zoomIn():t.ctrlKey&&t.deltaY>0&&this.zoomOut())}),this.addEventListener("keydown",e=>{let t=e;t.ctrlKey&&("+"===t.key?(t.stopPropagation(),this.zoomIn()):"-"===t.key&&(t.stopPropagation(),this.zoomOut()))})}setRibbonLayerPanel(e){this.ribbonLayerPanel=e}setStatusPanel(e){this.statusPanel=e}create(e,t,i){this.paper.reset(),this.paper.addLayer(Z4Translations.BACKGROUND_LAYER,e,t,i,e,t),this.ribbonLayerPanel.reset(),this.ribbonLayerPanel.addLayerPreview(this.paper.getLayerAt(this.paper.getLayersCount()-1)),this.afterCreate("",e,t)}createFromFile(e){let t=new FileReader;t.onload=i=>this.createFromURL(e.name.substring(0,e.name.lastIndexOf(".")),t.result),t.readAsDataURL(e)}createFromClipboard(){navigator.clipboard.read().then(e=>{e.forEach(e=>{let t=e.types.find((e,t,i)=>e.startsWith("image/"));e.getType(t).then(e=>{this.createFromURL("",URL.createObjectURL(e))})})})}createFromURL(e,t){let i=document.createElement("img");return i.onload=t=>(this.paper.reset(),this.paper.addLayerFromImage(Z4Translations.BACKGROUND_LAYER,i,i.width,i.height),this.ribbonLayerPanel.reset(),this.ribbonLayerPanel.addLayerPreview(this.paper.getLayerAt(this.paper.getLayersCount()-1)),this.afterCreate(e,i.width,i.height),null),i.src=t,null}afterCreate(e,t,i){this.projectName=e,this.statusPanel.setProjectName(e),this.statusPanel.setZoom(1),this.width=t,this.height=i,this.zoom=1,this.saved=!0,this.canvas.width=t,this.canvas.height=i,this.drawCanvas()}openProject(e){new JSZip().loadAsync(e).then(e=>{e.file("manifest.json").async("string",null).then(t=>{this.paper.reset(),this.ribbonLayerPanel.reset();let i=JSON.parse(""+t);this.openLayer(e,i,i.layers,0)})})}openLayer(e,t,i,s){e.file("layers/layer"+s+".png").async("blob",e=>this.statusPanel.setProgressBarValue(e.percent)).then(a=>{let n=document.createElement("img");this.statusPanel.setProgressBarValue(0),n.onload=a=>{this.paper.addLayerFromImage(i[s].name,n,n.width,n.height);let r=this.paper.getLayerAt(s);return r.setOpacity(i[s].opacity),r.setCompositeOperation(i[s].compositeOperation),r.move(i[s].offsetX,i[s].offsetY),this.ribbonLayerPanel.addLayerPreview(r),s+1===i.length?this.afterCreate(t.projectName,t.width,t.height):this.openLayer(e,t,i,s+1),null},n.src=URL.createObjectURL(a)})}saveProject(e,t){this.projectName=e,this.statusPanel.setProjectName(e),this.saveLayer(new JSZip,[],0,t)}saveLayer(e,t,i,s){let a=this.paper.getLayerAt(i);a.convertToBlob(n=>{e.file("layers/layer"+i+".png",n,null);let r=a.getOffset();if(t[i]='{"name": "'+a.getName()+'","opacity": '+a.getOpacity()+',"compositeOperation": "'+a.getCompositeOperation()+'","offsetX": '+r.x+',"offsetY": '+r.y+"}",i+1===this.paper.getLayersCount()){let o='{"projectName": "'+this.projectName+'",\n"width": '+this.width+',\n"height": '+this.height+',\n"layers": ['+t.join(",")+"]}";e.file("manifest.json",o,null);let l={};l.type="blob",l.compression="DEFLATE",l.streamFiles=!0;let h={};h.level=9,l.compressionOptions=h,e.generateAsync(l,e=>this.statusPanel.setProgressBarValue(e.percent)).then(e=>{saveAs(e,this.projectName+".z4i"),this.statusPanel.setProgressBarValue(0),this.saved=!0,s&&s()})}else this.saveLayer(e,t,i+1,s)})}exportToFile(e,t,i){let s=new OffscreenCanvas(this.width,this.height),a=s.getContext("2d");this.paper.draw(a,!1);let n={};n.type=".png"===t?"image/png":"image/jpeg",n.quality=i,s.convertToBlob(n).then(i=>{let s=document.createElement("a");s.setAttribute("href",URL.createObjectURL(i)),s.setAttribute("download",e+t),document.body.appendChild(s);let a=document.createEvent("MouseEvents");a.initEvent("click",!1,!1),s.dispatchEvent(a),document.body.removeChild(s)})}addLayer(e,t,i){this.paper.addLayer(this.findLayerName(),e,t,i,this.width,this.height),this.afterAddLayer(),this.drawCanvas()}addLayerFromFile(e){let t=e.name.substring(0,e.name.lastIndexOf(".")),i=new FileReader;i.onload=e=>this.addLayerFromURL(t,i.result),i.readAsDataURL(e)}addLayerFromClipboard(){navigator.clipboard.read().then(e=>{e.forEach(e=>{let t=e.types.find((e,t,i)=>e.startsWith("image/"));e.getType(t).then(e=>{this.addLayerFromURL(this.findLayerName(),URL.createObjectURL(e))})})})}findLayerName(){let e=0,t="";for(;!t;){t=Z4Translations.LAYER+"_"+e;for(let i=0;i<this.paper.getLayersCount();i++)t===this.paper.getLayerAt(i).getName()&&(t="");e++}return t}addLayerFromURL(e,t){let i=document.createElement("img");return i.onload=t=>(this.paper.addLayerFromImage(e,i,this.width,this.height),this.afterAddLayer(),this.drawCanvas(),null),i.src=t,null}afterAddLayer(){this.ribbonLayerPanel.addLayerPreview(this.paper.getLayerAt(this.paper.getLayersCount()-1)),this.saved=!1}moveLayer(e,t){return!!this.paper.moveLayer(e,t)&&(this.saved=!1,this.drawCanvas(),!0)}getLayersCount(){return this.paper.getLayersCount()}getProjectName(){return this.projectName}getSize(){return new Dimension(this.width,this.height)}isSaved(){return this.saved}setSaved(e){this.saved=e}setZoom(e){this.zoom=e,this.canvas.width=this.width*e,this.canvas.height=this.height*e,this.drawCanvas()}fitZoom(){this.setZoom(Math.min((this.canvas.parentElement.clientWidth-20)/this.width,(this.canvas.parentElement.clientHeight-20)/this.height))}zoomIn(){if(this.zooming);else{this.zooming=!0;let e=Z4Constants.ZOOM_LEVEL.find(e=>e>this.zoom,null);e&&(this.zoom=e,this.canvas.width=this.width*e,this.canvas.height=this.height*e,this.statusPanel.setZoom(this.zoom),this.drawCanvas()),this.zooming=!1}}zoomOut(){if(this.zooming);else{this.zooming=!0;let e=Z4Constants.ZOOM_LEVEL.filter(e=>e<this.zoom).pop();e&&(this.zoom=e,this.canvas.width=this.width*e,this.canvas.height=this.height*e,this.statusPanel.setZoom(this.zoom),this.drawCanvas()),this.zooming=!1}}drawCanvas(){this.ctx.save(),this.ctx.scale(this.zoom,this.zoom),this.paper.draw(this.ctx,!1),this.ctx.restore()}}class Z4ColorPreview extends JSComponent{component=new JSComponent(document.createElement("div"));componentOpacity=new JSComponent(document.createElement("div"));constructor(){super(document.createElement("div")),this.cssAddClass("z4colorpreview"),this.component.cssAddClass("z4colorpreview-opaque"),this.appendChild(this.component),this.componentOpacity.cssAddClass("z4colorpreview-transparent"),this.appendChild(this.componentOpacity),this.setColor(new Color(0,0,0,255))}setColor(e){this.component.getStyle().backgroundColor=e.getRGB_String(),this.componentOpacity.getStyle().backgroundColor=e.getRGBA_String();let t=[],i=[];t[0]=e.red,t[1]=e.green,t[2]=e.blue,Color.RGBtoHSL(t,i),this.getStyle().border="1px solid "+(i[2]>.5?e.darkened(.1).getRGB_HEX():e.lighted(.1).getRGB_HEX())}}class Z4LayerPreview extends JSComponent{summary=new JSPanel;name=new JSLabel;preview=new JSComponent(document.createElement("canvas"));ctx=this.preview.invoke("getContext('2d')");editor=new JSTabbedPane;editName=new JSTextField;offsetXSlider=new JSSlider;offsetXSpinner=new JSSpinner;offsetYSlider=new JSSlider;offsetYSpinner=new JSSpinner;opacitySlider=new JSSlider;opacitySpinner=new JSSpinner;compositeOperations=[];compositeOperationsGroup=new ButtonGroup;canvas=null;layer=null;zoom=1;static PREVIEW_SIZE=50;constructor(){super(document.createElement("details")),this.cssAddClass("z4layerpreview"),this.addEventListener("toggle",e=>{if(""+this.getProperty("open")=="true"){this.getChilStyleByQuery(".z4layerpreview-editor").visibility="visible";let t=this.invokeInTree(".z4layerpreview-editor","getBoundingClientRect()"),i=this.invokeInTree("summary","getBoundingClientRect()");i.left+t.width<document.body.scrollWidth?this.getChilStyleByQuery(".z4layerpreview-editor").left=i.left+"px":i.right-t.width>0?this.getChilStyleByQuery(".z4layerpreview-editor").left=i.right-t.width+"px":(this.getChilStyleByQuery(".z4layerpreview-editor").left="auto",this.getChilStyleByQuery(".z4layerpreview-editor").right="5px"),i.bottom+t.height<document.body.scrollHeight?this.getChilStyleByQuery(".z4layerpreview-editor").top=i.bottom+"px":i.top-t.height>0?this.getChilStyleByQuery(".z4layerpreview-editor").top="calc("+(i.top-t.height)+"px - 1rem)":(this.getChilStyleByQuery(".z4layerpreview-editor").top="auto",this.getChilStyleByQuery(".z4layerpreview-editor").bottom="5px")}else this.getChilStyleByQuery(".z4layerpreview-editor").removeProperty("visibility"),this.getChilStyleByQuery(".z4layerpreview-editor").removeProperty("top"),this.getChilStyleByQuery(".z4layerpreview-editor").removeProperty("bottom"),this.getChilStyleByQuery(".z4layerpreview-editor").removeProperty("left"),this.getChilStyleByQuery(".z4layerpreview-editor").removeProperty("right")}),this.name.getStyle().width=Z4LayerPreview.PREVIEW_SIZE+"px",this.preview.setAttribute("width",""+Z4LayerPreview.PREVIEW_SIZE),this.preview.setAttribute("height",""+Z4LayerPreview.PREVIEW_SIZE),this.summary.setLayout(new BorderLayout(0,0)),this.summary.add(this.name,BorderLayout.NORTH),this.summary.add(this.preview,BorderLayout.CENTER),this.appendNodeChild(document.createElement("summary")),this.appendChildInTree("summary",this.summary),this.editor.cssAddClass("z4layerpreview-editor");let e=new JSPanel;e.setLayout(new GridBagLayout),this.editName.addActionListener(e=>{let t=this.editName.getText();t&&(this.canvas.setSaved(!1),this.name.setText(t),this.layer.setName(t))}),this.addLabel(e,Z4Translations.LAYER_NAME,0,0,1,1,GridBagConstraints.WEST,GridBagConstraints.NONE),this.addComponent(e,this.editName,0,1,2,1,GridBagConstraints.WEST,GridBagConstraints.HORIZONTAL,new Insets(0,0,5,0)),this.addLabel(e,Z4Translations.OFFSET_X,0,2,1,1,GridBagConstraints.WEST,GridBagConstraints.NONE),this.offsetXSpinner.getStyle().minWidth="4rem",this.offsetXSpinner.getChilStyleByQuery("input[type=number]").minWidth="3.5rem",this.offsetXSpinner.getChilStyleByQuery("input[type=number]").width="3.5rem",this.offsetXSpinner.addChangeListener(e=>this.onChange(!0,this.offsetXSpinner.getValueIsAdjusting(),this.offsetXSpinner,this.offsetXSlider)),this.addComponent(e,this.offsetXSpinner,1,2,1,1,GridBagConstraints.EAST,GridBagConstraints.NONE,null),this.offsetXSlider.addChangeListener(e=>this.onChange(!1,this.offsetXSlider.getValueIsAdjusting(),this.offsetXSpinner,this.offsetXSlider)),this.offsetXSlider.getStyle().minWidth="25rem",this.addComponent(e,this.offsetXSlider,0,3,2,1,GridBagConstraints.NORTH,GridBagConstraints.HORIZONTAL,null),this.addLabel(e,Translations.JSColorChooser_OPACITY,0,4,1,1,GridBagConstraints.WEST,GridBagConstraints.NONE),this.opacitySpinner.getStyle().minWidth="4rem",this.opacitySpinner.getChilStyleByQuery("input[type=number]").minWidth="3.5rem",this.opacitySpinner.getChilStyleByQuery("input[type=number]").width="3.5rem",this.opacitySpinner.addChangeListener(e=>this.onChange(!0,this.opacitySpinner.getValueIsAdjusting(),this.opacitySpinner,this.opacitySlider)),this.addComponent(e,this.opacitySpinner,1,4,1,1,GridBagConstraints.EAST,GridBagConstraints.NONE,null),this.opacitySlider.addChangeListener(e=>this.onChange(!1,this.opacitySlider.getValueIsAdjusting(),this.opacitySpinner,this.opacitySlider)),this.opacitySlider.getStyle().minWidth="25rem",this.addComponent(e,this.opacitySlider,0,5,2,1,GridBagConstraints.NORTH,GridBagConstraints.HORIZONTAL,null),this.addVLine(e,2,2,1,5,GridBagConstraints.CENTER,GridBagConstraints.VERTICAL),this.addLabel(e,Z4Translations.OFFSET_Y,3,2,1,1,GridBagConstraints.WEST,GridBagConstraints.NONE),this.offsetYSpinner.getStyle().minWidth="4rem",this.offsetYSpinner.getChilStyleByQuery("input[type=number]").minWidth="3.5rem",this.offsetYSpinner.getChilStyleByQuery("input[type=number]").width="3.5rem",this.offsetYSpinner.addChangeListener(e=>this.onChange(!0,this.offsetYSpinner.getValueIsAdjusting(),this.offsetYSpinner,this.offsetYSlider)),this.addComponent(e,this.offsetYSpinner,4,2,1,1,GridBagConstraints.EAST,GridBagConstraints.NONE,new Insets(0,2,0,0)),this.offsetYSlider.setOrientation(JSSlider.VERTICAL),this.offsetYSlider.setInverted(!0),this.offsetYSlider.addChangeListener(e=>this.onChange(!1,this.offsetYSlider.getValueIsAdjusting(),this.offsetYSpinner,this.offsetYSlider)),this.offsetYSlider.getStyle().minHeight="25rem",this.addComponent(e,this.offsetYSlider,3,3,1,4,GridBagConstraints.NORTH,GridBagConstraints.NONE,null),this.editor.addTab(Z4Translations.BASIC,e);let t=new JSPanel;t.setLayout(new GridBagLayout),this.addLabel(t,Z4Translations.COMPOSITE_OPERATION,0,0,1,1,GridBagConstraints.WEST,GridBagConstraints.NONE),Z4Constants.COMPOSITE_OPERATION.forEach((e,i,s)=>{e.forEach((e,s,a)=>{let n=new JSRadioButton;n.setContentAreaFilled(!1),n.setToggle(),n.setText(e),n.setTooltip(Z4Translations["COMPOSITE_OPERATION_"+e.toUpperCase().replace("-","_")]),n.addActionListener(t=>this.onAction(e)),this.compositeOperations.push(n),this.compositeOperationsGroup.add(n),this.addComponent(t,n,s,i+1,1,1,GridBagConstraints.WEST,GridBagConstraints.HORIZONTAL,new Insets(1,1,1,1))})}),this.editor.addTab(Z4Translations.ADVANCED,t),this.appendChild(this.editor)}addLabel(e,t,i,s,a,n,r,o){let l=new JSLabel;l.setText(t),this.addComponent(e,l,i,s,a,n,r,o,null)}addVLine(e,t,i,s,a,n,r){let o=new JSComponent(document.createElement("div"));o.getStyle().width="1px",o.getStyle().background="var(--main-action-bgcolor",this.addComponent(e,o,t,i,s,a,n,r,new Insets(1,2,1,2))}addComponent(e,t,i,s,a,n,r,o,l){let h=new GridBagConstraints;h.gridx=i,h.gridy=s,h.gridwidth=a,h.gridheight=n,h.anchor=r,h.fill=o,l&&(h.insets=l),e.add(t,h)}onChange(e,t,i,s){this.canvas.setSaved(!1),e?s.setValue(i.getValue()):i.setValue(s.getValue()),t?this.editor.setAttribute("offset","true"):this.editor.removeAttribute("offset"),this.layer.setOpacity(this.opacitySpinner.getValue()/100),this.layer.move(this.offsetXSlider.getValue(),this.offsetYSlider.getValue()),this.canvas.drawCanvas()}onAction(e){this.canvas.setSaved(!1),this.layer.setCompositeOperation(e),this.canvas.drawCanvas()}setLayer(e,t){this.canvas=e,this.layer=t,this.name.setText(this.layer.getName()),this.editName.setText(this.layer.getName()),this.setChildAttributeByQuery("summary","title",this.layer.getName());let i=t.getSize(),s=i.width/i.height,a=0,n=0;s>1?(a=Z4LayerPreview.PREVIEW_SIZE,n=Z4LayerPreview.PREVIEW_SIZE/s):(a=Z4LayerPreview.PREVIEW_SIZE*s,n=Z4LayerPreview.PREVIEW_SIZE),this.zoom=Math.min(a/i.width,n/i.height),this.preview.setAttribute("width",""+a),this.preview.setAttribute("height",""+n),this.preview.getStyle().marginTop=(Z4LayerPreview.PREVIEW_SIZE-n-1)/2+"px",this.preview.getStyle().marginBottom=(Z4LayerPreview.PREVIEW_SIZE-n-1)/2+"px",this.preview.getStyle().marginLeft=(Z4LayerPreview.PREVIEW_SIZE-a-1)/2+"px",this.preview.getStyle().marginRight=(Z4LayerPreview.PREVIEW_SIZE-a-1)/2+"px";let r=t.getOffset(),o=this.canvas.getSize();this.offsetXSlider.setMinimum(-i.width),this.offsetXSlider.setMaximum(o.width),this.offsetXSlider.setValue(r.x),this.offsetXSpinner.setModel(new SpinnerNumberModel(r.x,-i.width,o.width,1)),this.offsetYSlider.setMinimum(-i.height),this.offsetYSlider.setMaximum(o.height),this.offsetYSlider.setValue(r.y),this.offsetYSpinner.setModel(new SpinnerNumberModel(r.y,-i.height,o.height,1)),this.opacitySlider.setValue(parseInt(100*t.getOpacity())),this.opacitySpinner.setModel(new SpinnerNumberModel(parseInt(100*t.getOpacity()),0,100,1)),this.compositeOperations.forEach(e=>e.setSelected(e.getText()===t.getCompositeOperation())),this.drawLayer()}drawLayer(){this.layer&&(this.ctx.save(),this.ctx.scale(this.zoom,this.zoom),this.layer.draw(this.ctx,!0),this.ctx.restore())}}class Z4Frame extends JSFrame{ribbon=new Z4Ribbon;canvas=new Z4Canvas;statusPanel=new Z4StatusPanel;constructor(){super(),this.cssAddClass("z4frame"),this.getContentPane().setLayout(new BorderLayout(5,5)),this.ribbon.setCanvas(this.canvas),this.ribbon.setStatusPanel(this.statusPanel),this.canvas.setStatusPanel(this.statusPanel),this.statusPanel.setCanvas(this.canvas),this.getContentPane().add(this.ribbon,BorderLayout.NORTH),this.getContentPane().add(this.canvas,BorderLayout.CENTER),this.getContentPane().add(this.statusPanel,BorderLayout.SOUTH),this.canvas.create(Z4Constants.DEFAULT_IMAGE_SIZE,Z4Constants.DEFAULT_IMAGE_SIZE,new Color(0,0,0,0))}}class Z4RibbonFilePanel extends JSPanel{canvas=null;statusPanel=null;constructor(){super(),this.setLayout(new GridBagLayout),this.cssAddClass("z4ribbonfilepanel"),this.addLabel(Z4Translations.NEW_PROJECT,0,3),this.addButton(Z4Translations.CREATE,!0,0,1,"left",e=>this.checkSaved(Z4Translations.CREATE,()=>this.createFromColor())),this.addButton(Z4Translations.FROM_CLIPBOARD,"function"==typeof navigator.clipboard.read,1,1,"both",e=>this.checkSaved(Z4Translations.FROM_CLIPBOARD,()=>this.createFromClipboard())),this.addButton(Z4Translations.FROM_FILE,!0,2,1,"right",e=>this.checkSaved(Z4Translations.FROM_FILE,()=>this.createFromFile())),this.addVLine(3,0),this.addLabel(Z4Translations.OPEN,4,1),this.addButton(Z4Translations.OPEN_PROJECT,!0,4,1,"",e=>this.checkSaved(Z4Translations.OPEN_PROJECT,()=>this.openProject())),this.addVLine(5,0),this.addLabel(Z4Translations.SAVE,6,2),this.addButton(Z4Translations.SAVE_PROJECT,!0,6,1,"left",e=>this.saveProject(null)),this.addButton(Z4Translations.EXPORT,!0,7,1,"right",e=>this.exportToFile()),this.addVLine(8,1)}setCanvas(e){this.canvas=e}setStatusPanel(e){this.statusPanel=e}addLabel(e,t,i){let s=new JSLabel;s.setText(e);let a=new GridBagConstraints;a.gridx=t,a.gridy=0,a.gridwidth=i,a.anchor=GridBagConstraints.WEST,a.insets=new Insets(5,5,2,0),this.add(s,a)}addButton(e,t,i,s,a,n){let r=new JSButton;r.setText(e),r.setEnabled(t),r.setContentAreaFilled(!1),r.addActionListener(n);let o=new GridBagConstraints;switch(o.gridx=i,o.gridy=s,o.anchor=GridBagConstraints.NORTH,a){case"left":o.insets=new Insets(0,5,0,0),r.getStyle().borderTopRightRadius="0px",r.getStyle().borderBottomRightRadius="0px",r.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"both":r.getStyle().borderRadius="0px",r.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",r.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"right":o.insets=new Insets(0,0,0,5),r.getStyle().borderTopLeftRadius="0px",r.getStyle().borderBottomLeftRadius="0px",r.getStyle().borderLeft="1px solid var(--main-action-bgcolor)"}this.add(r,o)}addVLine(e,t){let i=new JSComponent(document.createElement("div"));i.getStyle().width="1px",i.getStyle().background="var(--main-action-bgcolor";let s=new GridBagConstraints;s.gridx=e,s.gridy=0,s.gridheight=2,s.fill=GridBagConstraints.VERTICAL,s.weightx=t,s.weighty=1,s.insets=new Insets(1,2,1,2),this.add(i,s)}checkSaved(e,t){this.canvas.isSaved()?t():JSOptionPane.showConfirmDialog(Z4Translations.PROJECT_NOT_SAVED_MESSAGE,e,JSOptionPane.YES_NO_CANCEL_OPTION,JSOptionPane.QUESTION_MESSAGE,e=>{switch(e){case JSOptionPane.YES_OPTION:this.saveProject(t);break;case JSOptionPane.NO_OPTION:t()}})}createFromColor(){let e=new Z4NewImagePanel;JSOptionPane.showInputDialog(e,Z4Translations.CREATE,e=>{},()=>!0,t=>{if(t===JSOptionPane.OK_OPTION){let i=e.getSelectedSize();this.canvas.create(i.width,i.height,e.getSelectedColor())}})}createFromFile(){JSFileChooser.showOpenDialog(""+Z4Constants.ACCEPTED_IMAGE_FILE_FORMAT.join(","),JSFileChooser.SINGLE_SELECTION,0,e=>e.forEach(e=>this.canvas.createFromFile(e)))}createFromClipboard(){this.canvas.createFromClipboard()}openProject(){JSFileChooser.showOpenDialog(".z4i",JSFileChooser.SINGLE_SELECTION,0,e=>e.forEach(e=>this.canvas.openProject(e)))}saveProject(e){let t=new JSPanel;t.setLayout(new BorderLayout(0,0));let i=new JSLabel;i.setText(Z4Translations.PROJECT_NAME),t.add(i,BorderLayout.NORTH);let s=new JSTextField;s.setText(this.canvas.getProjectName()),t.add(s,BorderLayout.CENTER),JSOptionPane.showInputDialog(t,Z4Translations.SAVE,e=>s.addActionListener(t=>e(new ChangeEvent)),()=>!!s.getText(),t=>{t===JSOptionPane.OK_OPTION&&this.canvas.saveProject(s.getText(),e)})}exportToFile(){let e=new Z4ExportToFilePanel;e.setFilename(this.canvas.getProjectName()),JSOptionPane.showInputDialog(e,Z4Translations.EXPORT,t=>e.addChangeListener(t),()=>e.isValid(),t=>{t===JSOptionPane.OK_OPTION&&this.canvas.exportToFile(e.getFilename(),e.getFileExtension(),e.getQuality())})}}class Z4RibbonLayerPanel extends JSPanel{layersPreview=new JSPanel;canvas=null;layerDnD=null;previewDnD=null;constructor(){super(),this.setLayout(new GridBagLayout),this.cssAddClass("z4ribbonlayerpanel"),this.addLabel(Z4Translations.NEW_LAYER,0),this.addButton(Z4Translations.CREATE,!0,0,1,"left",e=>this.addFromColor()),this.addButton(Z4Translations.FROM_CLIPBOARD,"function"==typeof navigator.clipboard.read,1,1,"both",e=>this.addFromClipboard()),this.addButton(Z4Translations.FROM_FILE,!0,2,1,"right",e=>this.addFromFile()),this.addVLine(3),this.layersPreview.setLayout(new BoxLayout(this.layersPreview,BoxLayout.X_AXIS)),this.layersPreview.getStyle().overflowX="scroll",this.layersPreview.addEventListener("dragenter",e=>e.preventDefault()),this.layersPreview.addEventListener("dragover",e=>e.preventDefault()),this.layersPreview.addEventListener("dragleave",e=>e.preventDefault()),this.layersPreview.addEventListener("drop",e=>{e.preventDefault();let t=e,i=this.previewDnD.invoke("getBoundingClientRect()"),s=this.layersPreview.invoke("getBoundingClientRect()"),a=parseInt((t.clientX-s.left)/i.width);this.canvas.moveLayer(this.layerDnD,a)&&(a<this.canvas.getLayersCount()?(a=Math.min(this.canvas.getLayersCount(),a+1),this.layersPreview.insertBefore(this.previewDnD,"details:nth-child("+a+")")):this.layersPreview.add(this.previewDnD,null))});let e=new GridBagConstraints;e.gridx=4,e.gridy=0,e.gridheight=2,e.weightx=1,e.fill=GridBagConstraints.BOTH,this.add(this.layersPreview,e)}setCanvas(e){this.canvas=e}addLabel(e,t){let i=new JSLabel;i.setText(e);let s=new GridBagConstraints;s.gridx=t,s.gridy=0,s.gridwidth=3,s.anchor=GridBagConstraints.WEST,s.insets=new Insets(5,5,2,0),this.add(i,s)}addButton(e,t,i,s,a,n){let r=new JSButton;r.setText(e),r.setEnabled(t),r.setContentAreaFilled(!1),r.addActionListener(n);let o=new GridBagConstraints;switch(o.gridx=i,o.gridy=s,o.anchor=GridBagConstraints.NORTH,a){case"left":o.insets=new Insets(0,5,0,0),r.getStyle().borderTopRightRadius="0px",r.getStyle().borderBottomRightRadius="0px",r.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"both":r.getStyle().borderRadius="0px",r.getStyle().borderLeft="1px solid var(--main-action-bgcolor)",r.getStyle().borderRight="1px solid var(--main-action-bgcolor)";break;case"right":o.insets=new Insets(0,0,0,5),r.getStyle().borderTopLeftRadius="0px",r.getStyle().borderBottomLeftRadius="0px",r.getStyle().borderLeft="1px solid var(--main-action-bgcolor)"}this.add(r,o)}addVLine(e){let t=new JSComponent(document.createElement("div"));t.getStyle().width="1px",t.getStyle().background="var(--main-action-bgcolor";let i=new GridBagConstraints;i.gridx=e,i.gridy=0,i.gridheight=2,i.fill=GridBagConstraints.VERTICAL,i.weighty=1,i.insets=new Insets(1,2,1,2),this.add(t,i)}addFromColor(){let e=new Z4NewImagePanel;JSOptionPane.showInputDialog(e,Z4Translations.CREATE,e=>{},()=>!0,t=>{if(t===JSOptionPane.OK_OPTION){let i=e.getSelectedSize();this.canvas.addLayer(i.width,i.height,e.getSelectedColor())}})}addFromFile(){JSFileChooser.showOpenDialog(""+Z4Constants.ACCEPTED_IMAGE_FILE_FORMAT.join(","),JSFileChooser.SINGLE_SELECTION,0,e=>e.forEach(e=>this.canvas.addLayerFromFile(e)))}addFromClipboard(){this.canvas.addLayerFromClipboard()}reset(){this.layersPreview.setProperty("innerHTML","")}addLayerPreview(e){let t=new Z4LayerPreview;t.setLayer(this.canvas,e),t.setChildAttributeByQuery("summary","draggable","true"),t.addEventListener("dragstart",i=>{i.dataTransfer.effectAllowed="move",this.layerDnD=e,this.previewDnD=t}),this.layersPreview.add(t,null)}}class Z4RibbonSettingsPanel extends JSPanel{language=new JSComboBox;theme=new JSComboBox;color=new JSColorChooser;constructor(){super(),this.setLayout(new GridBagLayout),this.cssAddClass("z4ribbonsettingspanel");let e=new JSLabel;e.setText(Z4Translations.LANGUAGE);let t=new GridBagConstraints;t.gridx=0,t.gridy=0,t.anchor=GridBagConstraints.WEST,t.insets=new Insets(5,5,2,0),this.add(e,t);let i=new DefaultKeyValueComboBoxModelAndRenderer;i.addElement(new KeyValue("en",Z4Translations.LANGUAGE_ENGLISH_NATIVE)),i.addElement(new KeyValue("it",Z4Translations.LANGUAGE_ITALIAN_NATIVE)),this.language.setModelAndRenderer(i),this.language.setSelectedItem(Z4Translations.CURRENT_LANGUAGE),this.language.addActionListener(e=>this.onchangeLanguage()),(t=new GridBagConstraints).gridx=0,t.gridy=1,t.fill=GridBagConstraints.HORIZONTAL,t.anchor=GridBagConstraints.NORTH,t.weighty=1,t.insets=new Insets(0,5,0,5),this.add(this.language,t),(e=new JSLabel).setText(Z4Translations.THEME),(t=new GridBagConstraints).gridx=1,t.gridy=0,t.anchor=GridBagConstraints.WEST,t.insets=new Insets(5,5,2,0),this.add(e,t);let s=null;switch(localStorage.getItem("z4theme")){case"light":s=new KeyValue("light",Z4Translations.THEME_LIGHT);break;case"dark":s=new KeyValue("dark",Z4Translations.THEME_DARK);break;default:s=new KeyValue("auto",Z4Translations.THEME_AUTO)}let a=new DefaultKeyValueComboBoxModelAndRenderer;a.addElement(new KeyValue("auto",Z4Translations.THEME_AUTO)),a.addElement(new KeyValue("light",Z4Translations.THEME_LIGHT)),a.addElement(new KeyValue("dark",Z4Translations.THEME_DARK)),this.theme.setModelAndRenderer(a),this.theme.setSelectedItem(s),this.theme.addActionListener(e=>this.onchangeTheme()),(t=new GridBagConstraints).gridx=1,t.gridy=1,t.fill=GridBagConstraints.HORIZONTAL,t.anchor=GridBagConstraints.NORTH,t.weighty=1,t.insets=new Insets(0,5,0,5),this.add(this.theme,t),(e=new JSLabel).setText(Z4Translations.THEME_COLOR),(t=new GridBagConstraints).gridx=2,t.gridy=0,t.anchor=GridBagConstraints.WEST,t.insets=new Insets(5,5,2,0),this.add(e,t);let n=localStorage.getItem("z4color");this.color.setSelectedColor(Color.fromRGB_HEX(n||"#0d6efd")),this.color.setOpacityVisible(!1),this.color.addChangeListener(e=>this.onchangeColor()),(t=new GridBagConstraints).gridx=2,t.gridy=1,t.fill=GridBagConstraints.HORIZONTAL,t.anchor=GridBagConstraints.NORTH,t.weighty=1,t.insets=new Insets(0,5,0,5),this.add(this.color,t);let r=new JSButton;r.setText(Z4Translations.RESET),r.setContentAreaFilled(!1),r.addActionListener(e=>this.onreset()),(t=new GridBagConstraints).gridx=3,t.gridy=1,t.fill=GridBagConstraints.HORIZONTAL,t.anchor=GridBagConstraints.NORTH,t.weighty=1,t.insets=new Insets(0,5,0,5),this.add(r,t),e=new JSLabel,(t=new GridBagConstraints).gridx=4,t.gridy=0,t.fill=GridBagConstraints.BOTH,t.weightx=1,this.add(e,t)}onchangeLanguage(){localStorage.setItem("z4language",this.language.getSelectedItem().key),JSOptionPane.showMessageDialog(Z4Translations.REFRESH_PAGE_MESSAGE,Z4Translations.LANGUAGE,JSOptionPane.INFORMATION_MESSAGE,null)}onchangeTheme(){localStorage.setItem("z4theme",this.theme.getSelectedItem().key),JSOptionPane.showMessageDialog(Z4Translations.REFRESH_PAGE_MESSAGE,Z4Translations.THEME,JSOptionPane.INFORMATION_MESSAGE,null)}onchangeColor(){this.color.getValueIsAdjusting()||(localStorage.setItem("z4color",this.color.getSelectedColor().getRGB_HEX()),JSOptionPane.showMessageDialog(Z4Translations.REFRESH_PAGE_MESSAGE,Z4Translations.THEME_COLOR,JSOptionPane.INFORMATION_MESSAGE,null))}onreset(){localStorage.removeItem("z4language"),localStorage.removeItem("z4theme"),localStorage.removeItem("z4color"),JSOptionPane.showMessageDialog(Z4Translations.REFRESH_PAGE_MESSAGE,Z4Translations.RESET,JSOptionPane.INFORMATION_MESSAGE,null)}}class Z4ExportToFilePanel extends JSPanel{filename=new JSTextField;png=new JSRadioButton;jpg=new JSRadioButton;qualitySlider=new JSSlider;qualitySpinner=new JSSpinner;listeners=[];constructor(){super(),this.cssAddClass("z4exporttofilepanel"),this.setLayout(new GridBagLayout),this.addLabel(Z4Translations.FILENAME,0,0),this.filename.addActionListener(e=>this.onchange());let e=new GridBagConstraints;e.gridx=0,e.gridy=1,e.gridwidth=2,e.fill=GridBagConstraints.HORIZONTAL,e.weightx=1,this.add(this.filename,e);let t=new ButtonGroup;t.add(this.png),t.add(this.jpg),this.addRadio(this.png,!0,"PNG",0),this.addRadio(this.jpg,!1,"JPG",1),this.addLabel(Z4Translations.QUALITY,0,3),this.qualitySlider.setEnabled(!1),this.qualitySlider.setValue(100),this.qualitySlider.addChangeListener(e=>this.qualitySpinner.setValue(this.qualitySlider.getValue())),(e=new GridBagConstraints).gridx=0,e.gridy=4,e.gridwidth=2,e.fill=GridBagConstraints.HORIZONTAL,e.weightx=1,this.add(this.qualitySlider,e),this.qualitySpinner.setEnabled(!1),this.qualitySpinner.setModel(new SpinnerNumberModel(100,0,100,1)),this.qualitySpinner.addChangeListener(e=>this.qualitySlider.setValue(this.qualitySpinner.getValue())),this.qualitySpinner.getStyle().minWidth="3rem",this.qualitySpinner.getChilStyleByQuery("input[type=number]").minWidth="2.5rem",this.qualitySpinner.getChilStyleByQuery("input[type=number]").width="2.5rem",(e=new GridBagConstraints).gridx=1,e.gridy=3,e.anchor=GridBagConstraints.EAST,this.add(this.qualitySpinner,e)}addLabel(e,t,i){let s=new JSLabel;s.setText(e);let a=new GridBagConstraints;a.gridx=t,a.gridy=i,a.anchor=GridBagConstraints.WEST,this.add(s,a)}onchange(){let e=new ChangeEvent;this.listeners.forEach(t=>{"function"==typeof t?t(e):t.stateChanged(e)})}addRadio(e,t,i,s){e.setSelected(t),e.setText(i),e.addActionListener(e=>{this.qualitySlider.setEnabled(!t),this.qualitySpinner.setEnabled(!t)});let a=new GridBagConstraints;a.gridx=s,a.gridy=2,a.anchor=GridBagConstraints.WEST,this.add(e,a)}addChangeListener(e){this.listeners.push(e)}isValid(){return!!this.filename.getText()}setFilename(e){this.filename.setText(e)}getFilename(){return this.filename.getText()}getFileExtension(){return this.png.isSelected()?".png":".jpg"}getQuality(){return this.qualitySpinner.getValue()/100}}class Z4NewImagePanel extends JSPanel{width=new JSSpinner;height=new JSSpinner;resolution=new JSSpinner;dimensionMM=new JSLabel;dimensionIN=new JSLabel;colorPreview=new Z4ColorPreview;selectedColor=new Color(255,255,255,255);constructor(){super(),this.cssAddClass("z4newimagepanel"),this.setLayout(new GridBagLayout),this.addLabel(Z4Translations.WIDTH+" (px)",0,0,1,0),this.addSpinner(this.width,Z4Constants.DEFAULT_IMAGE_SIZE,Z4Constants.MAX_IMAGE_SIZE,0,1),this.addLabel(Z4Translations.HEIGHT+" (px)",1,0,1,0),this.addSpinner(this.height,Z4Constants.DEFAULT_IMAGE_SIZE,Z4Constants.MAX_IMAGE_SIZE,1,1),this.addLabel(Z4Translations.RESOLUTION+" (dpi)",2,0,1,0),this.addSpinner(this.resolution,Z4Constants.DEFAULT_DPI,Z4Constants.MAX_DPI,2,1),this.addDimension(this.dimensionMM,3),this.addDimension(this.dimensionIN,4),this.addLabel(Z4Translations.FILLING_COLOR,0,5,3,10),this.colorPreview.setColor(this.selectedColor);let e=new GridBagConstraints;e.gridx=0,e.gridy=6,e.gridwidth=2,e.fill=GridBagConstraints.HORIZONTAL,e.insets=new Insets(0,5,0,5),this.add(this.colorPreview,e);let t=new JSButton;t.setText(Z4Translations.EDIT),t.addActionListener(e=>{JSColorChooser.showDialog(Z4Translations.FILLING_COLOR,this.selectedColor,!0,null,e=>{this.selectedColor=e,this.colorPreview.setColor(e)})}),(e=new GridBagConstraints).gridx=2,e.gridy=6,e.gridwidth=1,e.anchor=GridBagConstraints.WEST,this.add(t,e),this.setDimensions()}addLabel(e,t,i,s,a){let n=new JSLabel;n.setText(e);let r=new GridBagConstraints;r.gridx=t,r.gridy=i,r.gridwidth=s,r.anchor=GridBagConstraints.WEST,r.insets=new Insets(a,5,0,5),this.add(n,r)}addSpinner(e,t,i,s,a){e.setModel(new SpinnerNumberModel(t,1,i,1)),e.getStyle().minWidth="6.6rem",e.getChilStyleByQuery("input[type=number]").minWidth="5.5rem",e.getChilStyleByQuery("input[type=number]").width="5.5rem",e.addChangeListener(e=>this.setDimensions());let n=new GridBagConstraints;n.gridx=s,n.gridy=a,n.anchor=GridBagConstraints.WEST,n.insets=new Insets(0,5,0,5),this.add(e,n)}addDimension(e,t){let i=new GridBagConstraints;i.gridy=t,i.gridwidth=3,i.fill=GridBagConstraints.HORIZONTAL,i.insets=new Insets(2,5,0,0),this.add(e,i)}setDimensions(){let e=this.width.getValue(),t=this.height.getValue(),i=this.resolution.getValue(),s=e/i,a=t/i;this.dimensionMM.setText(new Number(25.4*s).toFixed(2)+" ✖ "+new Number(25.4*a).toFixed(2)+" mm"),this.dimensionIN.setText(new Number(s).toFixed(2)+" ✖ "+new Number(a).toFixed(2)+" inch")}getSelectedSize(){return new Dimension(this.width.getValue(),this.height.getValue())}getSelectedColor(){return this.selectedColor}}class Z4StatusPanel extends JSPanel{canvas=null;projectName=new JSLabel;zoom=new JSComboBox;progressBar=new JSProgressBar;constructor(){super(),this.cssAddClass("z4statuspanel"),this.setLayout(new GridBagLayout),this.projectName.setText(Z4Translations.PROJECT_NAME+": "),this.setLabel(this.projectName,0),this.addPipe(1);let e=new DefaultKeyValueComboBoxModelAndRenderer;Z4Constants.ZOOM_LEVEL.forEach(t=>e.addElement(new KeyValue(""+t,parseInt(100*t)+"%"))),e.addElement(new KeyValue("FIT",Z4Translations.FIT)),this.zoom.setModelAndRenderer(e),this.zoom.getStyle().minWidth="5rem",this.zoom.getChilStyleByQuery("ul").minWidth="5rem",this.zoom.setSelectedItem(new KeyValue("1","")),this.zoom.addActionListener(e=>this.onZoom());let t=new GridBagConstraints;t.gridx=2,t.gridy=0,this.add(this.zoom,t),this.addPipe(3),this.progressBar.setStringPainted(!0),(t=new GridBagConstraints).gridx=4,t.gridy=0,t.weightx=1,t.fill=GridBagConstraints.BOTH,this.add(this.progressBar,t)}addPipe(e){let t=new JSLabel;t.setText("|"),t.getStyle().minWidth="2rem",t.getStyle().textAlign="center",this.setLabel(t,e)}setLabel(e,t){let i=new GridBagConstraints;i.gridx=t,i.gridy=0,this.add(e,i)}setCanvas(e){this.canvas=e}setProjectName(e){this.projectName.setText(Z4Translations.PROJECT_NAME+": "+e)}setProgressBarValue(e){this.progressBar.setValue(e)}setZoom(e){this.zoom.setSelectedItem(new KeyValue(""+e,""))}onZoom(){let e=this.zoom.getSelectedItem().key;"FIT"===e?this.canvas.fitZoom():this.canvas.setZoom(parseFloat(e))}}class Z4Ribbon extends JSTabbedPane{filePanel=new Z4RibbonFilePanel;layerPanel=new Z4RibbonLayerPanel;settingsPanel=new Z4RibbonSettingsPanel;constructor(){super(),this.cssAddClass("z4ribbon"),this.addTab(Z4Translations.FILE,this.filePanel),this.addTab(Z4Translations.LAYER,this.layerPanel),this.addTab(Z4Translations.SETTINGS,this.settingsPanel)}setCanvas(e){this.filePanel.setCanvas(e),this.layerPanel.setCanvas(e),e.setRibbonLayerPanel(this.layerPanel)}setStatusPanel(e){this.filePanel.setStatusPanel(e)}}class Z4Translations{static CURRENT_LANGUAGE=null;static FILE="";static NEW_PROJECT="";static CREATE="";static FROM_CLIPBOARD="";static FROM_FILE="";static OPEN="";static OPEN_PROJECT="";static SAVE="";static SAVE_PROJECT="";static EXPORT="";static PROJECT_NOT_SAVED_MESSAGE="";static LAYER="";static LAYER_NAME="";static NEW_LAYER="";static BACKGROUND_LAYER="";static SETTINGS="";static LANGUAGE="";static LANGUAGE_ENGLISH_NATIVE="";static LANGUAGE_ITALIAN_NATIVE="";static THEME="";static THEME_AUTO="";static THEME_LIGHT="";static THEME_DARK="";static THEME_COLOR="";static REFRESH_PAGE_MESSAGE="";static PROJECT_NAME="";static FILENAME="";static QUALITY="";static RESET="";static WIDTH="";static HEIGHT="";static RESOLUTION="";static FILLING_COLOR="";static EDIT="";static FIT="";static OFFSET_X="";static OFFSET_Y="";static BASIC="";static ADVANCED="";static COMPOSITE_OPERATION="";static COMPOSITE_OPERATION_SOURCE_OVER="";static COMPOSITE_OPERATION_SOURCE_IN="";static COMPOSITE_OPERATION_SOURCE_OUT="";static COMPOSITE_OPERATION_SOURCE_ATOP="";static COMPOSITE_OPERATION_DESTINATION_OVER="";static COMPOSITE_OPERATION_DESTINATION_IN="";static COMPOSITE_OPERATION_DESTINATION_OUT="";static COMPOSITE_OPERATION_DESTINATION_ATOP="";static COMPOSITE_OPERATION_LIGHTER="";static COMPOSITE_OPERATION_COPY="";static COMPOSITE_OPERATION_XOR="";static COMPOSITE_OPERATION_MULTIPLY="";static COMPOSITE_OPERATION_SCREEN="";static COMPOSITE_OPERATION_OVERLAY="";static COMPOSITE_OPERATION_DARKEN="";static COMPOSITE_OPERATION_LIGHTEN="";static COMPOSITE_OPERATION_COLOR_DODGE="";static COMPOSITE_OPERATION_COLOR_BURN="";static COMPOSITE_OPERATION_HARD_LIGHT="";static COMPOSITE_OPERATION_SOFT_LIGHT="";static COMPOSITE_OPERATION_DIFFERENCE="";static COMPOSITE_OPERATION_EXCLUSION="";static COMPOSITE_OPERATION_HUE="";static COMPOSITE_OPERATION_SATURATION="";static COMPOSITE_OPERATION_COLOR="";static COMPOSITE_OPERATION_LUMINOSITY="";static{switch(navigator.language.substring(0,2)){case"en":default:Z4Translations.setEnglish();break;case"it":Z4Translations.setItalian()}}constructor(){}static setEnglish(){Z4Translations.FILE="File",Z4Translations.NEW_PROJECT="New Project",Z4Translations.CREATE="Create",Z4Translations.FROM_CLIPBOARD="From Clipboard",Z4Translations.FROM_FILE="From File",Z4Translations.OPEN="Open",Z4Translations.OPEN_PROJECT="Open Project",Z4Translations.SAVE="Save",Z4Translations.SAVE_PROJECT="Save Project",Z4Translations.EXPORT="Export",Z4Translations.PROJECT_NOT_SAVED_MESSAGE="Project not saved, do you want to save your changes?",Z4Translations.LAYER="Layer",Z4Translations.LAYER_NAME="Layer Name",Z4Translations.NEW_LAYER="New Layer",Z4Translations.BACKGROUND_LAYER="Bkgrd",Z4Translations.SETTINGS="Settings",Z4Translations.LANGUAGE="Language",Z4Translations.LANGUAGE_ENGLISH_NATIVE="English",Z4Translations.LANGUAGE_ITALIAN_NATIVE="Italiano",Z4Translations.THEME="Theme",Z4Translations.THEME_AUTO="Auto",Z4Translations.THEME_LIGHT="Light",Z4Translations.THEME_DARK="Dark",Z4Translations.THEME_COLOR="Color",Z4Translations.REFRESH_PAGE_MESSAGE="Refresh the page to make the changes",Z4Translations.PROJECT_NAME="Project Name",Z4Translations.FILENAME="File Name",Z4Translations.QUALITY="Quality",Z4Translations.RESET="Reset",Z4Translations.WIDTH="Width",Z4Translations.HEIGHT="Height",Z4Translations.RESOLUTION="Resolution",Z4Translations.FILLING_COLOR="Filling Color",Z4Translations.EDIT="Edit",Z4Translations.FIT="Fit",Z4Translations.OFFSET_X="Offset X",Z4Translations.OFFSET_Y="Offset Y",Z4Translations.BASIC="Basic",Z4Translations.ADVANCED="Advanced",Z4Translations.COMPOSITE_OPERATION="Composite Operation",Z4Translations.COMPOSITE_OPERATION_SOURCE_OVER="This is the default setting and draws the layer on top of the existing content",Z4Translations.COMPOSITE_OPERATION_SOURCE_IN="The layer is drawn only where both the layer and the destination content overlap; everything else is made transparent",Z4Translations.COMPOSITE_OPERATION_SOURCE_OUT="The layer is drawn where it doesn't overlap the existing content",Z4Translations.COMPOSITE_OPERATION_SOURCE_ATOP="The layer is only drawn where it overlaps the existing content",Z4Translations.COMPOSITE_OPERATION_DESTINATION_OVER="The layer is drawn behind the existing content",Z4Translations.COMPOSITE_OPERATION_DESTINATION_IN="The existing content is kept where both the layer and existing content overlap; everything else is made transparent",Z4Translations.COMPOSITE_OPERATION_DESTINATION_OUT="The existing content is kept where it doesn't overlap the layer",Z4Translations.COMPOSITE_OPERATION_DESTINATION_ATOP="The existing content is only kept where it overlaps the layer; the layer is drawn behind the content",Z4Translations.COMPOSITE_OPERATION_LIGHTER="Where both layer and existing content overlap the color is determined by adding color values",Z4Translations.COMPOSITE_OPERATION_COPY="Only the layer is shown",Z4Translations.COMPOSITE_OPERATION_XOR="Layer and existing content are made transparent where both overlap and drawn normal everywhere else",Z4Translations.COMPOSITE_OPERATION_MULTIPLY="The pixels of the layer are multiplied with the corresponding pixel of the existing content; a darker picture is the result",Z4Translations.COMPOSITE_OPERATION_SCREEN="The pixels are inverted, multiplied, and inverted again; a lighter picture is the result (opposite of 'multiply')",Z4Translations.COMPOSITE_OPERATION_OVERLAY="A combination of 'multiply' and 'screen'; dark parts on the existing content become darker, and light parts become lighter",Z4Translations.COMPOSITE_OPERATION_DARKEN="Retains the darkest pixels of both layer and existing content",Z4Translations.COMPOSITE_OPERATION_LIGHTEN="Retains the lightest pixels of both layer and existing content",Z4Translations.COMPOSITE_OPERATION_COLOR_DODGE="Divides the existing content by the inverted layer",Z4Translations.COMPOSITE_OPERATION_COLOR_BURN="Divides the inverted existing content by the layer, and then inverts the result",Z4Translations.COMPOSITE_OPERATION_HARD_LIGHT="A combination of 'multiply' and 'screen' like 'overlay', but with layer and existing content swapped",Z4Translations.COMPOSITE_OPERATION_SOFT_LIGHT="A softer version of 'hard-light'; pure black or white does not result in pure black or white",Z4Translations.COMPOSITE_OPERATION_DIFFERENCE="Subtracts the existing content from the layer or the other way round to always get a positive value",Z4Translations.COMPOSITE_OPERATION_EXCLUSION="Like 'difference', but with lower contrast",Z4Translations.COMPOSITE_OPERATION_HUE="Preserves the luma and chroma of the existing content, while adopting the hue of the layer",Z4Translations.COMPOSITE_OPERATION_SATURATION="Preserves the luma and hue of the existing content, while adopting the chroma of the layer",Z4Translations.COMPOSITE_OPERATION_COLOR="Preserves the luma of the existing content, while adopting the hue and chroma of the layer",Z4Translations.COMPOSITE_OPERATION_LUMINOSITY="Preserves the hue and chroma of the existing content, while adopting the luma of the layer",Z4Translations.CURRENT_LANGUAGE=new KeyValue("en",Z4Translations.LANGUAGE_ENGLISH_NATIVE)}static setItalian(){Z4Translations.FILE="File",Z4Translations.NEW_PROJECT="Nuovo Progetto",Z4Translations.CREATE="Crea",Z4Translations.FROM_CLIPBOARD="Dagli Appunti",Z4Translations.FROM_FILE="Da File",Z4Translations.OPEN="Apri",Z4Translations.OPEN_PROJECT="Apri Progetto",Z4Translations.SAVE="Salva",Z4Translations.SAVE_PROJECT="Salva Progetto",Z4Translations.EXPORT="Esporta",Z4Translations.PROJECT_NOT_SAVED_MESSAGE="Progetto non salvato, vuoi salvare le modifiche?",Z4Translations.LAYER="Livello",Z4Translations.LAYER_NAME="Nome Livello",Z4Translations.NEW_LAYER="Nuovo Livello",Z4Translations.BACKGROUND_LAYER="Sfondo",Z4Translations.SETTINGS="Impostazioni",Z4Translations.LANGUAGE="Lingua",Z4Translations.LANGUAGE_ENGLISH_NATIVE="English",Z4Translations.LANGUAGE_ITALIAN_NATIVE="Italiano",Z4Translations.THEME="Tema",Z4Translations.THEME_AUTO="Auto",Z4Translations.THEME_LIGHT="Chiaro",Z4Translations.THEME_DARK="Scuro",Z4Translations.THEME_COLOR="Colore",Z4Translations.REFRESH_PAGE_MESSAGE="Aggiorna la pagina per eseguire le modifiche",Z4Translations.PROJECT_NAME="Nome Progetto",Z4Translations.FILENAME="Nome File",Z4Translations.QUALITY="Qualit\xe0",Z4Translations.RESET="Ripristina",Z4Translations.WIDTH="Larghezza",Z4Translations.HEIGHT="Altezza",Z4Translations.RESOLUTION="Risoluzione",Z4Translations.FILLING_COLOR="Colore di Riempimento",Z4Translations.EDIT="Modifica",Z4Translations.FIT="Adatta",Z4Translations.OFFSET_X="Offset X",Z4Translations.OFFSET_Y="Offset Y",Z4Translations.BASIC="Base",Z4Translations.ADVANCED="Avanzato",Z4Translations.COMPOSITE_OPERATION="Operazione Composita",Z4Translations.COMPOSITE_OPERATION_SOURCE_OVER="Questa \xe8 l'impostazione predefinita e disegna il livello sopra il contenuto esistente",Z4Translations.COMPOSITE_OPERATION_SOURCE_IN="Il livello viene disegnato solo dove si sovrappongono sia il livello che il contenuto di destinazione; tutto il resto \xe8 reso trasparente",Z4Translations.COMPOSITE_OPERATION_SOURCE_OUT="Il livello viene disegnato dove non si sovrappone al contenuto esistente",Z4Translations.COMPOSITE_OPERATION_SOURCE_ATOP="Il livello viene disegnato solo dove si sovrappone al contenuto esistente",Z4Translations.COMPOSITE_OPERATION_DESTINATION_OVER="Il livello viene disegnato dietro il contenuto esistente",Z4Translations.COMPOSITE_OPERATION_DESTINATION_IN="Il contenuto esistente viene mantenuto dove sia il livello che il contenuto esistente si sovrappongono; tutto il resto \xe8 reso trasparente",Z4Translations.COMPOSITE_OPERATION_DESTINATION_OUT="Il contenuto esistente viene mantenuto dove non si sovrappone al livello",Z4Translations.COMPOSITE_OPERATION_DESTINATION_ATOP="Il contenuto esistente viene mantenuto solo dove si sovrappone al livello; il livello viene disegnato dietro il contenuto",Z4Translations.COMPOSITE_OPERATION_LIGHTER="Laddove sia il livello che il contenuto esistente si sovrappongono, il colore viene determinato sommando i colori",Z4Translations.COMPOSITE_OPERATION_COPY="Viene mostrato solo il livello",Z4Translations.COMPOSITE_OPERATION_XOR="Il livello e il contenuto esistente vengono resi trasparenti laddove entrambi si sovrappongono e vengono disegnati normali altrove",Z4Translations.COMPOSITE_OPERATION_MULTIPLY="I pixel del layer vengono moltiplicati per il pixel corrispondente del contenuto esistente; il risultato \xe8 un'immagine pi\xf9 scura",Z4Translations.COMPOSITE_OPERATION_SCREEN="I pixel vengono invertiti, moltiplicati e nuovamente invertiti; il risultato \xe8 un'immagine pi\xf9 chiara (opposto di 'multiply')",Z4Translations.COMPOSITE_OPERATION_OVERLAY="Una combinazione di 'multiply' e 'screen'; le parti scure del contenuto esistente diventano pi\xf9 scure e le parti chiare diventano pi\xf9 chiare",Z4Translations.COMPOSITE_OPERATION_DARKEN="Mantiene i pixel pi\xf9 scuri sia del livello che del contenuto esistente",Z4Translations.COMPOSITE_OPERATION_LIGHTEN="Mantiene i pixel pi\xf9 chiari sia del livello che del contenuto esistente",Z4Translations.COMPOSITE_OPERATION_COLOR_DODGE="Divide il contenuto esistente per il livello invertito",Z4Translations.COMPOSITE_OPERATION_COLOR_BURN="Divide il contenuto esistente invertito per il livello, quindi inverte il risultato",Z4Translations.COMPOSITE_OPERATION_HARD_LIGHT="Una combinazione di 'multiply' e 'screen' come 'overlay', ma con il livello e il contenuto esistente scambiati",Z4Translations.COMPOSITE_OPERATION_SOFT_LIGHT="Una versione pi\xf9 morbida della 'hard-light'; il nero o il bianco puro non risultano in bianco o nero puro",Z4Translations.COMPOSITE_OPERATION_DIFFERENCE="Sottrae il contenuto esistente dal livello o viceversa per ottenere sempre un valore positivo",Z4Translations.COMPOSITE_OPERATION_EXCLUSION="Come 'difference', ma con contrasto inferiore",Z4Translations.COMPOSITE_OPERATION_HUE="Preserva la luminanza e la crominanza del contenuto esistente, adottando la tonalit\xe0 del livello",Z4Translations.COMPOSITE_OPERATION_SATURATION="Preserva la luminanza e la tonalit\xe0 del contenuto esistente, adottando la crominanza del livello",Z4Translations.COMPOSITE_OPERATION_COLOR="Preserva la luminanza del contenuto esistente, adottando la tonalit\xe0 e la saturazione del livello",Z4Translations.COMPOSITE_OPERATION_LUMINOSITY="Preserva la tonalit\xe0 e il croma del contenuto esistente, adottando la luminanza del livello",Z4Translations.CURRENT_LANGUAGE=new KeyValue("it",Z4Translations.LANGUAGE_ITALIAN_NATIVE)}}class Z4Constants{static ACCEPTED_IMAGE_FILE_FORMAT=[".gif",".png",".apng",".jpeg",".jpg",".jfif",".pjpeg",".pjp",".bmp",".svg",".webp",".avif"];static ZOOM_LEVEL=[.25,.33,.5,.66,1,1.5,2,3,4];static COMPOSITE_OPERATION=[["source-over","source-in","source-out","source-atop"],["destination-over","destination-in","destination-out","destination-atop"],["lighter"],["copy"],["xor"],["multiply","screen","overlay"],["darken","lighten"],["color-dodge","color-burn"],["hard-light","soft-light"],["difference","exclusion"],["hue","saturation","color","luminosity"]];static DEFAULT_IMAGE_SIZE=500;static MAX_IMAGE_SIZE=3e3;static DEFAULT_DPI=150;static MAX_DPI=1500;constructor(){}}class Z4Layer{offscreen=null;offscreenCtx=null;name=null;offsetX=0;offsetY=0;opacity=1;compositeOperation="source-over";width=0;height=0;constructor(e,t,i,s,a,n){this.name=e,this.offscreen=new OffscreenCanvas(t,i),this.offscreenCtx=this.offscreen.getContext("2d"),this.offscreenCtx.fillStyle=this.getFillStyle(s.getRGBA_HEX()),this.offscreenCtx.fillRect(0,0,t,i),this.offsetX=(a-t)/2,this.offsetY=(n-i)/2,this.width=t,this.height=i}getFillStyle(e){return e}static fromImage(e,t,i,s){let a=new Z4Layer(e,t.width,t.height,new Color(0,0,0,0),i,s);return a.offscreenCtx.drawImage(t,0,0),a}convertToBlob(e){let t={};t.type="image/png",this.offscreen.convertToBlob(t).then(t=>{e(t)})}shift(e,t){this.offsetX+=e,this.offsetY+=t}setOpacity(e){this.opacity=e}getOpacity(){return this.opacity}setCompositeOperation(e){this.compositeOperation=e}getCompositeOperation(){return this.compositeOperation}move(e,t){this.offsetX=e,this.offsetY=t}setName(e){this.name=e}getName(){return this.name}getOffset(){return new Point(this.offsetX,this.offsetY)}getSize(){return new Dimension(this.width,this.height)}draw(e,t){e.save(),e.globalAlpha=this.opacity,e.globalCompositeOperation=this.compositeOperation,e.drawImage(this.offscreen,t?0:this.offsetX,t?0:this.offsetY),e.restore()}}class Z4Paper{layers=[];getLayersCount(){return this.layers.length}getLayerAt(e){return this.layers[e]}addLayer(e,t,i,s,a,n){this.layers.push(new Z4Layer(e,t,i,s,a,n))}addLayerFromImage(e,t,i,s){this.layers.push(Z4Layer.fromImage(e,t,i,s))}moveLayer(e,t){let i=Math.min(this.layers.length,t),s=this.layers.indexOf(e);return i<s?(this.layers.splice(i,0,this.layers.splice(s,1)[0]),!0):i>s&&(this.layers.splice(i,0,this.layers[s]),this.layers.splice(s,1),!0)}reset(){this.layers.length=0}draw(e,t){this.layers.forEach(i=>i.draw(e,t))}}