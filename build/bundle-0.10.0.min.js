class Z4Setting{static language=Z4Setting.initLanguage();static theme=Z4Setting.initTheme();static mode=Z4Setting.initMode();static initLanguage(){let e=decodeURIComponent(document.cookie).split(";");for(let t=0;t<e.length;t++){let i=e[t].trim();if(i.startsWith("z4language"))return i.substring(11)}return navigator.languages?navigator.languages[0].substring(0,2):navigator.language?navigator.language.substring(0,2):navigator.userLanguage?navigator.userLanguage.substring(0,2):"en"}static initTheme(){Z4Setting.theme="auto";let e=decodeURIComponent(document.cookie).split(";");for(let t=0;t<e.length;t++){let i=e[t].trim();i.startsWith("z4theme")&&(Z4Setting.theme=i.substring(8))}return Z4Setting.setTheme(Z4Setting.theme),Z4Setting.theme}static initMode(){Z4Setting.mode="standard";let e=decodeURIComponent(document.cookie).split(";");for(let t=0;t<e.length;t++){let i=e[t].trim();i.startsWith("z4mode")&&(Z4Setting.mode=i.substring(7))}return Z4Setting.setMode(Z4Setting.mode),Z4Setting.mode}static setLanguage(e){let t=new Date;t.setTime(t.getTime()+31536e6),document.cookie="z4language="+e+";expires="+t.toUTCString()+";path="+Z4Loader.path,Z4Setting.language=e}static getLanguage(){return Z4Setting.language}static setTheme(e){Z4Setting.theme=e;let t=new Date;switch(t.setTime(t.getTime()+31536e6),document.cookie="z4theme="+e+";expires="+t.toUTCString()+";path="+Z4Loader.path,Z4Setting.theme){case"auto":window.matchMedia?Z4Setting.addDarkModeListener():document.body.classList.remove("z4-dark");break;case"light":document.body.classList.remove("z4-dark");break;case"dark":document.body.classList.add("z4-dark")}}static addDarkModeListener(){if("auto"===Z4Setting.theme){window.matchMedia("(prefers-color-scheme: dark)").matches?document.body.classList.add("z4-dark"):document.body.classList.remove("z4-dark");let e=new Object;e.once=!0,window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(()=>Z4Setting.addDarkModeListener()),e)}}static getTheme(){return Z4Setting.theme}static setMode(e){Z4Setting.mode=e,document.body.classList.remove("z4-lite"),document.body.classList.remove("z4-standard"),document.body.classList.remove("z4-pro"),document.body.classList.add("z4-"+e);let t=new Date;t.setTime(t.getTime()+31536e6),document.cookie="z4mode="+e+";expires="+t.toUTCString()+";path="+Z4Loader.path}static getMode(){return Z4Setting.mode}static isLiteMode(){return"lite"===Z4Setting.mode}static isStandardMode(){return"standard"===Z4Setting.mode}static isProMode(){return"pro"===Z4Setting.mode}constructor(){}}class Z4HTMLFactory{static HTML=Z4HTMLFactory.initHTML();static get(e){return Z4HTMLFactory.HTML[e]}static initHTML(){let e=new Array,t=new XMLHttpRequest;return Z4Loader.allFiles?(t.open("GET",Z4Loader.UP+"src/giada/html_list.properties?random="+Math.random(),!1),t.send(),new String(t.responseText).split("\n").forEach((i=>{i&&!i.startsWith("#")&&(t.open("GET",Z4Loader.UP+"src/"+i,!1),t.send(),e[i]=t.responseText)}))):(t.open("GET",Z4Loader.UP+"build/bundle-"+Z4Loader.version+".html",!1),t.send(),Z4HTMLFactory.readHTMLs(e,t.responseText)),e}static readHTMLs(e,t){new String(t).split("\n").forEach((t=>{if(t){let i=t.split(":=");e[i[0].trim()]=i[1].trim()}}))}constructor(){}}class Z4MessageFactory{static MESSAGE=Z4MessageFactory.initMessages();static get(e){return Z4MessageFactory.MESSAGE[e]}static changingLanguage(){Z4MessageFactory.MESSAGE=Z4MessageFactory.initMessages(),document.querySelectorAll("[data-token-lang-inner_text]").forEach((e=>e.innerHTML=Z4MessageFactory.get(e.getAttribute("data-token-lang-inner_text"))))}static initMessages(){let e=new Array,t=Z4Loader.UP+(Z4Loader.allFiles?"src/message/":"build/message/"),i=Z4Loader.allFiles?"message-"+Z4Setting.getLanguage()+".properties?random="+Math.random():"message-"+Z4Setting.getLanguage()+"-"+Z4Loader.version+".properties",s=new XMLHttpRequest;if(s.open("GET",t+i,!1),s.send(),Z4MessageFactory.readMessages(e,s.responseText),0===Object.keys(e).length){Z4Setting.setLanguage("en"),i=Z4Loader.allFiles?"message-en.properties?random="+Math.random():"message-en-"+Z4Loader.version+".properties";let s=new XMLHttpRequest;s.open("GET",t+i,!1),s.send(),Z4MessageFactory.readMessages(e,s.responseText)}return e}static readMessages(e,t){new String(t).split("\n").forEach((t=>{if(t&&!t.startsWith("#")){let i=t.split("=");e[i[0].trim()]=i[1].trim()}}))}constructor(){}}class Z4ImageFactory{static IMAGES=Z4ImageFactory.initImages();static get(e){return Z4ImageFactory.IMAGES[e]}static initImages(){let e=new Array,t=Z4Loader.UP+(Z4Loader.allFiles?"src/image/":"build/image/"),i=Z4Loader.allFiles?"image_list.properties?random="+Math.random():"image_list-"+Z4Loader.version+".properties",s=new XMLHttpRequest;return s.open("GET",t+i,!1),s.send(),Z4ImageFactory.readImages(t,e,new String(s.responseText).split("\n")),e}static readImages(e,t,i){i.forEach((s=>{if(s&&!s.startsWith("#")){let r=s.split("="),o=new Image;o.onload=s=>Z4ImageFactory.readImages(e,t,i.slice(1)),o.src=e+r[1].trim(),t[r[0].trim()]=o}}))}constructor(){}}class Z4AbstractComponentUI{root=null;constructor(e){this.root=document.createElement("div"),this.root.setAttribute("id","id"+(new Date).getTime()+"_"+parseInt(1e3*Math.random())),this.root.innerHTML=e;let t=this.root.querySelectorAll("#"+this.root.id+" [data-token-lang-inner_text]");for(let e=0;e<t.length;e++){let i=t.item(e);i.innerHTML=Z4MessageFactory.get(i.getAttribute("data-token-lang-inner_text"))}}querySelector(e){return this.root.querySelector(e)}querySelectorAll(e){return this.root.querySelectorAll(e)}appendToElement(e){return e.appendChild(this.root),this}appendToComponent(e){return e.root.appendChild(this.root),this}prependElement(e){return this.root.prepend(e),this}prependComponent(e){return this.root.prepend(e.root),this}}class Z4AbstractComponentWithValueUI extends Z4AbstractComponentUI{value=null;onchange=e=>{};oninput=e=>{};constructor(e){super(e)}setValue(e){}getValue(){return this.value}}class Z4ModalMessageUI{static html=Z4ModalMessageUI.loadHTML();static modal=new bootstrap.Modal(Z4ModalMessageUI.html);static loadHTML(){let e=document.createElement("div");return e.setAttribute("id",(new Date).getTime()+"-"+parseInt(1e3*Math.random())),e.setAttribute("data-bs-backdrop","static"),e.setAttribute("data-bs-keyboard","false"),e.setAttribute("tabindex","-1"),e.setAttribute("style","display:none"),e.className="modal modal-dialog-centered fade",e.innerHTML=Z4HTMLFactory.get("giada/pizzapazza/ui/Z4ModalMessageUI.html"),document.body.appendChild(e),e}static showInfo(e,t,i){Z4ModalMessageUI.showOneButton(e,t,i,"bi bi-info-circle-fill","#0dcaf0")}static showWarning(e,t,i){Z4ModalMessageUI.showOneButton(e,t,i,"bi bi-exclamation-triangle-fill","#ffc107")}static showError(e,t,i){Z4ModalMessageUI.showOneButton(e,t,i,"bi bi-exclamation-octagon-fill","#dc3545")}static showOneButton(e,t,i,s,r){Z4ModalMessageUI.html.querySelector(".modal-title").innerHTML=e,Z4ModalMessageUI.html.querySelector(".modal-message").innerHTML=t;let o=Z4ModalMessageUI.html.querySelector(".modal-icon i");o.className=s,o.style.color=r;let a=Z4ModalMessageUI.html.querySelector(".modal-footer");a.innerHTML="",Z4ModalMessageUI.appendButton(Z4MessageFactory.get("OK"),"btn btn-sm btn-primary",i,a),Z4ModalMessageUI.modal.show()}static showQuestion(e,t,i,s,r,o){Z4ModalMessageUI.html.querySelector(".modal-title").innerHTML=e,Z4ModalMessageUI.html.querySelector(".modal-message").innerHTML=t;let a=Z4ModalMessageUI.html.querySelector(".modal-icon i");a.className="bi bi-question-circle-fill",a.style.color="#6c757d";let n=Z4ModalMessageUI.html.querySelector(".modal-footer");n.innerHTML="",i&&Z4ModalMessageUI.appendButton(Z4MessageFactory.get("YES"),"btn btn-sm btn-primary",i,n),s&&Z4ModalMessageUI.appendButton(Z4MessageFactory.get("NO"),"btn btn-sm btn-secondary",s,n),r&&Z4ModalMessageUI.appendButton(Z4MessageFactory.get("OK"),"btn btn-sm btn-primary",r,n),o&&Z4ModalMessageUI.appendButton(Z4MessageFactory.get("CANCEL"),"btn btn-sm btn-secondary",o,n),Z4ModalMessageUI.modal.show()}static appendButton(e,t,i,s){let r=document.createElement("button");r.setAttribute("type","button"),r.setAttribute("data-bs-dismiss","modal"),r.className=t,r.innerHTML=e,r.onclick=e=>(i(),null),s.appendChild(r)}constructor(){}}class Z4Math{static TWO_PI=2*Math.PI;static HALF_PI=Math.PI/2;static GOLD_SECTION=(1+Math.sqrt(5))/2;static SQUARE_GOLD_SECTION=Z4Math.GOLD_SECTION*Z4Math.GOLD_SECTION;static RAD2DEG=180/Math.PI;static DEG2RAD=Math.PI/180;static rad2deg(e){return e*Z4Math.RAD2DEG}static deg2rad(e){return e*Z4Math.DEG2RAD}static distance(e,t,i,s){let r=e-i,o=t-s;return Math.sqrt(r*r+o*o)}static atan(e,t,i,s){let r=Math.atan2(s-t,i-e);return r<0?r+Z4Math.TWO_PI:r}static ripple(e,t,i,s){let r=(i-t)*s*Math.random();return(e+=Math.random()>.5?r:-r)<t?t:e>i?i:e}constructor(){}}class Z4Sign{static POSITIVE=new Z4Sign(1);static NEGATIVE=new Z4Sign(-1);static RANDOM=new Z4Sign(0);sign=0;constructor(e){this.sign=e}next(){switch(this.sign){case 1:case-1:return this.sign;case 0:default:return Math.random()>.5?1:-1;case 2:case-2:return this.sign*=-1,this.sign/2}}static alternate(){return new Z4Sign(-2)}}class Z4SignedValue{sign=Z4Sign.RANDOM;value=0;getSign(){return this.sign}setSign(e){return this.sign=e,this}getValue(){return this.value}setValue(e){return this.value=e,this}next(){return this.sign.next()*this.value}}class Z4SignedRandomValue{sign=Z4Sign.RANDOM;value=0;type=0;length=0;step=0;prevRandom=0;controlRandom=0;nextRandom=0;bezierCurve=null;constructor(e,t,i){this.value=e,this.type=t,this.length=i,this.step=0,this.prevRandom=Math.random(),this.controlRandom=1,this.nextRandom=Math.random(),1===this.type&&this.createBezierCurve()}createBezierCurve(){this.bezierCurve=new Bezier(0,this.prevRandom,this.length/2,this.controlRandom,1,this.nextRandom)}isClassic(){return 0===this.type}isBezier(){return 1===this.type}isPolyline(){return 2===this.type}isStepped(){return 3===this.type}getSign(){return this.sign}setSign(e){return this.sign=e,this}getValue(){return this.value}getLength(){return this.length}nextUnsigned(){switch(this.type){case 0:default:return this.value*Math.random();case 1:return this.step===this.length?(this.step=0,this.prevRandom=this.nextRandom,this.controlRandom=1===this.controlRandom?0:1,this.nextRandom=Math.random(),this.createBezierCurve()):this.step++,value*this.bezierCurve.get(this.step/this.length).y;case 2:return this.step===this.length?(this.step=0,this.prevRandom=this.nextRandom,this.nextRandom=Math.random()):this.step++,value*((this.nextRandom-this.prevRandom)*this.step/this.length+this.prevRandom);case 3:return this.step===this.length?(this.step=0,this.prevRandom=Math.random()):this.step++,value*this.prevRandom}}nextSigned(){return this.sign.next()*this.nextUnsigned()}static classic(e){return new Z4SignedRandomValue(e,0,1)}static bezier(e,t){return new Z4SignedRandomValue(e,1,t)}static polyline(e,t){return new Z4SignedRandomValue(e,2,t)}static stepped(e,t){return new Z4SignedRandomValue(e,3,t)}}class Z4FancifulValue{constant=new Z4SignedValue;random=Z4SignedRandomValue.classic(0);proportional=new Z4SignedValue;uniformSign=!1;setConstant(e){return this.constant=e,this}getConstant(){return this.constant}setRandom(e){return this.random=e,this}getRandom(){return this.random}setProportional(e){return this.proportional=e,this}getProportional(){return this.proportional}setUniformSign(e){return this.uniformSign=e,this}isUniformSign(){return this.uniformSign}next(e){return Z4Setting.isLiteMode()?this.constant.next():Z4Setting.isStandardMode()?this.uniformSign?this.constant.getSign().next()*(this.constant.getValue()+this.random.nextUnsigned()):this.constant.next()+this.random.nextSigned():Z4Setting.isProMode()?this.uniformSign?this.constant.getSign().next()*(this.constant.getValue()+this.random.nextUnsigned()+e*this.proportional.getValue()):this.constant.next()+this.random.nextSigned()+e*this.proportional.next():0}}class Z4Rotation{type=0;startAngle=0;angle=new Z4FancifulValue;delayed=!1;rotationNext=0;constructor(e){this.type=e}isFixed(){return 0===this.type}isCumulative(){return 1===this.type}isRelativeToPath(){return 2===this.type}getStartAngle(){return this.startAngle}setStartAngle(e){return this.startAngle=e,this}getAngle(){return this.angle}setAngle(e){return this.angle=e,this}isDelayed(){return this.delayed}setDelayed(e){return this.delayed=e,this}next(e){let t=Z4Math.deg2rad(this.startAngle+this.angle.next(0));switch(this.type){case 0:return t+(this.delayed?Math.PI:0);case 1:return this.rotationNext+=t,this.rotationNext+(this.delayed?Math.PI:0);case 2:return t+e+(this.delayed?Math.PI:0);default:return 0}}nextSide(e,t){switch(this.type){case 0:case 1:e.setSide(Z4Sign.POSITIVE);break;case 2:e.setSide(t?t.direction(e.getZ4Vector()):Z4Sign.RANDOM)}}static fixed(){return new Z4Rotation(0)}static cumulative(){return new Z4Rotation(1)}static relativeToPath(){return new Z4Rotation(2)}}class Z4Shape2D{static CIRCLE=new Z4Shape2D(0);static TRIANGLE=new Z4Shape2D(3);static SQUARE=new Z4Shape2D(-4);static DIAMOND=new Z4Shape2D(4);static PENTAGON=new Z4Shape2D(5);static HEXAGON=new Z4Shape2D(6);static SEPTAGON=new Z4Shape2D(7);static HEPTAGON=new Z4Shape2D(8);static STAR=new Z4Shape2D(-5);path=new Path2D;constructor(e){let t=.5,i=0,s=0;switch(e){case 0:this.path.arc(0,0,t,0,Z4Math.TWO_PI);break;case-4:this.path.rect(-.5,-.5,1,1);break;case-5:i=-Z4Math.HALF_PI,s=Z4Math.TWO_PI/5;let r=t/Z4Math.SQUARE_GOLD_SECTION;this.path.moveTo(Math.cos(i)*t,Math.sin(i)*t),i=3*s+Z4Math.HALF_PI,this.path.lineTo(Math.cos(i)*r,Math.sin(i)*r);for(let e=1;e<5;e++)i=s*e-Z4Math.HALF_PI,this.path.lineTo(Math.cos(i)*t,Math.sin(i)*t),i=s*(e+3)+Z4Math.HALF_PI,this.path.lineTo(Math.cos(i)*r,Math.sin(i)*r);break;default:i=-Z4Math.HALF_PI,s=Z4Math.TWO_PI/e,this.path.moveTo(Math.cos(i)*t,Math.sin(i)*t);for(let r=1;r<e;r++)i=s*r-Z4Math.HALF_PI,this.path.lineTo(Math.cos(i)*t,Math.sin(i)*t)}this.path.closePath()}getPath(){return path}}class Z4Vector{x0=0;y0=0;x=0;y=0;module=0;phase=0;constructor(e,t,i,s,r,o){this.x0=e,this.y0=t,this.x=i,this.y=s,this.module=r,this.phase=o}static fromPoints(e,t,i,s){return new Z4Vector(e,t,i,s,Z4Math.distance(e,t,i,s),Z4Math.atan(e,t,i,s))}static fromVector(e,t,i,s){return new Z4Vector(e,t,e+i*Math.cos(s),t+i*Math.sin(s),i,s)}clone(){return new Z4Vector(this.x0,this.y0,this.x,this.y,this.module,this.phase)}getX0(){return this.x0}getY0(){return this.y0}getX(){return this.x}getY(){return this.y}getModule(){return this.module}getPhase(){return this.phase}direction(e){let t=this.x-this.x0,i=this.y-this.y0,s=e.x-e.x0,r=e.y-e.y0;return Math.atan2(t*r-i*s,t*s+i*r)>=0?Z4Sign.POSITIVE:Z4Sign.NEGATIVE}}class Z4Point{z4Vector=Z4Vector.fromPoints(0,0,1,1);intensity=1;lighting=Z4Lighting.NONE;colorPosition=-1;drawBounds=!1;side=Z4Sign.RANDOM;useVectorModuleAsSize=!1;clone(){let e=new Z4Point;return e.z4Vector=this.z4Vector.clone(),e.intensity=this.intensity,e.lighting=this.lighting,e.colorPosition=this.colorPosition,e.drawBounds=this.drawBounds,e.side=this.side,e.useVectorModuleAsSize=this.useVectorModuleAsSize,e}getZ4Vector(){return this.z4Vector}setZ4Vector(e){return this.z4Vector=e,this}getIntensity(){return this.intensity}getLighting(){return this.lighting}setLighting(e){return this.lighting=e,this}getColorPosition(){return this.colorPosition}setColorPosition(e){return this.colorPosition=e,this}isDrawBounds(){return this.drawBounds}setSide(e){return this.side=e,this}isUseVectorModuleAsSize(){return this.useVectorModuleAsSize}}class Z4SignedValueUI extends Z4AbstractComponentWithValueUI{toggle=this.querySelector(".sign-button");toggleImg=this.querySelector(".sign-button img");text=this.querySelector(".value");spinner=this.querySelector(".spinner");applySpin=()=>this.spin();isApplySpin=!1;static PATH=Z4Loader.UP+(Z4Loader.allFiles?"src/image/":"build/image/");static UI=Z4HTMLFactory.get("giada/pizzapazza/math/ui/Z4SignedValueUI.html");constructor(){super(Z4SignedValueUI.UI),this.toggleImg.setAttribute("src",Z4SignedValueUI.PATH+"z4sign_"+this.toggle.getAttribute("data-value")+".svg");let e=this.querySelectorAll(".dropdown-menu img");for(let t=0;t<e.length;t++){let i=e.item(t);i.setAttribute("src",Z4SignedValueUI.PATH+"z4sign_"+i.getAttribute("data-icon")+".svg")}let t=this.querySelectorAll(".dropdown-item");for(let e=0;e<t.length;e++){let i=t.item(e);i.onclick=e=>{let t=i.getAttribute("data-value");switch(this.toggle.setAttribute("data-value",t),this.toggleImg.setAttribute("src",Z4SignedValueUI.PATH+"z4sign_"+t+".svg"),t){case"positive":this.onchange(this.value.setSign(Z4Sign.POSITIVE));break;case"negative":this.onchange(this.value.setSign(Z4Sign.NEGATIVE));break;case"random":this.onchange(this.value.setSign(Z4Sign.RANDOM));break;case"alternate":this.onchange(this.value.setSign(Z4Sign.alternate()))}return null}}this.text.oninput=e=>(this.oninput(this.value.setValue(this.text.valueAsNumber)),null),this.text.onchange=e=>(this.onchange(this.value.setValue(this.text.valueAsNumber)),null),this.text.onfocus=e=>(this.text.select(),null),Z4Loader.touch?(this.spinner.ontouchstart=e=>this.startSpin(),this.spinner.ontouchend=e=>this.stopSpin()):(this.spinner.onmousedown=e=>this.startSpin(),this.spinner.onmouseup=e=>this.stopSpin()),this.setValue(new Z4SignedValue)}startSpin(){return this.isApplySpin=!0,this.applySpin(),null}stopSpin(){return this.isApplySpin=!1,this.spinner.value="0",null}spin(){let e=parseFloat(this.text.getAttribute("min")),t=parseFloat(this.text.getAttribute("max")),i=this.spinner.valueAsNumber,s=1;i&&(s=Math.abs(i),i=Math.max(e,this.text.valueAsNumber+(i>0?1:-1)),i=Math.min(i,t),this.text.value=""+i,this.oninput(this.value.setValue(this.text.valueAsNumber))),this.isApplySpin?setTimeout(this.applySpin,500/s):this.onchange(this.value.setValue(this.text.valueAsNumber))}setRange(e,t){return this.text.setAttribute("min",""+e),this.text.setAttribute("max",""+t),this.querySelector(".range-label").innerHTML="["+e+","+(999999999===t?"&infin;":t)+"]",this}setSignVisible(e){return e?(this.querySelector(".sign-label").classList.remove("sign-label-not-visible"),this.toggle.classList.remove("sign-toggle-not-visible")):(this.querySelector(".sign-label").classList.add("sign-label-not-visible"),this.toggle.classList.add("sign-toggle-not-visible")),this}setValueLabel(e,t,i){let s=this.querySelector(".value-label");return s.setAttribute("data-token-lang-inner_text",e),s.innerHTML=Z4MessageFactory.get(e),s.style.fontWeight=t?"700":"400",s.style.fontStyle=i?"italic":"normal",this}setValue(e){this.value=e;let t=null;return t=e.getSign()===Z4Sign.POSITIVE?"positive":e.getSign()===Z4Sign.NEGATIVE?"negative":e.getSign()===Z4Sign.RANDOM?"random":"alternate",this.toggle.setAttribute("data-value",t),this.toggleImg.setAttribute("src",Z4SignedValueUI.PATH+"z4sign_"+t+".svg"),this.text.value=""+e.getValue(),this}}class Z4SignedRandomValueUI extends Z4AbstractComponentWithValueUI{toggleType=this.querySelector(".toggle-type");toggleTypeImg=this.querySelector(".toggle-type img");valueLength=this.querySelector(".type-length");spinnerLength=this.querySelector(".type-length-spinner");signedValueUI=new Z4SignedValueUI;applySpin=()=>this.spin();isApplySpin=!1;static PATH=Z4Loader.UP+(Z4Loader.allFiles?"src/image/":"build/image/");static UI=Z4HTMLFactory.get("giada/pizzapazza/math/ui/Z4SignedRandomValueUI.html");constructor(){super(Z4SignedRandomValueUI.UI),this.signedValueUI.appendToComponent(this),this.signedValueUI.oninput=e=>this.oninput(this.createSignedRandomValue(this.toggleType.getAttribute("data-value"))),this.signedValueUI.onchange=e=>this.onchange(this.createSignedRandomValue(this.toggleType.getAttribute("data-value"))),this.toggleTypeImg.setAttribute("src",Z4SignedRandomValueUI.PATH+"z4randomvalue_"+this.toggleType.getAttribute("data-value")+".svg");let e=this.querySelectorAll(".toggle-type-dropdown-menu img");for(let t=0;t<e.length;t++){let i=e.item(t);i.setAttribute("src",Z4SignedRandomValueUI.PATH+"z4randomvalue_"+i.getAttribute("data-icon")+".svg")}let t=this.querySelectorAll(".toggle-type-dropdown-menu .dropdown-item");for(let e=0;e<t.length;e++){let i=t.item(e);i.onclick=e=>{let t=i.getAttribute("data-value");return this.toggleType.setAttribute("data-value",t),this.toggleTypeImg.setAttribute("src",Z4SignedRandomValueUI.PATH+"z4randomvalue_"+t+".svg"),this.querySelector(".divider-length").style.display="classic"===t?"none":"block",this.querySelector(".container-length").style.display="classic"===t?"none":"block",this.onchange(this.createSignedRandomValue(t)),null}}this.valueLength.oninput=e=>(this.oninput(this.createSignedRandomValue(this.toggleType.getAttribute("data-value"))),null),this.valueLength.onchange=e=>(this.onchange(this.createSignedRandomValue(this.toggleType.getAttribute("data-value"))),null),this.valueLength.onfocus=e=>(this.valueLength.select(),null),Z4Loader.touch?(this.spinnerLength.ontouchstart=e=>this.startSpin(),this.spinnerLength.ontouchend=e=>this.stopSpin()):(this.spinnerLength.onmousedown=e=>this.startSpin(),this.spinnerLength.onmouseup=e=>this.stopSpin()),this.signedValueUI.prependElement(this.querySelector(".type-label")),this.querySelector(".number-group").prepend(this.querySelector(".toggle-type-dropdown-menu")),this.querySelector(".number-group").prepend(this.toggleType),this.querySelector(".sign-label").style.width="50px",this.querySelector(".range-label").classList.add("signed-random-value"),this.setValue(Z4SignedRandomValue.classic(0))}startSpin(){return this.isApplySpin=!0,this.applySpin(),null}stopSpin(){return this.isApplySpin=!1,this.spinnerLength.value="0",null}spin(){let e=parseFloat(this.valueLength.getAttribute("min")),t=parseFloat(this.valueLength.getAttribute("max")),i=this.spinnerLength.valueAsNumber,s=1;i&&(s=Math.abs(i),i=Math.max(e,this.valueLength.valueAsNumber+(i>0?1:-1)),i=Math.min(i,t),this.valueLength.value=""+i,this.oninput(this.createSignedRandomValue(this.toggleType.getAttribute("data-value")))),this.isApplySpin?setTimeout(this.applySpin,500/s):this.onchange(this.createSignedRandomValue(this.toggleType.getAttribute("data-value")))}setRange(e,t){return this.signedValueUI.setRange(e,t),this}setSignVisible(e){return this.signedValueUI.setSignVisible(e),this}setLengthRange(e,t){return this.valueLength.setAttribute("min",""+e),this.valueLength.setAttribute("max",""+t),this.querySelector(".range-length-label").innerHTML="["+e+","+(999999999===t?"&infin;":t)+"]",this}setValueLabel(e,t,i){return this.signedValueUI.setValueLabel(e,t,i),this}setValue(e){this.value=e;let t=null;return this.value.isClassic()?t="classic":this.value.isBezier()?t="bezier":this.value.isPolyline()?t="polyline":this.value.isStepped()&&(t="stepped"),this.toggleType.setAttribute("data-value",t),this.toggleTypeImg.setAttribute("src",Z4SignedRandomValueUI.PATH+"z4randomvalue_"+t+".svg"),this.signedValueUI.setValue((new Z4SignedValue).setValue(this.value.getValue()).setSign(this.value.getSign())),this.querySelector(".divider-length").style.display="classic"===t?"none":"block",this.querySelector(".container-length").style.display="classic"===t?"none":"block",this.valueLength.value=""+this.getValue().getLength(),this}createSignedRandomValue(e){let t=this.signedValueUI.getValue();switch(e){case"classic":this.value=Z4SignedRandomValue.classic(t.getValue()).setSign(t.getSign());break;case"bezier":this.value=Z4SignedRandomValue.bezier(t.getValue(),this.valueLength.valueAsNumber).setSign(t.getSign());break;case"polyline":this.value=Z4SignedRandomValue.polyline(t.getValue(),this.valueLength.valueAsNumber).setSign(t.getSign());break;case"stepped":this.value=Z4SignedRandomValue.stepped(t.getValue(),this.valueLength.valueAsNumber).setSign(t.getSign())}return this.value}}class Z4FancifulValueUI extends Z4AbstractComponentWithValueUI{uniformCheck=this.querySelector(".uniform-check");toggleUniform=this.querySelector(".toggle-uniform");toggleUniformImg=this.querySelector(".toggle-uniform img");constantUI=new Z4SignedValueUI;randomUI=new Z4SignedRandomValueUI;proportionalUI=new Z4SignedValueUI;constantSignVisible=!0;randomSignVisible=!0;proportionalSignVisible=!0;constantVisible=!0;randomVisible=!0;proportionalVisible=!0;selector=new Array;static PATH=Z4Loader.UP+(Z4Loader.allFiles?"src/image/":"build/image/");static UI=Z4HTMLFactory.get("giada/pizzapazza/math/ui/Z4FancifulValueUI.html");constructor(){super(Z4FancifulValueUI.UI),this.uniformCheck.id="uniform_"+(new Date).getTime()+"_"+parseInt(1e3*Math.random()),this.querySelector(".uniform-label").setAttribute("for",this.uniformCheck.id),this.uniformCheck.onchange=e=>(this.setUI(),this.onchange(this.value.setUniformSign(this.uniformCheck.checked)),null),this.toggleUniformImg.setAttribute("src",Z4FancifulValueUI.PATH+"z4sign_"+this.toggleUniform.getAttribute("data-value")+".svg");let e=this.querySelectorAll(".toggle-uniform-dropdown-menu img");for(let t=0;t<e.length;t++){let i=e.item(t);i.setAttribute("src",Z4FancifulValueUI.PATH+"z4sign_"+i.getAttribute("data-icon")+".svg")}let t=this.querySelectorAll(".toggle-uniform-dropdown-menu .dropdown-item");for(let e=0;e<t.length;e++){let i=t.item(e);i.onclick=e=>{let t=i.getAttribute("data-value");return this.toggleUniform.setAttribute("data-value",t),this.toggleUniformImg.setAttribute("src",Z4FancifulValueUI.PATH+"z4sign_"+t+".svg"),this.constantUI.setValue(this.constantUI.getValue().setSign(this.getUniformSign(t))),this.onchange(this.value.setConstant(this.constantUI.getValue())),null}}this.constantUI.appendToElement(this.querySelector(".fanciful-costant")),this.constantUI.setValueLabel("CONSTANT",!1,!0),this.randomUI.appendToElement(this.querySelector("div.fanciful-random")),this.randomUI.setValueLabel("RANDOM",!1,!0),this.proportionalUI.appendToElement(this.querySelector(".fanciful-proportional")),this.proportionalUI.setValueLabel("PROPORTIONAL",!1,!0),this.constantUI.oninput=e=>this.onInput(),this.randomUI.oninput=e=>this.onInput(),this.proportionalUI.oninput=e=>this.onInput(),this.constantUI.onchange=e=>this.onChange(),this.randomUI.onchange=e=>this.onChange(),this.proportionalUI.onchange=e=>this.onChange(),this.setValue(new Z4FancifulValue)}onInput(){return this.setUniformSign(this.constantUI.getValue().getSign()),this.oninput(this.value.setConstant(this.constantUI.getValue()).setRandom(this.randomUI.getValue()).setProportional(this.proportionalUI.getValue())),null}onChange(){return this.setUniformSign(this.constantUI.getValue().getSign()),this.onchange(this.value.setConstant(this.constantUI.getValue()).setRandom(this.randomUI.getValue()).setProportional(this.proportionalUI.getValue())),null}setComponentsVisible(e,t,i){return this.constantVisible=e,this.randomVisible=t,this.proportionalVisible=i,this.setUI(),this}setSignsVisible(e,t,i){return this.constantSignVisible=e,this.randomSignVisible=t,this.proportionalSignVisible=i,this.setUI(),this}setConstantRange(e,t){return this.constantUI.setRange(e,t),this}setRandomRange(e,t){return this.randomUI.setRange(e,t),this}setRandomLengthRange(e,t){return this.randomUI.setLengthRange(e,t),this}setProportionalRange(e,t){return this.proportionalUI.setRange(e,t),this}setValueLabel(e,t,i){let s=this.querySelector(".fanciful-label");return s.setAttribute("data-token-lang-inner_text",e),s.innerHTML=Z4MessageFactory.get(e),s.style.fontWeight=t?"700":"400",s.style.fontStyle=i?"italic":"normal",this}setHorizontal(){let e=this.querySelector(".fanciful-container");return e.classList.remove("fanciful-container-vertical"),e.classList.add("fanciful-container-horizontal"),this}setVertical(){let e=this.querySelector(".fanciful-container");return e.classList.add("fanciful-container-vertical"),e.classList.remove("fanciful-container-horizontal"),this}setValue(e){return this.value=e,this.uniformCheck.checked=this.value.isUniformSign(),this.constantUI.setValue(this.value.getConstant()),this.setUniformSign(this.value.getConstant().getSign()),this.randomUI.setValue(this.value.getRandom()),this.proportionalUI.setValue(this.value.getProportional()),this.setUI(),this}setUI(){this.selector.forEach((e=>{this.querySelector(".fanciful-label").classList.remove(e),this.querySelector(".form-check").classList.remove(e),this.querySelector(".fanciful-container").classList.remove(e)})),this.selector=new Array("cv-"+this.constantVisible,"rv-"+this.randomVisible,"pv-"+this.proportionalVisible,"csv-"+this.constantSignVisible,"rsv-"+this.randomSignVisible,"psv-"+this.proportionalSignVisible,"u-"+this.uniformCheck.checked),this.selector.forEach((e=>{this.querySelector(".fanciful-label").classList.add(e),this.querySelector(".form-check").classList.add(e),this.querySelector(".fanciful-container").classList.add(e)}))}setUniformSign(e){let t=null;t=e===Z4Sign.POSITIVE?"positive":e===Z4Sign.NEGATIVE?"negative":e===Z4Sign.RANDOM?"random":"alternate",this.toggleUniform.setAttribute("data-value",t),this.toggleUniformImg.setAttribute("src",Z4FancifulValueUI.PATH+"z4sign_"+t+".svg")}getUniformSign(e){switch(e){case"positive":return Z4Sign.POSITIVE;case"negative":return Z4Sign.NEGATIVE;case"random":return Z4Sign.RANDOM;case"alternate":return Z4Sign.alternate();default:return null}}}class Z4RotationUI extends Z4AbstractComponentWithValueUI{toggleType=this.querySelector(".toggle-type-rotation");toggleTypeImg=this.querySelector(".toggle-type-rotation img");startAngle=(new Z4SignedValueUI).setRange(0,360).setValueLabel("START_ANGLE",!0,!1).setSignVisible(!1).appendToElement(this.querySelector(".start-angle-container"));delayedCheck=this.querySelector(".delayed-check");angle=(new Z4FancifulValueUI).setValueLabel("ANGLE",!0,!1).setComponentsVisible(!0,!0,!1).setConstantRange(0,180).setRandomRange(0,180).appendToComponent(this);static PATH=Z4Loader.UP+(Z4Loader.allFiles?"src/image/":"build/image/");static UI=Z4HTMLFactory.get("giada/pizzapazza/math/ui/Z4RotationUI.html");constructor(){super(Z4RotationUI.UI),this.toggleTypeImg.setAttribute("src",Z4RotationUI.PATH+"z4rotation_"+this.toggleType.getAttribute("data-value")+".svg");let e=this.querySelectorAll(".toggle-type-rotation-dropdown-menu img");for(let t=0;t<e.length;t++){let i=e.item(t);i.setAttribute("src",Z4RotationUI.PATH+"z4rotation_"+i.getAttribute("data-icon")+".svg")}let t=this.querySelectorAll(".toggle-type-rotation-dropdown-menu .dropdown-item");for(let e=0;e<t.length;e++){let i=t.item(e);i.onclick=e=>{let t=i.getAttribute("data-value");switch(this.toggleType.setAttribute("data-value",t),this.toggleTypeImg.setAttribute("src",Z4RotationUI.PATH+"z4rotation_"+t+".svg"),t){case"fixed":this.value=Z4Rotation.fixed();break;case"cumulative":this.value=Z4Rotation.cumulative();break;case"relativetopath":this.value=Z4Rotation.relativeToPath()}return this.onchange(this.value.setAngle(this.angle.getValue()).setStartAngle(this.startAngle.getValue().getValue()).setDelayed(this.delayedCheck.checked)),null}}this.delayedCheck.id="uniform_"+(new Date).getTime()+"_"+parseInt(1e3*Math.random()),this.querySelector(".delayed-label").setAttribute("for",this.delayedCheck.id),this.delayedCheck.onchange=e=>(this.onchange(this.value.setDelayed(this.delayedCheck.checked)),null),this.startAngle.oninput=e=>this.oninput(this.value.setStartAngle(e.getValue())),this.startAngle.onchange=e=>this.onchange(this.value.setStartAngle(e.getValue())),this.angle.oninput=e=>this.oninput(this.value.setAngle(e)),this.angle.onchange=e=>this.onchange(this.value.setAngle(e)),this.setValue(Z4Rotation.fixed())}setRandomLengthRange(e,t){return this.angle.setRandomLengthRange(e,t),this}setValueLabel(e,t,i){let s=this.querySelector(".rotation-label");return s.setAttribute("data-token-lang-inner_text",e),s.innerHTML=Z4MessageFactory.get(e),s.style.fontWeight=t?"700":"400",s.style.fontStyle=i?"italic":"normal",this}setHorizontal(){return this.angle.setHorizontal(),this}setVertical(){return this.angle.setVertical(),this}setValue(e){this.value=e;let t=null;return this.value.isFixed()?t="fixed":this.value.isCumulative()?t="cumulative":this.value.isRelativeToPath()&&(t="relativetopath"),this.toggleType.setAttribute("data-value",t),this.toggleTypeImg.setAttribute("src",Z4RotationUI.PATH+"z4rotation_"+t+".svg"),this.delayedCheck.checked=this.value.isDelayed(),this.startAngle.setValue((new Z4SignedValue).setValue(this.value.getStartAngle())),this.angle.setValue(this.value.getAngle()),this}}class Z4Lighting{static NONE=new Z4Lighting;static LIGTHED=new Z4Lighting;static DARKENED=new Z4Lighting;constructor(){}}class Z4Progression{static SPATIAL=new Z4Progression;static TEMPORAL=new Z4Progression;static RELATIVE_TO_PATH=new Z4Progression;static RANDOM=new Z4Progression;constructor(){}}class Z4AbstractColor{a=0;r=0;g=0;b=0;argb=0;hex=null;constructor(e,t,i,s){this.a=e,this.r=t,this.g=i,this.b=s,this.init()}init(){return this.argb=this.a<<24|this.r<<16|this.g<<8|this.b,this.hex="#"+new Number(this.r).toString(16).padStart(2,"0")+new Number(this.g).toString(16).padStart(2,"0")+new Number(this.b).toString(16).padStart(2,"0")+new Number(this.a).toString(16).padStart(2,"0"),this}getComponents(){return new Array(this.a,this.r,this.g,this.b)}getARGB(){return this.argb}getHEX(){return this.hex}set(e){return this.a=e>>>24&255,this.r=e>>>16&255,this.g=e>>>8&255,this.b=255&e,this.init()}gray(){let e=parseInt(.21*this.r+.71*this.g+.08*this.b);return this.r=e,this.g=e,this.b=e,this.init()}negative(){return this.r=255-this.r,this.g=255-this.g,this.b=255-this.b,this.init()}lighted(e){return this.r=parseInt((255-this.r)*e+this.r),this.g=parseInt((255-this.g)*e+this.g),this.b=parseInt((255-this.b)*e+this.b),this.init()}darkened(e){return e=1-e,this.r=parseInt(e*this.r),this.g=parseInt(e*this.g),this.b=parseInt(e*this.b),this.init()}}class Z4Color extends Z4AbstractColor{constructor(e,t,i,s){super(e,t,i,s)}static fromARGB(e){return new Z4Color(e>>>24&255,e>>>16&255,e>>>8&255,255&e)}static fromHEX(e,t){let i=new RegExp("^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$","i").exec(e);return new Z4Color(t,parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16))}static fromZ4AbstractColor(e){return Z4Color.fromARGB(e.getARGB())}static fromZ4AbstractColors(e,t,i){let s=e.getComponents(),r=t.getComponents();return new Z4Color(parseInt((r[0]-s[0])*i+s[0]),parseInt((r[1]-s[1])*i+s[1]),parseInt((r[2]-s[2])*i+s[2]),parseInt((r[3]-s[3])*i+s[3]))}}class Z4StopColor extends Z4AbstractColor{position=0;constructor(e,t,i,s,r){super(e,t,i,s),this.position=r}getPosition(){return this.position}setPosition(e){return this.position=e,this}static fromARGB(e,t){return new Z4StopColor(e>>>24&255,e>>>16&255,e>>>8&255,255&e,t)}static fromHEX(e,t,i){let s=new RegExp("^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$","i").exec(e);return new Z4StopColor(t,parseInt(s[1],16),parseInt(s[2],16),parseInt(s[3],16),i)}static fromZ4AbstractColor(e,t){return Z4StopColor.fromARGB(e.getARGB(),t)}}class Z4AbstractGradientColor{z4StopColors=new Array;ripple=0;mirrored=!1;constructor(){this.z4StopColors.push(new Z4StopColor(255,255,255,255,0)),this.z4StopColors.push(new Z4StopColor(255,0,0,0,1))}getComponents(){return this.z4StopColors}addOrUpdateColor(e,t){let i=this.z4StopColors.find(((t,i,s)=>t.getPosition()===e));return i?i.set(t):this.z4StopColors.push(Z4StopColor.fromARGB(t,e)),this}generateColor(e){return this.addOrUpdateColor(e,this.getZ4ColorAt(e,!1,!1).getARGB())}removeColor(e){return this.z4StopColors=this.z4StopColors.filter(((t,i,s)=>t.getPosition()!==e)),this}move(e,t){let i=this.z4StopColors.find(((t,i,s)=>t.getPosition()===e));return i&&0!==e&&1!==e&&0!==t&&1!==t&&i.setPosition(t),this}setRipple(e){return this.ripple=e,this}getRipple(){return this.ripple}setMirrored(e){return this.mirrored=e,this}isMirrored(){return this.mirrored}negative(){return this.z4StopColors.forEach((e=>e.negative())),this}inverted(){return this.z4StopColors.forEach((e=>e.setPosition(1-e.getPosition()))),this}getZ4ColorAt(e,t,i){if(Z4Setting.isLiteMode())return this.z4StopColors.find(((e,t,i)=>1===e.getPosition()));if(Z4Setting.isStandardMode()||Z4Setting.isProMode()){i&&this.mirrored&&(e=2*(e<.5?e:1-e)),t&&0!==this.ripple&&(e=Z4Math.ripple(e,0,1,this.ripple));let s=e,r=this.z4StopColors.filter(((e,t,i)=>1===s?e.getPosition()<s:e.getPosition()<=s)).reduce(((e,t,i,s)=>e&&e.getPosition()>t.getPosition()?e:t)),o=this.z4StopColors.filter(((e,t,i)=>0===s?e.getPosition()>s:e.getPosition()>=s)).reduce(((e,t,i,s)=>e&&e.getPosition()<t.getPosition()?e:t));if(r===o)return r;{let t=(e-r.getPosition())/(o.getPosition()-r.getPosition());return Z4Color.fromZ4AbstractColors(r,o,t)}}return null}getLinearGradient(e,t,i,s,r){let o=e.createLinearGradient(t,i,s,r);return this.z4StopColors.forEach(((e,t,i)=>o.addColorStop(e.getPosition(),e.getHEX()))),o}getRadialGradient(e,t,i,s,r,o,a){let n=e.createRadialGradient(t,i,s,r,o,a);return this.z4StopColors.forEach(((e,t,i)=>n.addColorStop(e.getPosition(),e.getHEX()))),n}getConicGradient(e,t,i,s){let r=e.createConicGradient(s,t,i);return this.z4StopColors.forEach(((e,t,i)=>r.addColorStop(e.getPosition(),e.getHEX()))),r}}class Z4GradientColor extends Z4AbstractGradientColor{constructor(){super()}static fromZ4AbstractGradientColor(e){let t=new Z4GradientColor;return e.getComponents().forEach((e=>t.addOrUpdateColor(e.getPosition(),e.getARGB()))),t}static fromZ4AbstractGradientColors(e,t,i){let s=new Z4GradientColor;return e.getComponents().forEach((e=>{let r=t.getZ4ColorAt(e.getPosition(),!1,!1),o=Z4Color.fromZ4AbstractColors(e,r,i);s.addOrUpdateColor(e.getPosition(),o.getARGB())})),s.setRipple(e.getRipple()).setMirrored(e.isMirrored())}}class Z4StopGradientColor extends Z4AbstractGradientColor{position=0;constructor(e){super(),this.position=e}getPosition(){return this.position}setPosition(e){return this.position=e,this}static fromZ4AbstractGradientColor(e,t){let i=new Z4StopGradientColor(t);return e.getComponents().forEach((e=>i.addOrUpdateColor(e.getPosition(),e.getARGB()))),i.setRipple(e.getRipple()).setMirrored(e.isMirrored())}}class Z4TemporalColor{z4StopGradientColors=new Array;ripple=0;mirrored=!1;constructor(){this.z4StopGradientColors.push(new Z4StopGradientColor(0)),this.z4StopGradientColors.push(new Z4StopGradientColor(1))}getComponents(){return this.z4StopGradientColors}addOrUpdateColor(e,t,i){if(!this.z4StopGradientColors.find(((t,i,s)=>t.getPosition()===e))){let t=this.getZ4GradientColorAt(e,!1,!1);this.z4StopGradientColors.push(Z4StopGradientColor.fromZ4AbstractGradientColor(t,e))}return this.z4StopGradientColors.forEach((s=>{if(s.getPosition()!==e){s.getComponents().find(((e,i,s)=>e.getPosition()===t))||s.generateColor(t)}else s.addOrUpdateColor(t,i)})),this}generateColor(e,t){return-1!==e?this.addOrUpdateColor(e,t,this.getZ4ColorAt(e,t,!1,!1).getARGB()):(-1!==t&&this.z4StopGradientColors.forEach((e=>e.generateColor(t))),this)}removeColor(e,t){return 0!==e&&1!==e&&(this.z4StopGradientColors=this.z4StopGradientColors.filter(((t,i,s)=>t.getPosition()!==e))),0!==t&&1!==t&&this.z4StopGradientColors.forEach((e=>e.removeColor(t))),this}move(e,t,i,s){let r=this.z4StopGradientColors.find(((t,i,s)=>t.getPosition()===e));return r&&0!==e&&1!==e&&0!==t&&1!==t&&r.setPosition(t),this.z4StopGradientColors.forEach((e=>e.move(i,s))),this}setRipple(e,t){return this.ripple=e,this.z4StopGradientColors.forEach((e=>e.setRipple(t))),this}getTemporalRipple(){return this.ripple}getSpatialRipple(){return this.z4StopGradientColors[0].getRipple()}setMirrored(e,t){return this.mirrored=e,this.z4StopGradientColors.forEach((e=>e.setMirrored(t))),this}isTemporalyMirrored(){return this.mirrored}isSpatialyMirrored(){return this.z4StopGradientColors[0].isMirrored()}negative(){return this.z4StopGradientColors.forEach((e=>e.negative())),this}inverted(e,t){return e&&this.z4StopGradientColors.forEach((e=>e.setPosition(1-e.getPosition()))),t&&this.z4StopGradientColors.forEach((e=>e.inverted())),this}getZ4GradientColorAt(e,t,i){if(Z4Setting.isLiteMode()||Z4Setting.isStandardMode())return this.z4StopGradientColors.find(((e,t,i)=>0===e.getPosition()));if(Z4Setting.isProMode()){i&&this.mirrored&&(e=2*(e<.5?e:1-e)),t&&0!==this.ripple&&(e=Z4Math.ripple(e,0,1,this.ripple));let s=e,r=this.z4StopGradientColors.filter(((e,t,i)=>1===s?e.getPosition()<s:e.getPosition()<=s)).reduce(((e,t,i,s)=>e&&e.getPosition()>t.getPosition()?e:t)),o=this.z4StopGradientColors.filter(((e,t,i)=>0===s?e.getPosition()>s:e.getPosition()>=s)).reduce(((e,t,i,s)=>e&&e.getPosition()<t.getPosition()?e:t));if(r===o)return r;{let e=(s-r.getPosition())/(o.getPosition()-r.getPosition());return Z4GradientColor.fromZ4AbstractGradientColors(r,o,e)}}return null}getZ4ColorAt(e,t,i,s){return Z4Setting.isLiteMode()?this.getZ4GradientColorAt(0,!1,!1).getZ4ColorAt(1,!1,!1):Z4Setting.isStandardMode()?this.getZ4GradientColorAt(0,!1,!1).getZ4ColorAt(t,i,s):Z4Setting.isProMode()?this.getZ4GradientColorAt(e,i,s).getZ4ColorAt(t,i,s):null}}class Z4ColorUI extends Z4AbstractComponentWithValueUI{color=this.querySelector(".form-control-color");formRangeLabel=this.querySelector(".form-range-label");formRange=this.querySelector(".form-range");static UI=Z4HTMLFactory.get("giada/pizzapazza/color/ui/Z4ColorUI.html");constructor(){super(Z4ColorUI.UI),this.querySelector(".gray").onclick=e=>(this.setValue(this.value.gray()),this.onchange(this.value),null),this.querySelector(".negative").onclick=e=>(this.setValue(this.value.negative()),this.onchange(this.value),null),this.color.oninput=e=>(this.value=Z4Color.fromHEX(this.color.value,this.formRange.valueAsNumber),this.oninput(this.value),null),this.color.onchange=e=>(this.value=Z4Color.fromHEX(this.color.value,this.formRange.valueAsNumber),this.onchange(this.value),null),this.formRange.oninput=e=>(this.formRangeLabel.innerText=this.formRange.value,this.value=Z4Color.fromHEX(this.color.value,this.formRange.valueAsNumber),this.oninput(this.value),null),this.formRange.onchange=e=>(this.formRangeLabel.innerText=this.formRange.value,this.value=Z4Color.fromHEX(this.color.value,this.formRange.valueAsNumber),this.onchange(this.value),null),this.setValue(new Z4Color(255,0,0,0))}setColorLabel(e,t,i){let s=this.querySelector(".color-label");return s.setAttribute("data-token-lang-inner_text",e),s.innerHTML=Z4MessageFactory.get(e),s.style.fontWeight=t?"700":"400",s.style.fontStyle=i?"italic":"normal",this}setValue(e){return this.value=e,this.color.value=this.value.getHEX().substring(0,7),this.formRange.valueAsNumber=this.value.getComponents()[0],this.formRangeLabel.innerText=this.formRange.value,this}}class Z4GradientColorUI extends Z4AbstractComponentWithValueUI{canvas=this.querySelector(".canvas");ctx=this.canvas.getContext("2d");chessboard=this.ctx.createPattern(Z4ImageFactory.get("CHESSBOARD"),"repeat");sliders=this.querySelector(".sliders");formRangeLabel=this.querySelector(".form-range-label");mirroredCheck=this.querySelector(".mirrored-check");formRange=this.querySelector(".form-range");del=document.createElement("button");z4ColorUI=new Z4ColorUI;key=(new Date).getTime()+"_"+parseInt(1e3*Math.random());devicePixelRatioListener=null;mouseDown=!1;static UI=Z4HTMLFactory.get("giada/pizzapazza/color/ui/Z4GradientColorUI.html");static WIDTH=500;static HEIGHT=50;constructor(){super(Z4GradientColorUI.UI),this.initDevicePixelRatio(),this.querySelector(".gradient-inverted").onclick=e=>(this.setValue(this.value.inverted()),this.onchange(this.value),null),this.querySelector(".gradient-negative").onclick=e=>(this.setValue(this.value.negative()),this.onchange(this.value),null),this.querySelector(".gradient-guided-tour").onclick=e=>(Z4GradientColorGuidedTourUI.show(),null),this.canvas.style.border="1px dashed gray",this.canvas.style.width=Z4GradientColorUI.WIDTH+"px",this.canvas.style.height=Z4GradientColorUI.HEIGHT+"px",this.sliders.onmousemove=e=>{this.sliders.style.cursor="default";let t=e.clientX-this.sliders.getBoundingClientRect().left-8,i=Z4GradientColorUI.WIDTH/(this.value.isMirrored()?2:1);if(t<i){let e=t/i;this.value.getComponents().every(((t,i,s)=>Math.abs(e-t.getPosition())>.05))&&(this.sliders.style.cursor="pointer")}return null},Z4Loader.touch?this.sliders.ontouchstart=e=>(this.addColor(e.changedTouches[0].clientX),null):this.sliders.onmousedown=e=>(this.addColor(e.clientX),null),this.mirroredCheck.id="mirrored_"+(new Date).getTime()+"_"+parseInt(1e3*Math.random()),this.querySelector(".mirrored-label").setAttribute("for",this.mirroredCheck.id),this.mirroredCheck.onchange=e=>(this.value.setMirrored(this.mirroredCheck.checked),this.configureSliders(-1),this.drawCanvas(),this.onchange(this.value),null),this.formRange.oninput=e=>(this.formRangeLabel.innerText=this.formRange.value,this.value.setRipple(this.formRange.valueAsNumber),this.drawCanvas(),this.oninput(this.value),null),this.formRange.onchange=e=>(this.formRangeLabel.innerText=this.formRange.value,this.value.setRipple(this.formRange.valueAsNumber),this.drawCanvas(),this.onchange(this.value),null),this.z4ColorUI.appendToElement(this.querySelector(".canvas-container")),this.z4ColorUI.oninput=e=>{let t=this.querySelector(".sliders .form-check-input:checked");this.value.addOrUpdateColor(parseFloat(t.value),e.getARGB()),this.drawCanvas(),this.oninput(this.value)},this.z4ColorUI.onchange=e=>{let t=this.querySelector(".sliders .form-check-input:checked");this.value.addOrUpdateColor(parseFloat(t.value),e.getARGB()),this.drawCanvas(),this.onchange(this.value)},this.del.setAttribute("class","dropdown-item delete-color"),this.del.setAttribute("type","button"),this.del.setAttribute("data-token-lang-inner_text","DELETE"),this.del.innerHTML=Z4MessageFactory.get("DELETE"),this.del.onclick=e=>(Z4ModalMessageUI.showQuestion(Z4MessageFactory.get("TITLE"),Z4MessageFactory.get("DELETE_COLOR_MESSAGE"),(()=>{let e=this.querySelector(".sliders .form-check-input:checked");this.value.removeColor(parseFloat(e.value)),this.configureSliders(-1),this.drawCanvas(),this.onchange(this.value)}),(()=>{}),null,null),null),this.querySelector(".negative").parentElement.appendChild(document.createElement("li")).appendChild(this.del),this.setValue(new Z4GradientColor)}initDevicePixelRatio(){window.matchMedia&&(this.devicePixelRatioListener=()=>{this.drawCanvas(),this.addDevicePixelRatioListener()},this.addDevicePixelRatioListener())}addDevicePixelRatioListener(){let e=new Object;e.once=!0,window.matchMedia("(resolution: "+window.devicePixelRatio+"dppx)").addEventListener("change",this.devicePixelRatioListener,e)}addColor(e){e-=this.sliders.getBoundingClientRect().left+8;let t=Z4GradientColorUI.WIDTH/(this.value.isMirrored()?2:1);if(e<t){let i=e/t;this.value.getComponents().every(((e,t,s)=>Math.abs(i-e.getPosition())>.05))&&(this.value.generateColor(i),this.configureSliders(this.value.getComponents().length-1),this.drawCanvas(),this.onchange(this.value))}}setGradientColorLabel(e,t,i){let s=this.querySelector(".gradient-color-label");return s.setAttribute("data-token-lang-inner_text",e),s.innerHTML=Z4MessageFactory.get(e),s.style.fontWeight=t?"700":"400",s.style.fontStyle=i?"italic":"normal",this}setColorLabel(e,t,i){return this.z4ColorUI.setColorLabel(e,t,i),this}setValue(e){return this.value=e,this.mirroredCheck.checked=this.value.isMirrored(),this.formRange.valueAsNumber=this.value.getRipple(),this.formRangeLabel.innerText=this.formRange.value,this.configureSliders(-1),this.drawCanvas(),this}configureSliders(e){let t=Z4GradientColorUI.WIDTH/(this.value.isMirrored()?2:1);this.sliders.innerHTML="",this.value.getComponents().forEach(((i,s,r)=>{let o=i.getPosition(),a=t*o-16*s,n=document.createElement("input");n.setAttribute("class","form-check-input"),n.setAttribute("type","radio"),n.setAttribute("name","colors_"+this.key),n.setAttribute("value",""+o),n.setAttribute("style",(0!==s&&1!==s?"cursor:ew-resize;":"")+"position:relative;left:"+a+"px"),n.onchange=e=>(this.z4ColorUI.setValue(Z4Color.fromZ4AbstractColor(i)),0===s||1===s?this.del.setAttribute("disabled",""):this.del.removeAttribute("disabled"),null),Z4Loader.touch?(n.ontouchstart=e=>this.manageEvent(e,!0,!1,s,n,e.changedTouches[0].clientX),n.ontouchmove=e=>this.manageEvent(e,this.mouseDown,!0,s,n,e.changedTouches[0].clientX),n.ontouchend=e=>this.manageEvent(e,!1,!1,s,n,e.changedTouches[0].clientX),n.ontouchcancel=e=>this.manageEvent(e,!1,!1,s,n,e.changedTouches[0].clientX)):(n.onmousedown=e=>this.manageEvent(e,!0,!1,s,n,e.clientX),n.onmousemove=e=>this.manageEvent(e,this.mouseDown,!0,s,n,e.clientX),n.onmouseup=e=>this.manageEvent(e,!1,!1,s,n,e.clientX),n.onmouseleave=e=>this.manageEvent(e,!1,!1,s,n,e.clientX)),-1!==e&&s===e?(n.setAttribute("checked",""),this.z4ColorUI.setValue(Z4Color.fromZ4AbstractColor(i)),this.del.removeAttribute("disabled")):-1===e&&0===s&&(n.setAttribute("checked",""),this.z4ColorUI.setValue(Z4Color.fromZ4AbstractColor(i)),this.del.setAttribute("disabled","")),this.sliders.appendChild(n)}))}manageEvent(e,t,i,s,r,o){return e.stopPropagation(),this.mouseDown&&!t&&this.onchange(this.value),this.mouseDown=t,i&&this.mouseDown&&0!==s&&1!==s&&this.moveColor(r,s,o),null}moveColor(e,t,i){i-=this.sliders.getBoundingClientRect().left+8;let s=Z4GradientColorUI.WIDTH/(this.value.isMirrored()?2:1);if(i<s){let r=i/s;if(this.value.getComponents().every(((e,i,s)=>i===t||Math.abs(r-e.getPosition())>.05))){let i=parseFloat(e.value),o=s*r-16*t;e.setAttribute("value",""+r),e.style.left=o+"px",this.value.move(i,r),this.drawCanvas(),this.oninput(this.value)}}}drawCanvas(){this.canvas.width=Math.floor(Z4GradientColorUI.WIDTH*window.devicePixelRatio),this.canvas.height=Math.floor(Z4GradientColorUI.HEIGHT*window.devicePixelRatio);let e=new OffscreenCanvas(Z4GradientColorUI.WIDTH,Z4GradientColorUI.HEIGHT),t=e.getContext("2d");for(let e=0;e<Z4GradientColorUI.WIDTH;e++)t.fillStyle=this.value.getZ4ColorAt(e/Z4GradientColorUI.WIDTH,!0,!0).getHEX(),t.fillRect(e,0,1,Z4GradientColorUI.HEIGHT);this.ctx.save(),this.ctx.scale(window.devicePixelRatio,window.devicePixelRatio),this.ctx.fillStyle=this.chessboard,this.ctx.fillRect(0,0,Z4GradientColorUI.WIDTH,Z4GradientColorUI.HEIGHT),this.ctx.drawImage(e,0,0),this.ctx.restore()}}class Z4GradientColorGuidedTourUI extends Z4GradientColorUI{options=new Object;element1=null;element2=null;event=null;message=null;constructor(){super(),this.querySelector(".dropdown-divider").remove(),this.querySelector(".gradient-guided-tour").remove(),this.options.once=!0,this.doStep(0)}static show(){Z4ModalMessageUI.showInfo(Z4MessageFactory.get("TITLE"),"",(()=>{document.querySelector(".modal-dialog").classList.remove("modal-lg"),document.querySelector(".modal-message").innerHTML="",document.querySelector(".modal-dialog .modal-footer").innerHTML=""}));let e=document.createElement("label");e.className="z4-guided-tour",document.querySelector(".modal-dialog").classList.add("modal-lg"),document.querySelector(".modal-dialog .modal-footer").insertBefore(e,document.querySelector(".modal-dialog .modal-footer button")),(new Z4GradientColorGuidedTourUI).appendToElement(document.querySelector(".modal-message"))}doStep(e){switch(e){case 0:this.element1=this.element2=this.querySelector(".form-check-input[value='1']"),this.event="change",this.message=Z4MessageFactory.get("GUIDED_TOUR_GRADIENT_SELECT_COLOR");break;case 1:this.element1=this.element2=this.querySelector(".form-control-color"),this.event="input",this.message=Z4MessageFactory.get("GUIDED_TOUR_GRADIENT_EDIT_COMPONENTS1");break;case 2:this.element1=this.querySelector(".dropdown-toggle-split"),this.element2=this.querySelector(".dropdown-menu .form-range"),this.event="input",this.message=Z4MessageFactory.get("GUIDED_TOUR_GRADIENT_EDIT_OPACITY");break;case 3:this.element1=this.element2=this.querySelector(".sliders"),this.event=Z4Loader.touch?"touchstart":"mousedown",this.message=Z4MessageFactory.get("GUIDED_TOUR_GRADIENT_ADD_COLOR");break;case 4:this.element1=this.element2=this.querySelector(".form-control-color"),this.event="input",this.message=Z4MessageFactory.get("GUIDED_TOUR_GRADIENT_EDIT_COMPONENTS2");break;case 5:this.element1=this.element2=this.querySelector(".form-check-input:nth-child(3)"),this.event=Z4Loader.touch?"touchend":"mouseup",this.message=Z4MessageFactory.get("GUIDED_TOUR_GRADIENT_MOVE");break;case 6:this.element1=this.querySelector(".z4-dropdown-toggle-three-dots"),this.element2=this.querySelector(".gradient-inverted"),this.event="click",this.message=Z4MessageFactory.get("GUIDED_TOUR_GRADIENT_INVERT");break;case 7:this.element1=this.querySelector(".z4-dropdown-toggle-three-dots"),this.element2=this.querySelector(".gradient-negative"),this.event="click",this.message=Z4MessageFactory.get("GUIDED_TOUR_GRADIENT_NEGATIVIZE");break;case 8:this.element1=this.element2=this.querySelector(".mirrored-check"),this.event="change",this.message=Z4MessageFactory.get("GUIDED_TOUR_GRADIENT_MIRROR");break;case 9:this.element1=this.element2=this.querySelector(".form-range[step='0.01']"),this.event="input",this.message=Z4MessageFactory.get("GUIDED_TOUR_GRADIENT_ADD_RIPPLE");break;default:this.element1=null,this.message=Z4MessageFactory.get("GUIDED_TOUR_COMPLETED")}let t=document.querySelector(".modal-dialog .modal-footer label");this.element1?(this.element1.classList.add("z4-guided-tour"),this.element2.classList.add("z4-guided-tour"),this.element2.addEventListener(this.event,(t=>{this.element1.classList.remove("z4-guided-tour"),this.element2.classList.remove("z4-guided-tour"),this.doStep(e+1)}),this.options)):t&&(t.className=""),t?t.innerHTML=this.message:console.log(this.message)}}class Z4TemporalColorUI extends Z4AbstractComponentWithValueUI{canvas=this.querySelector(".canvas");ctx=this.canvas.getContext("2d");chessboard=this.ctx.createPattern(Z4ImageFactory.get("CHESSBOARD"),"repeat");sliders=this.querySelector(".sliders");temporalFormRangeLabel=this.querySelector(".temporal-form-range-label");spatialFormRangeLabel=this.querySelector(".spatial-form-range-label");temporalMirroredCheck=this.querySelector(".temporal-mirrored-check");spatialMirroredCheck=this.querySelector(".spatial-mirrored-check");temporalFormRange=this.querySelector(".form-range-temporal");spatialFormRange=this.querySelector(".form-range-spatial");del=document.createElement("button");z4ColorUI=new Z4ColorUI;key=(new Date).getTime()+"_"+parseInt(1e3*Math.random());devicePixelRatioListener=null;mouseDown=!1;static UI=Z4HTMLFactory.get("giada/pizzapazza/color/ui/Z4TemporalColorUI.html");static WIDTH=500;static HEIGHT=200;constructor(){super(Z4TemporalColorUI.UI),this.initDevicePixelRatio(),this.querySelector(".temporal-inverted").onclick=e=>this.inverted(!0,!1),this.querySelector(".spatial-inverted").onclick=e=>this.inverted(!1,!0),this.querySelector(".temporal-negative").onclick=e=>(this.setValue(this.value.negative()),this.onchange(this.value),null),this.querySelector(".temporal-guided-tour").onclick=e=>(Z4TemporalColorGuidedTourUI.show(),null),this.canvas.style.border="1px dashed gray",this.canvas.style.width=Z4TemporalColorUI.WIDTH+"px",this.canvas.style.height=Z4TemporalColorUI.HEIGHT+"px",this.canvas.onmousemove=e=>{this.canvas.style.cursor="default";let t=Z4TemporalColorUI.WIDTH/(this.value.isTemporalyMirrored()?2:1),i=Z4TemporalColorUI.HEIGHT/(this.value.isSpatialyMirrored()?2:1),s=this.value.isSpatialyMirrored()?Z4TemporalColorUI.HEIGHT/2:0,r=e.clientX-this.canvas.getBoundingClientRect().left,o=e.clientY-this.canvas.getBoundingClientRect().top;if(r<t&&s<o&&o<s+i){let e=r/t,a=(i-o+s)/i,n=this.value.getComponents().every(((t,i,s)=>Math.abs(e-t.getPosition())>.05)),l=this.value.getComponents()[0].getComponents().every(((e,t,i)=>Math.abs(a-e.getPosition())>.1));n&&l&&(this.canvas.style.cursor="pointer")}return null},Z4Loader.touch?this.canvas.ontouchstart=e=>(this.addColor(e.changedTouches[0].clientX,e.changedTouches[0].clientY),null):this.canvas.onmousedown=e=>(this.addColor(e.clientX,e.clientY),null);let e=e=>(this.value.setMirrored(this.temporalMirroredCheck.checked,this.spatialMirroredCheck.checked),this.configureSliders(-1,-1),this.drawCanvas(1),this.onchange(this.value),null);this.temporalMirroredCheck.onchange=e,this.spatialMirroredCheck.onchange=e,this.temporalMirroredCheck.id="mirrored_"+(new Date).getTime()+"_"+parseInt(1e3*Math.random()),this.querySelector(".temporal-mirrored-label").setAttribute("for",this.temporalMirroredCheck.id),this.spatialMirroredCheck.id="mirrored_"+(new Date).getTime()+"_"+parseInt(1e3*Math.random()),this.querySelector(".spatial-mirrored-label").setAttribute("for",this.spatialMirroredCheck.id),this.temporalFormRange.oninput=e=>this.setRipple(5),this.spatialFormRange.oninput=e=>this.setRipple(5),this.temporalFormRange.onchange=e=>this.setRipple(1),this.spatialFormRange.onchange=e=>this.setRipple(1),this.z4ColorUI.appendToElement(this.querySelector(".canvas-container")),this.z4ColorUI.oninput=e=>{let t=this.querySelector(".sliders .form-check-input:checked");this.value.addOrUpdateColor(parseFloat(t.getAttribute("T")),parseFloat(t.getAttribute("S")),e.getARGB()),this.drawCanvas(5),this.oninput(this.value)},this.z4ColorUI.onchange=e=>{let t=this.querySelector(".sliders .form-check-input:checked");this.value.addOrUpdateColor(parseFloat(t.getAttribute("T")),parseFloat(t.getAttribute("S")),e.getARGB()),this.drawCanvas(1),this.onchange(this.value)},this.del.setAttribute("class","dropdown-item delete-color"),this.del.setAttribute("type","button"),this.del.setAttribute("data-token-lang-inner_text","DELETE"),this.del.innerHTML=Z4MessageFactory.get("DELETE"),this.del.onclick=e=>(Z4ModalMessageUI.showQuestion(Z4MessageFactory.get("TITLE"),Z4MessageFactory.get("DELETE_COLOR_MESSAGE"),(()=>{let e=this.querySelector(".sliders .form-check-input:checked");this.value.removeColor(parseFloat(e.getAttribute("T")),parseFloat(e.getAttribute("S"))),this.configureSliders(-1,-1),this.drawCanvas(1),this.onchange(this.value)}),(()=>{}),null,null),null),this.querySelector(".negative").parentElement.appendChild(document.createElement("li")).appendChild(this.del),this.setValue(new Z4TemporalColor)}initDevicePixelRatio(){window.matchMedia&&(this.devicePixelRatioListener=()=>{this.drawCanvas(1),this.addDevicePixelRatioListener()},this.addDevicePixelRatioListener())}addDevicePixelRatioListener(){let e=new Object;e.once=!0,window.matchMedia("(resolution: "+window.devicePixelRatio+"dppx)").addEventListener("change",this.devicePixelRatioListener,e)}addColor(e,t){e-=this.canvas.getBoundingClientRect().left,t-=this.canvas.getBoundingClientRect().top;let i=Z4TemporalColorUI.WIDTH/(this.value.isTemporalyMirrored()?2:1),s=Z4TemporalColorUI.HEIGHT/(this.value.isSpatialyMirrored()?2:1),r=this.value.isSpatialyMirrored()?Z4TemporalColorUI.HEIGHT/2:0;if(e<i&&r<t&&t<r+s){let o=e/i,a=(s-t+r)/s,n=this.value.getComponents().every(((e,t,i)=>Math.abs(o-e.getPosition())>.05)),l=this.value.getComponents()[0].getComponents().every(((e,t,i)=>Math.abs(a-e.getPosition())>.1));n&&l&&(this.value.generateColor(o,a),this.configureSliders(this.value.getComponents().length-1,this.value.getComponents()[0].getComponents().length-1),this.drawCanvas(1),this.onchange(this.value))}}setRipple(e){return this.temporalFormRangeLabel.innerText=this.temporalFormRange.value,this.spatialFormRangeLabel.innerText=this.spatialFormRange.value,this.value.setRipple(this.temporalFormRange.valueAsNumber,this.spatialFormRange.valueAsNumber),this.drawCanvas(e),1===e?this.onchange(this.value):this.oninput(this.value),null}inverted(e,t){return this.setValue(this.value.inverted(e,t)),this.onchange(this.value),null}setTemporalColorLabel(e,t,i){let s=this.querySelector(".temporal-color-label");return s.setAttribute("data-token-lang-inner_text",e),s.innerHTML=Z4MessageFactory.get(e),s.style.fontWeight=t?"700":"400",s.style.fontStyle=i?"italic":"normal",this}setColorLabel(e,t,i){return this.z4ColorUI.setColorLabel(e,t,i),this}setValue(e){return this.value=e,this.temporalMirroredCheck.checked=this.value.isTemporalyMirrored(),this.spatialMirroredCheck.checked=this.value.isSpatialyMirrored(),this.temporalFormRange.valueAsNumber=this.value.getTemporalRipple(),this.temporalFormRangeLabel.innerText=this.temporalFormRange.value,this.spatialFormRange.valueAsNumber=this.value.getSpatialRipple(),this.spatialFormRangeLabel.innerText=this.spatialFormRange.value,this.configureSliders(-1,-1),this.drawCanvas(1),this}configureSliders(e,t){let i=Z4TemporalColorUI.WIDTH/(this.value.isTemporalyMirrored()?2:1),s=Z4TemporalColorUI.HEIGHT/(this.value.isSpatialyMirrored()?2:1),r=this.value.isSpatialyMirrored()?Z4TemporalColorUI.HEIGHT/2:0;this.sliders.innerHTML="",this.value.getComponents().forEach(((o,a,n)=>{let l=o.getPosition(),h=i*l-8;o.getComponents().forEach(((i,o,n)=>{let u=i.getPosition(),c=r-8+s*(1-u)-16*(o+n.length*a),g=document.createElement("input");g.setAttribute("class","form-check-input"),g.setAttribute("type","radio"),g.setAttribute("name","colors_"+this.key),g.setAttribute("value",l+"-"+u),g.setAttribute("T",""+l),g.setAttribute("S",""+u),g.setAttribute("style","margin-top:0px;position:relative;left:"+h+"px;top:"+c+"px"),0!==a&&1!==a&&0!==o&&1!==o?g.style.cursor="move":0!==a&&1!==a?g.style.cursor="ew-resize":0!==o&&1!==o&&(g.style.cursor="ns-resize"),g.onchange=e=>(this.z4ColorUI.setValue(Z4Color.fromZ4AbstractColor(i)),0!==a&&1!==a||0!==o&&1!==o?this.del.removeAttribute("disabled"):this.del.setAttribute("disabled",""),null),Z4Loader.touch?(g.ontouchstart=e=>this.manageEvent(e,!0,!1,a,o,g,e.changedTouches[0].clientX,e.changedTouches[0].clientY),g.ontouchmove=e=>this.manageEvent(e,this.mouseDown,!0,a,o,g,e.changedTouches[0].clientX,e.changedTouches[0].clientY),g.ontouchend=e=>this.manageEvent(e,!1,!1,a,o,g,e.changedTouches[0].clientX,e.changedTouches[0].clientY),g.ontouchcancel=e=>this.manageEvent(e,!1,!1,a,o,g,e.changedTouches[0].clientX,e.changedTouches[0].clientY)):(g.onmousedown=e=>this.manageEvent(e,!0,!1,a,o,g,e.clientX,e.clientY),g.onmousemove=e=>this.manageEvent(e,this.mouseDown,!0,a,o,g,e.clientX,e.clientY),g.onmouseup=e=>this.manageEvent(e,!1,!1,a,o,g,e.clientX,e.clientY),g.onmouseleave=e=>this.manageEvent(e,!1,!1,a,o,g,e.clientX,e.clientY)),-1!==e&&-1!==t&&a===e&&o===t?(g.setAttribute("checked",""),this.z4ColorUI.setValue(Z4Color.fromZ4AbstractColor(i)),this.del.removeAttribute("disabled")):-1===e&&-1===t&&0===a&&0===o&&(g.setAttribute("checked",""),this.z4ColorUI.setValue(Z4Color.fromZ4AbstractColor(i)),this.del.setAttribute("disabled","")),this.sliders.appendChild(g)}))}))}manageEvent(e,t,i,s,r,o,a,n){return e.stopPropagation(),this.mouseDown&&!t&&(this.drawCanvas(1),this.onchange(this.value)),this.mouseDown=t,i&&this.mouseDown&&(0!==s&&1!==s||0!==r&&1!==r)&&this.moveColor(o,s,r,a,n),null}moveColor(e,t,i,s,r){s-=this.canvas.getBoundingClientRect().left,r-=this.canvas.getBoundingClientRect().top;let o=Z4TemporalColorUI.WIDTH/(this.value.isTemporalyMirrored()?2:1),a=Z4TemporalColorUI.HEIGHT/(this.value.isSpatialyMirrored()?2:1),n=this.value.isSpatialyMirrored()?Z4TemporalColorUI.HEIGHT/2:0,l=0!==t&&1!==t&&0!==i&&1!==i&&s<o&&n<r&&r<n+a,h=0!==t&&1!==t&&s<o,u=0!==i&&1!==i&&n<r&&r<n+a,c=s/o,g=(a-r+n)/a,d=this.value.getComponents().every(((e,i,s)=>i===t||Math.abs(c-e.getPosition())>.05)),m=this.value.getComponents()[0].getComponents().every(((e,t,s)=>t===i||Math.abs(g-e.getPosition())>.1)),p=parseFloat(e.getAttribute("T")),S=parseFloat(e.getAttribute("S")),v=o*c-8,Z=n-8+a*(1-g)-16*(i+this.value.getComponents()[0].getComponents().length*t);l?d&&m&&(this.move(e,p,S,c,g,v,Z,n,a),this.value.move(p,c,S,g),this.drawCanvas(5),this.oninput(this.value)):h?d&&(this.move(e,p,S,c,S,v,parseFloat(e.style.top.replace("px","")),n,a),this.value.move(p,c,-1,-1),this.drawCanvas(5),this.oninput(this.value)):u&&m&&(this.move(e,p,S,p,g,parseFloat(e.style.left.replace("px","")),Z,n,a),this.value.move(p,c,S,g),this.drawCanvas(5),this.oninput(this.value))}move(e,t,i,s,r,o,a,n,l){this.value.getComponents().forEach(((e,a,h)=>{let u=e.getPosition();e.getComponents().forEach(((e,h,c)=>{let g=e.getPosition();if(u===t||g===i){let e=this.querySelector(".sliders input[value='"+u+"-"+g+"']");if(0!==u&&1!==u&&u===t&&(e.setAttribute("value",s+"-"+g),e.setAttribute("T",""+s),e.style.left=o+"px"),0!==g&&1!==g&&g===i){let t=n-8+l*(1-r)-16*(h+c.length*a);e.setAttribute("value",u+"-"+r),e.setAttribute("S",""+r),e.style.top=t+"px"}}}))})),e.setAttribute("value",s+"-"+r),e.setAttribute("T",""+s),e.setAttribute("S",""+r),e.style.left=o+"px",e.style.top=a+"px"}drawCanvas(e){this.canvas.width=Math.floor(Z4TemporalColorUI.WIDTH*window.devicePixelRatio),this.canvas.height=Math.floor(Z4TemporalColorUI.HEIGHT*window.devicePixelRatio);let t=new OffscreenCanvas(Z4TemporalColorUI.WIDTH,Z4TemporalColorUI.HEIGHT),i=t.getContext("2d");for(let t=0;t<Z4TemporalColorUI.WIDTH;t+=e){let s=this.value.getZ4GradientColorAt(t/Z4TemporalColorUI.WIDTH,!0,!0);for(let r=0;r<Z4TemporalColorUI.HEIGHT;r+=e)i.fillStyle=s.getZ4ColorAt(r/Z4TemporalColorUI.HEIGHT,!0,!0).getHEX(),i.fillRect(t,Z4TemporalColorUI.HEIGHT-r-e,e,e)}this.ctx.save(),this.ctx.scale(window.devicePixelRatio,window.devicePixelRatio),this.ctx.fillStyle=this.chessboard,this.ctx.fillRect(0,0,Z4TemporalColorUI.WIDTH,Z4TemporalColorUI.HEIGHT),this.ctx.drawImage(t,0,0),this.ctx.restore()}}class Z4TemporalColorGuidedTourUI extends Z4TemporalColorUI{options=new Object;element1=null;element2=null;event=null;message=null;i=document.createElement("i");constructor(){super(),this.querySelector(".dropdown-divider").remove(),this.querySelector(".temporal-guided-tour").remove();let e=document.createElement("div");e.setAttribute("style","float:right"),this.querySelector(".canvas-container div div:nth-child(3)").appendChild(e),this.i.className="bi bi-arrow-left-circle",this.i.setAttribute("style","font-size:30px;border-radius:48px;position:relative;top:50px;padding:0px 5px;visibility:hidden"),e.appendChild(this.i),this.options.once=!0,this.doStep(0)}static show(){Z4ModalMessageUI.showInfo(Z4MessageFactory.get("TITLE"),"",(()=>{document.querySelector(".modal-dialog").classList.remove("modal-lg"),document.querySelector(".modal-message").innerHTML="",document.querySelector(".modal-dialog .modal-footer").innerHTML=""}));let e=document.createElement("label");e.className="z4-guided-tour",document.querySelector(".modal-dialog").classList.add("modal-lg"),document.querySelector(".modal-dialog .modal-footer").insertBefore(e,document.querySelector(".modal-dialog .modal-footer button")),(new Z4TemporalColorGuidedTourUI).appendToElement(document.querySelector(".modal-message"))}doStep(e){switch(e){case 0:this.element1=this.element2=this.querySelector(".form-check-input[value='1-1']"),this.event="change",this.message=Z4MessageFactory.get("GUIDED_TOUR_TEMPORAL_SELECT_COLOR");break;case 1:this.element1=this.element2=this.querySelector(".form-control-color"),this.event="input",this.message=Z4MessageFactory.get("GUIDED_TOUR_TEMPORAL_EDIT_COMPONENTS1");break;case 2:this.element1=this.querySelector(".dropdown-toggle-split"),this.element2=this.querySelector(".dropdown-menu .form-range"),this.event="input",this.message=Z4MessageFactory.get("GUIDED_TOUR_TEMPORAL_EDIT_OPACITY");break;case 3:this.i.style.visibility="visible",this.element1=this.querySelector(".bi-arrow-left-circle"),this.element2=this.querySelector(".canvas"),this.event=Z4Loader.touch?"touchstart":"mousedown",this.message=Z4MessageFactory.get("GUIDED_TOUR_TEMPORAL_ADD_COLOR");break;case 4:this.i.style.visibility="hidden",this.element1=this.element2=this.querySelector(".form-control-color"),this.event="input",this.message=Z4MessageFactory.get("GUIDED_TOUR_TEMPORAL_EDIT_COMPONENTS2");break;case 5:this.element1=this.element2=this.querySelector(".form-check-input:nth-child(9)"),this.event=Z4Loader.touch?"touchend":"mouseup",this.message=Z4MessageFactory.get("GUIDED_TOUR_TEMPORAL_MOVE");break;case 6:this.element1=this.querySelector(".z4-dropdown-toggle-three-dots"),this.element2=this.querySelector(".spatial-inverted"),this.event="click",this.message=Z4MessageFactory.get("GUIDED_TOUR_TEMPORAL_INVERT_SPATIAL");break;case 7:this.element1=this.querySelector(".z4-dropdown-toggle-three-dots"),this.element2=this.querySelector(".temporal-inverted"),this.event="click",this.message=Z4MessageFactory.get("GUIDED_TOUR_TEMPORAL_INVERT_TEMPORAL");break;case 8:this.element1=this.querySelector(".z4-dropdown-toggle-three-dots"),this.element2=this.querySelector(".temporal-negative"),this.event="click",this.message=Z4MessageFactory.get("GUIDED_TOUR_TEMPORAL_NEGATIVIZE");break;case 9:this.element1=this.element2=this.querySelector(".temporal-mirrored-check"),this.event="change",this.message=Z4MessageFactory.get("GUIDED_TOUR_TEMPORAL_MIRROR_TEMPORAL");break;case 10:this.element1=this.element2=this.querySelector(".spatial-mirrored-check"),this.event="change",this.message=Z4MessageFactory.get("GUIDED_TOUR_TEMPORAL_MIRROR_SPATIAL");break;case 11:this.element1=this.element2=this.querySelector(".form-range-spatial"),this.event="input",this.message=Z4MessageFactory.get("GUIDED_TOUR_TEMPORAL_ADD_RIPPLE_SPATIAL");break;case 12:this.element1=this.element2=this.querySelector(".form-range-temporal"),this.event="input",this.message=Z4MessageFactory.get("GUIDED_TOUR_TEMPORAL_ADD_RIPPLE_TEMPORAL");break;default:this.element1=null,this.message=Z4MessageFactory.get("GUIDED_TOUR_COMPLETED")}let t=document.querySelector(".modal-dialog .modal-footer label");this.element1?(this.element1.classList.add("z4-guided-tour"),this.element2.classList.add("z4-guided-tour"),this.element2.addEventListener(this.event,(t=>{this.element1.classList.remove("z4-guided-tour"),this.element2.classList.remove("z4-guided-tour"),this.doStep(e+1)}),this.options)):t&&(t.className=""),t?t.innerHTML=this.message:console.log(this.message)}}class Z4Painter{draw(e,t,i){}getColor(e){return e}}class Z4ArrowPainter extends Z4Painter{bool=!1;draw(e,t,i){this.bool=!this.bool;let s=t.getIntensity()*t.getZ4Vector().getModule();return e.save(),e.lineWidth=1,e.strokeStyle=this.getColor("black"),e.beginPath(),e.arc(0,0,2,0,Z4Math.TWO_PI),e.stroke(),e.strokeStyle=this.getColor(this.bool?"blue":"red"),e.beginPath(),e.moveTo(0,0),e.lineTo(s,0),e.lineTo(s-5,-2.5),e.lineTo(s-5,2.5),e.lineTo(s,0),e.stroke(),e.restore(),this}}class Z4ClassicPainter extends Z4Painter{draw(e,t,i){return this}}class Z4Shape2DPainter extends Z4Painter{shape=Z4Shape2D.SQUARE;size=(new Z4FancifulValue).setConstant((new Z4SignedValue).setValue(50).setSign(Z4Sign.POSITIVE));shadowShiftX=new Z4FancifulValue;shadowShiftY=new Z4FancifulValue;shadowColor=new Z4Color(255,0,0,0);borderSize=new Z4FancifulValue;borderColor=new Z4Color(255,0,0,0);setShape2D(e){return this.shape=e,this}draw(e,t,i){if(t.isDrawBounds())this.drawBounds(e,t.getIntensity()*(t.isUseVectorModuleAsSize()?2*t.getZ4Vector().getModule():this.size.getConstant().getValue()));else{let s=t.getIntensity()*(t.isUseVectorModuleAsSize()?2*t.getZ4Vector().getModule():this.size.next(0));if(s<=0)return this;let r=t.getIntensity()*this.shadowShiftX.next(0),o=t.getIntensity()*this.shadowShiftY.next(0),a=t.getIntensity()*this.borderSize.next(0);(r||o)&&(e.save(),e.translate(r,o),this.drawPath(e,s+(a>0?a:0),this.shadowColor),e.restore()),a&&(e.save(),this.drawPath(e,s+a,this.borderColor),e.restore());let n=t.getColorPosition(),l=t.getLighting();if(-1===n)for(let t=s;t>0;t--)this.drawPath(e,t,i.getZ4ColorAt(t/s,!0,!0));else if(l===Z4Lighting.NONE)this.drawPath(e,s,i.getZ4ColorAt(n,!0,!0));else{let t=i.getZ4ColorAt(n,!0,!0);for(let i=s;i>0;i--)l===Z4Lighting.LIGTHED?this.drawPath(e,i,Z4Color.fromARGB(t.getARGB()).lighted(i/s)):l===Z4Lighting.DARKENED&&this.drawPath(e,i,Z4Color.fromARGB(t.getARGB()).darkened(i/s))}}return this}drawPath(e,t,i){e.save(),e.scale(t,t),e.fillStyle=i.getHEX(),e.fill(this.shape.getPath()),e.restore()}drawBounds(e,t){e.save(),e.scale(t,t),e.lineWidth=1/t,e.strokeStyle=this.getColor("gray"),e.stroke(this.shape.getPath()),e.strokeStyle=this.getColor("black"),e.translate(1/t,1/t),e.stroke(this.shape.getPath()),e.restore()}}class Z4NaturalFigurePainter extends Z4Painter{draw(e,t,i){return this}}class Z4CenteredFigurePainter extends Z4Painter{draw(e,t,i){return this}}class Z4Action{static START=new Z4Action;static CONTINUE=new Z4Action;static STOP=new Z4Action;constructor(){}}class Z4PointIterator{progression=Z4Progression.SPATIAL;temporalStepProgression=.1;lighting=Z4Lighting.NONE;rotation=Z4Rotation.fixed();z4Point=new Z4Point;P=new Object;hasNext=!1;constructor(){this.P.x=0,this.P.y=0}seProgression(e,t,i){return this.progression=e,this.temporalStepProgression=t,this.lighting=i,this}setRotation(e){return this.rotation=e,this}getRotation(){return this.rotation}draw(e,t,i){}next(){}drawDemo(e,t,i){}getColor(e){return e}}class Z4Stamper extends Z4PointIterator{intensity=(new Z4FancifulValue).setConstant((new Z4SignedValue).setValue(15).setSign(Z4Sign.POSITIVE));multiplicity=(new Z4FancifulValue).setConstant((new Z4SignedValue).setValue(1).setSign(Z4Sign.POSITIVE));push=(new Z4FancifulValue).setConstant((new Z4SignedValue).setValue(0).setSign(Z4Sign.POSITIVE));currentMultiplicityCounter=0;currentMultiplicityTotal=0;currentPush=0;draw(e,t,i){return e===Z4Action.START&&(this.currentMultiplicityCounter=0,this.currentMultiplicityTotal=parseInt(this.multiplicity.next(0)),this.currentPush=this.push.next(0),this.P.x=t,this.P.y=i,this.hasNext=!0,!0)}getIntensity(){return this.intensity}getMultiplicity(){return this.multiplicity}getPush(){return this.push}next(){if(this.hasNext){this.currentMultiplicityCounter++,this.hasNext=this.currentMultiplicityCounter<this.currentMultiplicityTotal;let e=this.rotation.next(0);if(this.currentPush){let t=Z4Vector.fromVector(this.P.x,this.P.y,this.currentPush,e);this.z4Point.setZ4Vector(Z4Vector.fromVector(t.getX(),t.getY(),this.intensity.next(0),e))}else this.z4Point.setZ4Vector(Z4Vector.fromVector(this.P.x,this.P.y,this.intensity.next(0),e));if(this.rotation.nextSide(this.z4Point,null),this.progression===Z4Progression.TEMPORAL){this.z4Point.setLighting(this.lighting);let e=this.z4Point.getColorPosition();e=-1===e?0:e+this.temporalStepProgression,e>1&&(e-=1),this.z4Point.setColorPosition(e)}else this.progression===Z4Progression.SPATIAL?(this.z4Point.setLighting(Z4Lighting.NONE),this.z4Point.setColorPosition(-1)):this.progression!==Z4Progression.RELATIVE_TO_PATH&&this.progression!==Z4Progression.RANDOM||(this.z4Point.setLighting(this.lighting),this.z4Point.setColorPosition(Math.random()));return this.z4Point}return null}drawDemo(e,t,i){let s=new Z4ArrowPainter,r=new Z4GradientColor;this.initDraw(t,i).forEach((t=>{this.draw(Z4Action.START,t.x,t.y),this.currentPush&&!this.currentMultiplicityCounter&&(e.save(),e.lineWidth=1,e.fillStyle=this.getColor("black"),e.beginPath(),e.arc(this.P.x,this.P.y,2,0,Z4Math.TWO_PI),e.fill(),e.restore());let i=null;for(;null!==(i=this.next());){let t=i.getZ4Vector();e.save(),e.translate(t.getX0(),t.getY0()),e.rotate(t.getPhase()),s.draw(e,i,r),e.restore()}}))}initDraw(e,t){let i=new Array;for(let s=50;s<=e-50;s+=100)for(let e=50;e<=t-50;e+=100){let t=new Object;t.x=s,t.y=e,i.push(t)}return i}}class Z4StamperUI extends Z4AbstractComponentWithValueUI{intensity=(new Z4FancifulValueUI).setValueLabel("INTENSITY",!0,!0).setComponentsVisible(!0,!0,!1).setSignsVisible(!1,!0,!0).appendToElement(this.querySelector(".stamper-container"));rotation=(new Z4RotationUI).setValueLabel("ROTATION",!0,!0).appendToElement(this.querySelector(".stamper-container"));multiplicity=(new Z4FancifulValueUI).setValueLabel("MULTIPLICITY",!0,!0).setComponentsVisible(!0,!0,!1).setSignsVisible(!1,!0,!0).setConstantRange(1,999999999).appendToElement(this.querySelector(".stamper-container"));push=(new Z4FancifulValueUI).setValueLabel("PUSH",!0,!0).setComponentsVisible(!0,!0,!1).setSignsVisible(!1,!0,!0).appendToElement(this.querySelector(".stamper-container"));static UI=Z4HTMLFactory.get("giada/pizzapazza/iterator/ui/Z4StamperUI.html");constructor(){super(Z4StamperUI.UI),this.setValue(new Z4Stamper)}setValue(e){return this.value=e,this.intensity.setValue(this.value.getIntensity()),this.rotation.setValue(this.value.getRotation()),this.multiplicity.setValue(this.value.getMultiplicity()),this.push.setValue(this.value.getPush()),this}}
//# sourceMappingURL=bundle-0.10.0.min.js.map